const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-RemoveFromExchangeModal-DZr326W8.js","assets/chunk-state-1lfzh_F6.js","assets/index-DqvBsTHA.js","assets/chunk-router-BHRPxDXG.js","assets/chunk-validation-Cdg1t4SS.js","assets/index-CSgXCPkN.css","assets/chunk-ModalErrorBoundary-Ds39JdOD.js"])))=>i.map(i=>d[i]);
import{c as X,aR as ge,ar as le,aS as pt,aT as xt,aU as yt,f as bt,e as U,aV as Tt,ay as vt,q as Q,a3 as $,aW as Et,o as Ke,p as de,N as _e,ap as Mt,aq as St,D as Ct,t as he,v as pe,w as xe,I as fe,as as qe,r as kt,u as ee,E as wt,F as Nt,aX as _t,h as ie,ad as We,ag as At,aY as Ae,aP as Qe,K as Dt,aZ as It,O as Ft,P as De,Q as jt,R as Lt,_ as Ve}from"./index-DqvBsTHA.js";import{b as ze,a as i,u as ye,j as t,d as Ot}from"./chunk-state-1lfzh_F6.js";import{u as te,i as be,c as Xe}from"./chunk-ojp-client-BsltjT2J.js";import{h as Ye,a as Ze,b as Je,s as et,M as Te,T as J,B as Ie,f as Rt,N as Gt,d as Pt,e as $t}from"./chunk-useTravelTime-B-0fJR5i.js";import{g as Ut,E as Bt,M as Ht,F as Kt,C as qt,u as Fe,a as je,P as Wt,T as Qt,b as Vt,W as zt,S as Xt}from"./chunk-ModalErrorBoundary-Ds39JdOD.js";import{r as Yt}from"./chunk-router-BHRPxDXG.js";import{T as Zt}from"./chunk-pdf-form-filler-Cw4AEX4e.js";const Jt=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],tt=X("award",Jt);const ea=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m17 22 5-5",key:"1k6ppv"}],["path",{d:"m17 17 5 5",key:"p7ous7"}]],at=X("calendar-x-2",ea);const ta=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],aa=X("car",ta);const na=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],sa=X("loader-circle",na);const ra=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],oa=X("sliders-horizontal",ra);const ia=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ve=X("user",ia),ca=100,la=3,da=1e4,ua=1e3,ma=1e5,fa=5,ne=10,ga=5,ha=6,pa=100,xa=10;function ya(e){const s=e/40*bt;return Math.round(15+s)}function ba(e){return e<pt?0:e<xt?1:e<yt?2:la}function Ta(e){return new Promise(n=>setTimeout(n,e))}function Le(e){const n=Math.abs(Math.round(e.latitude*da)),a=Math.abs(Math.round(e.longitude*ua)),s=(n+a)%ma;return`85${String(s).padStart(fa,"0")}`}function Oe(e){const n=Math.round(e.latitude*ne)/ne,a=Math.round(e.longitude*ne)/ne;return`Station ${n}N ${a}E`}async function nt(e,n,a={}){await Ta(ca);const s=ge(e,n),o=ya(s),c=ba(s),r=a.departureTime??new Date,p=new Date(r.getTime()+o*le),l={id:Le(e),name:a.originLabel??Oe(e)},m={id:Le(n),name:a.destinationLabel??Oe(n)},d=Math.abs(Math.round(n.latitude*pa+n.longitude*xa))%ha,u=ga+d;return{durationMinutes:o,departureTime:r.toISOString(),arrivalTime:p.toISOString(),transfers:c,originStation:l,destinationStation:m,finalWalkingMinutes:u,tripData:void 0}}const st=60,Ee=5,Re=60,z=6e4;function va(e,n=st,a){const s=new Map,o=[...e].sort((c,r)=>new Date(c.startTime).getTime()-new Date(r.startTime).getTime());for(let c=0;c<o.length;c++){const r=o[c],p=new Date(r.startTime),l=new Date(r.endTime);for(let m=c+1;m<o.length;m++){const d=o[m],u=new Date(d.startTime),b=new Date(d.endTime),M=(u.getTime()-l.getTime())/z;if(!a&&M>=n)break;const x=(p.getTime()-b.getTime())/z,S=Math.max(M,x);if(a?a(r,d):S<n){const D={assignmentId:r.gameId,conflictingAssignmentId:d.gameId,gapMinutes:Math.round(M),conflictingAssignment:{gameId:d.gameId,homeTeam:d.homeTeam,awayTeam:d.awayTeam,startTime:d.startTime,endTime:d.endTime,league:d.league,association:d.association,hallName:d.hallName}},y={assignmentId:d.gameId,conflictingAssignmentId:r.gameId,gapMinutes:Math.round(-M),conflictingAssignment:{gameId:r.gameId,homeTeam:r.homeTeam,awayTeam:r.awayTeam,startTime:r.startTime,endTime:r.endTime,league:r.league,association:r.association,hallName:r.hallName}},h=s.get(r.gameId)??[];h.push(D),s.set(r.gameId,h);const C=s.get(d.gameId)??[];C.push(y),s.set(d.gameId,C)}}}return s}function An(e){const n=e<0,a=Math.abs(e),s=Math.floor(a/Re),o=a%Re;return{type:n?"overlap":"gap",hours:s,minutes:o}}function Ea(e={}){const{thresholdMinutes:n=st,sameLocationDistanceKm:a=Ee}=e;return(s,o)=>{const c=new Date(s.startTime).getTime(),r=new Date(s.endTime).getTime(),p=new Date(o.startTime).getTime(),l=new Date(o.endTime).getTime(),m=n*z,d=p-r,u=c-l;return!(Math.max(d,u)>=m||s.coordinates&&o.coordinates&&ge(s.coordinates,o.coordinates)<=a)}}const Ma=90;function Sa(e,n,a){const s=typeof a=="number"?{minGapMinutes:a}:a,{minGapMinutes:o,venueCoordinates:c=null,sameLocationDistanceKm:r=Ee}=s;if(!e||n.length===0)return!0;const p=new Date(e).getTime();if(isNaN(p))return!0;const l=p+Ma*z;for(const m of n){const d=new Date(m.startTime).getTime(),u=new Date(m.endTime).getTime();if(isNaN(d)||isNaN(u))continue;const b=(d-l)/z,M=(p-u)/z;if(!(Math.max(b,M)>=o)&&!(c&&m.coordinates&&ge(c,m.coordinates)<=r))return!1}return!0}const Ca=60,ka=5,wa=5,Na=6e4,_a=wa*Na,Aa=new Map;function rt(e={}){const n=typeof e=="number"?{thresholdMinutes:e}:e,{thresholdMinutes:a=Ca,sameLocationDistanceKm:s=ka,useSmartConflictDetection:o=!0,evaluator:c}=n,r=c||(o?Ea({thresholdMinutes:a,sameLocationDistanceKm:s}):void 0),p=U(b=>b.calendarCode),l=U(b=>b.status==="authenticated"),m=U(b=>b.dataSource==="demo"),d=ze({queryKey:m?Q.calendar.assignmentsByCode("demo"):Q.calendar.assignmentsByCode(p??""),queryFn:({signal:b})=>m?Promise.resolve(Tt()):p?vt(p,b):Promise.resolve([]),enabled:m||l&&!!p,staleTime:_a,placeholderData:[]});return{conflicts:i.useMemo(()=>!d.data||d.data.length===0?Aa:va(d.data,a,r),[d.data,a,r]),assignments:d.data??[],isLoading:d.isLoading,isError:d.isError,error:d.error,hasCalendarCode:m||!!p}}function Dn(e){const{conflicts:n,isLoading:a,hasCalendarCode:s}=rt();return{conflicts:i.useMemo(()=>e?n.get(e)??[]:[],[n,e]),isLoading:a,hasCalendarCode:s}}const ue="85",Da=7,Ia=5;function Ge(e){return e.startsWith(ue)&&e.length===Da?e:/^\d+$/.test(e)&&!e.startsWith(ue)?`${ue}${e.padStart(Ia,"0")}`:e}function Fa(e){const n=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear();return`${n}.${a}.${s}`}function ja(e){const n=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${n}:${a}`}function se(e){const{destination:n,date:a,arrivalTime:s,language:o="de",originStation:c,destinationStation:r,originAddress:p,destinationAddress:l}=e,m=Fa(a),d=ja(s),u=c?.name??p,b=l??r?.name??n,M=`datum=${m}&zeit=${d}&an=true&suche=true`;if(c&&r&&!l){const S=[{value:Ge(c.id),type:"ID",label:c.name},{value:Ge(r.id),type:"ID",label:r.name}],v=encodeURIComponent(JSON.stringify(S));return`https://www.sbb.ch/${o}?stops=${v}&${M}`}const x=new URLSearchParams;return u&&x.set("von",u),x.set("nach",b),`https://www.sbb.ch/${o}?${x.toString()}&${M}`}function La(e,n){const a=typeof e=="string"?new Date(e):e;return new Date(a.getTime()-n*le)}function re(e){window.open(e,"_blank","noopener,noreferrer")}const Oa=6e4;function Pe(e,n,a,s){const o=La(e,n);return a&&s>0?new Date(o.getTime()-s*Oa):o}function oe(e,n,a,s,o,c,r,p){return{destination:e,date:n,arrivalTime:a,language:s,originStation:r,destinationStation:p,originAddress:o,destinationAddress:c}}async function Ra(e,n,a,s,o,c){const r=Ye(e),p=Ze(s),l=Je(a,r,p);if(l)return l;const m={latitude:e.latitude,longitude:e.longitude};let d;return be()?d=await Xe(m,n,{targetArrivalTime:c}):d=await nt(m,n,{originLabel:"Home",destinationLabel:o}),et(a,r,p,d),d}function Ga(e){const{hallCoords:n,hallId:a,city:s,hallAddress:o,gameStartTime:c,language:r}=e,[p,l]=i.useState(!1),[m,d]=i.useState(null),[u,b]=i.useState(),[M,x]=i.useState(),[S,v]=i.useState(0),y=U(E=>E.dataSource)==="demo",h=$(E=>E.homeLocation),C=te(),w=$(E=>E.getArrivalBufferForAssociation(C)),g=$(E=>E.travelTimeFilter.sbbDestinationType??"address"),k=i.useCallback(async()=>{if(!s||!c)return;const E=new Date(c),N=g==="station",F=N?void 0:o??void 0,j=h?.source==="geocoded"?h.label:void 0,R=Pe(E,w,N,S);if(u&&M){const _=oe(s,E,R,r,j,F,u,M);re(se(_));return}if(!(h&&n&&a&&(y||be()))){const _=oe(s,E,R,r,j,F);re(se(_));return}l(!0),d(null);try{const _=await Ra(h,n,a,E,s,R);_.originStation&&b(_.originStation),_.destinationStation&&x(_.destinationStation),_.finalWalkingMinutes!==void 0&&v(_.finalWalkingMinutes);const G=_.finalWalkingMinutes??0,B=Pe(E,w,N,G),T=oe(s,E,B,r,j,F,_.originStation,_.destinationStation);re(se(T))}catch(_){d(_ instanceof Error?_:new Error("Failed to fetch trip data"));const G=oe(s,E,R,r,j,F);re(se(G))}finally{l(!1)}},[s,o,c,w,u,M,S,g,r,h,n,a,y]);return{isLoading:p,error:m,originStation:u,destinationStation:M,openSbbConnection:k}}function ce(e){if(!e)return null;if(e.latitude!=null&&e.longitude!=null)return{latitude:e.latitude,longitude:e.longitude};if(e.plusCode){const n=Et.decode(e.plusCode);if(n)return{latitude:n.latitude,longitude:n.longitude}}return null}function Pa(e){if(!e)return null;const n=e.postalCodeAndCity||(e.postalCode&&e.city?`${e.postalCode} ${e.city}`:e.city||null);return e.streetAndHouseNumber&&n?`${e.streetAndHouseNumber}, ${n}`:e.streetAndHouseNumber?e.combinedAddress&&e.combinedAddress!==e.streetAndHouseNumber?e.combinedAddress:null:e.combinedAddress||n}function $a(e){return e?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`:null}function Ua(e,n,a){const s=/iPad|iPhone|iPod/.test(navigator.userAgent);if(e)return s?`maps:?q=${encodeURIComponent(e)}`:`geo:0,0?q=${encodeURIComponent(e)}`;if(n){const{latitude:o,longitude:c}=n;return s?`maps:?q=${o},${c}&ll=${o},${c}`:`geo:${o},${c}?q=${o},${c}(${encodeURIComponent(a)})`}return null}function Ba(e,n){const a=e?.geographicalLocation?.plusCode,s=$a(a),o=Pa(e),c=e?.geographicalLocation?.latitude,r=e?.geographicalLocation?.longitude,l=Ua(o,c!==void 0&&r!==void 0?{latitude:c,longitude:r}:null,n);return{googleMapsUrl:s,nativeMapsUrl:l,fullAddress:o}}const W=kt("useExchanges"),$e=e=>fe(e,"yyyy-MM-dd"),Ue=[];function Ha(e="all"){const n=U(x=>x.dataSource),a=n==="demo",s=U(x=>x.activeOccupationId),o=U(x=>x.user?.id),c=Ke(x=>x.activeAssociationCode),r=de(n),p=a?c:s,l=$e(new Date),m=$e(_e().to),d=i.useMemo(()=>({from:St(new Date).toISOString(),to:Mt(_e().to).toISOString()}),[l,m]),u=i.useMemo(()=>[{propertyName:"refereeGame.game.startingDateTime",dateRange:d},{propertyName:"status",enumValues:["open"]}],[d]),b=i.useMemo(()=>({offset:0,limit:Ct,propertyFilters:u,propertyOrderings:[{propertyName:"refereeGame.game.startingDateTime",descending:!1,isSetByUser:!0}]}),[u]),M=i.useMemo(()=>x=>{const S=x.items??Ue;if(e==="mine"){const v=a?qe:o;return v?S.filter(D=>D.submittedByPerson?.__identity===v):Ue}return S},[e,a,o]);return ze({queryKey:Q.exchanges.list(b,p),queryFn:()=>r.searchExchanges(b),select:M,staleTime:2*le,placeholderData:x=>x})}function Ka(){const e=ye(),n=U(y=>y.dataSource),a=he(),{refresh:s}=pe(),o=de(n),[c,r]=i.useState(!1),[p,l]=i.useState(!1),[m,d]=i.useState(!1),[u,b]=i.useState(null),[M,x]=i.useState(!1),S=i.useCallback(()=>{r(!1),l(!1),d(!1),b(null),x(!1)},[]),v=i.useCallback(async y=>{S(),r(!0);try{if(a){W.debug("Applying for exchange (online):",{exchangeId:y});const h=await o.applyForExchange(y);return await e.invalidateQueries({queryKey:Q.exchanges.lists()}),l(!0),x(!1),h}else{if(W.debug("Queueing exchange application (offline):",{exchangeId:y}),!await xe("applyForExchange",{exchangeId:y}))throw new Error("Failed to queue action - IndexedDB unavailable");return await s(),l(!0),x(!0),null}}catch(h){const C=h instanceof Error?h:new Error(String(h));throw W.error("Failed to apply for exchange:",C),d(!0),b(C),C}finally{r(!1)}},[a,o,e,s,S]);return{mutate:i.useCallback((y,h)=>{v(y).then(C=>{h?.onSuccess?.(C)}).catch(C=>{h?.onError?.(C)})},[v]),mutateAsync:v,isPending:c,isSuccess:p,isError:m,error:u,reset:S,wasQueued:M}}function qa(){const e=ye(),n=U(y=>y.dataSource),a=he(),{refresh:s}=pe(),o=de(n),[c,r]=i.useState(!1),[p,l]=i.useState(!1),[m,d]=i.useState(!1),[u,b]=i.useState(null),[M,x]=i.useState(!1),S=i.useCallback(()=>{r(!1),l(!1),d(!1),b(null),x(!1)},[]),v=i.useCallback(async y=>{S(),r(!0);try{if(a)W.debug("Removing own exchange (online):",{convocationId:y}),await o.removeOwnExchange(y),await e.invalidateQueries({queryKey:Q.exchanges.lists()}),await e.invalidateQueries({queryKey:Q.assignments.lists()}),l(!0),x(!1);else{if(W.debug("Queueing remove own exchange (offline):",{convocationId:y}),!await xe("removeOwnExchange",{convocationId:y}))throw new Error("Failed to queue action - IndexedDB unavailable");await s(),l(!0),x(!0)}}catch(h){const C=h instanceof Error?h:new Error(String(h));throw W.error("Failed to remove own exchange:",C),d(!0),b(C),C}finally{r(!1)}},[a,o,e,s,S]);return{mutate:i.useCallback((y,h)=>{v(y).then(()=>{h?.onSuccess?.()}).catch(C=>{h?.onError?.(C)})},[v]),mutateAsync:v,isPending:c,isSuccess:p,isError:m,error:u,reset:S,wasQueued:M}}function In(){const e=ye(),n=U(y=>y.dataSource),a=he(),{refresh:s}=pe(),o=de(n),[c,r]=i.useState(!1),[p,l]=i.useState(!1),[m,d]=i.useState(!1),[u,b]=i.useState(null),[M,x]=i.useState(!1),S=i.useCallback(()=>{r(!1),l(!1),d(!1),b(null),x(!1)},[]),v=i.useCallback(async y=>{S(),r(!0);try{if(a)W.debug("Adding to exchange (online):",{convocationId:y}),await o.addToExchange(y),await e.invalidateQueries({queryKey:Q.exchanges.lists()}),await e.invalidateQueries({queryKey:Q.assignments.lists()}),l(!0),x(!1);else{if(W.debug("Queueing add to exchange (offline):",{convocationId:y}),!await xe("addToExchange",{convocationId:y}))throw new Error("Failed to queue action - IndexedDB unavailable");await s(),l(!0),x(!0)}}catch(h){const C=h instanceof Error?h:new Error(String(h));throw W.error("Failed to add to exchange:",C),d(!0),b(C),C}finally{r(!1)}},[a,o,e,s,S]);return{mutate:i.useCallback((y,h)=>{v(y).then(()=>{h?.onSuccess?.()}).catch(C=>{h?.onError?.(C)})},[v]),mutateAsync:v,isPending:c,isSuccess:p,isError:m,error:u,reset:S,wasQueued:M}}function Wa({hideOwnActive:e,distanceActive:n,travelTimeActive:a,gameGapActive:s,levelActive:o}){const{t:c}=ee(),r=e||n||a||s||o,p=i.useMemo(()=>{const l=[];return e&&l.push(c("exchange.hideOwn")),n&&l.push(c("exchange.filterByDistance")),a&&l.push(c("exchange.filterByTravelTime")),s&&l.push(c("exchange.filterByGameGap")),o&&l.push(c("exchange.filterByLevel")),l.join(", ")},[e,n,a,s,o,c]);return r?t.jsxs("div",{className:"flex items-center gap-1",role:"img","aria-label":p,children:[e&&t.jsx("span",{className:"w-5 h-5 p-0.5 rounded-full bg-primary-100 text-primary-600 dark:bg-primary-900 dark:text-primary-300","aria-hidden":"true",children:t.jsx(ve,{className:"w-full h-full"})}),n&&t.jsx("span",{className:"w-5 h-5 p-0.5 rounded-full bg-primary-100 text-primary-600 dark:bg-primary-900 dark:text-primary-300","aria-hidden":"true",children:t.jsx(Te,{className:"w-full h-full"})}),a&&t.jsx("span",{className:"w-5 h-5 p-0.5 rounded-full bg-primary-100 text-primary-600 dark:bg-primary-900 dark:text-primary-300","aria-hidden":"true",children:t.jsx(J,{className:"w-full h-full"})}),s&&t.jsx("span",{className:"w-5 h-5 p-0.5 rounded-full bg-primary-100 text-primary-600 dark:bg-primary-900 dark:text-primary-300","aria-hidden":"true",children:t.jsx(at,{className:"w-full h-full"})}),o&&t.jsx("span",{className:"w-5 h-5 p-0.5 rounded-full bg-primary-100 text-primary-600 dark:bg-primary-900 dark:text-primary-300","aria-hidden":"true",children:t.jsx(tt,{className:"w-full h-full"})})]}):null}const Qa=i.memo(Wa);function Va({durationMinutes:e,isLoading:n=!1,isError:a=!1,className:s=""}){const{t:o}=ee();return n?t.jsx(Ie,{variant:"neutral",className:`animate-pulse ${s}`,children:t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(J,{className:"w-3 h-3","aria-hidden":"true"}),t.jsx("span",{children:"..."})]})}):a||e===void 0?null:t.jsx(Ie,{variant:"neutral",className:s,title:o("exchange.travelTime"),children:t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(J,{className:"w-3 h-3","aria-hidden":"true"}),t.jsx("span",{children:Rt(e)})]})})}const za=i.memo(Va),Xa=[{field:"activeFirstHeadRefereeName",labelKey:"positions.head-one"},{field:"activeSecondHeadRefereeName",labelKey:"positions.head-two"},{field:"activeFirstLinesmanRefereeName",labelKey:"positions.linesman-one"},{field:"activeSecondLinesmanRefereeName",labelKey:"positions.linesman-two"}];function Ya({exchange:e,disableExpansion:n,dataTour:a,carDistanceKm:s,travelTimeMinutes:o,travelTimeLoading:c}){const{t:r,tInterpolate:p,locale:l}=ee(),m=wt(),d=te(),u=e.refereeGame?.game,b=u?.startingDateTime?Nt(u.startingDateTime):null,M=i.useMemo(()=>{const A=e.refereeGame,K=e.submittedByPerson,H=K?`${K.firstName} ${K.lastName}`:null;return Xa.filter(({field:L})=>A?.[L]).map(({field:L,labelKey:ae})=>({labelKey:ae,name:A[L],isSubmitter:A[L]===H}))},[e.refereeGame,e.submittedByPerson]),x=u?.encounter?.teamHome?.name||r("common.tbd"),S=u?.encounter?.teamAway?.name||r("common.tbd"),v=u?.hall?.name||r("common.locationTbd"),D=u?.hall?.primaryPostalAddress,y=D?.city,{googleMapsUrl:h,nativeMapsUrl:C,fullAddress:w}=Ba(D,v),g=e.requiredRefereeLevel,k=Ut(e.refereePosition,r),E=u?.group?.phase?.league?.leagueCategory?.name,N=u?.group?.phase?.league?.gender,F=$(A=>A.isTransportEnabledForAssociation(d)),j=u?.hall?.primaryPostalAddress?.geographicalLocation,R=ce(j),q=u?.hall?.__identity,_=u?.startingDateTime,{isLoading:G,openSbbConnection:B}=Ga({hallCoords:R,hallId:q,city:y,hallAddress:w,gameStartTime:_,language:l}),T=F&&y&&_;return t.jsx(Bt,{data:e,disableExpansion:n,dataTour:a,renderCompact:(A,{expandArrow:K})=>t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xs text-text-muted dark:text-text-muted-dark min-w-[4.5rem] shrink-0",children:b?t.jsxs(t.Fragment,{children:[t.jsx("div",{children:fe(b,"EEE, MMM d",{locale:m})}),t.jsx("div",{className:"font-medium text-text-secondary dark:text-text-secondary-dark",children:fe(b,"HH:mm",{locale:m})})]}):r("common.tbd")}),t.jsxs("div",{className:"flex-1 min-w-0",children:[E&&t.jsxs("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate text-sm flex items-center gap-1",children:[t.jsx("span",{className:"truncate",children:E}),N==="m"&&t.jsx(Ht,{className:"w-3.5 h-3.5 text-blue-500 dark:text-blue-400 shrink-0","aria-label":r("common.men")}),N==="f"&&t.jsx(Kt,{className:"w-3.5 h-3.5 text-pink-500 dark:text-pink-400 shrink-0","aria-label":r("common.women")})]}),t.jsxs("div",{className:"text-xs text-text-muted dark:text-text-muted-dark truncate",children:[x," ",r("common.vs")," ",S]})]}),(s!=null||o!==void 0||c)&&t.jsxs("div",{className:"flex flex-col items-end gap-0.5 shrink-0",children:[s!=null&&t.jsxs("span",{className:"text-xs font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 px-2 py-0.5 rounded-full flex items-center gap-1",children:[t.jsx(aa,{className:"w-3 h-3","aria-hidden":"true"}),"~",s.toFixed(0)," ",r("common.distanceUnit")]}),(o!==void 0||c)&&t.jsx(za,{durationMinutes:o??void 0,isLoading:c})]}),t.jsx("div",{className:"flex items-center",children:K})]}),renderDetails:()=>t.jsxs("div",{className:"px-2 pb-2 pt-0 border-t border-border-subtle dark:border-border-subtle-dark space-y-1",children:[t.jsxs("div",{className:"flex items-start gap-2 text-sm text-text-muted dark:text-text-muted-dark pt-2",children:[t.jsx(Te,{className:"w-4 h-4 flex-shrink-0 mt-0.5","aria-hidden":"true"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark",children:v}),w&&(C?t.jsx("a",{href:C,className:"text-primary-600 dark:text-primary-400 hover:underline focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 rounded block",onClick:A=>A.stopPropagation(),"aria-label":p("assignments.openAddressInMaps",{address:w}),children:w}):t.jsx("span",{children:w}))]}),t.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[h&&t.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 hover:bg-primary-200 dark:hover:bg-primary-800/40 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 rounded-lg transition-colors",onClick:A=>A.stopPropagation(),title:r("assignments.openInGoogleMaps"),"aria-label":r("assignments.openInGoogleMaps"),children:t.jsx(Gt,{className:"w-5 h-5","aria-hidden":"true"})}),T&&t.jsx("button",{type:"button",className:"p-2 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 hover:bg-primary-200 dark:hover:bg-primary-800/40 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 rounded-lg transition-colors disabled:opacity-50",onClick:A=>{A.stopPropagation(),B()},disabled:G,title:r("assignments.openSbbConnection"),"aria-label":r("assignments.openSbbConnection"),children:G?t.jsx(sa,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}):t.jsx(J,{className:"w-5 h-5","aria-hidden":"true"})})]})]}),k&&t.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted dark:text-text-muted-dark",children:[t.jsx(ve,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),t.jsxs("div",{children:[t.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[r("common.position"),":"," "]}),t.jsx("span",{className:"font-medium text-text-primary dark:text-text-primary-dark",children:k})]})]}),g&&t.jsx("div",{className:"text-xs text-text-subtle dark:text-text-subtle-dark",children:p("exchange.levelRequired",{level:g})}),M.length>0&&t.jsx("div",{className:"text-xs text-text-muted dark:text-text-muted-dark space-y-0.5 pt-1",children:M.map(A=>t.jsxs("div",{className:"flex gap-1",children:[t.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[r(A.labelKey),":"]}),t.jsx("span",{className:A.isSubmitter?"italic text-primary-600 dark:text-primary-400":"",children:A.name})]},A.labelKey))})]})})}const Za=i.memo(Ya);function Ja({isOpen:e,onClose:n,titleId:a,children:s}){i.useEffect(()=>{if(!e)return;const c=window.scrollY,r={overflow:document.body.style.overflow,position:document.body.style.position,top:document.body.style.top,width:document.body.style.width};return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${c}px`,document.body.style.width="100%",()=>{document.body.style.overflow=r.overflow,document.body.style.position=r.position,document.body.style.top=r.top,document.body.style.width=r.width,window.scrollTo(0,c)}},[e]);const{handleBackdropClick:o}=_t({isOpen:e,onClose:n});return e?Yt.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[55]",children:[t.jsx("div",{className:"absolute inset-0 bg-black/50 transition-opacity","aria-hidden":"true",onClick:o}),t.jsx("div",{role:"dialog","aria-modal":"true","aria-labelledby":a,className:`
          fixed inset-x-0 bottom-0
          md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2
          max-h-[80vh] md:max-h-[70vh] md:max-w-lg md:w-full
          bg-surface-card dark:bg-surface-card-dark rounded-t-xl md:rounded-lg
          shadow-xl flex flex-col
          animate-in slide-in-from-bottom md:slide-in-from-bottom-0 md:fade-in
          duration-200
        `,children:s})]}),document.body):null}const Z=60;function Be(e,n,a=""){if(e<Z)return`${a}${e}${n.minutesUnit}`;const s=Math.floor(e/Z),o=e%Z;return o===0?`${a}${s}${n.hoursUnit}`:`${a}${s}${n.hoursUnit} ${o}${n.minutesUnit}`}const en=[10,25,50,75,100],tn=10,an=100,nn=[30,45,60,90,120],sn=30,rn=120,on=[60,90,120,150,180],cn=60,ln=180;function Y({icon:e,label:n,enabled:a,onToggle:s,value:o,children:c}){return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("button",{type:"button",role:"switch","aria-checked":a,"aria-label":n,onClick:s,className:"w-full flex items-center gap-3 p-3 rounded-lg bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark transition-colors",children:[t.jsx("span",{className:`w-5 h-5 flex-shrink-0 ${a?"text-primary-600 dark:text-primary-400":"text-text-muted dark:text-text-muted-dark"}`,children:e}),t.jsx("span",{className:`flex-1 text-left text-sm font-medium ${a?"text-text-primary dark:text-text-primary-dark":"text-text-muted dark:text-text-muted-dark"}`,children:n}),o&&a&&t.jsx("span",{className:"text-sm font-semibold text-primary-600 dark:text-primary-400",children:o}),t.jsx("div",{className:`w-10 h-6 rounded-full transition-colors relative ${a?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"}`,children:t.jsx("div",{className:`absolute top-1 w-4 h-4 rounded-full bg-white shadow transition-transform ${a?"translate-x-5":"translate-x-1"}`})})]}),a&&c&&t.jsx("div",{className:"px-3 pb-2",children:c})]})}function me({id:e,value:n,min:a,max:s,step:o,presets:c,formatPreset:r,onChange:p}){return t.jsxs("div",{className:"space-y-2",children:[t.jsx("input",{id:e,type:"range",min:a,max:s,step:o,value:n,onChange:p,className:"w-full h-2 bg-surface-muted dark:bg-surface-muted-dark rounded-lg appearance-none cursor-pointer accent-primary-600"}),t.jsx("div",{className:"flex justify-between text-xs text-text-muted dark:text-text-muted-dark",children:c.map(l=>t.jsx("span",{children:r(l)},l))})]})}function dn({hideOwnExchanges:e,onHideOwnToggle:n,isLevelFilterAvailable:a,isDistanceFilterAvailable:s,isTravelTimeFilterAvailable:o,isGameGapFilterAvailable:c,userRefereeLevel:r,dataTour:p}){const{t:l}=ee(),[m,d]=i.useState(!1),u=te(),{distanceFilter:b,distanceFilterByAssociation:M,setDistanceFilterEnabled:x,setDistanceFilterForAssociation:S,travelTimeFilter:v,setTravelTimeFilterEnabled:D,setMaxTravelTimeForAssociation:y,levelFilterEnabled:h,setLevelFilterEnabled:C,gameGapFilter:w,setGameGapFilterEnabled:g,setMinGameGapMinutes:k}=$(ie(T=>({distanceFilter:T.distanceFilter,distanceFilterByAssociation:T.distanceFilterByAssociation,setDistanceFilterEnabled:T.setDistanceFilterEnabled,setDistanceFilterForAssociation:T.setDistanceFilterForAssociation,travelTimeFilter:T.travelTimeFilter,setTravelTimeFilterEnabled:T.setTravelTimeFilterEnabled,setMaxTravelTimeForAssociation:T.setMaxTravelTimeForAssociation,levelFilterEnabled:T.levelFilterEnabled,setLevelFilterEnabled:T.setLevelFilterEnabled,gameGapFilter:T.gameGapFilter,setGameGapFilterEnabled:T.setGameGapFilterEnabled,setMinGameGapMinutes:T.setMinGameGapMinutes}))),E=i.useMemo(()=>{const T=M??{};return u&&T[u]!==void 0?T[u]:b},[u,M,b]),N=i.useMemo(()=>{const T=v.maxTravelTimeByAssociation??{};return u&&T[u]!==void 0?T[u]:v.maxTravelTimeMinutes},[u,v]),F=i.useCallback(T=>{u&&S(u,{maxDistanceKm:Number(T.target.value)})},[u,S]),j=i.useCallback(T=>{u&&y(u,Number(T.target.value))},[u,y]),R=i.useCallback(T=>{k(Number(T.target.value))},[k]),q=i.useMemo(()=>{let T=0;return e&&T++,s&&b.enabled&&T++,o&&v.enabled&&T++,a&&h&&T++,c&&w.enabled&&T++,T},[e,s,b.enabled,o,v.enabled,a,h,c,w.enabled]),_=T=>`${T} km`,G={minutesUnit:l("common.minutesUnit"),hoursUnit:l("common.hoursUnit")},B=T=>T<Z?`${T}m`:`${T/Z}h`;return t.jsxs(t.Fragment,{children:[t.jsxs("button",{type:"button",onClick:()=>d(!0),"data-tour":p,className:`
          inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full
          text-sm font-medium
          bg-surface-subtle dark:bg-surface-subtle-dark
          text-text-primary dark:text-text-primary-dark
          hover:bg-surface-muted dark:hover:bg-surface-muted-dark
          transition-colors cursor-pointer
          focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-1
        `,children:[t.jsx(oa,{className:"w-4 h-4"}),t.jsx("span",{children:l("exchange.filters")}),q>0&&t.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold rounded-full bg-primary-600 text-white",children:q})]}),t.jsxs(Ja,{isOpen:m,onClose:()=>d(!1),titleId:"exchange-filter-menu-title",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[t.jsx("h2",{id:"exchange-filter-menu-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:l("exchange.filters")}),t.jsx("button",{type:"button",onClick:()=>d(!1),className:"p-2 -m-2 text-text-muted dark:text-text-muted-dark hover:text-text-primary dark:hover:text-text-primary-dark transition-colors","aria-label":l("common.close"),children:t.jsx(We,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"p-4 space-y-3 overflow-y-auto",children:[t.jsx(Y,{icon:t.jsx(ve,{className:"w-full h-full"}),label:l("exchange.hideOwn"),enabled:e,onToggle:n}),s&&t.jsx(Y,{icon:t.jsx(Te,{className:"w-full h-full"}),label:l("exchange.filterByDistance"),enabled:b.enabled,onToggle:()=>x(!b.enabled),value:`≤${E.maxDistanceKm} km`,children:t.jsx(me,{id:"max-distance",value:E.maxDistanceKm,min:tn,max:an,step:5,presets:[...en],formatPreset:_,onChange:F})}),o&&t.jsx(Y,{icon:t.jsx(J,{className:"w-full h-full"}),label:l("exchange.filterByTravelTime"),enabled:v.enabled,onToggle:()=>D(!v.enabled),value:`≤${Be(N,G)}`,children:t.jsx(me,{id:"max-travel-time",value:N,min:sn,max:rn,step:15,presets:[...nn],formatPreset:B,onChange:j})}),c&&t.jsx(Y,{icon:t.jsx(at,{className:"w-full h-full"}),label:l("exchange.filterByGameGap"),enabled:w.enabled,onToggle:()=>g(!w.enabled),value:`≥${Be(w.minGapMinutes,G)}`,children:t.jsx(me,{id:"min-game-gap",value:w.minGapMinutes,min:cn,max:ln,step:15,presets:[...on],formatPreset:B,onChange:R})}),a&&t.jsx(Y,{icon:t.jsx(tt,{className:"w-full h-full"}),label:l("exchange.filterByLevel"),enabled:h,onToggle:()=>C(!h),value:r??void 0}),t.jsx("p",{className:"pt-2 text-xs text-text-muted dark:text-text-muted-dark",children:l("exchange.settings.description")})]})]})]})}const un=i.memo(dn),mn=30;function He(e){const n=e.refereeGame?.game?.hall;if(!n?.__identity)return null;const a=n.primaryPostalAddress?.geographicalLocation,s=ce(a),o=e.refereeGame?.game?.startingDateTime,c=o?new Date(o):null;return{id:n.__identity,coords:s,gameStartTime:c}}function fn(e){const a=U(g=>g.dataSource)==="demo",s=$(g=>g.homeLocation),o=$(g=>g.transportEnabled),c=$(g=>g.transportEnabledByAssociation),r=$(g=>g.travelTimeFilter.enabled),p=$(g=>g.travelTimeFilter.maxTravelTimeMinutes),l=$(g=>g.travelTimeFilter.arrivalBufferByAssociation),m=te(),d=i.useMemo(()=>{const g=c??{};return m&&g[m]!==void 0?g[m]:o},[m,c,o]),u=i.useMemo(()=>{const g=l??{};return m&&g[m]!==void 0?g[m]:At(m)},[m,l]),b=i.useMemo(()=>{if(!e)return[];const g=new Set,k=[];for(const E of e){const N=He(E);N&&!g.has(N.id)&&(g.add(N.id),k.push({...N,exchange:E}))}return k},[e]),M=s?Ye(s):null,x=Ze(),S=!!(d&&s&&(a||be())),v=Ot({queries:b.map(g=>({queryKey:Q.travelTime.hall(g.id,M??"",x),queryFn:async()=>{if(!s||!g.coords)throw new Error("Missing location data");const k=Je(g.id,M??"",x);if(k)return k;const E={latitude:s.latitude,longitude:s.longitude},N=u*le,F=g.gameStartTime?new Date(g.gameStartTime.getTime()-N):void 0;let j;return a?j=await nt(E,g.coords):j=await Xe(E,g.coords,{targetArrivalTime:F}),et(g.id,M??"",x,j),j},enabled:S&&g.coords!==null,staleTime:$t,gcTime:Pt,refetchOnWindowFocus:!1,retry:3,retryDelay:k=>Math.min(Ae*2**k,mn*Ae)}))}),D=i.useMemo(()=>{const g=new Map,k=new Map;return v.forEach((E,N)=>{const F=b[N];F&&k.set(F.id,E)}),b.forEach(E=>{const N=k.get(E.id);g.set(E.id,{minutes:N?.data?.durationMinutes??null,isLoading:N?.isLoading??!1,isError:N?.isError??!1})}),g},[b,v]),y=i.useMemo(()=>e?e.map(g=>{const k=He(g),E=k?D.get(k.id):null;return{item:g,travelTimeMinutes:E?.minutes??null,isLoading:E?.isLoading??!1,isError:E?.isError??!1}}):null,[e,D]),h=i.useCallback(g=>!r||g.travelTimeMinutes===null?!0:g.travelTimeMinutes<=p,[r,p]),C=i.useMemo(()=>y?y.filter(h):null,[y,h]),w=v.some(g=>g.isLoading);return{exchangesWithTravelTime:y,filteredExchanges:C,isLoading:w,filterByTravelTime:h,isAvailable:S}}const gn=i.createElement(qt,{size:Qe}),hn=i.createElement(We,{size:Qe}),pn={"head-one":"activeRefereeConvocationFirstHeadReferee","head-two":"activeRefereeConvocationSecondHeadReferee","linesman-one":"activeRefereeConvocationFirstLinesman","linesman-two":"activeRefereeConvocationSecondLinesman","linesman-three":"activeRefereeConvocationThirdLinesman","linesman-four":"activeRefereeConvocationFourthLinesman","standby-head":"activeRefereeConvocationStandbyHeadReferee","standby-linesman":"activeRefereeConvocationStandbyLinesman"};function xn(e){const n=e.refereePosition;if(!n)return;const a=pn[n];if(!a)return;const s=e.refereeGame;return s?s[a]?.__identity:void 0}function yn(e,n){return{takeOver:{id:"take-over",label:"Take Over",shortLabel:"Take Over",color:"bg-primary-500",icon:gn,onAction:()=>n.onTakeOver(e)},removeFromExchange:{id:"remove-from-exchange",label:"Remove",shortLabel:"Remove",color:"bg-danger-500",icon:hn,onAction:()=>n.onRemoveFromExchange(e)}}}function bn(){const e=Fe(),n=Fe(),a=Ka(),s=qa(),o=je(async(l,m)=>{await a.mutateAsync(l.__identity),m.debug("Successfully applied for exchange:",l.__identity)},{logContext:"useExchangeActions",successMessage:"exchange.applySuccess",errorMessage:"exchange.applyError",safeGuard:{context:"useExchangeActions",action:"taking exchange"},skipSuccessToastInDemoMode:!0,onSuccess:()=>e.close()}),c=je(async(l,m)=>{const d=xn(l);if(!d)throw new Error("Could not find convocation ID for this exchange");await s.mutateAsync(d),m.debug("Successfully removed own exchange, convocation:",d)},{logContext:"useExchangeActions",successMessage:"exchange.removeSuccess",errorMessage:"exchange.removeError",safeGuard:{context:"useExchangeActions",action:"removing own exchange"},skipSuccessToastInDemoMode:!0,onSuccess:()=>n.close()}),r=i.useCallback(async l=>{await o.execute(l)},[o]),p=i.useCallback(async l=>{await c.execute(l)},[c]);return{takeOverModal:{isOpen:e.isOpen,exchange:e.data,open:e.open,close:e.close},removeFromExchangeModal:{isOpen:n.isOpen,exchange:n.data,open:n.open,close:n.close},handleTakeOver:r,handleRemoveFromExchange:p}}const Tn=i.lazy(()=>Ve(()=>import("./chunk-RemoveFromExchangeModal-DZr326W8.js").then(e=>e.T),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.TakeOverExchangeModal}))),vn=i.lazy(()=>Ve(()=>import("./chunk-RemoveFromExchangeModal-DZr326W8.js").then(e=>e.R),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.RemoveFromExchangeModal})));function En(){const[e,n]=i.useState("open"),{t:a}=ee(),s=te(),{showDummyData:o}=Dt("exchange"),{dataSource:c,isAssociationSwitching:r,isCalendarMode:p,userId:l}=U(ie(f=>({dataSource:f.dataSource,isAssociationSwitching:f.isAssociationSwitching,isCalendarMode:f.isCalendarMode(),userId:f.user?.id}))),m=c==="demo",d=m?qe:l,u=i.useCallback(f=>d?f.submittedByPerson?.__identity===d:!1,[d]),{userRefereeLevel:b,userRefereeLevelGradationValue:M}=Ke(ie(f=>({userRefereeLevel:f.userRefereeLevel,userRefereeLevelGradationValue:f.userRefereeLevelGradationValue}))),{homeLocation:x,distanceFilter:S,travelTimeFilter:v,levelFilterEnabled:D,gameGapFilter:y,hideOwnExchangesByAssociation:h}=$(ie(f=>({homeLocation:f.homeLocation,distanceFilter:f.distanceFilter,travelTimeFilter:f.travelTimeFilter,levelFilterEnabled:f.levelFilterEnabled,gameGapFilter:f.gameGapFilter,hideOwnExchangesByAssociation:f.hideOwnExchangesByAssociation}))),C=$(f=>f.setHideOwnExchangesForAssociation),w=i.useMemo(()=>s&&h[s]!==void 0?h[s]:!0,[s,h]),g=i.useCallback(()=>{s&&C(s,!w)},[s,w,C]),{data:k,isLoading:E,error:N,refetch:F}=Ha(e),j=r||E,{assignments:R,hasCalendarCode:q}=rt(),{exchangesWithTravelTime:_,isAvailable:G}=fn(k??null),B=i.useMemo(()=>_?new Map(_.map(f=>[f.item.__identity,{minutes:f.travelTimeMinutes,isLoading:f.isLoading}])):new Map,[_]),T=i.useMemo(()=>k?x?k.map(f=>{const I=f.refereeGame?.game?.hall?.primaryPostalAddress?.geographicalLocation,O=ce(I);if(!O)return{exchange:f,carDistanceKm:null};const P={latitude:x.latitude,longitude:x.longitude},V=It(P,O);return{exchange:f,carDistanceKm:V}}):k.map(f=>({exchange:f,carDistanceKm:null})):null,[k,x]),A=i.useMemo(()=>{if(o)return[{exchange:Zt,carDistanceKm:null}];if(!T)return null;let f=T;return D&&e==="open"&&m&&M!==null&&(f=f.filter(({exchange:I})=>{const O=I.requiredRefereeLevelGradationValue;if(O==null)return!0;const P=Number(O);return isNaN(P)?!0:M<=P})),S.enabled&&e==="open"&&x&&(f=f.filter(({carDistanceKm:I})=>I===null?!0:I<=S.maxDistanceKm)),v.enabled&&e==="open"&&G&&B.size>0&&(f=f.filter(({exchange:I})=>{const O=B.get(I.__identity);return O?.minutes===null||O?.minutes===void 0?!0:O.minutes<=v.maxTravelTimeMinutes})),y.enabled&&e==="open"&&q&&R.length>0&&(f=f.filter(({exchange:I})=>{const O=I.refereeGame?.game?.startingDateTime,P=I.refereeGame?.game?.hall?.primaryPostalAddress?.geographicalLocation,V=ce(P);return Sa(O,R,{minGapMinutes:y.minGapMinutes,venueCoordinates:V,sameLocationDistanceKm:Ee})})),w&&e==="open"&&d&&(f=f.filter(({exchange:I})=>I.submittedByPerson?.__identity!==d)),f},[o,T,D,e,m,M,S.enabled,S.maxDistanceKm,x,v.enabled,v.maxTravelTimeMinutes,G,B,w,d,y.enabled,y.minGapMinutes,q,R]),K=i.useMemo(()=>!A||A.length===0?[]:Ft(A,f=>f.exchange.refereeGame?.game?.startingDateTime),[A]),{takeOverModal:H,removeFromExchangeModal:L,handleTakeOver:ae,handleRemoveFromExchange:Me}=bn(),ot=i.useCallback(f=>{const I=yn(f,{onTakeOver:H.open,onRemoveFromExchange:L.open});return e==="mine"?{right:[I.removeFromExchange]}:u(f)?{right:[I.removeFromExchange]}:f.status==="open"?{left:[I.takeOver]}:{}},[H.open,L.open,e,u]),it=[{id:"open",label:a("exchange.open")},{id:"mine",label:a("exchange.myApplications")}],ct=i.useCallback(f=>{n(f)},[]),lt=i.useCallback(()=>{H.exchange&&ae(H.exchange)},[H.exchange,ae]),dt=i.useCallback(()=>{L.exchange&&Me(L.exchange)},[L.exchange,Me]),Se=m&&b!==null,Ce=x!==null,ke=G,we=q&&R.length>0,ut=i.useCallback(async()=>{await F()},[F]),mt=e==="open"?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(un,{hideOwnExchanges:w,onHideOwnToggle:g,isLevelFilterAvailable:Se,isDistanceFilterAvailable:Ce,isTravelTimeFilterAvailable:ke,isGameGapFilterAvailable:we,userRefereeLevel:b,dataTour:"exchange-settings"}),t.jsx(Qa,{hideOwnActive:w,distanceActive:Ce&&S.enabled,travelTimeActive:ke&&v.enabled,gameGapActive:we&&y.enabled,levelActive:Se&&D})]}):void 0,ft=()=>{if(j&&!o)return t.jsx(jt,{message:a("exchange.loading")});if(N)return t.jsx(Lt,{message:N instanceof Error?N.message:a("exchange.errorLoading"),onRetry:()=>F()});if(K.length===0){const f=w||D||S.enabled||v.enabled||y.enabled;return t.jsx(De,{icon:"exchange",title:a(e==="open"?"exchange.noOpenExchangesTitle":"exchange.noApplicationsTitle"),description:a(e==="open"?f?"exchange.noExchangesWithFilters":"exchange.noOpenExchangesDescription":"exchange.noApplicationsDescription")})}return t.jsx("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:K.map((f,I)=>{const O=K.slice(0,I).reduce((P,V)=>P+V.items.length,0);return t.jsxs(i.Fragment,{children:[K.length>1&&t.jsx(zt,{week:f.week}),f.items.map(({exchange:P,carDistanceKm:V},gt)=>{const Ne=B.get(P.__identity);return t.jsx(Xt,{swipeConfig:ot(P),children:({isDrawerOpen:ht})=>t.jsx(Za,{exchange:P,disableExpansion:ht,dataTour:O+gt===0?"exchange-card":void 0,carDistanceKm:x?V:null,travelTimeMinutes:Ne?.minutes,travelTimeLoading:Ne?.isLoading})},P.__identity)})]},f.week.key)})})};return p?t.jsx("div",{className:"space-y-3",children:t.jsx(De,{icon:"exchange",title:a("exchange.unavailableInCalendarModeTitle"),description:a("exchange.unavailableInCalendarModeDescription")})}):t.jsx(Wt,{onRefresh:ut,children:t.jsxs("div",{className:"space-y-3",children:[t.jsx(Qt,{tabs:it,activeTab:e,onTabChange:ct,ariaLabel:a("exchange.title"),endContent:mt}),t.jsx(Vt,{tabId:e,activeTab:e,children:ft()}),H.exchange&&t.jsx(i.Suspense,{fallback:null,children:t.jsx(Tn,{exchange:H.exchange,isOpen:H.isOpen,onClose:H.close,onConfirm:lt})}),L.exchange&&t.jsx(i.Suspense,{fallback:null,children:t.jsx(vn,{exchange:L.exchange,isOpen:L.isOpen,onClose:L.close,onConfirm:dt})})]})})}const Fn=Object.freeze(Object.defineProperty({__proto__:null,ExchangePage:En},Symbol.toStringTag,{value:"Module"}));export{Fn as E,sa as L,Z as M,Ja as R,ve as U,Dn as a,Ba as b,In as c,ce as e,Be as f,An as p,Ga as u};
