import{a as m,u as Hs,b as xt,j as a}from"./chunk-state-1lfzh_F6.js";import{l as na,C as Ve,c as gt,e as ia}from"./chunk-ModalErrorBoundary-BeW9sYPO.js";import{c as K,r as oa,e as Ee,p as yt,l as te,q as Ne,A as bt,u as B,a3 as Us,L as Ws,an as Nt,o as la,a_ as ca,a$ as da,ad as fe,U as _e,b0 as wt,b1 as Vs,b2 as Gs,b3 as kt,b4 as ua,b5 as ma,b6 as $t,b7 as zt,B as G,M as vt,a as Ct,b as Ks}from"./index-BRx10Hyx.js";import"./chunk-router-BHRPxDXG.js";import{R as Xs,U as ha}from"./chunk-ExchangePage-DJtG7UAu.js";import{u as At,I as fa}from"./chunk-useDebouncedValue-C0ax3eZQ.js";import{B as pa}from"./chunk-useTravelTime-BbYlWQkE.js";import{C as Ie}from"./chunk-AssignmentsPage-DuDn5qtD.js";import{R as qs}from"./chunk-LoginPage-CSPLZK43.js";import{F as Qe}from"./chunk-PdfLanguageModal-DSSa7RFN.js";import{C as xa}from"./chunk-cropper-CP7W1s_t.js";import"./chunk-validation-Cdg1t4SS.js";import"./chunk-ojp-client-D0bpwLr5.js";import"./chunk-pdf-form-filler-CnSzfh0X.js";import"./chunk-assignments-DBz14qIH.js";import"./chunk-SafeModeWarningModal-DUptztOK.js";import"./chunk-calendar-helpers-mvnDCw52.js";const ga=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],St=K("camera",ga);const ya=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ys=K("chevron-right",ya);const ba=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Et=K("chevron-up",ba);const Na=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Je=K("circle-check-big",Na);const wa=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ka=K("circle-x",wa);const va=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Zs=K("image",va);const Ca=[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]],Aa=K("party-popper",Ca);const Sa=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Ea=K("pen-tool",Sa);const ja=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ra=K("plus",ja);const _a=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ia=K("rotate-ccw",_a);const Ma=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Ta=K("rotate-cw",Ma);const Oa=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],Pa=K("skip-forward",Oa);const La=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],Ba=K("stethoscope",La);const Da=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Fa=K("trash-2",Da);const $a=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],za=K("undo-2",$a);const Ha=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ht=K("upload",Ha);const Ua=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Qs=K("user-plus",Ua);function Ut(){return{homeRoster:{reviewed:!1,playerModifications:{added:[],removed:[]},coachModifications:{added:new Map,removed:new Set}},awayRoster:{reviewed:!1,playerModifications:{added:[],removed:[]},coachModifications:{added:new Map,removed:new Set}},scorer:{selected:null},scoresheet:{file:null,uploaded:!1}}}const ie=oa("ValidationApi");function et(t){return t.added.length>0||t.removed.length>0}function Js(t,e){const s=t.indoorPlayerNominations?.map(o=>o.__identity).filter(o=>!!o)??[],r=new Set(e.removed),n=s.filter(o=>!r.has(o)),i=e.added.map(o=>o.id);return[...n,...i]}function er(t){return t.added.size>0||t.removed.size>0}function tr(t,e){if(!er(e))return;const s={},r={head:"coachPerson",firstAssistant:"firstAssistantCoachPerson",secondAssistant:"secondAssistantCoachPerson"};for(const n of["head","firstAssistant","secondAssistant"]){const i=e.added.get(n);if(i){s[n]=i.id;continue}if(e.removed.has(n)){s[n]="";continue}const o=t[r[n]]?.__identity;o&&(s[n]=o)}return s}async function Wt(t,e,s,r,n){const i=et(r),o=n?er(n):!1;if(!i&&!o){ie.debug("[VS] skip roster save: no modifications");return}if(!s?.__identity||!s.team?.__identity){ie.debug("[VS] skip roster save: missing nomination list or team ID");return}if(s.closed){ie.debug("[VS] skip roster save: nomination list already closed");return}const c=Js(s,r),d=n?tr(s,n):void 0;await t.updateNominationList(s.__identity,e,s.team.__identity,c,d)}async function Wa(t,e,s,r,n){if(!r){ie.debug("[VS] skip scorer save: no scorer selected");return}if(s?.closedAt){ie.debug("[VS] skip scorer save: scoresheet already closed");return}await t.updateScoresheet(s?.__identity,e,r,s?.isSimpleScoresheet??!1,n)}async function Vt(t,e,s,r,n){if(!s?.__identity||!s.team?.__identity){ie.debug("[VS] skip roster finalize: missing nomination list or team ID");return}if(s.closed){ie.debug("[VS] skip roster finalize: nomination list already closed");return}const i=Js(s,r),o=n?tr(s,n):void 0;await t.finalizeNominationList(s.__identity,e,s.team.__identity,i,s.nominationListValidation?.__identity,o)}async function Va(t,e,s,r,n){if(!r){ie.debug("[VS] skip scoresheet finalize: no scorer selected");return}if(s?.closedAt){ie.debug("[VS] skip scoresheet finalize: scoresheet already closed");return}await t.finalizeScoresheet(s?.__identity,e,r,n,s?.scoresheetValidation?.__identity,s?.isSimpleScoresheet??!1)}function Ga(t){const[e,s]=m.useState(Ut),[r,n]=m.useState(!1),[i,o]=m.useState(!1),c=m.useRef(!1),d=m.useRef(!1),u=m.useRef(void 0),l=Ee(A=>A.dataSource),h=yt(l),f=Hs(),x=xt({queryKey:Ne.validation.gameDetail(t??""),queryFn:async()=>t?h.getGameWithScoresheet(t):null,enabled:!!t,staleTime:bt}),g=m.useMemo(()=>({homeRoster:e.homeRoster.reviewed,awayRoster:e.awayRoster.reviewed,scorer:e.scorer.selected!==null,scoresheet:!0}),[e.homeRoster.reviewed,e.awayRoster.reviewed,e.scorer.selected]),p=m.useMemo(()=>g.homeRoster&&g.awayRoster&&g.scorer,[g]),y=m.useMemo(()=>!!x.data?.scoresheet?.closedAt,[x.data]),E=m.useMemo(()=>{const A=x.data?.scoresheet;if(!A?.closedAt)return null;const P=A.writerPerson;return{validatedAt:A.closedAt,scorerName:P?.displayName??"Unknown",scorerBirthday:P?.birthday,hasScoresheet:!!A.hasFile}},[x.data]),j=m.useMemo(()=>{if(y)return null;const A=x.data?.scoresheet?.writerPerson;return A?.__identity?{__identity:A.__identity,displayName:A.displayName??"Unknown",birthday:A.birthday}:null},[x.data,y]),R=m.useMemo(()=>x.data?.group?.hasNoScoresheet??!1,[x.data]),S=m.useMemo(()=>x.data?.nominationListOfTeamHome??null,[x.data?.nominationListOfTeamHome]),N=m.useMemo(()=>x.data?.nominationListOfTeamAway??null,[x.data?.nominationListOfTeamAway]),w=m.useMemo(()=>et(e.homeRoster.playerModifications)||et(e.awayRoster.playerModifications)||e.homeRoster.coachModifications.added.size>0||e.homeRoster.coachModifications.removed.size>0||e.awayRoster.coachModifications.added.size>0||e.awayRoster.coachModifications.removed.size>0||e.scorer.selected!==null||e.scoresheet.file!==null,[e]),b=m.useCallback(A=>{s(P=>({...P,homeRoster:{...P.homeRoster,playerModifications:A.players,coachModifications:A.coaches,reviewed:!0}}))},[]),v=m.useCallback(A=>{s(P=>({...P,awayRoster:{...P.awayRoster,playerModifications:A.players,coachModifications:A.coaches,reviewed:!0}}))},[]),C=m.useCallback(A=>{s(P=>({...P,scorer:{selected:A}}))},[]),D=m.useCallback((A,P)=>{s(V=>({...V,scoresheet:{file:A,uploaded:P}}))},[]),I=m.useCallback(()=>{s(Ut())},[]),M=m.useCallback(async()=>{if(c.current){te.debug("[VS] save skip: in progress");return}c.current=!0,n(!0);try{const A=x.data;if(!t||!A){te.warn("[VS] no game data for save");return}te.debug("[VS] saveProgress: scoresheet data from API",{hasScoresheet:!!A.scoresheet,scoresheetId:A.scoresheet?.__identity,scorerId:e.scorer.selected?.__identity,hasNoScoresheet:A.group?.hasNoScoresheet});let P=u.current;!P&&e.scoresheet.file&&(P=(await h.uploadResource(e.scoresheet.file))[0]?.__identity,u.current=P,te.debug("[VS] PDF uploaded:",P)),await Wt(h,t,A.nominationListOfTeamHome,e.homeRoster.playerModifications,e.homeRoster.coachModifications),await Wt(h,t,A.nominationListOfTeamAway,e.awayRoster.playerModifications,e.awayRoster.coachModifications),await Wa(h,t,A.scoresheet,e.scorer.selected?.__identity,P),await f.invalidateQueries({queryKey:Ne.validation.gameDetail(t)}),te.debug("[VS] save done")}catch(A){throw te.error("[VS] save failed:",A),A}finally{c.current=!1,n(!1)}},[t,x.data,e,h,f]),F=m.useCallback(async()=>{if(d.current){te.debug("[VS] finalize skip: in progress");return}d.current=!0,o(!0);try{const A=x.data;if(!t||!A){te.warn("[VS] no game data for finalize");return}let P=u.current;!P&&e.scoresheet.file&&(P=(await h.uploadResource(e.scoresheet.file))[0]?.__identity,u.current=P,te.debug("[VS] PDF uploaded:",P)),await Vt(h,t,A.nominationListOfTeamHome,e.homeRoster.playerModifications,e.homeRoster.coachModifications),await Vt(h,t,A.nominationListOfTeamAway,e.awayRoster.playerModifications,e.awayRoster.coachModifications),await Va(h,t,A.scoresheet,e.scorer.selected?.__identity,P),await f.invalidateQueries({queryKey:Ne.validation.gameDetail(t)}),te.debug("[VS] finalize done")}catch(A){throw te.error("[VS] finalize failed:",A),A}finally{d.current=!1,o(!1)}},[t,x.data,e,h,f]);return{state:e,isDirty:w,completionStatus:g,isAllRequiredComplete:p,isValidated:y,validatedInfo:E,pendingScorer:j,scoresheetNotRequired:R,setHomeRosterModifications:b,setAwayRosterModifications:v,setScorer:C,setScoresheet:D,reset:I,saveProgress:M,finalizeValidation:F,isSaving:r,isFinalizing:i,isLoadingGameDetails:x.isLoading,gameDetailsError:x.error,homeNominationList:S,awayNominationList:N}}const tt=6;function Gt(t,e,s){if(!t)return{isValid:!0,playerCount:0,hasHeadCoach:!0,hasMinPlayers:!0};const r=t.indoorPlayerNominations?.length??0,n=e.added.length,i=e.removed.length,o=r+n-i,c=!!t.coachPerson,d=s.removed.has("head"),l=s.added.has("head")||c&&!d,h=o>=tt;return{isValid:l&&h,playerCount:o,hasHeadCoach:l,hasMinPlayers:h}}function Ka(t,e,s,r,n,i){const o=Gt(t,e,s),c=Gt(r,n,i);return{home:o,away:c,allValid:o.isValid&&c.isValid}}function Xa({steps:t,initialStepIndex:e=0,onStepChange:s}){if(t.length===0)throw new Error("useWizardNavigation: steps array cannot be empty");const r=Math.max(0,Math.min(e,t.length-1)),[n,i]=m.useState(r),[o,c]=m.useState(()=>new Set),d=t.length,u=n===0,l=n===d-1,h=!l,f=!u,x=m.useMemo(()=>{const S=t[n];if(!S)throw new Error(`useWizardNavigation: step at index ${n} not found`);return S},[t,n]),g=m.useCallback(S=>{const N=Math.max(0,Math.min(S,t.length-1));N!==n&&(s?.(n,N),i(N))},[n,t.length,s]),p=m.useCallback((S,N)=>{c(w=>{if(N&&w.has(S)||!N&&!w.has(S))return w;const b=new Set(w);return N?b.add(S):b.delete(S),b})},[]),y=m.useCallback(()=>{h&&g(n+1)},[h,n,g]),E=m.useCallback(()=>{f&&g(n-1)},[f,n,g]),j=m.useCallback(()=>{i(0),c(new Set)},[]),R=m.useMemo(()=>{for(let S=0;S<t.length;S++)if(!t[S]?.isOptional&&!o.has(S))return!1;return!0},[t,o]);return{currentStepIndex:n,currentStep:x,totalSteps:d,isFirstStep:u,isLastStep:l,goNext:y,goBack:E,goToStep:g,resetToStart:j,canGoNext:h,canGoBack:f,stepsMarkedDone:o,setStepDone:p,allRequiredStepsDone:R}}const qa=3e3;function Ya({assignment:t,isOpen:e,onClose:s}){const{t:r}=B(),[n,i]=m.useState(!1),[o,c]=m.useState(!1),[d,u]=m.useState(!1),[l,h]=m.useState(null),[f,x]=m.useState(null),[g,p]=m.useState(!1),y=Ee(z=>z.dataSource),E=Us(z=>z.isSafeModeEnabled),j=y!=="demo"&&E,R=Hs(),S=t.refereeGame?.game?.__identity,{state:N,isDirty:w,completionStatus:b,isValidated:v,validatedInfo:C,pendingScorer:D,scoresheetNotRequired:I,setHomeRosterModifications:M,setAwayRosterModifications:F,setScorer:A,setScoresheet:P,reset:V,saveProgress:X,finalizeValidation:le,isSaving:ne,isFinalizing:xe,isLoadingGameDetails:ce,gameDetailsError:be,homeNominationList:J,awayNominationList:se}=Ga(S),de=t.refereeGame?.game?.scoresheet?.closedAt,ee=v||!!de,Y=C??(de?{validatedAt:de,scorerName:"â€”",scorerBirthday:void 0,hasScoresheet:!1}:null),H=m.useMemo(()=>Ka(J,N.homeRoster.playerModifications,N.homeRoster.coachModifications,se,N.awayRoster.playerModifications,N.awayRoster.coachModifications),[J,se,N.homeRoster.playerModifications,N.homeRoster.coachModifications,N.awayRoster.playerModifications,N.awayRoster.coachModifications]),L=!!J?.closed,U=!!se?.closed,$=ee,k=m.useMemo(()=>[{id:"home-roster",label:r("validation.homeRoster"),isInvalid:!L&&!H.home.isValid,isReadOnly:L},{id:"away-roster",label:r("validation.awayRoster"),isInvalid:!U&&!H.away.isValid,isReadOnly:U},{id:"scorer",label:r("validation.scorer"),isReadOnly:$},{id:"scoresheet",label:r("validation.scoresheet"),isOptional:!0,isReadOnly:$}],[r,H.home.isValid,H.away.isValid,L,U,$]),{currentStepIndex:_,currentStep:O,totalSteps:W,isFirstStep:q,isLastStep:ue,goNext:Z,goBack:Gr,goToStep:Te,resetToStart:Dt,stepsMarkedDone:Ge,setStepDone:me}=Xa({steps:k});m.useEffect(()=>{k.forEach((z,Le)=>{z.isReadOnly&&me(Le,!0)})},[k,me]);const Kr=O.isReadOnly??!1,Ft=m.useRef(w),Ke=m.useRef(!1),Oe=m.useRef(null);m.useEffect(()=>{Ft.current=w},[w]),m.useEffect(()=>()=>{Oe.current&&(clearTimeout(Oe.current),Oe.current=null)},[]),m.useEffect(()=>{e&&(S&&R.invalidateQueries({queryKey:Ne.validation.gameDetail(S)}),h(null),x(null),c(!1),u(!1),V(),Dt())},[e,V,Dt,S,R]);const je=m.useMemo(()=>k[_]?.id==="scorer"?b.scorer:!0,[_,k,b.scorer]),Xe=m.useMemo(()=>{for(let z=0;z<_;z++)if(!k[z]?.isOptional&&!Ge.has(z))return!1;return!0},[k,_,Ge]),Xr=!xe&&!ce&&!g,qr=m.useCallback(()=>{ee?s():Ft.current?i(!0):s()},[s,ee]),Pe=m.useCallback(async()=>{Ke.current=!0,h(null);try{j?(await X(),u(!0)):(await le(),x(r("validation.state.saveSuccess")),Oe.current=setTimeout(()=>{x(null)},qa),s())}catch(z){const Le=z instanceof Error?z.message:r("validation.state.saveError");h(Le)}finally{Ke.current=!1}},[j,X,le,r,s]),Yr=m.useCallback(async()=>{if(Ke.current)return;const z=k[k.length-1];if(!(!z?.isOptional&&!je)&&Xe){if(!H.allValid){c(!0);return}z?.isOptional||me(_,!0),await Pe()}},[k,je,Xe,H.allValid,_,me,Pe]),Zr=m.useCallback(async()=>{try{await X(),i(!1),s()}catch(z){te.error("[ValidateGameModal] Save failed during close:",z),h(r("validation.state.saveError")),i(!1)}},[X,s,r]),Qr=m.useCallback(()=>{i(!1),V(),s()},[V,s]),Jr=m.useCallback(()=>{i(!1)},[]),ea=m.useCallback(()=>{je&&(me(_,!0),Z())},[je,me,_,Z]),ta=m.useCallback(z=>{p(z)},[]),sa=m.useCallback(()=>{c(!1),H.home.isValid?H.away.isValid||Te(1):Te(0)},[H.home.isValid,H.away.isValid,Te]),ra=m.useCallback(async()=>{c(!1),k[k.length-1]?.isOptional||me(_,!0),await Pe()},[k,_,me,Pe]),aa=m.useCallback(()=>{u(!1),s()},[s]);return{currentStepIndex:_,currentStepId:O.id,currentStep:O,totalSteps:W,isFirstStep:q,isLastStep:ue,stepsMarkedDone:Ge,goToStep:Te,wizardSteps:k,validationState:N,isDirty:w,completionStatus:b,isValidated:ee,isCurrentStepReadOnly:Kr,validatedInfo:Y,pendingScorer:D,scoresheetNotRequired:I,setHomeRosterModifications:M,setAwayRosterModifications:F,setScorer:A,setScoresheet:P,isSaving:ne,isFinalizing:xe,isLoadingGameDetails:ce,gameDetailsError:be,homeNominationList:J,awayNominationList:se,showUnsavedDialog:n,showRosterWarningDialog:o,showSafeValidationComplete:d,saveError:l,successToast:f,isAddPlayerSheetOpen:g,rosterValidation:H,canMarkCurrentStepDone:je,allPreviousRequiredStepsDone:Xe,isSwipeEnabled:Xr,attemptClose:qr,handleFinish:Yr,handleSaveAndClose:Zr,handleDiscardAndClose:Qr,handleCancelClose:Jr,goNext:Z,handleValidateAndNext:ea,goBack:Gr,handleAddPlayerSheetOpenChange:ta,handleRosterWarningGoBack:sa,handleRosterWarningProceed:ra,handleSafeValidationCompleteClose:aa}}const Za=.3,Be=300;function Qa({currentStep:t,totalSteps:e,onSwipeNext:s,onSwipePrevious:r,swipeEnabled:n=!0,children:i}){const[o,c]=m.useState("idle"),[d,u]=m.useState(!1),l=m.useRef(t),h=m.useRef(null),f=t<e-1,x=t>0,g=m.useCallback((w,b,v)=>{u(!0),v(w?b:-b),requestAnimationFrame(()=>{requestAnimationFrame(()=>{u(!1),c("entering"),v(0)})}),h.current=setTimeout(()=>{c("idle"),h.current=null},Be)},[]),{containerRef:p,translateX:y,isDragging:E,containerWidth:j,setTranslateX:R,handlers:S}=na({enabled:n,maxSwipeMultiplier:1.5,canSwipe:(w,b)=>!(b==="left"&&!f||b==="right"&&!x),onDragEnd:(w,b)=>{const v=Math.abs(w),C=w<0,D=C&&f||!C&&x,I=b*Za;return v>I&&D?(c("exiting"),R(C?-b:b),h.current=setTimeout(()=>{p.current&&(l.current+=C?1:-1,C?s?.():r?.(),g(C,b,R))},Be),!0):!1}});m.useEffect(()=>()=>{h.current&&(clearTimeout(h.current),h.current=null)},[]),m.useLayoutEffect(()=>{if(t!==l.current&&j){const w=t>l.current;if(l.current=t,o==="idle"){R(w?j:-j),c("entering"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{R(0)})});const b=setTimeout(()=>{c("idle"),h.current=null},Be);return h.current=b,()=>{clearTimeout(b)}}}},[t,j,o,R]);const N=!E&&!d;return a.jsx("div",{ref:p,className:"relative overflow-hidden",...S,children:a.jsx("div",{style:{transform:`translateX(${y}px)`,transition:N?`transform ${Be}ms cubic-bezier(0.25, 0.1, 0.25, 1)`:"none",cursor:n?E?"grabbing":"grab":"default"},children:i})})}function Ja(t,e,s,r){return t?r?"bg-surface-muted dark:bg-surface-subtle-dark text-text-muted dark:text-text-muted-dark ring-2 ring-border-strong dark:ring-border-strong-dark ring-offset-2 dark:ring-offset-surface-card-dark":s?"bg-warning-500 text-warning-950 ring-2 ring-warning-500 ring-offset-2 dark:ring-offset-surface-card-dark":"bg-primary-500 text-primary-950 ring-2 ring-primary-500 ring-offset-2 dark:ring-offset-surface-card-dark":r?"bg-surface-muted dark:bg-surface-subtle-dark text-text-muted dark:text-text-muted-dark":s?"bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-400 ring-2 ring-warning-400 dark:ring-warning-600":e?"bg-success-500 text-white":"bg-surface-muted dark:bg-surface-subtle-dark text-text-muted dark:text-text-muted-dark"}function en({steps:t,currentStepIndex:e,stepsMarkedDone:s,onStepClick:r,clickable:n=!1}){const{t:i}=B();return a.jsx("div",{className:"flex items-center justify-center gap-2",role:"navigation","aria-label":i("common.wizardProgress"),children:t.map((o,c)=>{const d=c===e,u=s.has(c),l=o.isInvalid??!1,h=o.isReadOnly??!1,f=!o.isOptional&&u&&!l&&!h,x=!n,g=()=>{!x&&r&&r(c)},p=E=>{!x&&r&&(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),r(c))},y=[o.label];return d&&y.push(i("common.stepIndicatorCurrent")),h&&y.push(i("common.stepIndicatorFinalized")),f&&y.push(i("common.stepIndicatorDone")),l&&y.push(i("common.stepIndicatorInvalid")),a.jsxs("div",{className:"flex items-center",children:[c>0&&a.jsx("div",{className:`w-8 h-0.5 mx-1 transition-colors ${c<=e?"bg-primary-500":"bg-border-strong dark:bg-border-strong-dark"}`}),a.jsx("button",{type:"button",onClick:g,onKeyDown:p,"aria-disabled":x,"aria-current":d?"step":void 0,"aria-label":y.join(" "),className:`
                relative flex items-center justify-center w-8 h-8 rounded-full
                transition-all duration-200
                ${n?"cursor-pointer hover:scale-110":"cursor-default"}
                ${Ja(d,f,l,h)}
                focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-surface-card-dark
                aria-disabled:cursor-default aria-disabled:opacity-100
              `,children:h?a.jsx(Ws,{className:"w-3.5 h-3.5",strokeWidth:2.5,"aria-hidden":"true"}):l&&!d?a.jsx(Nt,{className:"w-4 h-4",strokeWidth:2.5,"aria-hidden":"true"}):f&&!d?a.jsx(Ve,{className:"w-4 h-4",strokeWidth:3,"aria-hidden":"true"}):a.jsx("span",{className:"text-xs font-semibold",children:c+1})})]},o.id)})})}function tn(t){const e=t.indoorPlayer?.person;if(e?.displayName)return e.displayName;const s=e?.firstName?.trim()??"",r=e?.lastName?.trim()??"";return[s,r].filter(Boolean).join(" ")}function sn(t){const e=t.__identity,s=tn(t),r=t.indoorPlayer?.person;return!e||!s?null:{id:e,displayName:s,firstName:r?.firstName,lastName:r?.lastName,birthday:r?.birthday,licenseCategory:t.indoorPlayerLicenseCategory?.shortName,isNewlyAdded:!1}}function Kt(t){return t?t.map(sn).filter(e=>e!==null).sort((e,s)=>e.displayName.localeCompare(s.displayName)):[]}function rn({gameId:t,team:e,prefetchedData:s}){const n=Ee(l=>l.dataSource)==="demo",i=la(l=>l.nominationLists),o=s!=null,c=m.useMemo(()=>o?Kt(s?.indoorPlayerNominations):[],[o,s]),d=m.useMemo(()=>{if(o||!n||!t)return null;const l=i[t];return l?l[e]??null:null},[o,n,t,e,i]),u=m.useMemo(()=>d?Kt(d.indoorPlayerNominations):[],[d]);return o?{nominationList:s,players:c,isLoading:!1,isError:!1,error:null,refetch:()=>{}}:n?{nominationList:d,players:u,isLoading:!1,isError:!1,error:null,refetch:()=>{}}:{nominationList:null,players:[],isLoading:!1,isError:!0,error:new Error("Nomination list data not available. Ensure prefetchedData is provided from getGameWithScoresheet()."),refetch:()=>{}}}function sr(t){const e=t.trim();if(!e)return{};const s=e.split(/\s+/),r={},n=s[s.length-1];return n&&/^\d{4}$/.test(n)&&(r.yearOfBirth=n,s.pop()),s.length===1?r.lastName=s[0]:s.length>=2&&(r.firstName=s[0],r.lastName=s.slice(1).join(" ")),r}function rr(t,e={}){const s=Ee(o=>o.dataSource),r=yt(s),n=!!(t.firstName||t.lastName||t.yearOfBirth),i=xt({queryKey:Ne.scorerSearch.search(t),queryFn:async()=>{const o=await r.searchPersons(t);return ca(o,da,"scorerSearch").items??[]},enabled:e.enabled!==!1&&n,staleTime:bt});return{data:i.data,isLoading:i.isLoading,isError:i.isError,error:i.error}}const an=100,nn=300,Xt="coach-search-listbox";function on(t,e){switch(t){case"head":return e("validation.roster.headCoach");case"firstAssistant":return e("validation.roster.firstAssistant");case"secondAssistant":return e("validation.roster.secondAssistant")}}function ln({isOpen:t,onClose:e,role:s,onSelectCoach:r}){const{t:n}=B(),[i,o]=m.useState(""),[c,d]=m.useState(-1),u=At(i,nn),l=m.useRef(null),h=sr(u),{data:f,isLoading:x,isError:g}=rr(h,{enabled:t&&u.trim().length>0}),p=m.useCallback(()=>{o(""),d(-1),e()},[e]),y=m.useCallback(N=>{r(N,s),p()},[r,s,p]),E=m.useCallback(N=>{if(!(!f||f.length===0))switch(N.key){case"ArrowDown":N.preventDefault(),d(w=>w<f.length-1?w+1:w);break;case"ArrowUp":N.preventDefault(),d(w=>w>0?w-1:w);break;case"Enter":{const w=f[c];c>=0&&w&&(N.preventDefault(),y(w));break}case"Escape":d(-1);break}},[f,c,y]);m.useEffect(()=>{if(t&&l.current){const N=setTimeout(()=>{l.current?.focus()},an);return()=>clearTimeout(N)}},[t]),m.useEffect(()=>{if(c>=0&&f?.[c]){const N=`coach-option-${f[c].__identity}`,w=document.getElementById(N);w?.scrollIntoView&&w.scrollIntoView({block:"nearest",behavior:"smooth"})}},[c,f]);const j=f&&f.length>0,R=u.trim().length>0,S=on(s,n);return a.jsxs(Xs,{isOpen:t,onClose:p,titleId:"add-coach-title",children:[a.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[a.jsxs("div",{children:[a.jsx("h2",{id:"add-coach-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:n("validation.roster.addCoach")}),a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:S})]}),a.jsx("button",{onClick:p,"aria-label":n("common.close"),className:`
            p-2 -mr-2 rounded-lg
            text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
            hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
            transition-colors
          `,children:a.jsx(fe,{className:"w-5 h-5","aria-hidden":"true"})})]}),a.jsx("div",{className:"flex-shrink-0 p-4 border-b border-border-default dark:border-border-default-dark",children:a.jsx("input",{ref:l,type:"text",value:i,onChange:N=>{o(N.target.value),d(-1)},onKeyDown:E,placeholder:n("validation.roster.searchCoaches"),"aria-label":n("validation.roster.searchCoaches"),role:"combobox","aria-expanded":j&&R?"true":"false","aria-controls":Xt,"aria-activedescendant":c>=0&&f?.[c]?`coach-option-${f[c].__identity}`:void 0,"aria-autocomplete":"list",className:`
            w-full px-4 py-2 rounded-lg
            bg-surface-subtle dark:bg-surface-subtle-dark
            text-text-primary dark:text-text-primary-dark
            placeholder-text-muted dark:placeholder-text-muted-dark
            border border-transparent
            focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
            outline-none transition-colors
          `})}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 py-2",children:R?x?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx(_e,{size:"md"})}):g?a.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:n("validation.roster.loadCoachesError")}):j?a.jsx("ul",{id:Xt,role:"listbox","aria-label":n("validation.roster.coaches"),className:"space-y-1",children:f.map((N,w)=>{const b=w===c;return a.jsx("li",{id:`coach-option-${N.__identity}`,role:"option","aria-selected":b,children:a.jsxs("button",{type:"button",onClick:()=>y(N),onMouseEnter:()=>d(w),className:`
                      w-full flex items-center justify-between p-3 rounded-lg
                      text-left
                      transition-colors
                      ${b?"bg-primary-50 dark:bg-primary-900/30":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
                    `,children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate",children:N.displayName}),a.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[N.associationId&&a.jsxs("span",{children:["ID: ",N.associationId]}),N.birthday&&a.jsxs("span",{children:[n("common.dob"),": ",wt(N.birthday)]})]})]}),a.jsx(Ys,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},N.__identity)})}):a.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:n("validation.roster.noCoachesFound")}):a.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:n("validation.scorerSearch.searchHint")})}),a.jsx("div",{className:"flex-shrink-0 p-4 border-t border-border-default dark:border-border-default-dark",children:a.jsx("button",{type:"button",onClick:p,className:`
            w-full py-3 px-4 rounded-lg
            text-sm font-medium
            text-text-secondary dark:text-text-secondary-dark
            bg-surface-subtle dark:bg-surface-subtle-dark
            hover:bg-gray-200 dark:hover:bg-gray-700
            transition-colors
            focus:outline-none focus:ring-2 focus:ring-primary-500/50
          `,children:n("common.cancel")})})]})}function cn({nominationListId:t,enabled:e=!0}){const s=Ee(n=>n.dataSource),r=yt(s);return xt({queryKey:Ne.nominations.possible(t),queryFn:async()=>(await r.getPossiblePlayerNominations(t)).items??[],enabled:e&&!!t,staleTime:bt})}const dn=100,un=200;function mn({isOpen:t,onClose:e,nominationListId:s,excludePlayerIds:r,onAddPlayer:n,onRemovePlayer:i}){const{t:o}=B(),[c,d]=m.useState(""),u=At(c,un),l=m.useRef(null),[h,f]=m.useState(new Set),{data:x,isLoading:g,isError:p}=cn({nominationListId:s,enabled:t&&!!s}),y=m.useMemo(()=>{if(!x)return[];const N=u.toLowerCase();return x.filter(w=>{const b=w.indoorPlayer?.__identity??"";if(r.includes(b)&&!h.has(b)||w.isAlreadyNominated)return!1;const v=w.indoorPlayer?.person?.lastName?.toLowerCase()??"",C=w.indoorPlayer?.person?.firstName?.toLowerCase()??"";return`${v} ${C}`.includes(N)||C.includes(N)||v.includes(N)})},[x,u,r,h]),E=m.useMemo(()=>{const N=y.map(w=>({id:w.indoorPlayer?.__identity??"",firstName:w.indoorPlayer?.person?.firstName,lastName:w.indoorPlayer?.person?.lastName,birthday:w.indoorPlayer?.person?.birthday}));return Vs(N)},[y]),j=m.useMemo(()=>Gs(E),[E]),R=m.useCallback(()=>{d(""),f(new Set),e()},[e]),S=m.useCallback(N=>{const w=N.indoorPlayer?.__identity??"";h.has(w)?(f(b=>{const v=new Set(b);return v.delete(w),v}),i(w)):(f(b=>{const v=new Set(b);return v.add(w),v}),n(N))},[h,n,i]);return m.useEffect(()=>{if(t&&l.current){const N=setTimeout(()=>{l.current?.focus()},dn);return()=>clearTimeout(N)}},[t]),a.jsxs(Xs,{isOpen:t,onClose:R,titleId:"add-player-title",children:[a.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h2",{id:"add-player-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:o("validation.addPlayer")}),h.size>0&&a.jsxs("span",{className:"px-2 py-0.5 text-sm font-medium text-success-700 dark:text-success-400 bg-success-100 dark:bg-success-900/30 rounded-full",children:[h.size," ",o("validation.roster.added")]})]}),a.jsx("button",{onClick:R,"aria-label":o("common.close"),className:`
              p-2 -mr-2 rounded-lg
              text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
              hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
              transition-colors
            `,children:a.jsx(fe,{className:"w-5 h-5","aria-hidden":"true"})})]}),a.jsx("div",{className:"flex-shrink-0 p-4 border-b border-border-default dark:border-border-default-dark",children:a.jsx("input",{ref:l,type:"text",value:c,onChange:N=>d(N.target.value),placeholder:o("validation.searchPlayers"),"aria-label":o("validation.searchPlayers"),className:`
              w-full px-4 py-2 rounded-lg
              bg-surface-subtle dark:bg-surface-subtle-dark
              text-text-primary dark:text-text-primary-dark
              placeholder-text-muted dark:placeholder-text-muted-dark
              border border-transparent
              focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
              outline-none transition-colors
            `})}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 py-2",children:g?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx(_e,{size:"md"})}):p?a.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:o("validation.loadPlayersError")}):y.length===0?a.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:o("validation.noPlayersFound")}):a.jsx("ul",{children:y.map(N=>{const w=N.indoorPlayer?.__identity??"",b=h.has(w),v=E.get(w),C=v?.lastName||N.indoorPlayer?.person?.lastName||"",D=v?.firstInitial||"",I=v?.dob||"",M=b?"text-success-700 dark:text-success-400":"text-text-primary dark:text-text-primary-dark";return a.jsx("li",{children:a.jsxs("button",{onClick:()=>S(N),"aria-pressed":b,className:`
                        group w-full flex items-center justify-between py-2 px-3 rounded-lg
                        text-left transition-colors
                        ${b?"bg-success-50 dark:bg-success-900/20 hover:bg-danger-50 dark:hover:bg-danger-900/20":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
                      `,children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-baseline text-sm font-mono",children:[a.jsx("span",{className:`font-medium ${M}`,style:{minWidth:`${j}ch`},children:C}),a.jsx("span",{className:`ml-2 w-[3ch] ${M}`,children:D}),a.jsx("span",{className:"ml-2 text-text-muted dark:text-text-muted-dark tabular-nums",children:I})]})}),b?a.jsxs("span",{className:"relative flex-shrink-0 ml-2 w-5 h-5",children:[a.jsx(Ve,{className:"w-5 h-5 text-success-600 dark:text-success-400 absolute inset-0 group-hover:opacity-0 transition-opacity","aria-hidden":"true"}),a.jsx(fe,{className:"w-5 h-5 text-danger-500 dark:text-danger-400 absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity","aria-hidden":"true"}),a.jsx("span",{className:"sr-only",children:o("validation.roster.added")})]}):a.jsx(Ra,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},N.__identity)})})}),a.jsx("div",{className:"flex-shrink-0 p-4 border-t border-border-default dark:border-border-default-dark",children:a.jsx("button",{type:"button",onClick:R,className:`
              w-full py-3 px-4 rounded-lg
              text-sm font-medium
              text-white bg-primary-500 hover:bg-primary-600
              dark:bg-primary-600 dark:hover:bg-primary-700
              transition-colors
              focus:outline-none focus:ring-2 focus:ring-primary-500/50
            `,children:o("common.done")})})]})}function qe({label:t,person:e,coachRole:s,readOnly:r,isPendingAddition:n,isPendingRemoval:i,onAdd:o,onRemove:c}){const{t:d}=B(),u=e!=null,l=e?.displayName??d("validation.roster.notAssigned"),h=i&&u,f=n;return a.jsxs("div",{className:`
        flex items-center justify-between py-2 px-3
        ${h?"bg-danger-50 dark:bg-danger-900/20":""}
        ${f?"bg-success-50 dark:bg-success-900/20":""}
      `,"data-testid":`coach-row-${s}`,children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"text-xs text-text-muted dark:text-text-muted-dark uppercase tracking-wide",children:t}),a.jsx("p",{className:`
            text-sm truncate
            ${h?"line-through text-danger-600 dark:text-danger-400":""}
            ${f?"text-success-700 dark:text-success-400 font-medium":""}
            ${!u&&!f?"text-text-muted dark:text-text-muted-dark italic":"text-text-primary dark:text-text-primary-dark"}
          `,children:l})]}),!r&&a.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[u&&!h&&a.jsx("button",{type:"button",onClick:c,"aria-label":d("validation.roster.removeCoach"),className:"p-1.5 rounded-md text-text-muted hover:text-danger-600 hover:bg-danger-50 dark:hover:text-danger-400 dark:hover:bg-danger-900/30 transition-colors",children:a.jsx(fe,{className:"w-4 h-4","aria-hidden":"true"})}),h&&a.jsx("button",{type:"button",onClick:c,"aria-label":d("validation.roster.undoRemoval"),className:"text-xs px-2 py-1 rounded-md text-danger-600 hover:bg-danger-100 dark:text-danger-400 dark:hover:bg-danger-900/40 transition-colors",children:d("validation.roster.undoRemoval")}),!u&&!f&&a.jsx("button",{type:"button",onClick:o,"aria-label":d("validation.roster.addCoach"),className:"p-1.5 rounded-md text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/30 transition-colors",children:a.jsx(Qs,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}function hn({headCoach:t,firstAssistant:e,secondAssistant:s,readOnly:r=!1,onAddCoach:n,onRemoveCoach:i,pendingAdditions:o,pendingRemovals:c}){const{t:d}=B(),u=o?.get("head")??t,l=o?.get("firstAssistant")??e,h=o?.get("secondAssistant")??s;return a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 divide-y divide-gray-200 dark:divide-gray-700",role:"list","aria-label":d("validation.roster.coaches"),children:[a.jsx(qe,{label:d("validation.roster.headCoach"),person:u,coachRole:"head",readOnly:r,isPendingAddition:o?.has("head"),isPendingRemoval:c?.has("head"),onAdd:()=>n?.("head"),onRemove:()=>i?.("head")}),a.jsx(qe,{label:d("validation.roster.firstAssistant"),person:l,coachRole:"firstAssistant",readOnly:r,isPendingAddition:o?.has("firstAssistant"),isPendingRemoval:c?.has("firstAssistant"),onAdd:()=>n?.("firstAssistant"),onRemove:()=>i?.("firstAssistant")}),a.jsx(qe,{label:d("validation.roster.secondAssistant"),person:h,coachRole:"secondAssistant",readOnly:r,isPendingAddition:o?.has("secondAssistant"),isPendingRemoval:c?.has("secondAssistant"),onAdd:()=>n?.("secondAssistant"),onRemove:()=>i?.("secondAssistant")})]})}function fn({player:t,displayData:e,maxLastNameWidth:s,isMarkedForRemoval:r,onRemove:n,onUndoRemoval:i,readOnly:o=!1}){const{t:c}=B(),d=r?"line-through text-text-subtle dark:text-text-subtle-dark":"text-text-primary dark:text-text-primary-dark";return a.jsxs("div",{className:`flex items-center justify-between py-3 px-2 border-b border-border-subtle dark:border-border-subtle-dark last:border-b-0 ${r?"opacity-50":""}`,children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[a.jsxs("div",{className:"flex items-baseline text-sm font-mono",children:[a.jsx("span",{className:d,style:{minWidth:`${s}ch`},children:e.lastName}),a.jsx("span",{className:`ml-2 w-[3ch] ${d}`,children:e.firstInitial}),a.jsx("span",{className:`ml-2 text-text-muted dark:text-text-muted-dark tabular-nums ${r?"line-through":""}`,children:e.dob})]}),t.isNewlyAdded&&!r&&a.jsx(pa,{variant:"success",children:c("validation.roster.newlyAdded")})]}),!o&&a.jsx("div",{className:"flex-shrink-0 ml-2",children:r?a.jsx("button",{type:"button",onClick:i,className:"p-1.5 rounded-full text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/50 transition-colors","aria-label":c("validation.roster.undoRemoval"),title:c("validation.roster.undoRemoval"),children:a.jsx(za,{className:"w-4 h-4","aria-hidden":"true"})}):a.jsx("button",{type:"button",onClick:n,className:"p-1.5 rounded-full text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/50 transition-colors","aria-label":c("validation.roster.removePlayer"),title:c("validation.roster.removePlayer"),children:a.jsx(Fa,{className:"w-4 h-4","aria-hidden":"true"})})})]})}function qt({title:t,count:e,countLabel:s,expanded:r,onToggle:n,sectionId:i}){const o=r?Et:kt;return a.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-3 px-1 text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 rounded-lg","aria-expanded":r,"aria-controls":i,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(o,{className:"w-5 h-5 text-text-muted dark:text-text-muted-dark","aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:t})]}),a.jsx("span",{className:"text-xs text-text-muted dark:text-text-muted-dark",children:s.replace("{count}",String(e))})]})}function ar({team:t,teamName:e,gameId:s,onModificationsChange:r,onAddPlayerSheetOpenChange:n,readOnly:i=!1,initialModifications:o,initialCoachModifications:c,prefetchedNominationList:d}){const{t:u}=B(),{nominationList:l,players:h,isLoading:f,isError:x,refetch:g}=rn({gameId:s,team:t,prefetchedData:d}),[p,y]=m.useState("players"),[E,j]=m.useState(()=>o?.added??[]),[R,S]=m.useState(()=>new Set(o?.removed??[])),[N,w]=m.useState(()=>c?.added??new Map),[b,v]=m.useState(()=>c?.removed??new Set),[C,D]=m.useState(!1),[I,M]=m.useState(!1),[F,A]=m.useState("head"),P=m.useRef(r);m.useEffect(()=>{P.current=r},[r]),m.useEffect(()=>{P.current?.({players:{added:E,removed:[...R]},coaches:{added:N,removed:b}})},[E,R,N,b]),m.useEffect(()=>{n?.(C)},[C,n]);const V=m.useCallback(k=>{S(_=>{const O=new Set(_);return O.add(k),O})},[]),X=m.useCallback(k=>{S(_=>{const O=new Set(_);return O.delete(k),O})},[]),le=m.useCallback(k=>{const _=k.indoorPlayer?.__identity;if(!_)return;const O=k.indoorPlayer?.person,W={id:_,displayName:O?.displayName??`${O?.firstName??""} ${O?.lastName??""}`.trim(),firstName:O?.firstName,lastName:O?.lastName,birthday:O?.birthday,licenseCategory:k.licenseCategory,isNewlyAdded:!0};j(q=>[...q,W])},[]),ne=m.useCallback(k=>{j(_=>_.filter(O=>O.id!==k))},[]),xe=m.useCallback(k=>{A(k),M(!0)},[]),ce=m.useCallback(k=>{if(N.has(k)){w(_=>{const O=new Map(_);return O.delete(k),O});return}v(_=>{const O=new Set(_);return O.has(k)?O.delete(k):O.add(k),O})},[N]),be=m.useCallback((k,_)=>{const O={id:k.__identity,displayName:k.displayName??"",firstName:k.firstName,lastName:k.lastName,birthday:k.birthday};w(W=>{const q=new Map(W);return q.set(_,O),q}),v(W=>{const q=new Set(W);return q.delete(_),q})},[]),J=[...h,...E].sort((k,_)=>{if(k.isNewlyAdded&&!_.isNewlyAdded)return 1;if(!k.isNewlyAdded&&_.isNewlyAdded)return-1;const O=k.lastName??k.displayName,W=_.lastName??_.displayName;return O.localeCompare(W)}),se=m.useMemo(()=>Vs(J),[J]),de=m.useMemo(()=>Gs(se),[se]),ee=J.filter(k=>!R.has(k.id)).length,Y=l?.coachPerson,H=l?.firstAssistantCoachPerson,L=l?.secondAssistantCoachPerson,U=m.useMemo(()=>{const k=new Map;return N.forEach((_,O)=>{k.set(O,{__identity:_.id,displayName:_.displayName,firstName:_.firstName,lastName:_.lastName,birthday:_.birthday})}),k},[N]),$=m.useMemo(()=>{let k=0;const _=["head","firstAssistant","secondAssistant"],O={head:Y,firstAssistant:H,secondAssistant:L};for(const W of _){const q=N.has(W),ue=O[W]&&!b.has(W);(q||ue)&&k++}return k},[Y,H,L,N,b]);return f?a.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"status","aria-live":"polite",children:[a.jsx(_e,{size:"md",className:"mb-3"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:u("validation.roster.loadingRoster")})]}):x?a.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"alert",children:[a.jsx(Ie,{className:"w-10 h-10 text-danger-500 mb-3","aria-hidden":"true"}),a.jsx("p",{className:"text-sm text-danger-600 dark:text-danger-400 mb-4",children:u("validation.roster.errorLoading")}),a.jsxs("button",{type:"button",onClick:()=>g(),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[a.jsx(qs,{className:"w-4 h-4","aria-hidden":"true"}),u("common.retry")]})]}):a.jsxs("div",{className:"py-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:e}),a.jsxs("div",{className:"mb-2",children:[a.jsx(qt,{title:u("validation.roster.coaches"),count:$,countLabel:u("validation.roster.coachCount"),expanded:p==="coaches",onToggle:()=>y("coaches"),sectionId:`coaches-section-${t}`}),p==="coaches"&&a.jsx("div",{id:`coaches-section-${t}`,className:"mt-2",children:a.jsx(hn,{headCoach:Y,firstAssistant:H,secondAssistant:L,readOnly:i,onAddCoach:xe,onRemoveCoach:ce,pendingAdditions:U,pendingRemovals:b})})]}),a.jsxs("div",{children:[a.jsx(qt,{title:u("validation.roster.players"),count:ee,countLabel:u("validation.roster.playerCount"),expanded:p==="players",onToggle:()=>y("players"),sectionId:`players-section-${t}`}),p==="players"&&a.jsxs("div",{id:`players-section-${t}`,className:"mt-2",children:[J.length===0?a.jsx("div",{className:"py-8 text-center",children:a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:u("validation.roster.emptyRoster")})}):a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:J.map(k=>{const _=se.get(k.id);return a.jsx(fn,{player:k,displayData:{lastName:_?.lastName||k.lastName||k.displayName,firstInitial:_?.firstInitial||"",dob:_?.dob||""},maxLastNameWidth:de,isMarkedForRemoval:R.has(k.id),onRemove:i?void 0:()=>V(k.id),onUndoRemoval:i?void 0:()=>X(k.id),readOnly:i},k.id)})}),!i&&a.jsx("div",{className:"mt-4 flex gap-2",children:a.jsxs("button",{type:"button",onClick:()=>D(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 hover:bg-primary-100 dark:hover:bg-primary-900/50 rounded-lg border border-primary-200 dark:border-primary-800 transition-colors",children:[a.jsx(Qs,{className:"w-4 h-4","aria-hidden":"true"}),u("validation.roster.addPlayer")]})})]})]}),!i&&a.jsx(mn,{isOpen:C,onClose:()=>D(!1),nominationListId:l?.__identity??"",excludePlayerIds:h.map(k=>k.id),onAddPlayer:le,onRemovePlayer:ne}),!i&&a.jsx(ln,{isOpen:I,onClose:()=>M(!1),role:F,onSelectCoach:be})]})}function pn({assignment:t,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:r=!1,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o}){const{homeTeam:c}=gt(t),d=t.refereeGame?.game?.__identity??"";return a.jsx(ar,{team:"home",teamName:c,gameId:d,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:r,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o})}function xn({assignment:t,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:r=!1,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o}){const{awayTeam:c}=gt(t),d=t.refereeGame?.game?.__identity??"";return a.jsx(ar,{team:"away",teamName:c,gameId:d,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:r,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o})}function gn(t){return`scorer-option-${t}`}function yn({results:t,isLoading:e,isError:s,onSelect:r,highlightedIndex:n=-1,onHighlight:i,listboxId:o}){const{t:c}=B(),d=t&&t.length>0;return e?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx(_e,{size:"md"})}):s?a.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:c("validation.scorerSearch.searchError")}):d?a.jsx("ul",{id:o,role:"listbox","aria-label":c("validation.scorerSearch.searchResults"),className:"space-y-1",children:t.map((u,l)=>{const h=l===n;return a.jsx("li",{id:gn(u.__identity),role:"option","aria-selected":h,children:a.jsxs("button",{onClick:()=>r(u),onMouseEnter:()=>i?.(l),className:`
                w-full flex items-center justify-between p-3 rounded-lg
                text-left
                transition-colors
                ${h?"bg-primary-50 dark:bg-primary-900/30":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
              `,children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate",children:u.displayName}),a.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[u.associationId&&a.jsxs("span",{children:["ID: ",u.associationId]}),u.birthday&&a.jsxs("span",{children:[c("common.dob"),": ",wt(u.birthday)]})]})]}),a.jsx(Ys,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},u.__identity)})}):a.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:c("validation.scorerSearch.noScorersFound")})}function Yt({scorer:t,displayName:e,displayBirthday:s,onClear:r,readOnly:n=!1}){const{t:i}=B(),o=t?.displayName??e??"",c=t?.birthday??s;return a.jsx("div",{className:"mb-4 p-4 bg-primary-50 dark:bg-primary-900/20 rounded-lg border border-primary-200 dark:border-primary-800",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark",children:o}),(t?.associationId||c)&&a.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[t?.associationId&&a.jsxs("span",{children:["ID: ",t.associationId]}),c&&a.jsxs("span",{children:[i("common.dob"),": ",wt(c)]})]})]}),!n&&r&&a.jsx("button",{onClick:r,"aria-label":i("common.close"),className:`
              p-2 rounded-lg
              text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
              hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
              transition-colors
            `,children:a.jsx(fe,{className:"w-5 h-5","aria-hidden":"true"})})]})})}const bn=300,Nn=100,Zt="scorer-search-listbox",Qt="scorer-search-hint";function wn({selectedScorer:t,onScorerSelect:e,readOnly:s=!1,readOnlyScorerName:r,readOnlyScorerBirthday:n}){const{t:i,tInterpolate:o}=B(),[c,d]=m.useState(""),[u,l]=m.useState(-1),h=At(c,bn),f=m.useRef(null),x=sr(h),{data:g,isLoading:p,isError:y}=rr(x);m.useEffect(()=>{if(t)return;const w=setTimeout(()=>{f.current?.focus()},Nn);return()=>clearTimeout(w)},[t]),m.useEffect(()=>{if(u>=0&&g?.[u]){const w=`scorer-option-${g[u].__identity}`,b=document.getElementById(w);b?.scrollIntoView&&b.scrollIntoView({block:"nearest",behavior:"smooth"})}},[u,g]);const E=m.useCallback(w=>{e(w),d(""),l(-1)},[e]),j=m.useCallback(w=>{if(!(!g||g.length===0))switch(w.key){case"ArrowDown":w.preventDefault(),l(b=>b<g.length-1?b+1:b);break;case"ArrowUp":w.preventDefault(),l(b=>b>0?b-1:b);break;case"Enter":{const b=g[u];u>=0&&b&&(w.preventDefault(),E(b));break}case"Escape":l(-1);break;case"Home":w.preventDefault(),l(0);break;case"End":w.preventDefault(),l(g.length-1);break}},[g,u,E]),R=m.useCallback(()=>{e(null),d(""),l(-1),f.current?.focus()},[e]),S=g&&g.length>0,N=h.trim()&&!t;return s?a.jsx("div",{className:"py-4",children:t||r?a.jsx(Yt,{scorer:t,displayName:r,displayBirthday:n,readOnly:!0}):a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.noScorerSelected")})}):a.jsxs("div",{className:"py-4",children:[t&&a.jsx(Yt,{scorer:t,onClear:R}),!t&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("input",{ref:f,type:"text",value:c,onChange:w=>{d(w.target.value),l(-1)},onKeyDown:j,placeholder:i("validation.scorerSearch.searchPlaceholder"),"aria-label":i("validation.scorerSearch.searchPlaceholder"),role:"combobox","aria-expanded":S&&N?"true":"false","aria-controls":Zt,"aria-activedescendant":u>=0&&g?.[u]?`scorer-option-${g[u].__identity}`:void 0,"aria-autocomplete":"list","aria-describedby":Qt,className:`
                w-full px-4 py-2 rounded-lg
                bg-surface-subtle dark:bg-surface-subtle-dark
                text-text-primary dark:text-text-primary-dark
                placeholder-text-muted dark:placeholder-text-muted-dark
                border border-transparent
                focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
                outline-none transition-colors
              `}),a.jsx("p",{id:Qt,className:"mt-2 text-xs text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.searchHint")})]}),N&&a.jsx("div",{className:"mt-4",children:a.jsx(yn,{results:g,isLoading:p,isError:y,onSelect:E,highlightedIndex:u,onHighlight:l,listboxId:Zt})}),a.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:N&&!p&&!y&&g&&a.jsx("span",{children:g.length===1?i("validation.scorerSearch.resultsCountOne"):o("validation.scorerSearch.resultsCount",{count:g.length})})})]}),!t&&!N&&a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.noScorerSelected")})]})}function kn({onScorerChange:t,initialScorer:e=null,readOnly:s=!1,readOnlyScorerName:r,readOnlyScorerBirthday:n}){const[i,o]=m.useState(e);m.useEffect(()=>{e&&t?.(e)},[e,t]);const c=d=>{o(d),t?.(d)};return a.jsx(wn,{selectedScorer:i,onScorerSelect:c,readOnly:s,readOnlyScorerName:r,readOnlyScorerBirthday:n})}const vn=".jpg,.jpeg,.png,.pdf",Jt=1500,Cn=10,An=90,Sn=100,En=10;function jn(t){return t<$t?`${t} B`:t<zt?`${(t/$t).toFixed(1)} KB`:`${(t/zt).toFixed(1)} MB`}function Rn({onScoresheetChange:t,readOnly:e=!1,hasScoresheet:s=!1,scoresheetNotRequired:r=!1}){const{t:n}=B(),o=Ee(M=>M.dataSource)==="demo",c=m.useRef(t);m.useEffect(()=>{c.current=t},[t]);const[d,u]=m.useState(null),[l,h]=m.useState("idle"),[f,x]=m.useState(null),[g,p]=m.useState(0),y=m.useRef(null),E=m.useRef(null),j=m.useRef({}),R=m.useRef(null),S=m.useRef(!1);m.useEffect(()=>{const M=j.current;return()=>{R.current&&URL.revokeObjectURL(R.current),M.interval&&clearInterval(M.interval),M.timeout&&clearTimeout(M.timeout)}},[]);const N=m.useCallback(M=>ua.includes(M.type)?M.size>ma?n("validation.scoresheetUpload.fileTooLarge"):null:n("validation.scoresheetUpload.invalidFileType"),[n]),w=m.useCallback(M=>{j.current.interval&&clearInterval(j.current.interval),j.current.timeout&&clearTimeout(j.current.timeout),S.current=!0,h("uploading"),p(0),c.current?.(M,!1),j.current.interval=setInterval(()=>{p(F=>F>=An?(j.current.interval&&clearInterval(j.current.interval),F):F+Cn)},Jt/En),j.current.timeout=setTimeout(()=>{j.current.interval&&clearInterval(j.current.interval),p(Sn),h("complete"),S.current=!1,c.current?.(M,!0)},Jt)},[]),b=m.useCallback(M=>{if(S.current)return;const F=N(M);if(F){x(F);return}R.current&&URL.revokeObjectURL(R.current),x(null);const A=M.type.startsWith("image/")?URL.createObjectURL(M):null;R.current=A,u({file:M,previewUrl:A}),w(M)},[N,w]),v=m.useCallback(M=>{const F=M.target.files?.[0];F&&b(F),M.target.value=""},[b]),C=m.useCallback(()=>{R.current&&(URL.revokeObjectURL(R.current),R.current=null),j.current.interval&&clearInterval(j.current.interval),j.current.timeout&&clearTimeout(j.current.timeout),S.current=!1,u(null),h("idle"),p(0),x(null),c.current?.(null,!1)},[]),D=m.useCallback(()=>{C(),y.current?.click()},[C]),I=M=>n(`validation.scoresheetUpload.${M}`);return r?a.jsx("div",{className:"py-4",children:a.jsxs("div",{className:"border border-info-200 dark:border-info-800 bg-info-50 dark:bg-info-900/20 rounded-lg p-4 text-center",children:[a.jsx(fa,{className:"w-12 h-12 mx-auto text-info-500 mb-3","aria-hidden":"true"}),a.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1",children:n("validation.scoresheetUpload.notRequired")}),a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:n("validation.scoresheetUpload.notRequiredDescription")})]})}):e?a.jsx("div",{className:"py-4",children:a.jsx("div",{className:"border border-border-default dark:border-border-default-dark rounded-lg p-4 text-center",children:s?a.jsxs(a.Fragment,{children:[a.jsx(Je,{className:"w-12 h-12 mx-auto text-green-500 mb-3","aria-hidden":"true"}),a.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:n("validation.scoresheetUpload.scoresheetUploaded")})]}):a.jsxs(a.Fragment,{children:[a.jsx(Qe,{className:"w-12 h-12 mx-auto text-text-subtle dark:text-text-subtle-dark mb-3","aria-hidden":"true"}),a.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:n("validation.scoresheetUpload.noScoresheet")})]})})}):a.jsxs("div",{className:"py-4",children:[a.jsx("input",{ref:y,type:"file",accept:vn,onChange:v,className:"hidden","aria-label":I("selectFile")}),a.jsx("input",{ref:E,type:"file",accept:"image/jpeg,image/png",capture:"environment",onChange:v,className:"hidden","aria-label":I("takePhoto")}),d?a.jsxs("div",{className:"border border-border-default dark:border-border-default-dark rounded-lg overflow-hidden",children:[d.previewUrl?a.jsx("div",{className:"relative bg-surface-subtle dark:bg-surface-card-dark",children:a.jsx("img",{src:d.previewUrl,alt:I("previewAlt"),className:"w-full max-h-64 object-contain"})}):a.jsxs("div",{className:"bg-surface-subtle dark:bg-surface-card-dark p-8 flex flex-col items-center justify-center",children:[a.jsx(Qe,{className:"w-16 h-16 text-text-subtle dark:text-text-subtle-dark mb-2","aria-hidden":"true"}),a.jsx("span",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:"PDF"})]}),a.jsxs("div",{className:"p-4 bg-surface-card dark:bg-surface-card-dark",children:[l==="uploading"&&a.jsxs("div",{className:"mb-3",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted dark:text-text-muted-dark mb-1",children:[a.jsx("span",{children:I("uploading")}),a.jsxs("span",{children:[g,"%"]})]}),a.jsx("div",{className:"h-2 bg-surface-muted dark:bg-surface-subtle-dark rounded-full overflow-hidden",role:"progressbar","aria-valuenow":g,"aria-valuemin":0,"aria-valuemax":100,"aria-label":I("uploading"),children:a.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-200",style:{width:`${g}%`}})})]}),l==="complete"&&a.jsxs("div",{className:"mb-3 flex items-center gap-2 text-green-600 dark:text-green-400",role:"status","aria-live":"polite",children:[a.jsx(Je,{className:"w-5 h-5","aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium",children:I("uploadComplete")})]}),a.jsx("p",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark truncate",children:d.file.name}),a.jsx("p",{className:"text-xs text-text-muted dark:text-text-muted-dark",children:jn(d.file.size)}),a.jsxs("div",{className:"mt-4 flex gap-3",children:[a.jsx("button",{type:"button",onClick:D,disabled:l==="uploading",className:"flex-1 px-4 py-2 text-sm font-medium text-text-secondary dark:text-text-secondary-dark bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:I("replace")}),a.jsx("button",{type:"button",onClick:C,disabled:l==="uploading",className:"flex-1 px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:I("remove")})]})]})]}):a.jsxs("div",{className:"border-2 border-dashed border-border-strong dark:border-border-strong-dark rounded-lg p-6 text-center",children:[a.jsx(Ht,{className:"w-12 h-12 mx-auto text-text-subtle dark:text-text-subtle-dark mb-4","aria-hidden":"true"}),a.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1",children:I("title")}),a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark mb-4",children:I("description")}),a.jsxs("p",{className:"text-xs text-text-subtle dark:text-text-subtle-dark mb-4",children:[I("acceptedFormats")," â€¢ ",I("maxFileSize")]}),f&&a.jsxs("div",{role:"alert",className:"mb-4 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg flex items-center gap-2",children:[a.jsx(Ie,{className:"w-5 h-5 text-danger-500 flex-shrink-0","aria-hidden":"true"}),a.jsx("span",{className:"text-sm text-danger-700 dark:text-danger-400",children:f})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[a.jsxs("button",{type:"button",onClick:()=>y.current?.click(),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[a.jsx(Ht,{className:"w-4 h-4","aria-hidden":"true"}),I("selectFile")]}),a.jsxs("button",{type:"button",onClick:()=>E.current?.click(),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-text-secondary dark:text-text-secondary-dark bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark rounded-lg transition-colors",children:[a.jsx(St,{className:"w-4 h-4","aria-hidden":"true"}),I("takePhoto")]})]})]}),o&&a.jsx("p",{className:"mt-3 text-xs text-center text-text-subtle dark:text-text-subtle-dark",children:I("demoModeNote")})]})}const _n=60;function In({isOpen:t,onSaveAndClose:e,onDiscard:s,onCancel:r,isSaving:n}){const{t:i}=B(),o=m.useRef(null);return m.useEffect(()=>{t&&o.current&&o.current.querySelector("button")?.focus()},[t]),t?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:_n},"aria-hidden":"true",children:a.jsxs("div",{ref:o,className:"bg-surface-card dark:bg-surface-card-dark rounded-lg shadow-xl max-w-sm w-full p-6",role:"alertdialog","aria-modal":"true","aria-labelledby":"unsaved-changes-title","aria-describedby":"unsaved-changes-description",children:[a.jsx("h3",{id:"unsaved-changes-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark mb-2",children:i("validation.state.unsavedChangesTitle")}),a.jsx("p",{id:"unsaved-changes-description",className:"text-sm text-text-muted dark:text-text-muted-dark mb-4",children:i("validation.state.unsavedChangesMessage")}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx(G,{variant:"secondary",onClick:r,disabled:n,children:i("validation.state.continueEditing")}),a.jsx(G,{variant:"danger",onClick:s,disabled:n,children:i("validation.state.discardChanges")}),a.jsx(G,{variant:"primary",onClick:e,disabled:n,children:i(n?"common.loading":"validation.state.saveAndClose")})]})]})}):null}const Mn=60;function Tn({isOpen:t,rosterValidation:e,homeTeamName:s,awayTeamName:r,onGoBack:n,onProceedAnyway:i,isProceedingAnyway:o}){const{t:c,tInterpolate:d}=B(),u=m.useRef(null);if(m.useEffect(()=>{t&&u.current&&u.current.querySelector("button")?.focus()},[t]),m.useEffect(()=>{if(!t)return;const p=y=>{y.key==="Escape"&&!o&&n()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[t,o,n]),!t)return null;const{home:l,away:h}=e,f=[],x=[];l.hasHeadCoach||f.push({key:"home-coach",message:c("validation.rosterWarning.missingHeadCoach")}),l.hasMinPlayers||f.push({key:"home-players",message:d("validation.rosterWarning.insufficientPlayers",{count:l.playerCount,required:tt})}),h.hasHeadCoach||x.push({key:"away-coach",message:c("validation.rosterWarning.missingHeadCoach")}),h.hasMinPlayers||x.push({key:"away-players",message:d("validation.rosterWarning.insufficientPlayers",{count:h.playerCount,required:tt})});const g=p=>{p.target===p.currentTarget&&!o&&n()};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:Mn},onClick:g,"aria-hidden":"true",children:a.jsxs("div",{ref:u,className:"bg-surface-card dark:bg-surface-card-dark rounded-lg shadow-xl max-w-md w-full p-6",role:"alertdialog","aria-modal":"true","aria-labelledby":"roster-warning-title","aria-describedby":"roster-warning-description",children:[a.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[a.jsx("div",{className:"flex-shrink-0 p-2 bg-warning-100 dark:bg-warning-900/30 rounded-full",children:a.jsx(Nt,{className:"w-6 h-6 text-warning-600 dark:text-warning-400","aria-hidden":"true"})}),a.jsxs("div",{children:[a.jsx("h3",{id:"roster-warning-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:c("validation.rosterWarning.title")}),a.jsx("p",{id:"roster-warning-description",className:"text-sm text-text-muted dark:text-text-muted-dark mt-1",children:c("validation.rosterWarning.description")})]})]}),a.jsxs("div",{className:"space-y-3 mb-6",children:[f.length>0&&a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-3",children:[a.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-300 mb-1",children:s}),a.jsx("ul",{className:"list-disc list-inside text-sm text-warning-700 dark:text-warning-400 space-y-0.5",children:f.map(p=>a.jsx("li",{children:p.message},p.key))})]}),x.length>0&&a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-3",children:[a.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-300 mb-1",children:r}),a.jsx("ul",{className:"list-disc list-inside text-sm text-warning-700 dark:text-warning-400 space-y-0.5",children:x.map(p=>a.jsx("li",{children:p.message},p.key))})]})]}),a.jsx("p",{className:"text-xs text-text-muted dark:text-text-muted-dark mb-4",children:c("validation.rosterWarning.forfeitNote")}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx(G,{variant:"secondary",onClick:n,disabled:o,children:c("validation.rosterWarning.goBack")}),a.jsx(G,{variant:"danger",onClick:i,disabled:o,children:c(o?"common.loading":"validation.rosterWarning.proceedAnyway")})]})]})})}const es="safe-validation-complete-title",On="https://volleymanager.volleyball.ch";function Pn({isOpen:t,onClose:e}){const{t:s}=B(),r=m.useRef(!1),n=m.useCallback(()=>{if(!r.current){r.current=!0;try{window.open(On,"_blank","noopener,noreferrer"),e()}finally{r.current=!1}}},[e]),i=a.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-success-100 dark:bg-success-900 flex items-center justify-center",children:a.jsx("svg",{className:"w-6 h-6 text-success-600 dark:text-success-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});return a.jsxs(vt,{isOpen:t,onClose:e,titleId:es,size:"md",children:[a.jsx(Ct,{title:s("settings.safeValidationCompleteTitle"),titleId:es,icon:i}),a.jsx("div",{className:"mb-6",children:a.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary-dark",children:s("settings.safeValidationCompleteMessage")})}),a.jsxs(Ks,{divider:!0,children:[a.jsx(G,{variant:"secondary",className:"flex-1 rounded-md",onClick:e,children:s("common.close")}),a.jsx(G,{variant:"primary",className:"flex-1 rounded-md",onClick:n,children:s("settings.safeValidationCompleteButton")})]})]})}const Ln=70;function Bn({message:t}){return a.jsxs("div",{role:"status","aria-live":"polite",className:"fixed top-4 right-4 bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",style:{zIndex:Ln},children:[a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5","aria-hidden":"true",children:[a.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),a.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]}),a.jsx("span",{className:"text-sm font-medium",children:t})]})}function Dn({currentStepId:t,assignment:e,loading:s,validation:r,handlers:n}){const{t:i}=B();if(s.isLoading)return a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("common.loading")})});if(s.error)return a.jsx("div",{role:"alert",className:"p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",children:a.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:s.error.message})});const o=r.isValidated||r.isCurrentStepReadOnly,c=t==="home-roster"||t==="away-roster",d=!r.isValidated&&r.isCurrentStepReadOnly;return a.jsxs(ia,{modalName:"ValidateGameModal",onClose:n.onClose,children:[d&&a.jsxs("div",{role:"status",className:"mb-3 p-2.5 flex items-center gap-2 bg-surface-muted dark:bg-surface-subtle-dark border border-border-strong dark:border-border-strong-dark rounded-lg",children:[a.jsx(Ws,{className:"w-4 h-4 flex-shrink-0 text-text-muted dark:text-text-muted-dark","aria-hidden":"true"}),a.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary-dark",children:i(c?"validation.wizard.rosterFinalized":"validation.wizard.scoresheetFinalized")})]}),t==="home-roster"&&a.jsx(pn,{assignment:e,onModificationsChange:n.setHomeRosterModifications,onAddPlayerSheetOpenChange:n.onAddPlayerSheetOpenChange,readOnly:o,initialModifications:r.state.homeRoster.playerModifications,initialCoachModifications:r.state.homeRoster.coachModifications,prefetchedNominationList:r.homeNominationList}),t==="away-roster"&&a.jsx(xn,{assignment:e,onModificationsChange:n.setAwayRosterModifications,onAddPlayerSheetOpenChange:n.onAddPlayerSheetOpenChange,readOnly:o,initialModifications:r.state.awayRoster.playerModifications,initialCoachModifications:r.state.awayRoster.coachModifications,prefetchedNominationList:r.awayNominationList}),t==="scorer"&&a.jsx(kn,{onScorerChange:n.setScorer,readOnly:o,readOnlyScorerName:r.validatedInfo?.scorerName,readOnlyScorerBirthday:r.validatedInfo?.scorerBirthday,initialScorer:r.pendingScorer?{__identity:r.pendingScorer.__identity,displayName:r.pendingScorer.displayName,birthday:r.pendingScorer.birthday??""}:null},r.pendingScorer?.__identity??"no-pending-scorer"),t==="scoresheet"&&a.jsx(Rn,{onScoresheetChange:n.setScoresheet,readOnly:o,hasScoresheet:r.validatedInfo?.hasScoresheet,scoresheetNotRequired:r.scoresheetNotRequired})]})}function Fn({navigation:t,onBack:e,onNext:s,onClose:r,closeLabel:n}){const{t:i}=B();return a.jsxs(a.Fragment,{children:[a.jsx("div",{children:!t.isFirstStep&&a.jsx(G,{variant:"secondary",onClick:e,children:i("validation.wizard.previous")})}),a.jsx("div",{children:t.isLastStep?a.jsx(G,{variant:"primary",onClick:r,children:n}):a.jsx(G,{variant:"primary",onClick:s,children:i("validation.wizard.next")})})]})}function $n(t){const{t:e}=B();return a.jsx(Fn,{...t,closeLabel:e("common.close")})}function zn({navigation:t,onBack:e,onNext:s,onFinish:r,finishDisabled:n,isFinalizing:i}){const{t:o}=B();return a.jsxs(a.Fragment,{children:[a.jsx("div",{children:!t.isFirstStep&&a.jsx(G,{variant:"secondary",onClick:e,children:o("validation.wizard.previous")})}),a.jsx("div",{children:t.isLastStep?a.jsx(G,{variant:"success",onClick:()=>r(),disabled:n,children:o(i?"common.loading":"validation.wizard.finish")}):a.jsx(G,{variant:"primary",onClick:s,children:o("validation.wizard.next")})})]})}function Hn({navigation:t,state:e,onAttemptClose:s,onBack:r,onValidateAndNext:n,onFinish:i}){const{t:o}=B(),c=e.isFinalizing||e.isLoadingGameDetails||e.hasGameDetailsError,d=c||!e.allPreviousRequiredStepsDone||!e.currentStepIsOptional&&!e.canMarkCurrentStepDone;return a.jsxs(a.Fragment,{children:[a.jsx("div",{children:t.isFirstStep?a.jsx(G,{variant:"secondary",onClick:s,disabled:e.isFinalizing,children:o("common.cancel")}):a.jsx(G,{variant:"secondary",onClick:r,disabled:e.isFinalizing,children:o("validation.wizard.previous")})}),a.jsx("div",{children:t.isLastStep?a.jsx(G,{variant:"success",onClick:()=>i(),disabled:d,title:e.allPreviousRequiredStepsDone?void 0:o("validation.state.markAllStepsTooltip"),children:e.isFinalizing?o("common.loading"):o("validation.wizard.finish")}):a.jsx(G,{variant:"success",onClick:n,disabled:c||!e.canMarkCurrentStepDone,children:o("validation.wizard.validate")})})]})}const nr=.7,ir=.9,Un=4,Wn=5,st=Un/Wn,Vn=180,Gn={electronic:{widthPercent:nr,aspectRatio:st},manuscript:{widthPercent:ir,aspectRatio:st}},or=.92;function Kn(t,e,s,r,n){const i=Gn[n],o=t/e,c=s/r;let d,u,l,h;o>c?(u=e,d=e*c,l=(t-d)/2,h=0):(d=t,u=t/c,l=0,h=(e-u)/2);const f=d*i.widthPercent,x=f/i.aspectRatio,g=(d-f)/2,p=(u-x)/2;return{x:Math.round(l+g),y:Math.round(h+p),width:Math.round(f),height:Math.round(x)}}function Xn(t,e,s=or){const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const n=r.getContext("2d");return n?(n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),new Promise((i,o)=>{r.toBlob(c=>{c?i(c):o(new Error("Failed to create blob from canvas"))},"image/jpeg",s)})):Promise.reject(new Error("Could not get canvas context"))}function lr(t){return t*Math.PI/Vn}function qn(t,e,s){const r=lr(s),n=Math.abs(Math.sin(r)),i=Math.abs(Math.cos(r));return{width:t*i+e*n,height:t*n+e*i}}function Yn(t){return new Promise((e,s)=>{const r=new Image;r.addEventListener("load",()=>e(r)),r.addEventListener("error",n=>s(n)),r.src=t})}async function Zn(t,e,s,r=or){const n=await Yn(t),i=document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new Error("Could not get canvas context");const c=lr(s),{width:d,height:u}=qn(n.width,n.height,s);i.width=d,i.height=u,o.translate(d/2,u/2),o.rotate(c),o.translate(-n.width/2,-n.height/2),o.drawImage(n,0,0);const l=document.createElement("canvas"),h=l.getContext("2d");if(!h)throw new Error("Could not get cropped canvas context");return l.width=e.width,l.height=e.height,h.drawImage(i,e.x,e.y,e.width,e.height,0,0,e.width,e.height),new Promise((f,x)=>{l.toBlob(g=>{g?f(g):x(new Error("Failed to create blob from canvas"))},"image/jpeg",r)})}const Qn=17,Jn=20,ei=Qn/Jn,ti=4,si=5,ri=ti/si,ai=.5,ni=3,ts=90;function ii({imageBlob:t,scoresheetType:e,onConfirm:s,onCancel:r}){const{t:n}=B(),i=m.useMemo(()=>URL.createObjectURL(t),[t]);m.useEffect(()=>()=>URL.revokeObjectURL(i),[i]);const[o,c]=m.useState({x:0,y:0}),[d,u]=m.useState(1),[l,h]=m.useState(0),[f,x]=m.useState(null),[g,p]=m.useState(!1),[y,E]=m.useState(null),j=e==="electronic"?ei:ri,R=m.useCallback((b,v)=>{x(v)},[]),S=m.useCallback(()=>{h(b=>b-ts)},[]),N=m.useCallback(()=>{h(b=>b+ts)},[]),w=m.useCallback(async()=>{if(f){p(!0),E(null);try{const b=await Zn(i,f,l);s(b)}catch(b){console.error("Failed to crop image:",b),E(n("validation.ocr.errors.processingFailed")),p(!1)}}},[f,i,l,s,n]);return a.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-gray-900",children:[a.jsx("div",{className:"relative flex-1",children:a.jsx(xa,{image:i,crop:o,zoom:d,rotation:l,aspect:j,minZoom:ai,maxZoom:ni,onCropChange:c,onZoomChange:u,onRotationChange:h,onCropComplete:R,showGrid:!0,classes:{containerClassName:"!absolute !inset-0",cropAreaClassName:"!border-2 !border-white/90"}})}),a.jsxs("div",{className:"flex-shrink-0 py-2 px-4",children:[y&&a.jsxs("div",{className:"flex items-center gap-2 mb-2 px-3 py-2 text-sm text-red-200 bg-red-900/50 rounded",role:"alert",children:[a.jsx(Ie,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),y]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("button",{type:"button",onClick:S,className:"p-2 text-gray-300 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors","aria-label":n("validation.ocr.rotateLeft"),children:a.jsx(Ia,{className:"w-6 h-6","aria-hidden":"true"})}),a.jsx("span",{className:"px-3 py-1 text-sm text-gray-300 bg-white/10 rounded",children:n("validation.ocr.photoGuide.alignScoresheet")}),a.jsx("button",{type:"button",onClick:N,className:"p-2 text-gray-300 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors","aria-label":n("validation.ocr.rotateRight"),children:a.jsx(Ta,{className:"w-6 h-6","aria-hidden":"true"})})]})]}),a.jsxs("div",{className:"flex-shrink-0 flex gap-4 p-4 bg-white dark:bg-gray-800",children:[a.jsxs("button",{type:"button",onClick:r,disabled:g,className:"flex-1 flex items-center justify-center gap-2 min-h-12 px-4 py-3 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-medium transition-colors disabled:opacity-50",children:[a.jsx(fe,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.cancel")]}),a.jsxs("button",{type:"button",onClick:w,disabled:g||!f,className:"flex-1 flex items-center justify-center gap-2 min-h-12 px-4 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg font-medium transition-colors disabled:opacity-50",children:[a.jsx(Ve,{className:"w-5 h-5","aria-hidden":"true"}),n(g?"validation.ocr.processing":"common.confirm")]})]})]})}const oi=100;function li({scoresheetType:t}){const{t:e}=B(),s=t==="electronic",n={width:`${(s?nr:ir)*oi}%`,aspectRatio:`${st}`},i=e(s?"validation.ocr.photoGuide.electronicHint":"validation.ocr.photoGuide.manuscriptHint");return a.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40"}),a.jsxs("div",{className:"relative border-2 border-white/80 rounded-lg bg-transparent z-10",style:n,children:[a.jsx("div",{className:"absolute -top-0.5 -left-0.5 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl-lg"}),a.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr-lg"}),a.jsx("div",{className:"absolute -bottom-0.5 -left-0.5 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl-lg"}),a.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-6 h-6 border-b-4 border-r-4 border-white rounded-br-lg"}),a.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[a.jsx("div",{className:"w-8 h-0.5 bg-white/50"}),a.jsx("div",{className:"absolute w-0.5 h-8 bg-white/50"})]}),a.jsx("div",{className:"absolute -bottom-10 left-0 right-0 text-center",children:a.jsx("span",{className:"text-sm text-white/90 bg-black/50 px-3 py-1 rounded-full",children:i})})]}),a.jsx("div",{className:"absolute top-4 left-0 right-0 text-center z-10",children:a.jsx("span",{className:"text-sm font-medium text-white/90 bg-black/50 px-4 py-2 rounded-lg",children:e("validation.ocr.photoGuide.alignScoresheet")})})]})}const ci=10,ss=1024,di=ci*ss*ss,ui=["image/jpeg","image/png","image/webp"],mi=".jpg,.jpeg,.png,.webp",hi={facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},rs=.92;function fi({isOpen:t,scoresheetType:e,onClose:s,onImageSelected:r}){const{t:n}=B(),i=m.useRef(null),o=m.useRef(null),c=m.useRef(null),[d,u]=m.useState("select"),[l,h]=m.useState(null),[f,x]=m.useState(null),[g,p]=m.useState(!1),y=m.useCallback(()=>{c.current&&(c.current.getTracks().forEach(v=>v.stop()),c.current=null),o.current&&(o.current.srcObject=null)},[]);m.useEffect(()=>()=>{y()},[y]),m.useEffect(()=>{d==="camera"&&c.current&&o.current&&(o.current.srcObject=c.current,o.current.play().catch(console.error))},[d]),m.useEffect(()=>{if(!t)return;const v=C=>{C.key==="Escape"&&(d==="camera"?(y(),u("select")):d==="crop"?(x(null),u("select")):s())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[t,d,s,y]);const E=m.useCallback(async()=>{h(null),p(!1);try{const v=await navigator.mediaDevices.getUserMedia({video:hi,audio:!1});c.current=v,u("camera")}catch(v){console.error("Camera access error:",v),p(!0),h(n("validation.ocr.errors.cameraNotAvailable"))}},[n]),j=m.useCallback(async()=>{const v=o.current;if(!v)return;const C=document.createElement("canvas");C.width=v.videoWidth,C.height=v.videoHeight;const D=C.getContext("2d");if(!D)return;D.drawImage(v,0,0,C.width,C.height);const I=Kn(v.videoWidth,v.videoHeight,v.clientWidth,v.clientHeight,e);try{const M=await Xn(C,I,rs);y(),x(M),u("crop")}catch(M){console.error("Failed to crop captured image:",M),C.toBlob(F=>{F&&(y(),x(F),u("crop"))},"image/jpeg",rs)}},[y,e]),R=m.useCallback(v=>{const C=v.target.files?.[0];if(C){if(v.target.value="",h(null),!ui.includes(C.type)){h(n("validation.scoresheetUpload.invalidFileType"));return}if(C.size>di){h(n("validation.ocr.errors.imageTooLarge"));return}x(C),u("crop")}},[n]),S=m.useCallback(()=>{h(null),i.current?.click()},[]),N=m.useCallback(v=>{r(v)},[r]),w=m.useCallback(()=>{x(null),u("select")},[]),b=m.useCallback(()=>{y(),u("select")},[y]);return t?d==="crop"&&f?a.jsx(ii,{imageBlob:f,scoresheetType:e,onConfirm:N,onCancel:w}):d==="camera"?a.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-gray-900",children:[a.jsxs("div",{className:"relative flex-1 min-h-0 overflow-hidden",children:[a.jsx("video",{ref:o,className:"w-full h-full object-cover bg-gray-800",autoPlay:!0,playsInline:!0,muted:!0}),a.jsx(li,{scoresheetType:e})]}),a.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-6 py-4 bg-gray-900 safe-area-bottom",children:[a.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-white bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition-colors",children:n("validation.ocr.cancel")}),a.jsx("button",{type:"button",onClick:j,className:"w-16 h-16 rounded-full bg-white hover:bg-gray-100 flex items-center justify-center transition-colors","aria-label":n("validation.ocr.takePhoto"),children:a.jsx("div",{className:"w-12 h-12 rounded-full bg-danger-500"})}),a.jsx("div",{className:"w-20"})]})]}):a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-capture-title",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-sm w-full mx-4 overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("h2",{id:"ocr-capture-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("validation.ocr.scanScoresheet")}),a.jsx("button",{type:"button",onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":n("common.close"),children:a.jsx(fe,{className:"w-5 h-5","aria-hidden":"true"})})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n("validation.ocr.scanScoresheetDescription")}),l&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",role:"alert",children:[a.jsx(Ie,{className:"w-5 h-5 text-danger-500 flex-shrink-0","aria-hidden":"true"}),a.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:l})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("button",{type:"button",onClick:g?S:E,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors font-medium",children:[a.jsx(St,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.takePhoto")]}),a.jsxs("button",{type:"button",onClick:S,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 hover:bg-primary-100 dark:hover:bg-primary-900/50 border border-primary-200 dark:border-primary-800 rounded-lg transition-colors font-medium",children:[a.jsx(Zs,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.selectImage")]}),a.jsx("button",{type:"button",onClick:s,className:"w-full px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors font-medium",children:n("validation.ocr.cancel")})]}),a.jsx("input",{ref:i,type:"file",accept:mi,onChange:R,className:"hidden","aria-hidden":"true"})]})]})}):null}const pi="https://volleykit-proxy.takishima.workers.dev/ocr",as=95,ns=50,xi=8,is=20,os=10,gi=20,yi=40,bi=80,Ni=100;class ls{#a;#e=!1;#s;#t=null;constructor(e,s){this.#a=e,this.#s=s??pi}#r(e,s){this.#a?.({status:e,progress:s})}async initialize(){if(!this.#e){this.#r("Initializing Mistral OCR...",0);try{const e=this.#s.replace("/ocr","/health");this.#t=new AbortController;const s=await fetch(e,{method:"GET",signal:this.#t.signal});if(this.#t=null,!s.ok)throw new Error("OCR service health check failed");this.#r("Mistral OCR ready",os),this.#e=!0}catch(e){if(this.#t=null,e instanceof Error&&e.name==="AbortError")throw new Error("OCR cancelled",{cause:e});console.warn("OCR service health check failed, will attempt OCR anyway:",e),this.#r("Mistral OCR ready (health check skipped)",os),this.#e=!0}}}#n(e){const n=new DOMParser().parseFromString(e,"text/html").querySelector("table");if(!n)return[e];const i=[],o=n.querySelectorAll("tr");for(const c of o){const d=c.querySelectorAll("th, td"),u=Array.from(d).map(l=>l.textContent?.trim()??"").filter(l=>l.length>0);u.length>0&&i.push(u.join("	"))}return i}#i(e){return typeof e=="string"?e:typeof e=="object"&&e!==null&&typeof e.content=="string"?e.content:(console.warn("Unexpected table format:",e),"")}#o(e,s){if(!s||s.length===0)return e;let r=e;for(let n=0;n<s.length;n++){const i=s[n];if(!i)continue;const o=`[tbl-${n}.html](tbl-${n}.html)`,c=this.#i(i),u=this.#n(c).join(`
`);r=r.replace(o,u)}return r}#l(e){const s=e.pages.map(o=>this.#o(o.markdown,o.tables??[])).join(`

--- Page Break ---

`).trim(),n=s.split(`
`).map((o,c)=>{const u=o.split(/\s+/).filter(l=>l.length>0).map((l,h)=>({text:l,confidence:as,bbox:{x0:h*ns,y0:c*is,x1:h*ns+l.length*xi,y1:(c+1)*is}}));return{text:o,confidence:as,words:u}}),i=n.flatMap(o=>o.words);return{fullText:s,lines:n,words:i,hasPreciseBoundingBoxes:!1}}async recognize(e){if(!this.#e)throw new Error("MistralOCR not initialized. Call initialize() first.");this.#r("Uploading image...",gi),this.#t=new AbortController;try{const s=new FormData;s.append("image",e,"scoresheet.jpg"),this.#r("Processing with Mistral OCR...",yi);const r=await fetch(this.#s,{method:"POST",body:s,signal:this.#t.signal});if(this.#r("Receiving results...",bi),!r.ok){const i=await r.json().catch(()=>({}));throw new Error(i.error??`OCR request failed: ${r.status}`)}const n=await r.json();return this.#r("Processing complete",Ni),this.#l(n)}catch(s){throw s instanceof Error&&s.name==="AbortError"?new Error("OCR cancelled",{cause:s}):s}finally{this.#t=null}}async terminate(){this.#t&&(this.#t.abort(),this.#t=null),this.#e=!1}}const wi=1500,ki=200,vi=300,cs=95,ds=50,Ci=8,us=20,Ai=50,Si=60,Ei=90,ji=100,Ri=`VBC Heimteam	VBC Gastteam
N.	Name of the player	License	N.	Name of the player	License
1	MÃœLLER ANNA	OK	3	SCHMIDT LISA	OK
4	WEBER MARIE	OK	7	FISCHER JULIA	OK
6	SCHNEIDER LAURA	OK	9	MEYER SARAH	OK
8	ZIMMERMANN NINA	OK	11	WAGNER EMMA	OK
10	HUBER LENA	OK	13	BECKER MILA	OK
12	KELLER SOPHIE	OK	15	HOFFMANN PAULA	OK
LIBERO
L1	2 BRUNNER LEA	OK	L1	5 KOCH CLARA	OK
OFFICIAL MEMBERS ADMITTED ON THE BENCH
C	Hans Trainer	C	Peter Coach
AC	Maria Assistentin	AC	Sandra Helper`;function _i(t){const s=t.split(`
`).map((r,n)=>{const i=r.split(/\s+/).filter(o=>o.length>0);return{text:r,confidence:cs,words:i.map((o,c)=>({text:o,confidence:cs,bbox:{x0:c*ds,y0:n*us,x1:c*ds+o.length*Ci,y1:(n+1)*us}}))}});return{fullText:t,lines:s,words:s.flatMap(r=>r.words),hasPreciseBoundingBoxes:!1}}const Ii=_i(Ri);class ms{#a;#e=!1;constructor(e){this.#a=e}#s(e,s){this.#a?.({status:e,progress:s})}async initialize(){this.#e||(this.#s("Initializing stub OCR...",0),await new Promise(e=>setTimeout(e,ki)),this.#s("Stub OCR ready",Ai),this.#e=!0)}async recognize(e){if(!this.#e)throw new Error("StubOCR not initialized. Call initialize() first.");return this.#s("Processing image...",Si),await new Promise(s=>setTimeout(s,wi)),this.#s("Extracting text...",Ei),await new Promise(s=>setTimeout(s,vi)),this.#s("Complete",ji),Ii}async terminate(){this.#e=!1}}const Mi=3e3,rt="https://volleykit-proxy.ngn-damien.workers.dev/ocr";async function Ti(){try{const t=rt.replace("/ocr","/health");return(await fetch(t,{method:"GET",signal:AbortSignal.timeout(Mi)})).ok}catch{return!1}}const Oi={create(t){return new ls(t,rt)},async createWithFallback(t){return await Ti()?new ls(t,rt):(console.warn("OCR proxy not available, falling back to stub implementation"),new ms(t))},createStub(t){return new ms(t)}},cr=99,dr=2,hs=3,Pi=.6,at=new Set(["C","AC","AC2","AC3","AC4","M"]),Li={O:"0",o:"0",Q:"0",D:"0",I:"1",l:"1",i:"1","|":"1",Z:"2",z:"2",E:"3",A:"4",S:"5",s:"5",G:"6",b:"6",T:"7",B:"8",g:"9",q:"9"},Bi={0:"O",1:"I","|":"I",5:"S",8:"B","@":"A","&":"A","â‚¬":"E","Â£":"L","Â¢":"C"};function Di(t){return t.split("").map(e=>Li[e]??e).join("")}function Fi(t){return t.split("").map(e=>Bi[e]??e).join("")}function $i(t){if(!t)return null;const e=t.trim(),s=Di(e),r=/^(\d{1,2})$/.exec(s);if(r){const n=parseInt(r[1],10);if(n>=1&&n<=cr)return n}return null}function we(t){return t?Fi(t).toLowerCase().split(/[\s-]+/).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}function jt(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=we(s[0]);return{lastName:o,firstName:"",displayName:o}}const r=we(s[0]),n=s.slice(1).map(we).join(" "),i=`${n} ${r}`;return{lastName:r,firstName:n,displayName:i}}function nt(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=we(s[0]);return{lastName:o,firstName:"",displayName:o}}const r=we(s[s.length-1]),n=s.slice(0,-1).map(we).join(" "),i=`${n} ${r}`;return{lastName:r,firstName:n,displayName:i}}const zi=3,Rt=[/punkte.*points.*punti/i,/lizenz.*licence.*licenza/i,/spieler.*joueur.*giocatore/i,/name.*nom.*nome/i,/mannschaft.*equipe.*squadra/i,/offizielle.*officiels.*ufficiali/i,/kapitÃ¤n.*capitaine.*capitano/i,/trainer.*entraÃ®neur.*allenatore/i,/aader\/ou\/o/i],Hi=10,Ui=[/^[\d\s.]+$/,/^["T:\s]+$/i,/^\d+$/];function Wi(t){const e=t.trim();return e.length<2||e.length>=Hi&&/^[\d\s]+$/.test(e)?!0:Ui.some(s=>s.test(e))}function Vi(t){const e=t.split(`
`),s=e.some(o=>Rt.some(c=>c.test(o))),n=e.filter(o=>o.includes("	")).length>=zi,i=/[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+/.test(t);return s&&(n||i)}function Gi(t){if(!t||t.trim().length===0)return[];const e=[],s=/([a-zÃ -Ã¿])([A-Z]\.)/g,i=t.replace(s,"$1|||$2").replace(/([a-zÃ -Ã¿])([A-Z][a-zÃ -Ã¿])/g,"$1|||$2").split("|||").filter(o=>o.trim().length>0);for(const o of i){const c=o.trim();c.length>=2&&e.push(c)}return e}function Ki(t){if(!t||t.trim().length===0)return[];const e=[];let s=t;for(;s.length>0;){const r=s.match(/^(\d{1,2})\.(\d{1,2})\.((?:19|20)\d{2})/);if(r){e.push(r[0]),s=s.substring(r[0].length);continue}const n=s.match(/^(\d{1,2})\.(\d{1,2})\.(\d{2})/);if(n){e.push(n[0]),s=s.substring(n[0].length);continue}s=s.substring(1)}return e}const ur=["VTV","TV","VBC","BC","VC","SC","FC","STV","TSV","USC","US"],Xi=3;function qi(t){return t.replace(/aader\/ou\/o\s*B?\s*/gi," ").replace(/punkte[\s\S]*?punti\s*/i," ").replace(/\s+/g," ").trim()}function Yi(t){const s=t.trim().split(/\s+/);for(;s.length>1&&/^\d+$/.test(s[s.length-1]);)s.pop();return s.join(" ")}function Zi(t,e,s){const r=t.substring(e+s.length).trim();let n=r.length;for(const o of ur){const c=r.toUpperCase().indexOf(` ${o} `);c>=0&&c<n&&(n=c)}const i=r.substring(0,n).trim();return Yi(`${s} ${i}`)}function Qi(t,e,s){const r=e===0||/\s/.test(t[e-1]),n=e+s,i=n>=t.length||/\s/.test(t[n]);return r&&i}function Ji(t){const e=qi(t),s=e.toUpperCase();for(const r of ur){const n=s.indexOf(r);if(n<0||!Qi(e,n,r.length))continue;const i=Zi(e,n,r);if(i.length>Xi)return i}return null}function eo(t){return t.every(e=>Rt.some(s=>s.test(e)))}function to(t){const e=t.split(`
`);for(const s of e){if(!s.includes("	"))continue;const r=s.split("	").map(i=>i.trim());if(eo(r))continue;const n=[];for(const i of r){const o=Ji(i);o&&!n.includes(o)&&n.push(o)}if(n.length>=2)return{teamA:n[0],teamB:n[1]};if(n.length===1)return{teamA:n[0],teamB:""}}return{teamA:"",teamB:""}}const so=14,ro=14,ao=3,no=/^\d{1,2}\.\d{1,2}\.\d{2,4}$/,io=/^[A-Za-zÃ€-Ã¿]/,mr=/^\d{1,2}$/;function fs(t,e){let s=e,r="",n=null,i="";if(s<t.length&&no.test(t[s])&&(r=t[s],s++),s<t.length&&mr.test(t[s])&&(n=parseInt(t[s],10),n>cr&&(n=null),s++),s<t.length&&io.test(t[s])&&(i=t[s],s++),!i)return{player:null,nextIndex:s};const o=jt(i);return{player:{shirtNumber:n,lastName:o.lastName,firstName:o.firstName,displayName:o.displayName,rawName:i,licenseStatus:"",birthDate:r||void 0},nextIndex:s}}function oo(t){const e=t.split("	").map(i=>i.trim()).filter(i=>i.length>0);if(e.length<ao)return{teamA:null,teamB:null};let s=0;mr.test(e[0])&&parseInt(e[0],10)<=ro&&(s=1);const r=fs(e,s);s=r.nextIndex;const n=fs(e,s);return{teamA:r.player,teamB:n.player}}function lo(t){const e=t.split("	").map(i=>i.trim()).filter(i=>i.length>0);let s=null,r=null,n=0;if(n<e.length){const i=e[n].toUpperCase();if(at.has(i)&&(n++,n<e.length&&/^[A-Za-zÃ€-Ã¿]/.test(e[n]))){const o=e[n],c=nt(o);s={role:i,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:o},n++}}if(n<e.length){const i=e[n].toUpperCase();if(at.has(i)&&(n++,n<e.length&&/^[A-Za-zÃ€-Ã¿]/.test(e[n]))){const o=e[n],c=nt(o);r={role:i,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:o}}}return{teamA:s,teamB:r}}const co=/[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+/,uo=/\d{1,2}\.\d{1,2}\.\d{2,4}.*\d{1,2}\.\d{1,2}\.\d{2,4}/,mo=/^[CA]C?\d?\t/i;function ho(t,e){const s=jt(t);return{shirtNumber:null,lastName:s.lastName,firstName:s.firstName,displayName:s.displayName,rawName:t,licenseStatus:"",birthDate:e}}function fo(t){const e=[],s=[],r=[],n=[],i=Math.ceil(t.length/2);for(let o=0;o<t.length;o++){const c=t[o],d=o<i;if(co.test(c)){const u=Gi(c);d?e.push(...u):s.push(...u)}if(uo.test(c)){const u=Ki(c);d?r.push(...u):n.push(...u)}}return{firstHalfNames:e,secondHalfNames:s,firstHalfDates:r,secondHalfDates:n}}function ps(t,e,s){for(let r=0;r<e.length&&!(t.players.length>=so);r++){const n=ho(e[r],s[r]);t.players.push(n)}}function po(t,e,s,r,n){if(e||mo.test(t)){const i=lo(t);return i.teamA&&r.officials.push(i.teamA),i.teamB&&n.officials.push(i.teamB),!0}if(s){const i=oo(t);return i.teamA&&r.players.push(i.teamA),i.teamB&&n.players.push(i.teamB),!0}return!1}function xo(t){return!!(Wi(t)||Rt.some(e=>e.test(t))&&!t.includes("	"))}function go(t){return _t(t)?"libero":It(t)?"officials":Mt(t)?"end":null}function yo(t,e){const s=[];return t.players.length===0&&s.push("No players found for Team A"),e.players.length===0&&s.push("No players found for Team B"),t.officials.length===0&&e.officials.length===0&&s.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),s}function bo(t){const e=t.split(`
`).map(d=>d.trim()),s=to(t),r={name:s.teamA,players:[],officials:[]},n={name:s.teamB,players:[],officials:[]};let i=!1,o=!1;for(const d of e){if(xo(d))continue;const u=go(d);if(u==="end")break;if(u==="libero"){i=!0,o=!1;continue}if(u==="officials"){o=!0,i=!1;continue}if(!d.includes("	")||po(d,o,i,r,n))continue;const l=d.split("	"),h=fo(l);ps(r,h.firstHalfNames,h.firstHalfDates),ps(n,h.secondHalfNames,h.secondHalfDates)}const c=yo(r,n);return{teamA:r,teamB:n,warnings:c}}const hr=/^(\d{1,2})[\s.:_-]+([A-Za-zÃ€-Ã¿][A-Za-zÃ€-Ã¿\s]*)/,fr=/^([0-9OoIlZzSsGgBb]{1,2})[\s.:_-]+([A-Za-zÃ€-Ã¿][A-Za-zÃ€-Ã¿\s]*)/,No=/^(C|AC\d?)[\s.:_-]+([a-zÃ -Ã¿][a-zÃ -Ã¿\s]*)/i;function wo(t){const e=t.toUpperCase();return e.includes("TEAM A")||e.includes("TEAM B")||e.includes("Ã‰QUIPE A")||e.includes("Ã‰QUIPE B")||e.includes("MANNSCHAFT A")||e.includes("MANNSCHAFT B")||e.includes("HOME")||e.includes("AWAY")||e.includes("HEIM")||e.includes("GAST")}function _t(t){return t.toUpperCase().includes("LIBERO")}function It(t){const e=t.toUpperCase();return e.includes("OFFICIAL")||e.startsWith("COACH")||/^TRAINER\b/.test(e)}function Mt(t){const e=t.toUpperCase();return e.includes("SIGNATURE")||e.includes("CAPTAIN")||e.includes("REFEREE")||e.includes("ARBITRE")}function ko(t){let e=hr.exec(t);if(e||(e=fr.exec(t)),!e)return null;const s=e[1],r=e[2].trim(),n=$i(s);if(r.length<dr)return null;const i=jt(r);return{shirtNumber:n,lastName:i.lastName,firstName:i.firstName,displayName:i.displayName,rawName:r,licenseStatus:""}}function xs(t){const e=No.exec(t);if(!e)return null;const s=e[1].toUpperCase(),r=e[2].trim();if(!at.has(s)||r.length<dr)return null;const n=nt(r);return{role:s,lastName:n.lastName,firstName:n.firstName,displayName:n.displayName,rawName:r}}function pr(t){const e=t.trim();if(e.length<hs||hr.test(e)||fr.test(e)||_t(e)||It(e)||Mt(e))return null;const s=(e.match(/[A-Za-zÃ€-Ã¿]/g)??[]).length;return s>=hs&&s/e.length>Pi?e:null}const vo=["TEAM A","Ã‰QUIPE A","MANNSCHAFT A","HOME","HEIM"],Co=["TEAM B","Ã‰QUIPE B","MANNSCHAFT B","AWAY","GAST"],Ao=/TEAM\s*A|Ã‰QUIPE\s*A|MANNSCHAFT\s*A|HOME|HEIM/i,So=/TEAM\s*B|Ã‰QUIPE\s*B|MANNSCHAFT\s*B|AWAY|GAST/i;function Eo(t){return vo.some(e=>t.includes(e))}function jo(t){return Co.some(e=>t.includes(e))}function gs(t,e){const s=t.replace(e,"").trim();return pr(s)??""}function Ro(t,e){const s=t.toUpperCase();if(Eo(s)){const r=gs(t,Ao);return r&&(e.teamAName=r),{team:"A",isTeamA:!0}}if(jo(s)){const r=gs(t,So);return r&&(e.teamBName=r),{team:"B",isTeamA:!1}}return null}function _o(t){const e={teamALines:[],teamBLines:[],teamAName:"",teamBName:""};let s=null,r=!1;for(const n of t){const i=n.trim();if(i){if(wo(i)){const o=Ro(i,e);if(o){s=o.team,o.isTeamA&&(r=!0);continue}}if(!r&&!e.teamAName){const o=pr(i);if(o){e.teamAName=o,s="A";continue}}s===null&&(s="A"),s==="A"?e.teamALines.push(i):e.teamBLines.push(i)}}return e}function ys(t,e){const s={name:e,players:[],officials:[]},r=[];let n=!1;for(const i of t){if(It(i)){n=!0;continue}if(Mt(i))break;if(!_t(i))if(n){const o=xs(i);o&&s.officials.push(o)}else{const o=ko(i);if(o){s.players.push(o);continue}const c=xs(i);c&&s.officials.push(c)}}return{team:s,warnings:r}}function Io(t){const e=[],s={name:"",players:[],officials:[]};if(!t||typeof t!="string")return e.push("No OCR text provided"),{teamA:{...s},teamB:{...s},warnings:e};const r=t.split(`
`).map(c=>c.trim()).filter(c=>c.length>0);if(r.length===0)return e.push("OCR text contains no lines"),{teamA:{...s},teamB:{...s},warnings:e};if(Vi(t))return bo(t);const n=_o(r),i=ys(n.teamALines,n.teamAName),o=ys(n.teamBLines,n.teamBName);return e.push(...i.warnings),e.push(...o.warnings),i.team.players.length===0&&e.push("No players found for Team A"),o.team.players.length===0&&n.teamBLines.length>0&&e.push("No players found for Team B"),{teamA:i.team,teamB:o.team,warnings:e}}const ye=3,Me=6,xr=2,gr=4,yr=0,br=1,Nr=2,wr=3,kr=4,vr=5,Cr=2,Ar=3,Mo=3,To=3,it=3,ot=99,Oo=4,Po=50,bs=new Set(["NOT","LFP","OK","NE","PEN"]),Lo=5;function Bo(t){if(!t||t.includes("	"))return null;const s=t.trim().split(/\s+/);if(s.length<Lo)return null;const r=s[0];if(!/^\d{1,2}$/.test(r))return null;const n=parseInt(r,10);if(n<1||n>ot)return null;let i=-1;for(let g=2;g<s.length-2;g++)if(bs.has(s[g].toUpperCase())){i=g;break}if(i===-1)return null;const o=s[i],c=s.slice(1,i);if(c.length===0)return null;const d=s[i+1];if(!d||!/^\d{1,2}$/.test(d))return null;const u=parseInt(d,10);if(u<1||u>ot)return null;const l=s.slice(i+2);if(l.length===0)return null;const h=l[l.length-1];let f="",x=l;return bs.has(h.toUpperCase())&&(f=h,x=l.slice(0,-1)),x.length===0?null:{teamAParts:[r,c.join(" "),o],teamBParts:[d,x.join(" "),f]}}function Tt(t){if(!t||t.includes("	"))return null;const e=t.trim(),s=e.search(/\s{3,}/);if(s===-1)return null;const r=e.slice(s).search(/\S/);if(r===-1)return null;const n=e.slice(0,s),i=e.slice(s+r),o=n.replace(/^[AB]\s+/,"").trim(),c=i.replace(/^[AB]\s+/,"").trim();return o.length>=it&&c.length>=it?[o,c]:null}function ke(t){return t?t.toLowerCase().split(/[\s-]+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}function lt(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=ke(s[0]);return{lastName:o,firstName:"",displayName:o}}const r=ke(s[0]),n=s.slice(1).map(ke).join(" "),i=`${n} ${r}`;return{lastName:r,firstName:n,displayName:i}}function Do(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=ke(s[0]);return{lastName:o,firstName:"",displayName:o}}const r=ke(s[s.length-1]),n=s.slice(0,-1).map(ke).join(" "),i=`${n} ${r}`;return{lastName:r,firstName:n,displayName:i}}function Fo(t){if(!t||typeof t!="string")return null;const e=t.trim(),s=/^L\d?\s+(\d{1,2})$/.exec(e);return s?parseInt(s[1],10):null}function $o(t){if(!t||typeof t!="string")return{number:null,name:""};const e=t.trim(),s=/^(\d{1,2})\s+(\S[\s\S]*?)$/.exec(e);return s?{number:parseInt(s[1],10),name:s[2].trim()}:{number:null,name:e}}function Sr(t){const e=t.toUpperCase();return e.includes("OFFICIAL MEMBERS")||e.includes("ADMITTED ON THE BENCH")}function Er(t){const e=t.toUpperCase();return e.includes("SIGNATURES")||e.includes("TEAM CAPTAIN")}function jr(t,e){return t.toUpperCase().includes("LIBERO")&&e.length<=2}const zo=new Set(["C","AC","AC2","AC3","AC4","M"]);function Ho(t){return zo.has(t.toUpperCase().trim())}function Ns(t){const e=t.toUpperCase();return e.includes("LIBERO")||e.includes("N.")||e.includes("NAME OF THE PLAYER")}function Uo(t){const e=/[a-zA-Z]{3,}/;return t.some(s=>e.test(s))}function Wo(t,e){const s=Math.max(0,e-To);for(let r=e-1;r>=s;r--){const n=t[r];if(!n)continue;const i=n.split("	").filter(c=>c.trim().length>0);if(i.length>=2&&Uo(i)||Tt(n))return r}return-1}function Vo(t){const e=t.split("	");if(e.length<ye)return!1;const s=e[0].trim();if(!/^\d{1,2}$/.test(s))return!1;const r=parseInt(s,10);if(r<1||r>ot)return!1;const n=e[1].trim();return/^[A-Z\s]+$/.test(n)&&n.length>it}function Rr(t){for(let e=0;e<t.length;e++){const s=t[e];if(!s)continue;const r=s.toUpperCase();if(r.includes("NAME OF THE PLAYER")||r.includes("N.")&&r.includes("NAME"))return{startIndex:e+1,teamNamesIndex:Wo(t,e)}}for(let e=0;e<t.length;e++){const s=t[e];if(s&&Vo(s))return{startIndex:e,teamNamesIndex:e-1}}return{startIndex:0,teamNamesIndex:-1}}function ve(t){return t.replace(/^[AB]\s+/,"").trim()}function _r(t,e){if(e<0||e>=t.length)return{teamAName:"",teamBName:""};const s=t[e];if(!s)return{teamAName:"",teamBName:""};const r=s.split("	").map(i=>i.trim()).filter(i=>i.length>0);if(r.length>=2)return{teamAName:ve(r[0]),teamBName:ve(r[1])};const n=Tt(s);return n?{teamAName:n[0],teamBName:n[1]}:r.length===1?{teamAName:ve(r[0]),teamBName:""}:{teamAName:"",teamBName:""}}function he(t,e){const s=t[e],r=t[e+1],n=t[e+2];if(!s||!r)return null;const i=parseInt(s,10);if(isNaN(i))return null;const o=lt(r);return{shirtNumber:i,lastName:o.lastName,firstName:o.firstName,displayName:o.displayName,rawName:r,licenseStatus:n||""}}function Ce(t,e,s,r){const n=t[e],i=t[s];if(!n||!i)return null;const o=Fo(n);if(o===null){const d=$o(i);if(d.name){const u=lt(d.name);return{shirtNumber:d.number,lastName:u.lastName,firstName:u.firstName,displayName:u.displayName,rawName:d.name,licenseStatus:t[r]||""}}return null}const c=lt(i);return{shirtNumber:o,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:i,licenseStatus:t[r]||""}}function Ae(t,e,s){const r=t[e],n=t[s];if(!r||!Ho(r)||!n)return null;const i=Do(n);return{role:r.toUpperCase(),lastName:i.lastName,firstName:i.firstName,displayName:i.displayName,rawName:n}}function Ot(t){return t.teamAColumnEnded||t.seenTwoColumnPlayers}function Ir(t,e,s){if(s.headerRowsParsed===0&&!Ns(e)){if(t.length>=2)s.teamA.name=ve(t[0]),s.teamB.name=ve(t[1]);else if(t.length===1){const r=Tt(e);r?(s.teamA.name=r[0],s.teamB.name=r[1]):s.teamA.name=ve(t[0])}return s.headerRowsParsed++,"header"}return Ns(e)?"players":(s.headerRowsParsed++,s.headerRowsParsed>Mo?"players":"header")}function Go(t,e,s){if(t.length<ye){const n=Bo(e);if(n){s.seenTwoColumnPlayers=!0;const i=he(n.teamAParts,0);i&&s.teamA.players.push(i);const o=he(n.teamBParts,0);o&&s.teamB.players.push(o)}return}if(t.length>=Me){s.seenTwoColumnPlayers=!0;const n=he(t,0);n&&s.teamA.players.push(n);const i=he(t,ye);i&&s.teamB.players.push(i)}else{const n=he(t,0);n&&(Ot(s)?(s.teamAColumnEnded=!0,s.teamB.players.push(n)):s.teamA.players.push(n))}}function Ko(t,e){if(t.length<ye)return;if(t.length>=Me){const r=Ce(t,yr,br,Nr);r&&e.teamA.players.push(r);const n=Ce(t,wr,kr,vr);n&&e.teamB.players.push(n)}else{const r=Ce(t,0,1,2);r&&(Ot(e)?e.teamB.players.push(r):e.teamA.players.push(r))}}function Xo(t,e){if(t.length<xr)return;if(t.length>=gr){const r=Ae(t,0,1);r&&e.teamA.officials.push(r);const n=Ae(t,Cr,Ar);n&&e.teamB.officials.push(n)}else{const r=Ae(t,0,1);r&&(Ot(e)?e.teamB.officials.push(r):e.teamA.officials.push(r))}}function qo(t,e){if(Er(t)){e.section="done";return}if(e.section==="done")return;if(Sr(t)){e.section="officials";return}const s=t.split("	").map(r=>r.trim());if(jr(t,s)){e.section="libero";return}switch(e.section){case"header":e.section=Ir(s,t,e);break;case"players":Go(s,t,e);break;case"libero":Ko(s,e);break;case"officials":Xo(s,e);break}}function Yo(t){const e=[],s={section:"header",headerRowsParsed:0,teamA:{name:"",players:[],officials:[]},teamB:{name:"",players:[],officials:[]},seenTwoColumnPlayers:!1,teamAColumnEnded:!1};if(!t||typeof t!="string")return e.push("No OCR text provided"),{teamA:s.teamA,teamB:s.teamB,warnings:e};const r=t.split(`
`).map(l=>l.trim()).filter(l=>l.length>0),{startIndex:n,teamNamesIndex:i}=Rr(r);n>0&&e.push(`Skipped ${n} lines of non-player data (score/set information)`);const{teamAName:o,teamBName:c}=_r(r,i);s.teamA.name=o,s.teamB.name=c;const d=o.length>0||c.length>0;s.section=d?"players":"header";const u=r.slice(n);if(u.length===0)return e.push("OCR text contains no lines"),{teamA:s.teamA,teamB:s.teamB,warnings:e};for(const l of u)qo(l,s);return s.teamA.players.length===0&&e.push("No players found for Team A"),s.teamB.players.length===0&&e.push("No players found for Team B"),s.teamA.officials.length===0&&s.teamB.officials.length===0&&e.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),{teamA:s.teamA,teamB:s.teamB,warnings:e}}function Zo(t,e){if(t.text.includes("	")||!e.isValid||!t.words||t.words.length===0)return t.text;const s=[...t.words].sort((i,o)=>i.bbox.x0-o.bbox.x0),r=[],n=[];for(const i of s)(i.bbox.x0+i.bbox.x1)/2<e.midpoint?r.push(i.text):n.push(i.text);return r.length===0||n.length===0?t.text:`${r.join(" ")}	${n.join(" ")}`}function Qo(t){const e=[],s=[];for(const o of t){if(!o.words||o.words.length<Oo||o.text.split("	").filter(f=>f.trim().length>0).length<Me)continue;const u=[...o.words].sort((f,x)=>f.bbox.x0-x.bbox.x0);let l=0,h=-1;for(let f=0;f<u.length-1;f++){const x=u[f+1].bbox.x0-u[f].bbox.x1;x>l&&(l=x,h=f)}if(h>=0&&l>Po){const f=u[h].bbox.x1,x=u[h+1].bbox.x0;e.push(f),s.push(x)}}if(e.length<2||s.length<2)return{midpoint:0,isValid:!1};const r=e.reduce((o,c)=>o+c,0)/e.length,n=s.reduce((o,c)=>o+c,0)/s.length;return{midpoint:(r+n)/2,isValid:!0}}function Pt(t,e){return!e.isValid||!t.words||t.words.length===0?"B":t.words.reduce((r,n)=>r+n.bbox.x0,0)/t.words.length<e.midpoint?"A":"B"}function Jo(t,e){if(t.length<ye)return;if(t.length>=Me){e.seenTwoColumnPlayers=!0;const r=he(t,0);r&&e.teamA.players.push(r);const n=he(t,ye);n&&e.teamB.players.push(n)}else{const r=he(t,0);r&&e.currentLine?Pt(e.currentLine,e.columnBoundary)==="A"?e.teamA.players.push(r):(e.teamAColumnEnded=!0,e.teamB.players.push(r)):r&&(e.seenTwoColumnPlayers?(e.teamAColumnEnded=!0,e.teamB.players.push(r)):e.teamA.players.push(r))}}function el(t,e){if(t.length<ye)return;if(t.length>=Me){const r=Ce(t,yr,br,Nr);r&&e.teamA.players.push(r);const n=Ce(t,wr,kr,vr);n&&e.teamB.players.push(n)}else{const r=Ce(t,0,1,2);r&&e.currentLine?Pt(e.currentLine,e.columnBoundary)==="A"?e.teamA.players.push(r):e.teamB.players.push(r):r&&(e.teamAColumnEnded||e.seenTwoColumnPlayers?e.teamB.players.push(r):e.teamA.players.push(r))}}function tl(t,e){if(t.length<xr)return;if(t.length>=gr){const r=Ae(t,0,1);r&&e.teamA.officials.push(r);const n=Ae(t,Cr,Ar);n&&e.teamB.officials.push(n)}else{const r=Ae(t,0,1);r&&e.currentLine?Pt(e.currentLine,e.columnBoundary)==="A"?e.teamA.officials.push(r):e.teamB.officials.push(r):r&&(e.teamAColumnEnded||e.seenTwoColumnPlayers?e.teamB.officials.push(r):e.teamA.officials.push(r))}}function sl(t,e,s){if(e.currentLine=s,Er(t)){e.section="done";return}if(e.section==="done")return;if(Sr(t)){e.section="officials";return}const r=t.split("	").map(n=>n.trim());if(jr(t,r)){e.section="libero";return}switch(e.section){case"header":e.section=Ir(r,t,e);break;case"players":Jo(r,e);break;case"libero":el(r,e);break;case"officials":tl(r,e);break}}function rl(t,e){if((e?.type??"electronic")==="manuscript")return Io(t.fullText);const r=[];if(!t.lines||t.lines.length===0){const p=Yo(t.fullText);return{...p,warnings:["No OCR line data available, using text-only parsing",...p.warnings]}}const n=Qo(t.lines);n.isValid||r.push("Could not determine column boundaries from bounding boxes, using heuristic fallback");const i={section:"header",headerRowsParsed:0,teamA:{name:"",players:[],officials:[]},teamB:{name:"",players:[],officials:[]},seenTwoColumnPlayers:!1,teamAColumnEnded:!1,columnBoundary:n},o=[],c=new Map;for(const p of t.lines){const y=p.text.trim();if(!y)continue;const E=Zo(p,n);o.push(E),c.set(y,p),E!==y&&c.set(E,p)}const d=o.length>0?o:t.fullText.split(`
`).map(p=>p.trim()).filter(p=>p.length>0),{startIndex:u,teamNamesIndex:l}=Rr(d);u>0&&r.push(`Skipped ${u} lines of non-player data (score/set information)`);const{teamAName:h,teamBName:f}=_r(d,l);i.teamA.name=h,i.teamB.name=f;const x=h.length>0||f.length>0;i.section=x?"players":"header";const g=d.slice(u);if(g.length===0)return r.push("OCR text contains no lines"),{teamA:i.teamA,teamB:i.teamB,warnings:r};for(const p of g){const y=c.get(p);sl(p,i,y)}return i.teamA.players.length===0&&r.push("No players found for Team A"),i.teamB.players.length===0&&r.push("No players found for Team B"),i.teamA.officials.length===0&&i.teamB.officials.length===0&&r.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),{teamA:i.teamA,teamB:i.teamB,warnings:r}}function al(){const[t,e]=m.useState(!1),[s,r]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(null),[d,u]=m.useState(null),l=m.useRef(null),h=m.useCallback(async(g,p="electronic")=>{e(!0),r(null),i(null),c(null),u(null);try{const y=Oi.create(R=>{r(R)});l.current=y,await y.initialize();const E=await y.recognize(g),j=rl(E,{type:p});return await y.terminate(),l.current=null,i(j),c(E),e(!1),j}catch(y){const E=y instanceof Error?y:new Error(String(y));return E.message!=="OCR cancelled"&&u(E),e(!1),l.current=null,null}},[]),f=m.useCallback(async()=>{if(l.current){try{await l.current.terminate()}catch{}l.current=null}e(!1),r(null)},[]),x=m.useCallback(()=>{e(!1),r(null),i(null),c(null),u(null)},[]);return{isProcessing:t,progress:s,result:n,ocrResult:o,error:d,processImage:h,cancel:f,reset:x}}function nl(t,e){return t.officials.filter(s=>s.role===e).length}function ws(t){return t.officials.some(e=>e.role==="AC3")}function ks(t){return nl(t,"M")>=2}function il(){const[t,e]=m.useState({isOpen:!1,type:null}),s=m.useCallback(n=>{ws(n.teamA)||ws(n.teamB)?e({isOpen:!0,type:"ac3"}):(ks(n.teamA)||ks(n.teamB))&&e({isOpen:!0,type:"multipleDoctors"})},[]),r=m.useCallback(()=>{e({isOpen:!1,type:null})},[]);return{easterEgg:t,checkForEasterEggs:s,dismissEasterEgg:r}}const vs=["#f94144","#f3722c","#f8961e","#f9c74f","#90be6d","#43aa8b","#4d908e","#577590","#277da1","#9b5de5"],ol=100,ll=.3,Cs=.99,cl=.015,dl=8,ul=8,ml=200,hl=.3,fl=10,pl=8,xl=8,As=.5,gl=.2,yl=.6,Ss=2,bl=4;function Nl(t=3e3){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const e=document.createElement("canvas");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e);const s=()=>{e.width=window.innerWidth,e.height=window.innerHeight};s(),window.addEventListener("resize",s);const r=e.getContext("2d");if(!r){e.parentNode&&e.parentNode.removeChild(e);return}const n=[],i=e.width/2;for(let u=0;u<ol;u++){const l=Math.random()*Math.PI*2,h=dl+Math.random()*ul;n.push({x:i+(Math.random()-As)*ml,y:e.height*hl,vx:Math.cos(l)*h,vy:Math.sin(l)*h-fl,color:vs[Math.floor(Math.random()*vs.length)],size:pl+Math.random()*xl,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-As)*gl,opacity:1})}let o;const c=Date.now(),d=()=>{const u=Date.now()-c;if(u>t||n.every(l=>l.opacity<=0)){cancelAnimationFrame(o),window.removeEventListener("resize",s),e.parentNode&&e.parentNode.removeChild(e);return}r.clearRect(0,0,e.width,e.height);for(const l of n)l.vy+=ll,l.vx*=Cs,l.vy*=Cs,l.x+=l.vx,l.y+=l.vy,l.rotation+=l.rotationSpeed,u>t*yl&&(l.opacity-=cl),l.opacity>0&&(r.save(),r.translate(l.x,l.y),r.rotate(l.rotation),r.globalAlpha=Math.max(0,l.opacity),r.fillStyle=l.color,r.fillRect(-l.size/Ss,-l.size/bl,l.size,l.size/Ss),r.restore());o=requestAnimationFrame(d)};d()}const wl=3e3;function kl({isOpen:t,type:e,onClose:s}){const{t:r}=B();m.useEffect(()=>{t&&Nl(wl)},[t]);const n=`easter-egg-${e}-title`,i=()=>{switch(e){case"ac3":return a.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center",children:a.jsx(Aa,{className:"w-6 h-6 text-amber-600 dark:text-amber-400","aria-hidden":"true"})});case"multipleDoctors":return a.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:a.jsx(Ba,{className:"w-6 h-6 text-red-600 dark:text-red-400","aria-hidden":"true"})})}};return a.jsxs(vt,{isOpen:t,onClose:s,titleId:n,size:"sm",zIndex:70,children:[a.jsx(Ct,{title:r(`easterEggs.${e}.title`),titleId:n,icon:i()}),a.jsx("p",{className:"text-text-secondary dark:text-text-secondary-dark mb-6",children:r(`easterEggs.${e}.message`)}),a.jsx(Ks,{children:a.jsx("button",{type:"button",onClick:s,className:"w-full px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:r("easterEggs.dismiss")})})]})}function oe(t){return Array.isArray?Array.isArray(t):Or(t)==="[object Array]"}function vl(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Cl(t){return t==null?"":vl(t)}function re(t){return typeof t=="string"}function Mr(t){return typeof t=="number"}function Al(t){return t===!0||t===!1||Sl(t)&&Or(t)=="[object Boolean]"}function Tr(t){return typeof t=="object"}function Sl(t){return Tr(t)&&t!==null}function Q(t){return t!=null}function Ye(t){return!t.trim().length}function Or(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const El="Incorrect 'index' type",jl=t=>`Invalid value for key ${t}`,Rl=t=>`Pattern length exceeds max of ${t}.`,_l=t=>`Missing ${t} property in key`,Il=t=>`Property 'weight' in key '${t}' must be a positive integer`,Es=Object.prototype.hasOwnProperty;class Ml{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(r=>{let n=Pr(r);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(r=>{r.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Pr(t){let e=null,s=null,r=null,n=1,i=null;if(re(t)||oe(t))r=t,e=js(t),s=ct(t);else{if(!Es.call(t,"name"))throw new Error(_l("name"));const o=t.name;if(r=o,Es.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(Il(o));e=js(o),s=ct(o),i=t.getFn}return{path:e,id:s,weight:n,src:r,getFn:i}}function js(t){return oe(t)?t:t.split(".")}function ct(t){return oe(t)?t.join("."):t}function Tl(t,e){let s=[],r=!1;const n=(i,o,c)=>{if(Q(i))if(!o[c])s.push(i);else{let d=o[c];const u=i[d];if(!Q(u))return;if(c===o.length-1&&(re(u)||Mr(u)||Al(u)))s.push(Cl(u));else if(oe(u)){r=!0;for(let l=0,h=u.length;l<h;l+=1)n(u[l],o,c+1)}else o.length&&n(u,o,c+1)}};return n(t,re(e)?e.split("."):e,0),r?s:s[0]}const Ol={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Pl={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},Ll={location:0,threshold:.6,distance:100},Bl={useExtendedSearch:!1,getFn:Tl,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var T={...Pl,...Ol,...Ll,...Bl};const Dl=/[^ ]+/g;function Fl(t=1,e=3){const s=new Map,r=Math.pow(10,e);return{get(n){const i=n.match(Dl).length;if(s.has(i))return s.get(i);const o=1/Math.pow(i,.5*t),c=parseFloat(Math.round(o*r)/r);return s.set(i,c),c},clear(){s.clear()}}}class Lt{constructor({getFn:e=T.getFn,fieldNormWeight:s=T.fieldNormWeight}={}){this.norm=Fl(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,r)=>{this._keysMap[s.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,re(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();re(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,r=this.size();s<r;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!Q(e)||Ye(e))return;let r={v:e,i:s,n:this.norm.get(e)};this.records.push(r)}_addObject(e,s){let r={i:s,$:{}};this.keys.forEach((n,i)=>{let o=n.getFn?n.getFn(e):this.getFn(e,n.path);if(Q(o)){if(oe(o)){let c=[];const d=[{nestedArrIndex:-1,value:o}];for(;d.length;){const{nestedArrIndex:u,value:l}=d.pop();if(Q(l))if(re(l)&&!Ye(l)){let h={v:l,i:u,n:this.norm.get(l)};c.push(h)}else oe(l)&&l.forEach((h,f)=>{d.push({nestedArrIndex:f,value:h})})}r.$[i]=c}else if(re(o)&&!Ye(o)){let c={v:o,n:this.norm.get(o)};r.$[i]=c}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function Lr(t,e,{getFn:s=T.getFn,fieldNormWeight:r=T.fieldNormWeight}={}){const n=new Lt({getFn:s,fieldNormWeight:r});return n.setKeys(t.map(Pr)),n.setSources(e),n.create(),n}function $l(t,{getFn:e=T.getFn,fieldNormWeight:s=T.fieldNormWeight}={}){const{keys:r,records:n}=t,i=new Lt({getFn:e,fieldNormWeight:s});return i.setKeys(r),i.setIndexRecords(n),i}function De(t,{errors:e=0,currentLocation:s=0,expectedLocation:r=0,distance:n=T.distance,ignoreLocation:i=T.ignoreLocation}={}){const o=e/t.length;if(i)return o;const c=Math.abs(r-s);return n?o+c/n:c?1:o}function zl(t=[],e=T.minMatchCharLength){let s=[],r=-1,n=-1,i=0;for(let o=t.length;i<o;i+=1){let c=t[i];c&&r===-1?r=i:!c&&r!==-1&&(n=i-1,n-r+1>=e&&s.push([r,n]),r=-1)}return t[i-1]&&i-r>=e&&s.push([r,i-1]),s}const ge=32;function Hl(t,e,s,{location:r=T.location,distance:n=T.distance,threshold:i=T.threshold,findAllMatches:o=T.findAllMatches,minMatchCharLength:c=T.minMatchCharLength,includeMatches:d=T.includeMatches,ignoreLocation:u=T.ignoreLocation}={}){if(e.length>ge)throw new Error(Rl(ge));const l=e.length,h=t.length,f=Math.max(0,Math.min(r,h));let x=i,g=f;const p=c>1||d,y=p?Array(h):[];let E;for(;(E=t.indexOf(e,g))>-1;){let b=De(e,{currentLocation:E,expectedLocation:f,distance:n,ignoreLocation:u});if(x=Math.min(b,x),g=E+l,p){let v=0;for(;v<l;)y[E+v]=1,v+=1}}g=-1;let j=[],R=1,S=l+h;const N=1<<l-1;for(let b=0;b<l;b+=1){let v=0,C=S;for(;v<C;)De(e,{errors:b,currentLocation:f+C,expectedLocation:f,distance:n,ignoreLocation:u})<=x?v=C:S=C,C=Math.floor((S-v)/2+v);S=C;let D=Math.max(1,f-C+1),I=o?h:Math.min(f+C,h)+l,M=Array(I+2);M[I+1]=(1<<b)-1;for(let A=I;A>=D;A-=1){let P=A-1,V=s[t.charAt(P)];if(p&&(y[P]=+!!V),M[A]=(M[A+1]<<1|1)&V,b&&(M[A]|=(j[A+1]|j[A])<<1|1|j[A+1]),M[A]&N&&(R=De(e,{errors:b,currentLocation:P,expectedLocation:f,distance:n,ignoreLocation:u}),R<=x)){if(x=R,g=P,g<=f)break;D=Math.max(1,2*f-g)}}if(De(e,{errors:b+1,currentLocation:f,expectedLocation:f,distance:n,ignoreLocation:u})>x)break;j=M}const w={isMatch:g>=0,score:Math.max(.001,R)};if(p){const b=zl(y,c);b.length?d&&(w.indices=b):w.isMatch=!1}return w}function Ul(t){let e={};for(let s=0,r=t.length;s<r;s+=1){const n=t.charAt(s);e[n]=(e[n]||0)|1<<r-s-1}return e}const He=String.prototype.normalize?(t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(t=>t);class Br{constructor(e,{location:s=T.location,threshold:r=T.threshold,distance:n=T.distance,includeMatches:i=T.includeMatches,findAllMatches:o=T.findAllMatches,minMatchCharLength:c=T.minMatchCharLength,isCaseSensitive:d=T.isCaseSensitive,ignoreDiacritics:u=T.ignoreDiacritics,ignoreLocation:l=T.ignoreLocation}={}){if(this.options={location:s,threshold:r,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:d,ignoreDiacritics:u,ignoreLocation:l},e=d?e:e.toLowerCase(),e=u?He(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(x,g)=>{this.chunks.push({pattern:x,alphabet:Ul(x),startIndex:g})},f=this.pattern.length;if(f>ge){let x=0;const g=f%ge,p=f-g;for(;x<p;)h(this.pattern.substr(x,ge),x),x+=ge;if(g){const y=f-ge;h(this.pattern.substr(y),y)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n}=this.options;if(e=s?e:e.toLowerCase(),e=r?He(e):e,this.pattern===e){let p={isMatch:!0,score:0};return n&&(p.indices=[[0,e.length-1]]),p}const{location:i,distance:o,threshold:c,findAllMatches:d,minMatchCharLength:u,ignoreLocation:l}=this.options;let h=[],f=0,x=!1;this.chunks.forEach(({pattern:p,alphabet:y,startIndex:E})=>{const{isMatch:j,score:R,indices:S}=Hl(e,p,y,{location:i+E,distance:o,threshold:c,findAllMatches:d,minMatchCharLength:u,includeMatches:n,ignoreLocation:l});j&&(x=!0),f+=R,j&&S&&(h=[...h,...S])});let g={isMatch:x,score:x?f/this.chunks.length:1};return x&&n&&(g.indices=h),g}}class pe{constructor(e){this.pattern=e}static isMultiMatch(e){return Rs(e,this.multiRegex)}static isSingleMatch(e){return Rs(e,this.singleRegex)}search(){}}function Rs(t,e){const s=t.match(e);return s?s[1]:null}class Wl extends pe{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Vl extends pe{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const r=e.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,e.length-1]}}}class Gl extends pe{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Kl extends pe{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Xl extends pe{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class ql extends pe{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Dr extends pe{constructor(e,{location:s=T.location,threshold:r=T.threshold,distance:n=T.distance,includeMatches:i=T.includeMatches,findAllMatches:o=T.findAllMatches,minMatchCharLength:c=T.minMatchCharLength,isCaseSensitive:d=T.isCaseSensitive,ignoreDiacritics:u=T.ignoreDiacritics,ignoreLocation:l=T.ignoreLocation}={}){super(e),this._bitapSearch=new Br(e,{location:s,threshold:r,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:d,ignoreDiacritics:u,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Fr extends pe{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,r;const n=[],i=this.pattern.length;for(;(r=e.indexOf(this.pattern,s))>-1;)s=r+i,n.push([r,s-1]);const o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}const dt=[Wl,Fr,Gl,Kl,ql,Xl,Vl,Dr],_s=dt.length,Yl=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Zl="|";function Ql(t,e={}){return t.split(Zl).map(s=>{let r=s.trim().split(Yl).filter(i=>i&&!!i.trim()),n=[];for(let i=0,o=r.length;i<o;i+=1){const c=r[i];let d=!1,u=-1;for(;!d&&++u<_s;){const l=dt[u];let h=l.isMultiMatch(c);h&&(n.push(new l(h,e)),d=!0)}if(!d)for(u=-1;++u<_s;){const l=dt[u];let h=l.isSingleMatch(c);if(h){n.push(new l(h,e));break}}}return n})}const Jl=new Set([Dr.type,Fr.type]);class ec{constructor(e,{isCaseSensitive:s=T.isCaseSensitive,ignoreDiacritics:r=T.ignoreDiacritics,includeMatches:n=T.includeMatches,minMatchCharLength:i=T.minMatchCharLength,ignoreLocation:o=T.ignoreLocation,findAllMatches:c=T.findAllMatches,location:d=T.location,threshold:u=T.threshold,distance:l=T.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:i,findAllMatches:c,ignoreLocation:o,location:d,threshold:u,distance:l},e=s?e:e.toLowerCase(),e=r?He(e):e,this.pattern=e,this.query=Ql(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:i}=this.options;e=n?e:e.toLowerCase(),e=i?He(e):e;let o=0,c=[],d=0;for(let u=0,l=s.length;u<l;u+=1){const h=s[u];c.length=0,o=0;for(let f=0,x=h.length;f<x;f+=1){const g=h[f],{isMatch:p,indices:y,score:E}=g.search(e);if(p){if(o+=1,d+=E,r){const j=g.constructor.type;Jl.has(j)?c=[...c,...y]:c.push(y)}}else{d=0,o=0,c.length=0;break}}if(o){let f={isMatch:!0,score:d/o};return r&&(f.indices=c),f}}return{isMatch:!1,score:1}}}const ut=[];function tc(...t){ut.push(...t)}function mt(t,e){for(let s=0,r=ut.length;s<r;s+=1){let n=ut[s];if(n.condition(t,e))return new n(t,e)}return new Br(t,e)}const Ue={AND:"$and",OR:"$or"},ht={PATH:"$path",PATTERN:"$val"},ft=t=>!!(t[Ue.AND]||t[Ue.OR]),sc=t=>!!t[ht.PATH],rc=t=>!oe(t)&&Tr(t)&&!ft(t),Is=t=>({[Ue.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function $r(t,e,{auto:s=!0}={}){const r=n=>{let i=Object.keys(n);const o=sc(n);if(!o&&i.length>1&&!ft(n))return r(Is(n));if(rc(n)){const d=o?n[ht.PATH]:i[0],u=o?n[ht.PATTERN]:n[d];if(!re(u))throw new Error(jl(d));const l={keyId:ct(d),pattern:u};return s&&(l.searcher=mt(u,e)),l}let c={children:[],operator:i[0]};return i.forEach(d=>{const u=n[d];oe(u)&&u.forEach(l=>{c.children.push(r(l))})}),c};return ft(t)||(t=Is(t)),r(t)}function ac(t,{ignoreFieldNorm:e=T.ignoreFieldNorm}){t.forEach(s=>{let r=1;s.matches.forEach(({key:n,norm:i,score:o})=>{const c=n?n.weight:null;r*=Math.pow(o===0&&c?Number.EPSILON:o,(c||1)*(e?1:i))}),s.score=r})}function nc(t,e){const s=t.matches;e.matches=[],Q(s)&&s.forEach(r=>{if(!Q(r.indices)||!r.indices.length)return;const{indices:n,value:i}=r;let o={indices:n,value:i};r.key&&(o.key=r.key.src),r.idx>-1&&(o.refIndex=r.idx),e.matches.push(o)})}function ic(t,e){e.score=t.score}function oc(t,e,{includeMatches:s=T.includeMatches,includeScore:r=T.includeScore}={}){const n=[];return s&&n.push(nc),r&&n.push(ic),t.map(i=>{const{idx:o}=i,c={item:e[o],refIndex:o};return n.length&&n.forEach(d=>{d(i,c)}),c})}class ae{constructor(e,s={},r){this.options={...T,...s},this.options.useExtendedSearch,this._keyStore=new Ml(this.options.keys),this.setCollection(e,r)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof Lt))throw new Error(El);this._myIndex=s||Lr(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Q(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let r=0,n=this._docs.length;r<n;r+=1){const i=this._docs[r];e(i,r)&&(this.removeAt(r),r-=1,n-=1,s.push(i))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:r,includeScore:n,shouldSort:i,sortFn:o,ignoreFieldNorm:c}=this.options;let d=re(e)?re(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return ac(d,{ignoreFieldNorm:c}),i&&d.sort(o),Mr(s)&&s>-1&&(d=d.slice(0,s)),oc(d,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(e){const s=mt(e,this.options),{records:r}=this._myIndex,n=[];return r.forEach(({v:i,i:o,n:c})=>{if(!Q(i))return;const{isMatch:d,score:u,indices:l}=s.searchIn(i);d&&n.push({item:i,idx:o,matches:[{score:u,value:i,norm:c,indices:l}]})}),n}_searchLogical(e){const s=$r(e,this.options),r=(c,d,u)=>{if(!c.children){const{keyId:h,searcher:f}=c,x=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(d,h),searcher:f});return x&&x.length?[{idx:u,item:d,matches:x}]:[]}const l=[];for(let h=0,f=c.children.length;h<f;h+=1){const x=c.children[h],g=r(x,d,u);if(g.length)l.push(...g);else if(c.operator===Ue.AND)return[]}return l},n=this._myIndex.records,i={},o=[];return n.forEach(({$:c,i:d})=>{if(Q(c)){let u=r(s,c,d);u.length&&(i[d]||(i[d]={idx:d,item:c,matches:[]},o.push(i[d])),u.forEach(({matches:l})=>{i[d].matches.push(...l)}))}}),o}_searchObjectList(e){const s=mt(e,this.options),{keys:r,records:n}=this._myIndex,i=[];return n.forEach(({$:o,i:c})=>{if(!Q(o))return;let d=[];r.forEach((u,l)=>{d.push(...this._findMatches({key:u,value:o[l],searcher:s}))}),d.length&&i.push({idx:c,item:o,matches:d})}),i}_findMatches({key:e,value:s,searcher:r}){if(!Q(s))return[];let n=[];if(oe(s))s.forEach(({v:i,i:o,n:c})=>{if(!Q(i))return;const{isMatch:d,score:u,indices:l}=r.searchIn(i);d&&n.push({score:u,key:e,value:i,idx:o,norm:c,indices:l})});else{const{v:i,n:o}=s,{isMatch:c,score:d,indices:u}=r.searchIn(i);c&&n.push({score:d,key:e,value:i,norm:o,indices:u})}return n}}ae.version="7.1.0";ae.createIndex=Lr;ae.parseIndex=$l;ae.config=T;ae.parseQuery=$r;tc(ec);const lc=50,Ms=.6,Ts=.4,zr=90,Hr=85,Ur=95,cc=.4,Wr=.6,Re={threshold:cc,ignoreLocation:!0,includeScore:!0},Bt=100,Vr=new Set(["de","del","della","di","du","von","van","den","der","la","le","las","los","dos","da","das"]);function dc(t){const e=new Map;for(const s of t){const r=[s.firstName??"",s.lastName??""].filter(x=>x&&x.trim()).join(" "),n=Se(r),i=n?n.split(" ").filter(x=>x.length>=2||Vr.has(x)):[],o=i.length>0?new ae(i,Re):null,c=Se(s.lastName??""),d=c?c.split(" ").filter(x=>x.length>1):[],u=d.length>0?new ae(d,Re):null,l=Se(s.firstName??""),h=l?l.split(" ").filter(x=>x.length>1):[],f=h.length>0?new ae(h,Re):null;e.set(s.id,{fullNameWords:i,fullNameFuse:o,lastNameWords:d,lastNameFuse:u,firstNameWords:h,firstNameFuse:f})}return e}function Se(t){return t?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function We(t){return Se(t)}function pt(t){const e=We(t);return e?e.split(" ").filter(s=>s.length>=2||Vr.has(s)):[]}function uc(t,e){const s=pt(t),r=pt(e);if(s.length===0||r.length===0)return 0;const n=new ae(r,Re);let i=0;const o=new Set;for(const d of s){const u=n.search(d);for(const l of u){const h=l.refIndex;if(o.has(h))continue;const f=1-(l.score??1);if(f>0){i+=f,o.add(h);break}}}const c=Math.max(s.length,r.length);return Math.round(i/c*Ur)}function Os(t,e){const s=We(t),r=We(e);if(!s||!r)return 0;if(s===r)return Bt;if(s.includes(r)||r.includes(s)){const l=s.length<r.length?s:r,h=s.length>=r.length?s:r;return Math.round(l.length/h.length*zr)}const n=s.split(" ").filter(l=>l.length>1),i=r.split(" ").filter(l=>l.length>1);if(i.length===0)return 0;const o=new ae(i,Re);let c=0;const d=new Set;for(const l of n){const h=o.search(l);for(const f of h){const x=f.refIndex;if(d.has(x))continue;const g=1-(f.score??1);if(g>Wr){c+=g,d.add(x);break}}}const u=Math.max(n.length,i.length);return u===0?0:Math.round(c/u*Hr)}function mc(t,e,s){const r=pt(t);if(r.length===0||e.length===0||!s)return 0;let n=0;const i=new Set;for(const c of r){const d=s.search(c);for(const u of d){const l=u.refIndex;if(i.has(l))continue;const h=1-(u.score??1);if(h>0){n+=h,i.add(l);break}}}const o=Math.max(r.length,e.length);return Math.round(n/o*Ur)}function Ps(t,e,s,r){const n=We(t);if(!n||!e)return 0;if(n===e)return Bt;if(n.includes(e)||e.includes(n)){const u=n.length<e.length?n:e,l=n.length>=e.length?n:e;return Math.round(u.length/l.length*zr)}const i=n.split(" ").filter(u=>u.length>1);if(s.length===0||!r)return 0;let o=0;const c=new Set;for(const u of i){const l=r.search(u);for(const h of l){const f=h.refIndex;if(c.has(f))continue;const x=1-(h.score??1);if(x>Wr){o+=x,c.add(f);break}}}const d=Math.max(i.length,s.length);return d===0?0:Math.round(o/d*Hr)}function Ls(t,e){return[t,e].filter(s=>s&&s.trim()).join(" ")}function hc(t,e,s,r){let n=null,i=0;const o=Ls(t.firstName,t.lastName);for(const c of e){if(s.has(c.id))continue;let d,u;const l=r?.get(c.id);if(l){const f=Se(c.lastName??""),x=Se(c.firstName??""),g=Ps(t.lastName,f,l.lastNameWords,l.lastNameFuse),p=Ps(t.firstName,x,l.firstNameWords,l.firstNameFuse);d=g*Ms+p*Ts,u=mc(o,l.fullNameWords,l.fullNameFuse)}else{const f=Os(t.lastName,c.lastName??""),x=Os(t.firstName,c.firstName??"");d=f*Ms+x*Ts;const g=Ls(c.firstName??"",c.lastName??"");u=uc(o,g)}const h=Math.max(d,u);h>i&&(i=h,n=c)}return i<lc?{player:null,confidence:0}:{player:n,confidence:Math.min(Bt,Math.round(i))}}function Fe(t,e){const s=[],r=new Set,n=dc(e);for(const o of t){const{player:c,confidence:d}=hc(o,e,r,n);c?(r.add(c.id),s.push({status:"match",ocrPlayer:o,rosterPlayerId:c.id,rosterPlayerName:c.displayName,confidence:d})):s.push({status:"ocr-only",ocrPlayer:o,rosterPlayerId:null,rosterPlayerName:null,confidence:0})}for(const o of e)r.has(o.id)||s.push({status:"roster-only",ocrPlayer:null,rosterPlayerId:o.id,rosterPlayerName:o.displayName,confidence:0});const i={match:0,"ocr-only":1,"roster-only":2};return s.sort((o,c)=>i[o.status]-i[c.status]),s}function fc(t,e){switch(t){case"match":return{icon:Ve,iconColor:"text-success-500",bgColor:"bg-success-50 dark:bg-success-900/20",borderColor:"border-success-200 dark:border-success-800",label:e("validation.ocr.comparison.matched")};case"ocr-only":return{icon:Nt,iconColor:"text-warning-500",bgColor:"bg-warning-50 dark:bg-warning-900/20",borderColor:"border-warning-200 dark:border-warning-800",label:e("validation.ocr.comparison.ocrOnly")};case"roster-only":return{icon:ka,iconColor:"text-danger-500",bgColor:"bg-danger-50 dark:bg-danger-900/20",borderColor:"border-danger-200 dark:border-danger-800",label:e("validation.ocr.comparison.rosterOnly")}}}function Ze({result:t,isSelected:e,onToggle:s,isSelectable:r}){const{t:n,tInterpolate:i}=B(),o=fc(t.status,n),c=o.icon,d=t.status==="roster-only"?t.rosterPlayerName:t.ocrPlayer?.displayName,u=t.status==="match"?t.rosterPlayerName:null;return a.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${o.bgColor} ${o.borderColor}`,children:[r&&a.jsx("input",{type:"checkbox",checked:e,onChange:s,className:"w-4 h-4 text-primary-500 border-gray-300 rounded focus:ring-primary-500 focus:ring-2","aria-label":`Select ${d}`}),a.jsx("div",{className:`flex-shrink-0 ${o.iconColor}`,children:a.jsx(c,{className:"w-5 h-5","aria-hidden":"true"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ha,{className:"w-4 h-4 text-gray-400 flex-shrink-0","aria-hidden":"true"}),a.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:d})]}),u&&a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate",children:u})]}),a.jsxs("div",{className:"flex flex-col items-end gap-1",children:[a.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${o.bgColor} ${o.iconColor}`,children:o.label}),t.confidence>0&&a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("validation.ocr.comparison.confidence",{score:String(t.confidence)})})]})]})}function $e({results:t,selectedPlayerIds:e,onTogglePlayer:s,onSelectAll:r,onDeselectAll:n,readOnly:i=!1}){const{t:o,tInterpolate:c}=B(),{matched:d,ocrOnly:u,rosterOnly:l}=m.useMemo(()=>({matched:t.filter(p=>p.status==="match"),ocrOnly:t.filter(p=>p.status==="ocr-only"),rosterOnly:t.filter(p=>p.status==="roster-only")}),[t]),h=d.length,f=e.size,x=h>0&&f===h,g=!i&&h>0&&r&&n;return t.length===0?a.jsx("div",{className:"py-8 text-center",children:a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o("validation.ocr.comparison.noMatches")})}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[d.length>0&&a.jsx("span",{className:"px-2 py-1 bg-success-50 dark:bg-success-900/20 text-success-700 dark:text-success-400 rounded-full",children:c("validation.ocr.comparison.matchedCount",{count:String(d.length)})}),u.length>0&&a.jsx("span",{className:"px-2 py-1 bg-warning-50 dark:bg-warning-900/20 text-warning-700 dark:text-warning-400 rounded-full",children:c("validation.ocr.comparison.ocrOnlyCount",{count:String(u.length)})}),l.length>0&&a.jsx("span",{className:"px-2 py-1 bg-danger-50 dark:bg-danger-900/20 text-danger-700 dark:text-danger-400 rounded-full",children:c("validation.ocr.comparison.rosterOnlyCount",{count:String(l.length)})})]}),g&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{type:"button",onClick:x?n:r,className:"text-xs text-primary-600 dark:text-primary-400 hover:underline",children:o(x?"validation.ocr.comparison.deselectAll":"validation.ocr.comparison.selectAll")}),a.jsxs("span",{className:"text-xs text-gray-400",children:["(",f,"/",h,")"]})]}),d.length>0&&a.jsx("div",{className:"space-y-2",children:d.map(p=>a.jsx(Ze,{result:p,isSelected:p.rosterPlayerId?e.has(p.rosterPlayerId):!1,onToggle:()=>p.rosterPlayerId&&s(p.rosterPlayerId),isSelectable:!i&&!!p.rosterPlayerId},p.rosterPlayerId??p.ocrPlayer?.rawName))}),u.length>0&&a.jsx("div",{className:"space-y-2",children:u.map(p=>a.jsx(Ze,{result:p,isSelected:!1,onToggle:()=>{},isSelectable:!1},`ocr-only-${p.ocrPlayer?.rawName??p.ocrPlayer?.displayName}`))}),l.length>0&&a.jsx("div",{className:"space-y-2",children:l.map(p=>a.jsx(Ze,{result:p,isSelected:!1,onToggle:()=>{},isSelectable:!1},p.rosterPlayerId))})]})}function Bs(t){return t.map(e=>({shirtNumber:null,lastName:e.lastName,firstName:e.firstName,displayName:e.displayName,rawName:e.rawName,licenseStatus:""}))}function Ds(t){return t.map(e=>({id:e.id,displayName:e.displayName,firstName:e.firstName,lastName:e.lastName}))}function pc({isOpen:t,homeTeamName:e,awayTeamName:s,homeRosterPlayers:r,awayRosterPlayers:n,homeRosterCoaches:i,awayRosterCoaches:o,onSkip:c,onComplete:d,onClose:u}){const{t:l}=B(),{processImage:h,progress:f,error:x,reset:g,ocrResult:p}=al(),{easterEgg:y,checkForEasterEggs:E,dismissEasterEgg:j}=il(),[R,S]=m.useState("intro"),[N,w]=m.useState(!1),[b,v]=m.useState("electronic"),[C,D]=m.useState(null),[I,M]=m.useState(null),[F,A]=m.useState(null),[P,V]=m.useState(null),[X,le]=m.useState(null),[ne,xe]=m.useState(new Set(["home-players","away-players"])),ce=m.useRef(!1);m.useEffect(()=>{if(!t||N)return;const L=U=>{U.key==="Escape"&&u()};return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[t,N,u]),m.useEffect(()=>{t&&(S("intro"),v("electronic"),D(null),M(null),A(null),V(null),X&&URL.revokeObjectURL(X),le(null),xe(new Set(["home-players","away-players"])),g())},[t,g]),m.useEffect(()=>()=>{X&&URL.revokeObjectURL(X)},[X]),m.useEffect(()=>{p&&V(p)},[p]);const be=m.useCallback(L=>{const U=L.teamA.name.toLowerCase(),$=L.teamB.name.toLowerCase(),k=e.toLowerCase(),_=s.toLowerCase(),O=U.includes(k)||k.includes(U),W=U.includes(_)||_.includes(U),q=$.includes(k)||k.includes($),ue=$.includes(_)||_.includes($);return O&&!W?{homeOCR:L.teamA,awayOCR:L.teamB}:W&&!O?{homeOCR:L.teamB,awayOCR:L.teamA}:q&&!ue?{homeOCR:L.teamB,awayOCR:L.teamA}:ue&&!q?{homeOCR:L.teamA,awayOCR:L.teamB}:{homeOCR:L.teamA,awayOCR:L.teamB}},[e,s]),J=m.useCallback(async L=>{if(ce.current)return;ce.current=!0,w(!1),S("processing");const U=URL.createObjectURL(L);le(U);try{const $=await h(L,b);if($){A($);const{homeOCR:k,awayOCR:_}=be($);if(k.players.length===0&&_.players.length===0){S("error");return}const O=Fe(k.players,r.map(Z=>({id:Z.id,displayName:Z.displayName,firstName:Z.firstName,lastName:Z.lastName}))),W=Fe(Bs(k.officials),Ds(i)),q=Fe(_.players,n.map(Z=>({id:Z.id,displayName:Z.displayName,firstName:Z.firstName,lastName:Z.lastName}))),ue=Fe(Bs(_.officials),Ds(o));D({teamName:e,ocrTeamName:k.name,playerResults:O,coachResults:W}),M({teamName:s,ocrTeamName:_.name,playerResults:q,coachResults:ue}),E($),S("results")}else S("error")}catch{S("error")}finally{ce.current=!1}},[h,b,be,e,s,r,n,i,o,E]),se=m.useCallback(()=>{g(),D(null),M(null),A(null),V(null),X&&URL.revokeObjectURL(X),le(null),S("capture"),w(!0)},[g,X]),de=m.useCallback(L=>{v(L),S("capture"),w(!0)},[]),ee=m.useCallback(L=>{xe(U=>{const $=new Set(U);return $.has(L)?$.delete(L):$.add(L),$})},[]);if(!t)return null;const Y=L=>{const U=L.filter(k=>k.status==="ocr-only").length,$=L.filter(k=>k.status==="roster-only").length;return U+$},H=(C?Y(C.playerResults)+Y(C.coachResults):0)+(I?Y(I.playerResults)+Y(I.coachResults):0);return a.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col bg-white dark:bg-gray-900",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-entry-title",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("div",{children:a.jsx("h1",{id:"ocr-entry-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scanScoresheet")})}),a.jsx("button",{type:"button",onClick:u,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":l("common.close"),children:a.jsx(fe,{className:"w-5 h-5","aria-hidden":"true"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[R==="intro"&&a.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",children:[a.jsx(St,{className:"w-16 h-16 text-primary-400 dark:text-primary-500 mb-4","aria-hidden":"true"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:l("validation.ocr.scanScoresheet")}),a.jsx("p",{className:"text-center text-gray-600 dark:text-gray-300 max-w-md mb-6",children:l("validation.ocr.scoresheetType.title")}),a.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-sm mb-6",children:[a.jsxs("button",{type:"button",onClick:()=>de("electronic"),className:"w-full flex items-start gap-4 p-4 bg-white dark:bg-gray-800 border-2 border-primary-500 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors text-left",children:[a.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-primary-100 dark:bg-primary-900/30",children:a.jsx(Qe,{className:"w-6 h-6 text-primary-600 dark:text-primary-400","aria-hidden":"true"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"block text-base font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scoresheetType.electronic")}),a.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:l("validation.ocr.scoresheetType.electronicDescription")})]})]}),a.jsxs("button",{type:"button",onClick:()=>de("manuscript"),className:"w-full flex items-start gap-4 p-4 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary-300 dark:hover:border-primary-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[a.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-700",children:a.jsx(Ea,{className:"w-6 h-6 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"block text-base font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scoresheetType.manuscript")}),a.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:l("validation.ocr.scoresheetType.manuscriptDescription")})]})]})]}),a.jsxs("button",{type:"button",onClick:c,className:"flex items-center justify-center gap-2 px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[a.jsx(Pa,{className:"w-4 h-4","aria-hidden":"true"}),l("tour.actions.skip")]})]}),R==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",role:"status","aria-live":"polite",children:[a.jsx(_e,{size:"lg",className:"mb-6"}),a.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:l("validation.ocr.processing")}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:f?.status??l("validation.ocr.processingDescription")}),f&&f.progress>0&&a.jsx("div",{className:"w-64 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mt-6 overflow-hidden",children:a.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-300",style:{width:`${f.progress}%`}})})]}),R==="results"&&a.jsxs("div",{className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-2 text-success-600 dark:text-success-400 mb-4",children:[a.jsx(Je,{className:"w-6 h-6","aria-hidden":"true"}),a.jsx("span",{className:"text-lg font-medium",children:l("validation.ocr.scanComplete")})]}),H>0&&a.jsx("div",{className:"mb-4 p-3 bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg",children:a.jsxs("p",{className:"text-sm text-warning-700 dark:text-warning-400",children:[H," discrepancies found"]})}),C&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:[C.teamName,C.ocrTeamName&&C.ocrTeamName!==C.teamName&&a.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(OCR: ",C.ocrTeamName,")"]})]}),a.jsx(ze,{title:l("validation.ocr.players"),count:C.playerResults.length,discrepancies:Y(C.playerResults),expanded:ne.has("home-players"),onToggle:()=>ee("home-players"),sectionId:"home-players",children:a.jsx($e,{results:C.playerResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})}),C.coachResults.length>0&&a.jsx(ze,{title:l("validation.ocr.coaches"),count:C.coachResults.length,discrepancies:Y(C.coachResults),expanded:ne.has("home-coaches"),onToggle:()=>ee("home-coaches"),sectionId:"home-coaches",children:a.jsx($e,{results:C.coachResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})})]}),I&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:[I.teamName,I.ocrTeamName&&I.ocrTeamName!==I.teamName&&a.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(OCR: ",I.ocrTeamName,")"]})]}),a.jsx(ze,{title:l("validation.ocr.players"),count:I.playerResults.length,discrepancies:Y(I.playerResults),expanded:ne.has("away-players"),onToggle:()=>ee("away-players"),sectionId:"away-players",children:a.jsx($e,{results:I.playerResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})}),I.coachResults.length>0&&a.jsx(ze,{title:l("validation.ocr.coaches"),count:I.coachResults.length,discrepancies:Y(I.coachResults),expanded:ne.has("away-coaches"),onToggle:()=>ee("away-coaches"),sectionId:"away-coaches",children:a.jsx($e,{results:I.coachResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})})]}),F&&a.jsx(xc,{data:F,ocrResult:P,imageUrl:X,expanded:ne.has("raw-ocr-data"),onToggle:()=>ee("raw-ocr-data")})]}),R==="error"&&a.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",role:"alert",children:[a.jsx(Ie,{className:"w-16 h-16 text-danger-500 mb-6","aria-hidden":"true"}),a.jsx("p",{className:"text-lg font-medium text-danger-700 dark:text-danger-400 mb-2",children:l("validation.ocr.scanFailed")}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center max-w-md mb-6",children:x?.message??l("validation.ocr.errors.processingFailed")}),a.jsxs("button",{type:"button",onClick:se,className:"flex items-center gap-2 px-6 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors font-medium",children:[a.jsx(qs,{className:"w-5 h-5","aria-hidden":"true"}),l("validation.ocr.retryCapture")]})]})]}),R==="results"&&a.jsxs("div",{className:"flex gap-3 px-4 py-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:se,className:"flex-1 px-4 py-3 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:l("validation.ocr.retryCapture")}),a.jsx("button",{type:"button",onClick:d,className:"flex-1 px-4 py-3 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:l("validation.ocr.continueToValidation")})]}),a.jsx(fi,{isOpen:N,scoresheetType:b,onClose:()=>{w(!1),R==="capture"&&S("intro")},onImageSelected:J}),y.type&&a.jsx(kl,{isOpen:y.isOpen,type:y.type,onClose:j})]})}function ze({title:t,count:e,discrepancies:s,expanded:r,onToggle:n,sectionId:i,children:o}){const c=r?Et:kt;return a.jsxs("div",{className:"mb-3",children:[a.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-expanded":r,"aria-controls":i,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t}),a.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",e,")"]})]}),s>0&&a.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-400",children:[s," discrepancies"]})]}),r&&a.jsx("div",{id:i,className:"mt-2 pl-6",children:o})]})}function xc({data:t,ocrResult:e,imageUrl:s,expanded:r,onToggle:n}){const{t:i}=B(),o=r?Et:kt;return a.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-2 px-3 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-expanded":r,"aria-controls":"raw-ocr-data",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(o,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("validation.ocr.rawData.title")})]})}),r&&a.jsxs("div",{id:"raw-ocr-data",className:"mt-3 space-y-4",children:[s&&e&&a.jsx(gc,{imageUrl:s,ocrResult:e,parsedData:t}),a.jsx(Fs,{team:t.teamA,label:i("validation.ocr.rawData.teamA")}),a.jsx(Fs,{team:t.teamB,label:i("validation.ocr.rawData.teamB")})]})]})}function Fs({team:t,label:e}){const{t:s}=B();return a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:e}),a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"-"})]}),t.players.length>0&&a.jsxs("div",{className:"mb-3",children:[a.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[s("validation.ocr.rawData.players")," (",t.players.length,")"]}),a.jsx("div",{className:"mt-1 overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[a.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.shirtNumber")}),a.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.name")}),a.jsx("th",{scope:"col",className:"text-left font-medium",children:s("validation.ocr.rawData.licenseStatus")})]})}),a.jsx("tbody",{children:t.players.map(r=>a.jsxs("tr",{className:"text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("td",{className:"pr-2 py-0.5",children:r.shirtNumber??"-"}),a.jsx("td",{className:"pr-2 py-0.5 font-mono",children:r.rawName||r.displayName}),a.jsx("td",{className:"py-0.5",children:r.licenseStatus||"-"})]},`${r.shirtNumber}-${r.rawName||r.displayName}`))})]})})]}),t.officials.length>0&&a.jsxs("div",{children:[a.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[s("validation.ocr.rawData.officials")," (",t.officials.length,")"]}),a.jsx("div",{className:"mt-1 overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[a.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.role")}),a.jsx("th",{scope:"col",className:"text-left font-medium",children:s("validation.ocr.rawData.name")})]})}),a.jsx("tbody",{children:t.officials.map(r=>a.jsxs("tr",{className:"text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("td",{className:"pr-2 py-0.5",children:r.role}),a.jsx("td",{className:"py-0.5 font-mono",children:r.rawName||r.displayName})]},`${r.role}-${r.rawName||r.displayName}`))})]})})]})]})}function gc({imageUrl:t,ocrResult:e,parsedData:s}){const{t:r}=B(),n=m.useRef(null),[i,o]=m.useState(null),[c,d]=m.useState(0),[u,l]=m.useState(!0),h=m.useMemo(()=>{const p=new Set;return[...s.teamA.players,...s.teamB.players].forEach(y=>{y.rawName&&p.add(y.rawName.toLowerCase()),y.displayName&&p.add(y.displayName.toLowerCase()),y.lastName&&p.add(y.lastName.toLowerCase())}),[...s.teamA.officials,...s.teamB.officials].forEach(y=>{y.rawName&&p.add(y.rawName.toLowerCase()),y.displayName&&p.add(y.displayName.toLowerCase()),y.lastName&&p.add(y.lastName.toLowerCase())}),p},[s]),f=m.useCallback(p=>{const y=p.toLowerCase();return h.has(y)},[h]),x=m.useCallback(p=>{const y=p.currentTarget;o({width:y.naturalWidth,height:y.naturalHeight}),n.current&&d(n.current.offsetWidth)},[]),g=m.useMemo(()=>!i||c===0?1:c/i.width,[i,c]);return a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Zs,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),a.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:r("validation.ocr.rawData.imageOverlay")})]}),e.hasPreciseBoundingBoxes&&a.jsx("button",{type:"button",onClick:()=>l(!u),className:"text-xs px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:r(u?"validation.ocr.rawData.hideOverlay":"validation.ocr.rawData.showOverlay")})]}),e.hasPreciseBoundingBoxes&&a.jsxs("div",{className:"flex items-center gap-4 mb-2 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-3 rounded border-2 border-success-500 bg-success-500/20"}),a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r("validation.ocr.rawData.matchedWords")})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-3 rounded border-2 border-gray-400 bg-gray-400/20"}),a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r("validation.ocr.rawData.otherWords")})]})]}),a.jsxs("div",{ref:n,className:"relative overflow-auto max-h-96 rounded border border-gray-200 dark:border-gray-700",children:[a.jsx("img",{src:t,alt:r("validation.ocr.rawData.capturedImage"),onLoad:x,className:"w-full h-auto"}),e.hasPreciseBoundingBoxes&&u&&i&&a.jsx("svg",{className:"absolute top-0 left-0 pointer-events-none",style:{width:i.width*g,height:i.height*g},viewBox:`0 0 ${i.width} ${i.height}`,preserveAspectRatio:"none",children:e.words.map(p=>{const y=f(p.text);return a.jsx("g",{children:a.jsx("rect",{x:p.bbox.x0,y:p.bbox.y0,width:p.bbox.x1-p.bbox.x0,height:p.bbox.y1-p.bbox.y0,fill:y?"rgba(34, 197, 94, 0.2)":"rgba(156, 163, 175, 0.15)",stroke:y?"#22c55e":"#9ca3af",strokeWidth:y?2:1,rx:2})},`${p.bbox.x0}-${p.bbox.y0}-${p.bbox.x1}-${p.bbox.y1}`)})})]}),a.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.words.length," ",r("validation.ocr.rawData.wordsDetected")," â€¢ ",e.words.filter(p=>f(p.text)).length," ",r("validation.ocr.rawData.wordsMatched")]}),!e.hasPreciseBoundingBoxes&&e.fullText&&a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"flex items-center gap-2 mb-2",children:a.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:r("validation.ocr.rawData.rawText")})}),a.jsx("pre",{className:"text-xs text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-900 p-3 rounded border border-gray-200 dark:border-gray-700 overflow-auto max-h-64 whitespace-pre-wrap break-words",children:e.fullText})]})]})}function $s(t){if(!t)return[];const e=[];for(const s of t){const r=s.__identity,n=s.indoorPlayer?.person,i=n?.displayName??[n?.firstName,n?.lastName].filter(Boolean).join(" ");!r||!i||e.push({id:r,displayName:i,firstName:n?.firstName,lastName:n?.lastName})}return e.sort((s,r)=>s.displayName.localeCompare(r.displayName))}function zs(t){if(!t)return[];const e=[],s=t.coachPerson;s?.__identity&&s.displayName&&e.push({id:s.__identity,displayName:s.displayName,firstName:s.firstName,lastName:s.lastName,role:"head"});const r=t.firstAssistantCoachPerson;r?.__identity&&r.displayName&&e.push({id:r.__identity,displayName:r.displayName,firstName:r.firstName,lastName:r.lastName,role:"firstAssistant"});const n=t.secondAssistantCoachPerson;return n?.__identity&&n.displayName&&e.push({id:n.__identity,displayName:n.displayName,firstName:n.firstName,lastName:n.lastName,role:"secondAssistant"}),e}function yc({assignment:t,isOpen:e,onClose:s}){const{t:r,tInterpolate:n}=B(),i=Us(M=>M.isOCREnabled),[o,c]=m.useState(null),d=t.__identity,u=o===d,l=Ya({assignment:t,isOpen:e,onClose:s}),{homeTeam:h,awayTeam:f}=gt(t),x="validate-game-title",g=`${h} ${r("common.vs")} ${f}`,p=m.useMemo(()=>$s(l.homeNominationList?.indoorPlayerNominations),[l.homeNominationList]),y=m.useMemo(()=>$s(l.awayNominationList?.indoorPlayerNominations),[l.awayNominationList]),E=m.useMemo(()=>zs(l.homeNominationList),[l.homeNominationList]),j=m.useMemo(()=>zs(l.awayNominationList),[l.awayNominationList]),R=m.useCallback(()=>{c(d)},[d]),S=m.useCallback(()=>{c(d)},[d]),N=m.useCallback(()=>{c(d)},[d]),w=e&&i&&!u&&!l.isLoadingGameDetails,b={isFirstStep:l.isFirstStep,isLastStep:l.isLastStep},v={isFinalizing:l.isFinalizing,isLoadingGameDetails:l.isLoadingGameDetails,hasGameDetailsError:!!l.gameDetailsError,canMarkCurrentStepDone:l.canMarkCurrentStepDone,allPreviousRequiredStepsDone:l.allPreviousRequiredStepsDone,currentStepIsOptional:l.currentStep.isOptional??!1},C={isLoading:l.isLoadingGameDetails,error:l.gameDetailsError},D={isValidated:l.isValidated,isCurrentStepReadOnly:l.isCurrentStepReadOnly,validatedInfo:l.validatedInfo,pendingScorer:l.pendingScorer,scoresheetNotRequired:l.scoresheetNotRequired,state:l.validationState,homeNominationList:l.homeNominationList,awayNominationList:l.awayNominationList},I={setHomeRosterModifications:l.setHomeRosterModifications,setAwayRosterModifications:l.setAwayRosterModifications,setScorer:l.setScorer,setScoresheet:l.setScoresheet,onAddPlayerSheetOpenChange:l.handleAddPlayerSheetOpenChange,onClose:s};return a.jsxs(a.Fragment,{children:[l.successToast&&a.jsx(Bn,{message:l.successToast}),a.jsxs(vt,{isOpen:e,onClose:l.attemptClose,titleId:x,size:"lg",isLoading:l.showUnsavedDialog||l.showRosterWarningDialog,children:[a.jsx(Ct,{title:r("assignments.validateGame"),titleId:x,subtitle:g,onClose:l.attemptClose}),l.isValidated&&l.validatedInfo&&a.jsxs("div",{role:"status",className:"mb-4 p-3 bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium text-success-700 dark:text-success-400",children:r("validation.wizard.alreadyValidated")}),a.jsx("p",{className:"text-xs text-success-600 dark:text-success-500 mt-1",children:n("validation.wizard.validatedBy",{scorer:l.validatedInfo.scorerName})})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx(en,{steps:l.wizardSteps,currentStepIndex:l.currentStepIndex,stepsMarkedDone:l.stepsMarkedDone,clickable:!l.isFinalizing,onStepClick:l.goToStep}),a.jsx("p",{className:"text-center text-xs text-text-muted dark:text-text-muted-dark mt-2",children:n("validation.wizard.stepOf",{current:l.currentStepIndex+1,total:l.totalSteps})})]}),a.jsx(Qa,{currentStep:l.currentStepIndex,totalSteps:l.totalSteps,onSwipeNext:l.goNext,onSwipePrevious:l.goBack,swipeEnabled:l.isSwipeEnabled,children:a.jsx("div",{className:"max-h-80 overflow-y-auto",children:a.jsx(Dn,{currentStepId:l.currentStepId,assignment:t,loading:C,validation:D,handlers:I})})}),l.saveError&&a.jsxs("div",{role:"alert",className:"mt-4 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",children:[a.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:l.saveError}),a.jsxs("div",{className:"mt-2 flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>l.handleFinish(),className:"text-sm font-medium text-danger-600 dark:text-danger-400 hover:text-danger-700 dark:hover:text-danger-300",children:r("common.retry")}),a.jsx("button",{type:"button",onClick:l.handleDiscardAndClose,className:"text-sm font-medium text-text-muted dark:text-text-muted-dark hover:text-text-secondary dark:hover:text-text-secondary-dark",children:r("validation.state.discardAndClose")})]})]}),l.isSaving&&a.jsx("div",{className:"mt-4 text-center text-sm text-text-muted dark:text-text-muted-dark",children:r("validation.wizard.saving")}),a.jsx("div",{className:"flex justify-between gap-3 pt-4 border-t border-border-default dark:border-border-default-dark mt-4",children:l.isValidated?a.jsx($n,{navigation:b,onBack:l.goBack,onNext:l.goNext,onClose:s}):l.isCurrentStepReadOnly?a.jsx(zn,{navigation:b,onBack:l.goBack,onNext:l.goNext,onFinish:l.handleFinish,finishDisabled:l.isFinalizing||l.isLoadingGameDetails||!!l.gameDetailsError||!l.allPreviousRequiredStepsDone,isFinalizing:l.isFinalizing}):a.jsx(Hn,{navigation:b,state:v,onAttemptClose:l.attemptClose,onBack:l.goBack,onValidateAndNext:l.handleValidateAndNext,onFinish:l.handleFinish})})]}),a.jsx(In,{isOpen:l.showUnsavedDialog,onSaveAndClose:l.handleSaveAndClose,onDiscard:l.handleDiscardAndClose,onCancel:l.handleCancelClose,isSaving:l.isSaving}),a.jsx(Tn,{isOpen:l.showRosterWarningDialog,rosterValidation:l.rosterValidation,homeTeamName:h,awayTeamName:f,onGoBack:l.handleRosterWarningGoBack,onProceedAnyway:l.handleRosterWarningProceed,isProceedingAnyway:l.isFinalizing}),a.jsx(Pn,{isOpen:l.showSafeValidationComplete,onClose:l.handleSafeValidationCompleteClose}),a.jsx(pc,{isOpen:w,homeTeamName:h,awayTeamName:f,homeRosterPlayers:p,awayRosterPlayers:y,homeRosterCoaches:E,awayRosterCoaches:j,onSkip:R,onComplete:S,onClose:N})]})}const Lc=m.memo(yc);export{Lc as ValidateGameModal};
