import{g as c}from"./index-DqvBsTHA.js";function f(e){switch(e){case"men":return"m";case"women":return"f";default:return}}const u=/^[a-zA-Z0-9]{6}$/,d=[/^https?:\/\/(?:www\.)?volleymanager\.volleyball\.ch\/calendar\/([a-z0-9]{6})\/?$/i,/^webcal:\/\/(?:www\.)?volleymanager\.volleyball\.ch\/calendar\/([a-z0-9]{6})\/?$/i,/^https?:\/\/(?:www\.)?volleymanager\.volleyball\.ch\/sportmanager\.volleyball\/calendar\/ical\/([a-z0-9]{6})\/?$/i,/^webcal:\/\/(?:www\.)?volleymanager\.volleyball\.ch\/sportmanager\.volleyball\/calendar\/ical\/([a-z0-9]{6})\/?$/i,/^https?:\/\/(?:www\.)?volleymanager\.volleyball\.ch\/indoor\/iCal\/referee\/([a-z0-9]{6})\/?$/i,/^webcal:\/\/(?:www\.)?volleymanager\.volleyball\.ch\/indoor\/iCal\/referee\/([a-z0-9]{6})\/?$/i];function s(e){return e.replace(/[\u200B-\u200D\uFEFF\u00A0]/g,"").replace(/[\u2060\u180E]/g,"").trim()}function m(e){const r=s(e);if(!r)return null;if(u.test(r))return r;for(const l of d){const o=r.match(l);if(o?.[1])return o[1]}try{const l=r.replace(/^webcal:\/\//i,"https://"),o=new URL(l);if(!o.hostname.includes("volleymanager.volleyball.ch"))return null;const t=o.pathname.split("/").filter(Boolean),a=t[t.length-1];if(a&&u.test(a)){const n=o.pathname.toLowerCase();if(n.includes("/calendar/")||n.includes("/ical/")||n.includes("/referee/"))return a}}catch{}return null}function i(e){if(e)return{indoorAssociationReferee:{indoorReferee:{person:{displayName:e}}}}}function p(e){const r={referee1:"head-one",referee2:"head-two",lineReferee:"linesman-one",scorer:"linesman-one",unknown:"head-one"};return{__identity:e.gameId,refereePosition:r[e.role],refereeConvocationStatus:"active",refereeGame:{__identity:e.gameId,isGameInFuture:new Date(e.startTime)>new Date?"1":"0",game:{__identity:e.gameId,startingDateTime:e.startTime,number:e.gameNumber!=null?e.gameNumber:void 0,encounter:{teamHome:{name:e.homeTeam},teamAway:{name:e.awayTeam}},group:{phase:{league:{gender:f(e.gender),leagueCategory:e.leagueCategory?{name:e.leagueCategory}:void 0}}},hall:{__identity:e.hallId!=null?e.hallId:e.gameId,name:e.hallName??void 0,primaryPostalAddress:e.address?{streetAndHouseNumber:e.address,city:h(e.address),geographicalLocation:e.coordinates||e.plusCode?{latitude:e.coordinates?.latitude,longitude:e.coordinates?.longitude,plusCode:e.plusCode??void 0}:void 0}:void 0}},activeRefereeConvocationFirstHeadReferee:i(e.referees?.referee1),activeRefereeConvocationSecondHeadReferee:i(e.referees?.referee2),activeRefereeConvocationFirstLinesman:i(e.referees?.lineReferee1),activeRefereeConvocationSecondLinesman:i(e.referees?.lineReferee2)}}}function h(e){const r=e.match(/\b(\d{4})\s+/);if(r){const t=e.indexOf(r[0])+r[0].length,a=e.slice(t).trim();if(a.length>0)return a}const l=e.split(","),o=l[l.length-1];if(l.length>1&&o){const t=o.trim(),a=t.match(/^\d{4}\s+/);return a&&t.slice(a[0].length).trim()||t}}async function w(e,r){if(!u.test(e))return{valid:!1,error:"auth.invalidCalendarCode"};const o=`https://volleykit-proxy.ngn-damien.workers.dev/iCal/referee/${e}`;try{const t=await fetch(o,{method:"HEAD",signal:r});return t.ok?{valid:!0}:t.status===c.NOT_FOUND?{valid:!1,error:"auth.calendarNotFound"}:{valid:!1,error:"auth.calendarValidationFailed"}}catch(t){if(t instanceof Error&&t.name==="AbortError")throw t;return{valid:!1,error:"auth.calendarValidationFailed"}}}export{m as e,p as m,w as v};
