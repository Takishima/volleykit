import{a as c,j as e}from"./chunk-state-CZJejFfH.js";import{e as I,h as V,a3 as L,a4 as P,a5 as _,a6 as k}from"./index-C6wbh34q.js";import{u as M,i as $}from"./chunk-ojp-client-BYLUzKIt.js";import"./chunk-router-CqUdIx6-.js";import"./chunk-validation-Cdg1t4SS.js";const S="volleykit-auth",v=2,F=2e3;function U(){const[t,o]=c.useState(null),s=c.useRef(null);c.useEffect(()=>()=>{s.current&&clearTimeout(s.current)},[]);const i=c.useCallback(async(r,n)=>{await A(r)&&(s.current&&clearTimeout(s.current),o(n),s.current=setTimeout(()=>o(null),F))},[]);return{copied:t,handleCopy:i}}function W(){try{const t=localStorage.getItem(S);return t?JSON.parse(t):null}catch{return null}}function Y(t){const[o,s]=c.useState(!1);return c.useEffect(()=>{(()=>{const d=new URLSearchParams(window.location.search).get("debug"),h=d!==null&&d!=="false"&&d!=="0",p=window.__VK_DEBUG===!0||window.__VK_DEBUG_ASSOCIATIONS===!0;(h||p)&&(s(!0),t())})();const r=()=>{s(l=>(l||t(),!l))},n=()=>{s(!0),t()};return window.addEventListener("vk-debug-toggle",r),window.addEventListener("vk-debug-show",n),()=>{window.removeEventListener("vk-debug-toggle",r),window.removeEventListener("vk-debug-show",n)}},[t]),{isVisible:o,setIsVisible:s}}function J(t,o){const s=[],i=t?.version,r=t?.state?.user?.occupations?.length??0,n=t?.state?.groupedEligibleAttributeValues?.length??0,l=t?.state?._wasAuthenticated??!1;return i!==void 0&&i!==v&&s.push(`Version mismatch: persisted=${i}, expected=${v}`),r!==o.occupationsCount&&s.push(`Occupations: persisted=${r}, live=${o.occupationsCount}`),n!==o.groupedCount&&s.push(`Grouped: persisted=${n}, live=${o.groupedCount}`),l!==(o.status==="authenticated")&&s.push(`Auth: persisted=${l}, live=${o.status==="authenticated"}`),s}function A(t){if(navigator.clipboard?.writeText)return navigator.clipboard.writeText(t).then(()=>!0).catch(()=>!1);try{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-9999px",document.body.appendChild(o),o.select();const s=document.execCommand("copy");return document.body.removeChild(o),Promise.resolve(s)}catch{return Promise.resolve(!1)}}function ae(){const[t,o]=c.useState(null),[s,i]=c.useState(new Set(["identity","status"])),{status:r,user:n,activeOccupationId:l,csrfToken:d,dataSource:h,eligibleAttributeValues:p,groupedEligibleAttributeValues:x}=I(V(a=>({status:a.status,user:a.user,activeOccupationId:a.activeOccupationId,csrfToken:a.csrfToken,dataSource:a.dataSource,eligibleAttributeValues:a.eligibleAttributeValues,groupedEligibleAttributeValues:a.groupedEligibleAttributeValues}))),g=h==="demo",y=c.useCallback(()=>{o(W())},[]),{isVisible:m,setIsVisible:T}=Y(y),b=a=>{i(O=>{const j=new Set(O);return j.has(a)?j.delete(a):j.add(a),j})};if(!m)return null;const C=n?.occupations?.length??0,w=x?.length??0,B=t?.version,E=t?.state?.user?.occupations?.length??0,R=t?.state?.groupedEligibleAttributeValues?.length??0,D=t?.state?.eligibleAttributeValues?.length??0,N=t?.state?._wasAuthenticated??!1,z=J(t,{status:r,occupationsCount:C,groupedCount:w});return e.jsxs("div",{style:{position:"fixed",bottom:"70px",left:"4px",right:"4px",maxHeight:"70vh",overflow:"auto",backgroundColor:"#0d0d1a",color:"#e0e0e0",padding:"8px",borderRadius:"8px",fontSize:"10px",fontFamily:"ui-monospace, monospace",zIndex:9999,boxShadow:"0 4px 20px rgba(0,0,0,0.7)",border:"1px solid #333"},children:[e.jsx(K,{onRefresh:y,onClose:()=>T(!1)}),e.jsx(f,{id:"identity",title:"User Identity",expanded:s.has("identity"),onToggle:()=>b("identity"),children:e.jsx(G,{user:n,activeOccupationId:l,isDemoMode:g})}),e.jsx(f,{id:"transport",title:"Transport Toggle",expanded:s.has("transport"),onToggle:()=>b("transport"),children:e.jsx(H,{})}),e.jsx(Z,{discrepancies:z}),e.jsx(f,{id:"comparison",title:"Live State vs Persisted",expanded:s.has("comparison"),onToggle:()=>b("comparison"),children:e.jsx(q,{status:r,isDemoMode:g,user:n,occupationsCount:C,groupedCount:w,eligibleCount:p?.length??0,activeOccupationId:l,csrfToken:d,persistedVersion:B,persistedWasAuth:N,persistedState:t,persistedOccupationsCount:E,persistedGroupedCount:R,persistedEligibleCount:D})}),e.jsx(f,{id:"occupations",title:`Occupations (${C})`,expanded:s.has("occupations"),onToggle:()=>b("occupations"),children:e.jsx(Q,{occupations:n?.occupations})}),e.jsx(f,{id:"raw",title:"Raw localStorage",expanded:s.has("raw"),onToggle:()=>b("raw"),children:e.jsx(X,{persistedState:t})}),e.jsx(f,{id:"auth-logs",title:"Auth Logs",expanded:s.has("auth-logs"),onToggle:()=>b("auth-logs"),children:e.jsx(se,{})})]})}function G({user:t,activeOccupationId:o,isDemoMode:s}){const{copied:i,handleCopy:r}=U(),n=t?.id,l=t?.occupations?.find(d=>d.id===o);return e.jsxs("div",{style:{fontSize:"10px"},children:[s&&e.jsx("div",{style:{marginBottom:"8px",padding:"4px 8px",backgroundColor:"#3d2a00",borderRadius:"4px",border:"1px solid #6b4500",color:"#ffaa00"},children:"Demo Mode Active - UUIDs are simulated"}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("div",{style:{color:"#888",marginBottom:"2px"},children:"User UUID (user.id):"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("code",{style:{backgroundColor:"#1a1a2e",padding:"6px 10px",borderRadius:"4px",color:n?"#4eff4e":"#ff6b6b",fontSize:"11px",fontFamily:"ui-monospace, monospace",wordBreak:"break-all",flex:1},children:n??"(not set)"}),n&&e.jsx("button",{onClick:()=>r(n,"userId"),style:{padding:"4px 8px",fontSize:"9px",backgroundColor:i==="userId"?"#0a2e0a":"#1a1a2e",border:`1px solid ${i==="userId"?"#1a5e1a":"#444"}`,color:i==="userId"?"#4eff4e":"#888",borderRadius:"4px",cursor:"pointer",whiteSpace:"nowrap"},children:i==="userId"?"Copied!":"Copy"})]}),e.jsx("div",{style:{color:"#666",fontSize:"8px",marginTop:"4px"},children:"This should match submittedByPerson.__identity in exchanges you created"})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("div",{style:{color:"#888",marginBottom:"2px"},children:"Active Occupation ID:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("code",{style:{backgroundColor:"#1a1a2e",padding:"6px 10px",borderRadius:"4px",color:o?"#00d4ff":"#ff6b6b",fontSize:"11px",fontFamily:"ui-monospace, monospace",wordBreak:"break-all",flex:1},children:o??"(not set)"}),o&&e.jsx("button",{onClick:()=>r(o,"occupationId"),style:{padding:"4px 8px",fontSize:"9px",backgroundColor:i==="occupationId"?"#0a2e0a":"#1a1a2e",border:`1px solid ${i==="occupationId"?"#1a5e1a":"#444"}`,color:i==="occupationId"?"#4eff4e":"#888",borderRadius:"4px",cursor:"pointer",whiteSpace:"nowrap"},children:i==="occupationId"?"Copied!":"Copy"})]}),l&&e.jsxs("div",{style:{color:"#666",fontSize:"8px",marginTop:"4px"},children:[l.type," @"," ",l.associationCode??l.clubName??"unknown"]})]}),t&&(t.firstName||t.lastName)&&e.jsxs("div",{children:[e.jsx("div",{style:{color:"#888",marginBottom:"2px"},children:"User Name:"}),e.jsxs("div",{style:{color:"#e0e0e0"},children:[t.firstName," ",t.lastName]})]})]})}function H(){const t=L(g=>g.homeLocation),o=M(),s=I(g=>g.dataSource),i=s==="demo",r=s==="calendar",n=$(),l=!0,d=!!t,h=!!o,p=i||r||n,x=d&&p&&h;return e.jsxs("div",{style:{fontSize:"10px"},children:[e.jsxs("div",{style:{marginBottom:"8px",padding:"8px",backgroundColor:"#111122",borderRadius:"4px",border:"1px solid #333"},children:[e.jsx("div",{style:{color:"#00d4ff",fontWeight:"bold",marginBottom:"8px"},children:"Toggle Conditions"}),e.jsxs("table",{style:{width:"100%",fontSize:"9px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{display:"none"},children:[e.jsx("th",{children:"Condition"}),e.jsx("th",{children:"Status"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"Home Location"}),e.jsx("td",{style:{padding:"4px",color:d?"#4eff4e":"#ff6b6b"},children:d?"✓ Set":"✗ Not set"})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"Association Code"}),e.jsx("td",{style:{padding:"4px",color:h?"#4eff4e":"#ff6b6b"},children:o??"✗ None"})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"API Available"}),e.jsx("td",{style:{padding:"4px",color:p?"#4eff4e":"#ff6b6b"},children:p?"✓ Yes":"✗ No"})]}),e.jsxs("tr",{style:{borderTop:"2px solid #333"},children:[e.jsx("td",{style:{padding:"4px",color:"#888",fontWeight:"bold"},children:"Can Enable Toggle"}),e.jsx("td",{style:{padding:"4px",color:x?"#4eff4e":"#ff6b6b",fontWeight:"bold"},children:x?"✓ Yes":"✗ No"})]})]})]})]}),e.jsxs("div",{style:{marginBottom:"8px",padding:"8px",backgroundColor:"#111122",borderRadius:"4px",border:"1px solid #333"},children:[e.jsx("div",{style:{color:"#00d4ff",fontWeight:"bold",marginBottom:"8px"},children:"API Details"}),e.jsxs("table",{style:{width:"100%",fontSize:"9px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{display:"none"},children:[e.jsx("th",{children:"Setting"}),e.jsx("th",{children:"Value"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"VITE_OJP_API_KEY"}),e.jsx("td",{style:{padding:"4px",color:l?"#4eff4e":"#ff6b6b"},children:l?"✓ Present":"✗ Missing"})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"isOjpConfigured()"}),e.jsx("td",{style:{padding:"4px",color:n?"#4eff4e":"#ff6b6b"},children:n?"✓ true":"✗ false"})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"Demo Mode"}),e.jsx("td",{style:{padding:"4px",color:i?"#ffaa00":"#888"},children:i?"Yes (bypasses API check)":"No"})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"Calendar Mode"}),e.jsx("td",{style:{padding:"4px",color:r?"#ffaa00":"#888"},children:r?"Yes (bypasses API check)":"No"})]})]})]})]}),t&&e.jsxs("div",{style:{padding:"8px",backgroundColor:"#111122",borderRadius:"4px",border:"1px solid #333"},children:[e.jsx("div",{style:{color:"#00d4ff",fontWeight:"bold",marginBottom:"8px"},children:"Home Location Details"}),e.jsxs("table",{style:{width:"100%",fontSize:"9px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{display:"none"},children:[e.jsx("th",{children:"Property"}),e.jsx("th",{children:"Value"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"Latitude"}),e.jsx("td",{style:{padding:"4px",color:"#e0e0e0"},children:t.latitude.toFixed(6)})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"Longitude"}),e.jsx("td",{style:{padding:"4px",color:"#e0e0e0"},children:t.longitude.toFixed(6)})]}),t.label&&e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"Label"}),e.jsx("td",{style:{padding:"4px",color:"#e0e0e0"},children:t.label})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"4px",color:"#888"},children:"Source"}),e.jsx("td",{style:{padding:"4px",color:"#e0e0e0"},children:t.source})]})]})]})]})]})}function K({onRefresh:t,onClose:o}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px",borderBottom:"1px solid #333",paddingBottom:"4px"},children:[e.jsx("strong",{style:{color:"#00d4ff",fontSize:"11px"},children:"VolleyKit Debug Panel"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:t,style:{background:"#1a1a2e",border:"1px solid #444",color:"#888",padding:"2px 6px",borderRadius:"4px",fontSize:"9px"},"aria-label":"Refresh persisted state",children:"Refresh"}),e.jsx("button",{onClick:o,style:{background:"none",border:"none",color:"#ff6b6b",cursor:"pointer",fontSize:"14px"},"aria-label":"Close debug panel",children:"✕"})]})]})}function Z({discrepancies:t}){return t.length===0?null:e.jsxs("div",{style:{marginBottom:"6px",padding:"6px",backgroundColor:"#3d2a00",borderRadius:"4px",border:"1px solid #6b4500"},role:"alert",children:[e.jsx("div",{style:{color:"#ffaa00",fontWeight:"bold",marginBottom:"4px"},children:"⚠️ State Discrepancies Detected"}),t.map(o=>e.jsxs("div",{style:{color:"#ffcc66",fontSize:"9px"},children:["• ",o]},o))]})}function q({status:t,isDemoMode:o,user:s,occupationsCount:i,groupedCount:r,eligibleCount:n,activeOccupationId:l,csrfToken:d,persistedVersion:h,persistedWasAuth:p,persistedState:x,persistedOccupationsCount:g,persistedGroupedCount:y,persistedEligibleCount:m}){return e.jsxs("table",{style:{width:"100%",fontSize:"9px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{color:"#666",textAlign:"left"},children:[e.jsx("th",{style:{padding:"2px 4px"},children:"Field"}),e.jsx("th",{style:{padding:"2px 4px"},children:"Live"}),e.jsx("th",{style:{padding:"2px 4px"},children:"Persisted"}),e.jsx("th",{style:{padding:"2px 4px"},children:"Match"})]})}),e.jsxs("tbody",{children:[e.jsx(u,{label:"version",live:String(v),persisted:String(h??"?")}),e.jsx(u,{label:"status",live:t,persisted:p?"authenticated":"idle"}),e.jsx(u,{label:"isDemoMode",live:String(o),persisted:String(x?.state?.isDemoMode??"?")}),e.jsx(u,{label:"user exists",live:String(!!s),persisted:String(!!x?.state?.user)}),e.jsx(u,{label:"occupations.length",live:String(i),persisted:String(g)}),e.jsx(u,{label:"grouped.length",live:String(r),persisted:String(y)}),e.jsx(u,{label:"eligible.length",live:String(n),persisted:String(m)}),e.jsx(u,{label:"activeOccupationId",live:l?.substring(0,12)??"null",persisted:x?.state?.activeOccupationId?.substring(0,12)??"null"}),e.jsx(u,{label:"csrfToken",live:d?"set":"null",persisted:x?.state?.csrfToken?"set":"null"})]})]})}function Q({occupations:t}){return!t||t.length===0?e.jsx("div",{style:{color:"#ff6b6b",padding:"4px"},children:"⚠️ EMPTY - This prevents dropdown from showing!"}):e.jsxs("table",{style:{width:"100%",fontSize:"9px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{color:"#666",textAlign:"left"},children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"id"}),e.jsx("th",{children:"type"}),e.jsx("th",{children:"assocCode"}),e.jsx("th",{children:"clubName"})]})}),e.jsx("tbody",{children:t.map((o,s)=>e.jsxs("tr",{style:{borderBottom:"1px solid #222"},children:[e.jsx("td",{style:{padding:"2px"},children:s}),e.jsxs("td",{style:{padding:"2px",color:"#888"},children:[o.id.substring(0,10),"..."]}),e.jsx("td",{style:{padding:"2px",color:o.type==="referee"?"#4eff4e":"#888"},children:o.type}),e.jsx("td",{style:{padding:"2px",color:"#00d4ff"},children:o.associationCode??"(none)"}),e.jsx("td",{style:{padding:"2px",color:"#888"},children:o.clubName??"(none)"})]},o.id))})]})}function X({persistedState:t}){const o=async()=>{const i=localStorage.getItem(S);if(!i){alert("No data in localStorage");return}const r=await A(i);alert(r?"Copied to clipboard!":`Copy failed. Data (truncated):
`+i.substring(0,500)+"...")},s=()=>{confirm("This will clear auth state and require re-login. Continue?")&&(localStorage.removeItem(S),window.location.reload())};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:"4px"},children:[e.jsx("button",{onClick:o,style:{padding:"4px 8px",fontSize:"9px",cursor:"pointer",backgroundColor:"#1a1a2e",border:"1px solid #444",color:"#888",borderRadius:"4px"},children:"Copy Full JSON"}),e.jsx("button",{onClick:s,style:{padding:"4px 8px",fontSize:"9px",cursor:"pointer",backgroundColor:"#2e0a0a",border:"1px solid #5e1a1a",color:"#ff6b6b",borderRadius:"4px"},children:"Clear & Reload"})]}),e.jsxs("pre",{style:{fontSize:"8px",color:"#666",whiteSpace:"pre-wrap",wordBreak:"break-all",maxHeight:"100px",overflow:"auto",backgroundColor:"#0a0a15",padding:"4px",borderRadius:"4px"},children:[JSON.stringify(t,null,1)?.substring(0,1e3),"..."]})]})}function f({id:t,title:o,expanded:s,onToggle:i,children:r}){const n=c.useId(),l=`debug-section-${t}-${n}`;return e.jsxs("div",{style:{marginBottom:"4px",backgroundColor:"#111122",borderRadius:"4px",border:"1px solid #222"},children:[e.jsxs("button",{onClick:i,"aria-expanded":s,"aria-controls":l,style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 8px",background:"none",border:"none",color:"#888",cursor:"pointer",fontSize:"9px",textAlign:"left"},children:[e.jsx("span",{children:o}),e.jsx("span",{style:{color:"#444"},children:s?"▼":"▶"})]}),s&&e.jsx("div",{id:l,style:{padding:"4px 8px 8px",borderTop:"1px solid #222"},children:r})]})}function u({label:t,live:o,persisted:s}){const i=o===s;return e.jsxs("tr",{style:{borderBottom:"1px solid #1a1a2e"},children:[e.jsx("td",{style:{padding:"2px 4px",color:"#888"},children:t}),e.jsx("td",{style:{padding:"2px 4px",color:"#00d4ff"},children:o}),e.jsx("td",{style:{padding:"2px 4px",color:"#ffaa00"},children:s}),e.jsx("td",{style:{padding:"2px 4px",color:i?"#4eff4e":"#ff6b6b"},children:i?"✓":"✗"})]})}function ee(){return c.useSyncExternalStore(_,k,k)}function te(t){const o=new Date(t),s=o.getHours().toString().padStart(2,"0"),i=o.getMinutes().toString().padStart(2,"0"),r=o.getSeconds().toString().padStart(2,"0"),n=o.getMilliseconds().toString().padStart(3,"0");return`${s}:${i}:${r}.${n}`}const oe={debug:"#888",info:"#00d4ff",warn:"#ffaa00",error:"#ff6b6b"};function se(){const t=ee();return e.jsxs("div",{style:{fontSize:"9px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsxs("span",{style:{color:"#666"},children:[t.length," entries"]}),e.jsx("button",{onClick:P,style:{padding:"2px 8px",fontSize:"9px",backgroundColor:"#1a1a2e",border:"1px solid #444",color:"#888",borderRadius:"4px",cursor:"pointer"},children:"Clear"})]}),t.length===0?e.jsx("div",{style:{color:"#666",padding:"8px",textAlign:"center"},children:"No auth logs yet. Try logging in to see debug messages."}):e.jsx("div",{style:{maxHeight:"200px",overflow:"auto",backgroundColor:"#0a0a15",borderRadius:"4px",padding:"4px"},children:t.map((o,s)=>e.jsxs("div",{style:{padding:"2px 4px",borderBottom:s<t.length-1?"1px solid #1a1a2e":"none",fontFamily:"ui-monospace, monospace"},children:[e.jsx("span",{style:{color:"#555"},children:te(o.timestamp)})," ",e.jsxs("span",{style:{color:oe[o.level],fontWeight:"bold"},children:["[",o.level.toUpperCase(),"]"]})," ",e.jsx("span",{style:{color:"#e0e0e0"},children:o.message}),o.data!==void 0&&e.jsx("pre",{style:{margin:"2px 0 0 0",padding:"2px 4px",backgroundColor:"#111122",borderRadius:"2px",color:"#888",whiteSpace:"pre-wrap",wordBreak:"break-all",fontSize:"8px"},children:typeof o.data=="object"?JSON.stringify(o.data,null,1):String(o.data)})]},`${o.timestamp}-${s}`))})]})}export{ae as DebugPanel};
