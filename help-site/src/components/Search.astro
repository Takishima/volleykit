---
/**
 * Search component
 * Triggers the search modal on click or keyboard shortcut (Cmd/Ctrl + K)
 */

interface Props {
  /** Variant for different layouts */
  variant?: 'desktop' | 'mobile';
}

const { variant = 'desktop' } = Astro.props;
---

{
  variant === 'desktop' ? (
    <button
      type="button"
      class="group flex w-full max-w-md items-center gap-3 rounded-lg border border-border-strong bg-surface-page px-4 py-2 text-left text-sm transition-colors hover:border-primary-500 hover:bg-surface-subtle dark:border-border-strong-dark dark:bg-surface-page-dark dark:hover:border-primary-400 dark:hover:bg-surface-subtle-dark"
      data-search-trigger
      aria-label="Search documentation"
    >
      <svg
        class="h-4 w-4 shrink-0 text-text-muted dark:text-text-muted-dark"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
        />
      </svg>
      <span class="flex-1 text-text-muted dark:text-text-muted-dark">Search documentation...</span>
      <kbd class="hidden rounded border border-border-default bg-surface-subtle px-1.5 py-0.5 text-xs font-medium text-text-muted dark:border-border-default-dark dark:bg-surface-muted-dark dark:text-text-muted-dark sm:inline-block">
        âŒ˜K
      </kbd>
    </button>
  ) : (
    <button
      type="button"
      class="flex h-9 w-9 items-center justify-center rounded-lg text-text-secondary hover:bg-surface-subtle hover:text-text-primary dark:text-text-secondary-dark dark:hover:bg-surface-subtle-dark dark:hover:text-text-primary-dark"
      data-search-trigger
      aria-label="Search documentation"
    >
      <svg
        class="h-5 w-5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
        />
      </svg>
    </button>
  )
}

<script>
  function initSearchTriggers() {
    const triggers = document.querySelectorAll('[data-search-trigger]');

    triggers.forEach((trigger) => {
      trigger.addEventListener('click', () => {
        document.dispatchEvent(new CustomEvent('open-search'));
      });
    });

    // Keyboard shortcut: Cmd/Ctrl + K
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        document.dispatchEvent(new CustomEvent('open-search'));
      }
    });
  }

  initSearchTriggers();
  document.addEventListener('astro:after-swap', initSearchTriggers);
</script>
