const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-EditCompensationModal-ChvG0EtK.js","assets/chunk-state-1lfzh_F6.js","assets/index-CdnFbi9b.js","assets/chunk-router-BHRPxDXG.js","assets/chunk-validation-Cdg1t4SS.js","assets/index-CX2Uz5nv.css","assets/chunk-ModalErrorBoundary-i56Z9n0V.js","assets/chunk-useCompensations-BOtNVmrT.js","assets/chunk-PdfLanguageModal-BuTsALUD.js"])))=>i.map(i=>d[i]);
import{z as P,u as E,E as B,F as D,G as H,L as U,I as _,e as R,J as W,h as z,K,N as $,O as q,P as A,Q as J,R as Q,_ as V}from"./index-CdnFbi9b.js";import{a as r,j as e}from"./chunk-state-1lfzh_F6.js";import{T as Y}from"./chunk-compensations-BxlPJvCO.js";import{g as X,E as Z,M as ee,F as te,u as se,a as ne,P as ae,T as oe,b as ie,W as re,S as ce}from"./chunk-ModalErrorBoundary-i56Z9n0V.js";import{i as I,d as de,c as le}from"./chunk-PdfLanguageModal-BuTsALUD.js";import{u as me}from"./chunk-useCompensations-BOtNVmrT.js";import"./chunk-router-BHRPxDXG.js";import"./chunk-validation-Cdg1t4SS.js";function xe(s,d){const t=+P(s)-+P(d);return t<0?-1:t>0?1:t}function ue(s,d){const t=+P(s)-+P(d);return t>0?-1:t<0?1:t}function pe({compensation:s,onClick:d,disableExpansion:t,dataTour:c}){const{t:n}=E(),w=B(),o=s.refereeGame?.game,a=s.convocationCompensation,h=o?.startingDateTime?D(o.startingDateTime):null,f=o?.encounter?.teamHome?.name||n("common.unknown"),y=o?.encounter?.teamAway?.name||n("common.unknown"),b=o?.number,k=o?.group?.phase?.league?.gender,j=o?.group?.phase?.league?.leagueCategory?.name,u=X(s.refereePosition,n),C=(a?.gameCompensation||0)+(a?.travelExpenses||0),l=a?.paymentDone,F=!I(s)&&!l;return e.jsx(Z,{data:s,onClick:d,disableExpansion:t,dataTour:c,renderCompact:(S,{expandArrow:M})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-text-muted dark:text-text-muted-dark min-w-[4rem]",children:[e.jsx("div",{children:h?_(h,"MMM d",{locale:w}):n("common.unknownDate")}),h&&e.jsx("div",{className:"text-text-subtle dark:text-text-subtle-dark",children:_(h,"HH:mm")}),b&&e.jsxs("div",{className:"text-text-subtle dark:text-text-subtle-dark",children:["#",b]})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate text-sm flex items-center gap-1",children:[e.jsxs("span",{className:"truncate",children:[f," ",n("common.vs")," ",y]}),k==="m"&&e.jsx(ee,{className:"w-3 h-3 flex-shrink-0 text-blue-500 dark:text-blue-400","aria-label":n("common.men")}),k==="f"&&e.jsx(te,{className:"w-3 h-3 flex-shrink-0 text-pink-500 dark:text-pink-400","aria-label":n("common.women")})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm font-bold ${l?"text-success-500 dark:text-success-400":"text-warning-500 dark:text-warning-400"}`,children:C.toFixed(0)}),M]})]}),renderDetails:()=>a&&e.jsxs("div",{className:"px-2 pb-2 pt-0 border-t border-border-subtle dark:border-border-subtle-dark space-y-1 text-sm",children:[e.jsxs("div",{className:"pt-2 pb-1 border-b border-border-subtle dark:border-border-subtle-dark",children:[e.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark",children:f}),e.jsxs("div",{className:"text-text-secondary dark:text-text-muted-dark",children:[n("common.vs")," ",y]}),(j||u)&&e.jsxs("div",{className:"text-xs text-text-subtle dark:text-text-subtle-dark mt-1 flex items-center gap-1",children:[j&&e.jsx("span",{children:j}),j&&u&&e.jsx("span",{children:"â€¢"}),u&&e.jsx("span",{children:u})]})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsxs("span",{className:"text-text-muted dark:text-text-muted-dark",children:[n("compensations.total"),":"]}),e.jsxs("span",{className:`font-bold ${l?"text-success-500 dark:text-success-400":"text-warning-500 dark:text-warning-400"}`,children:[n("common.currencyChf")," ",C.toFixed(2)]})]}),a.gameCompensation!==void 0&&a.gameCompensation>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[n("compensations.gameFee"),":"]}),e.jsxs("span",{className:"text-text-secondary dark:text-text-muted-dark",children:[n("common.currencyChf")," ",a.gameCompensation.toFixed(2)]})]}),a.travelExpenses!==void 0&&a.travelExpenses>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[n("compensations.travel"),":"]}),e.jsxs("span",{className:"text-text-secondary dark:text-text-muted-dark",children:[n("common.currencyChf")," ",a.travelExpenses.toFixed(2)]})]}),a.distanceInMetres!==void 0&&a.distanceInMetres>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[n("compensations.distance"),":"]}),e.jsxs("span",{className:"text-text-secondary dark:text-text-muted-dark",children:[H(a.distanceInMetres)," ",n("common.distanceUnit")]})]}),e.jsxs("div",{className:"flex justify-between text-xs pt-1",children:[e.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[n("compensations.status"),":"]}),e.jsx("span",{className:l?"text-success-500 dark:text-success-400":"text-warning-500 dark:text-warning-400",children:n(l?"compensations.paid":"compensations.pending")})]}),F&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs pt-2 text-text-muted dark:text-text-muted-dark",children:[e.jsx(U,{className:"w-3 h-3 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{children:n("compensations.editingRestrictedByRegion")})]})]})})}const ge=r.memo(pe);function fe(){const{t:s}=E(),d=R(o=>o.dataSource)==="demo",t=se(),c=ne(async(o,a)=>{a.debug("Generating PDF for:",o.__identity),await de(o.__identity),a.debug("PDF downloaded successfully:",o.__identity)},{logContext:"useCompensationActions",errorMessage:"compensations.pdfDownloadFailed"}),n=r.useCallback(o=>{t.open(o)},[t]),w=r.useCallback(async o=>{if(d){W.info(s("compensations.pdfNotAvailableDemo"));return}await c.execute(o)},[d,s,c]);return{editCompensationModal:{isOpen:t.isOpen,compensation:t.data,open:n,close:t.close},handleGeneratePDF:w}}const he=r.lazy(()=>V(()=>import("./chunk-EditCompensationModal-ChvG0EtK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(s=>({default:s.EditCompensationModal})));function be(s){switch(s){case"closed":return!0;case"pendingPast":case"pendingFuture":return!1}}function ke(s){return s!=="pendingFuture"}function Fe(){const[s,d]=r.useState("pendingPast"),{t}=E(),{editCompensationModal:c,handleGeneratePDF:n}=fe(),{isAssociationSwitching:w,isCalendarMode:o}=R(z(i=>({isAssociationSwitching:i.isAssociationSwitching,isCalendarMode:i.isCalendarMode()}))),{showDummyData:a}=K("compensations"),h=r.useMemo(()=>be(s),[s]),{data:f,isLoading:y,error:b,refetch:k}=me(h),j=w||y,u=r.useMemo(()=>$(),[]),C=r.useMemo(()=>new Date,[]),l=r.useMemo(()=>{if(a)return[Y];if(!f)return f;const i=f.filter(m=>{const g=m.refereeGame?.game?.startingDateTime;if(!g)return!0;const x=D(g);return!(x<u.from||x>u.to||s==="pendingPast"&&x>C||s==="pendingFuture"&&x<=C)}),N=ke(s)?ue:xe;return[...i].sort((m,g)=>{const x=m.refereeGame?.game?.startingDateTime,T=g.refereeGame?.game?.startingDateTime;return!x&&!T?0:x?T?N(D(x),D(T)):-1:1})},[a,f,s,u,C]),v=r.useMemo(()=>!l||l.length===0?[]:q(l,i=>i.refereeGame?.game?.startingDateTime),[l]),F=[{id:"pendingPast",label:t("compensations.pendingPast")},{id:"pendingFuture",label:t("compensations.pendingFuture")},{id:"closed",label:t("compensations.closed")}],S=r.useCallback(i=>{d(i)},[]),M=r.useCallback(i=>{const p=le(i,{onEditCompensation:c.open,onGeneratePDF:n});return{left:I(i)?[p.editCompensation,p.generatePDF]:[p.generatePDF]}},[c.open,n]),L=r.useCallback(async()=>{await k()},[k]),G=()=>{switch(s){case"pendingPast":return{title:t("compensations.noPendingPastTitle"),description:t("compensations.noPendingPastDescription")};case"pendingFuture":return{title:t("compensations.noPendingFutureTitle"),description:t("compensations.noPendingFutureDescription")};case"closed":return{title:t("compensations.noClosedTitle"),description:t("compensations.noClosedDescription")}}},O=()=>{if(j&&!a)return e.jsx(J,{message:t("compensations.loading")});if(b)return e.jsx(Q,{message:b instanceof Error?b.message:t("compensations.errorLoading"),onRetry:()=>k()});if(v.length===0){const{title:i,description:p}=G();return e.jsx(A,{icon:"wallet",title:i,description:p})}return e.jsx("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:v.map((i,p)=>{const N=v.slice(0,p).reduce((m,g)=>m+g.items.length,0);return e.jsxs(r.Fragment,{children:[v.length>1&&e.jsx(re,{week:i.week}),i.items.map((m,g)=>e.jsx(ce,{swipeConfig:M(m),children:({isDrawerOpen:x})=>e.jsx(ge,{compensation:m,disableExpansion:x,dataTour:N+g===0?"compensation-card":void 0})},m.__identity))]},i.week.key)})})};return o?e.jsx("div",{className:"space-y-3",children:e.jsx(A,{icon:"wallet",title:t("compensations.unavailableInCalendarModeTitle"),description:t("compensations.unavailableInCalendarModeDescription")})}):e.jsx(ae,{onRefresh:L,children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(oe,{tabs:F,activeTab:s,onTabChange:S,ariaLabel:t("compensations.title")}),e.jsx(ie,{tabId:s,activeTab:s,children:O()}),c.compensation&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(he,{isOpen:c.isOpen,onClose:c.close,compensation:c.compensation})})]})})}export{Fe as CompensationsPage};
