const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-OCRPanel-DRqLIcdW.js","assets/chunk-state-CZJejFfH.js","assets/index-BL6RLuQf.js","assets/chunk-router-CqUdIx6-.js","assets/chunk-validation-Cdg1t4SS.js","assets/index-KyjH_G7Q.css","assets/chunk-AssignmentsPage-BdXaLXQQ.js","assets/chunk-assignments-DBz14qIH.js","assets/chunk-ExchangePage-Bj6ckpjd.js","assets/chunk-ojp-client-CP-yjx9q.js","assets/chunk-useTravelTime-BvqbMrWI.js","assets/chunk-ModalErrorBoundary-6Sx6OVIZ.js","assets/chunk-pdf-form-filler-DI6YyRAo.js","assets/chunk-PdfLanguageModal-BPRFZlUC.js","assets/chunk-SafeModeWarningModal-Dt495ZYf.js","assets/chunk-calendar-helpers-d06GvDxC.js","assets/chunk-LoginPage-2A3Bsvbg.js","assets/chunk-useDebouncedValue-Xmd67xmg.js","assets/chunk-cropper-l1UCu5Q8.js"])))=>i.map(i=>d[i]);
import{a as m,u as Qa,b as ft,j as r}from"./chunk-state-CZJejFfH.js";import{l as Ja,C as We,d as pt,f as er}from"./chunk-ModalErrorBoundary-6Sx6OVIZ.js";import{c as K,l as q,e as Se,p as xt,q as Fe,A as gt,u as B,a3 as $e,an as yt,o as tr,a_ as sr,a$ as ar,ad as he,L as _e,b0 as bt,b1 as Fs,b2 as $s,b3 as Nt,_ as rr,b4 as nr,b5 as ir,b6 as Lt,b7 as Bt,B as Z,M as wt,a as kt,b as zs}from"./index-BL6RLuQf.js";import{R as Hs,U as or}from"./chunk-ExchangePage-Bj6ckpjd.js";import{u as vt,I as lr}from"./chunk-useDebouncedValue-Xmd67xmg.js";import{B as Dt}from"./chunk-useTravelTime-BvqbMrWI.js";import{C as Ie}from"./chunk-AssignmentsPage-BdXaLXQQ.js";import{R as Us}from"./chunk-LoginPage-2A3Bsvbg.js";import"./chunk-router-CqUdIx6-.js";import{F as qe}from"./chunk-PdfLanguageModal-BPRFZlUC.js";import{C as cr}from"./chunk-cropper-l1UCu5Q8.js";const dr=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ve=K("camera",dr);const ur=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ws=K("chevron-right",ur);const mr=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ct=K("chevron-up",mr);const hr=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ze=K("circle-check-big",hr);const fr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],pr=K("circle-x",fr);const xr=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Vs=K("image",xr);const gr=[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]],yr=K("party-popper",gr);const br=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Nr=K("pen-tool",br);const wr=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],kr=K("plus",wr);const vr=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Cr=K("rotate-ccw",vr);const Ar=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Sr=K("rotate-cw",Ar);const Er=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],jr=K("skip-forward",Er);const Rr=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],_r=K("stethoscope",Rr);const Ir=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Mr=K("trash-2",Ir);const Tr=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Or=K("undo-2",Tr);const Pr=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ft=K("upload",Pr);const Lr=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Gs=K("user-plus",Lr);function $t(){return{homeRoster:{reviewed:!1,playerModifications:{added:[],removed:[]},coachModifications:{added:new Map,removed:new Set}},awayRoster:{reviewed:!1,playerModifications:{added:[],removed:[]},coachModifications:{added:new Map,removed:new Set}},scorer:{selected:null},scoresheet:{file:null,uploaded:!1}}}function Qe(t){return t.added.length>0||t.removed.length>0}function Ks(t,e){const s=t.indoorPlayerNominations?.map(o=>o.__identity).filter(o=>!!o)??[],a=new Set(e.removed),n=s.filter(o=>!a.has(o)),i=e.added.map(o=>o.id);return[...n,...i]}function Xs(t){return t.added.size>0||t.removed.size>0}function Ys(t,e){if(!Xs(e))return;const s={},a={head:"coachPerson",firstAssistant:"firstAssistantCoachPerson",secondAssistant:"secondAssistantCoachPerson"};for(const n of["head","firstAssistant","secondAssistant"]){const i=e.added.get(n);if(i){s[n]=i.id;continue}if(e.removed.has(n)){s[n]="";continue}const o=t[a[n]]?.__identity;o&&(s[n]=o)}return s}async function zt(t,e,s,a,n){const i=Qe(a),o=n?Xs(n):!1;if(!i&&!o){q.debug("[VS] skip roster save: no modifications");return}if(!s?.__identity||!s.team?.__identity){q.debug("[VS] skip roster save: missing nomination list or team ID");return}const c=Ks(s,a),d=n?Ys(s,n):void 0;await t.updateNominationList(s.__identity,e,s.team.__identity,c,d)}async function Br(t,e,s,a){if(!a||!s?.__identity){q.debug("[VS] skip scorer save: no scorer or scoresheet ID");return}await t.updateScoresheet(s.__identity,e,a,s.isSimpleScoresheet??!1)}async function Ht(t,e,s,a,n){if(!s?.__identity||!s.team?.__identity){q.debug("[VS] skip roster finalize: missing nomination list or team ID");return}const i=Ks(s,a),o=n?Ys(s,n):void 0;await t.finalizeNominationList(s.__identity,e,s.team.__identity,i,s.nominationListValidation?.__identity,o)}async function Dr(t,e,s,a,n){if(!a||!s?.__identity){q.debug("[VS] skip scoresheet finalize: no scorer or scoresheet ID");return}await t.finalizeScoresheet(s.__identity,e,a,n,s.scoresheetValidation?.__identity,s.isSimpleScoresheet??!1)}function Fr(t){const[e,s]=m.useState($t),[a,n]=m.useState(!1),[i,o]=m.useState(!1),c=m.useRef(!1),d=m.useRef(!1),u=Se(A=>A.dataSource),l=xt(u),h=Qa(),f=ft({queryKey:Fe.validation.gameDetail(t??""),queryFn:async()=>t?l.getGameWithScoresheet(t):null,enabled:!!t,staleTime:gt}),x=m.useMemo(()=>({homeRoster:e.homeRoster.reviewed,awayRoster:e.awayRoster.reviewed,scorer:e.scorer.selected!==null,scoresheet:!0}),[e.homeRoster.reviewed,e.awayRoster.reviewed,e.scorer.selected]),g=m.useMemo(()=>x.homeRoster&&x.awayRoster&&x.scorer,[x]),p=m.useMemo(()=>!!f.data?.scoresheet?.closedAt,[f.data]),y=m.useMemo(()=>{const A=f.data?.scoresheet;if(!A?.closedAt)return null;const P=A.writerPerson;return{validatedAt:A.closedAt,scorerName:P?.displayName??"Unknown",scorerBirthday:P?.birthday,hasScoresheet:!!A.hasFile}},[f.data]),R=m.useMemo(()=>{if(p)return null;const A=f.data?.scoresheet?.writerPerson;return A?.__identity?{__identity:A.__identity,displayName:A.displayName??"Unknown",birthday:A.birthday}:null},[f.data,p]),S=m.useMemo(()=>f.data?.group?.hasNoScoresheet??!1,[f.data]),j=m.useMemo(()=>f.data?.nominationListOfTeamHome??null,[f.data?.nominationListOfTeamHome]),C=m.useMemo(()=>f.data?.nominationListOfTeamAway??null,[f.data?.nominationListOfTeamAway]),w=m.useMemo(()=>Qe(e.homeRoster.playerModifications)||Qe(e.awayRoster.playerModifications)||e.homeRoster.coachModifications.added.size>0||e.homeRoster.coachModifications.removed.size>0||e.awayRoster.coachModifications.added.size>0||e.awayRoster.coachModifications.removed.size>0||e.scorer.selected!==null||e.scoresheet.file!==null,[e]),b=m.useCallback(A=>{s(P=>({...P,homeRoster:{...P.homeRoster,playerModifications:A.players,coachModifications:A.coaches,reviewed:!0}}))},[]),N=m.useCallback(A=>{s(P=>({...P,awayRoster:{...P.awayRoster,playerModifications:A.players,coachModifications:A.coaches,reviewed:!0}}))},[]),k=m.useCallback(A=>{s(P=>({...P,scorer:{selected:A}}))},[]),v=m.useCallback((A,P)=>{s(Q=>({...Q,scoresheet:{file:A,uploaded:P}}))},[]),F=m.useCallback(()=>{s($t())},[]),_=m.useCallback(async()=>{if(c.current){q.debug("[VS] save skip: in progress");return}c.current=!0,n(!0);try{const A=f.data;if(!t||!A){q.warn("[VS] no game data for save");return}await zt(l,t,A.nominationListOfTeamHome,e.homeRoster.playerModifications,e.homeRoster.coachModifications),await zt(l,t,A.nominationListOfTeamAway,e.awayRoster.playerModifications,e.awayRoster.coachModifications),await Br(l,t,A.scoresheet,e.scorer.selected?.__identity),q.debug("[VS] save done")}catch(A){throw q.error("[VS] save failed:",A),A}finally{c.current=!1,n(!1)}},[t,f.data,e,l]),M=m.useCallback(async()=>{if(d.current){q.debug("[VS] finalize skip: in progress");return}d.current=!0,o(!0);try{const A=f.data;if(!t||!A){q.warn("[VS] no game data for finalize");return}let P;e.scoresheet.file&&(P=(await l.uploadResource(e.scoresheet.file))[0]?.__identity,q.debug("[VS] PDF uploaded:",P)),await Ht(l,t,A.nominationListOfTeamHome,e.homeRoster.playerModifications,e.homeRoster.coachModifications),await Ht(l,t,A.nominationListOfTeamAway,e.awayRoster.playerModifications,e.awayRoster.coachModifications),await Dr(l,t,A.scoresheet,e.scorer.selected?.__identity,P),await h.invalidateQueries({queryKey:Fe.validation.gameDetail(t)}),q.debug("[VS] finalize done")}catch(A){throw q.error("[VS] finalize failed:",A),A}finally{d.current=!1,o(!1)}},[t,f.data,e,l,h]);return{state:e,isDirty:w,completionStatus:x,isAllRequiredComplete:g,isValidated:p,validatedInfo:y,pendingScorer:R,scoresheetNotRequired:S,setHomeRosterModifications:b,setAwayRosterModifications:N,setScorer:k,setScoresheet:v,reset:F,saveProgress:_,finalizeValidation:M,isSaving:a,isFinalizing:i,isLoadingGameDetails:f.isLoading,gameDetailsError:f.error,homeNominationList:j,awayNominationList:C}}const Je=6;function Ut(t,e,s){if(!t)return{isValid:!0,playerCount:0,hasHeadCoach:!0,hasMinPlayers:!0};const a=t.indoorPlayerNominations?.length??0,n=e.added.length,i=e.removed.length,o=a+n-i,c=!!t.coachPerson,d=s.removed.has("head"),l=s.added.has("head")||c&&!d,h=o>=Je;return{isValid:l&&h,playerCount:o,hasHeadCoach:l,hasMinPlayers:h}}function $r(t,e,s,a,n,i){const o=Ut(t,e,s),c=Ut(a,n,i);return{home:o,away:c,allValid:o.isValid&&c.isValid}}function zr({steps:t,initialStepIndex:e=0,onStepChange:s}){if(t.length===0)throw new Error("useWizardNavigation: steps array cannot be empty");const a=Math.max(0,Math.min(e,t.length-1)),[n,i]=m.useState(a),[o,c]=m.useState(()=>new Set),d=t.length,u=n===0,l=n===d-1,h=!l,f=!u,x=m.useMemo(()=>{const C=t[n];if(!C)throw new Error(`useWizardNavigation: step at index ${n} not found`);return C},[t,n]),g=m.useCallback(C=>{const w=Math.max(0,Math.min(C,t.length-1));w!==n&&(s?.(n,w),i(w))},[n,t.length,s]),p=m.useCallback((C,w)=>{c(b=>{if(w&&b.has(C)||!w&&!b.has(C))return b;const N=new Set(b);return w?N.add(C):N.delete(C),N})},[]),y=m.useCallback(()=>{h&&g(n+1)},[h,n,g]),R=m.useCallback(()=>{f&&g(n-1)},[f,n,g]),S=m.useCallback(()=>{i(0),c(new Set)},[]),j=m.useMemo(()=>{for(let C=0;C<t.length;C++)if(!t[C]?.isOptional&&!o.has(C))return!1;return!0},[t,o]);return{currentStepIndex:n,currentStep:x,totalSteps:d,isFirstStep:u,isLastStep:l,goNext:y,goBack:R,goToStep:g,resetToStart:S,canGoNext:h,canGoBack:f,stepsMarkedDone:o,setStepDone:p,allRequiredStepsDone:j}}const Hr=3e3;function Ur({assignment:t,isOpen:e,onClose:s}){const{t:a}=B(),[n,i]=m.useState(!1),[o,c]=m.useState(!1),[d,u]=m.useState(!1),[l,h]=m.useState(null),[f,x]=m.useState(null),[g,p]=m.useState(!1),y=Se(z=>z.dataSource),R=$e(z=>z.isSafeModeEnabled),S=$e(z=>z.isSafeValidationEnabled),j=y!=="demo"&&R,C=y!=="demo"&&S,w=t.refereeGame?.game?.__identity,{state:b,isDirty:N,completionStatus:k,isValidated:v,validatedInfo:F,pendingScorer:_,scoresheetNotRequired:M,setHomeRosterModifications:A,setAwayRosterModifications:P,setScorer:Q,setScoresheet:ae,reset:H,saveProgress:te,finalizeValidation:re,isSaving:ye,isFinalizing:le,isLoadingGameDetails:pe,gameDetailsError:Ee,homeNominationList:ce,awayNominationList:de}=Fr(w),U=m.useMemo(()=>$r(ce,b.homeRoster.playerModifications,b.homeRoster.coachModifications,de,b.awayRoster.playerModifications,b.awayRoster.coachModifications),[ce,de,b.homeRoster.playerModifications,b.homeRoster.coachModifications,b.awayRoster.playerModifications,b.awayRoster.coachModifications]),D=m.useMemo(()=>[{id:"home-roster",label:a("validation.homeRoster"),isInvalid:!U.home.isValid},{id:"away-roster",label:a("validation.awayRoster"),isInvalid:!U.away.isValid},{id:"scorer",label:a("validation.scorer")},{id:"scoresheet",label:a("validation.scoresheet"),isOptional:!0}],[a,U.home.isValid,U.away.isValid]),{currentStepIndex:V,currentStep:L,totalSteps:X,isFirstStep:$,isLastStep:W,goNext:G,goBack:ue,goToStep:se,resetToStart:E,stepsMarkedDone:O,setStepDone:I}=zr({steps:D}),Y=m.useRef(N),J=m.useRef(!1),be=m.useRef(null);m.useEffect(()=>{Y.current=N},[N]),m.useEffect(()=>()=>{be.current&&(clearTimeout(be.current),be.current=null)},[]),m.useEffect(()=>{e&&(h(null),x(null),c(!1),u(!1),H(),E())},[e,H,E]);const je=m.useMemo(()=>D[V]?.id==="scorer"?k.scorer:!0,[V,D,k.scorer]),Ge=m.useMemo(()=>{for(let z=0;z<V;z++)if(!D[z]?.isOptional&&!O.has(z))return!1;return!0},[D,V,O]),za=!le&&!pe&&!g,Ha=m.useCallback(()=>{v?s():Y.current?i(!0):s()},[s,v]),Te=m.useCallback(async()=>{J.current=!0,h(null);try{C?(await te(),u(!0)):(await re(),x(a("validation.state.saveSuccess")),be.current=setTimeout(()=>{x(null)},Hr),s())}catch(z){const Pt=z instanceof Error?z.message:a("validation.state.saveError");h(Pt)}finally{J.current=!1}},[C,te,re,a,s]),Ua=m.useCallback(async()=>{if(J.current)return;const z=D[D.length-1];if(!(!z?.isOptional&&!je)&&Ge){if(!U.allValid){c(!0);return}z?.isOptional||I(V,!0),await Te()}},[D,je,Ge,U.allValid,V,I,Te]),Wa=m.useCallback(async()=>{try{await te(),i(!1),s()}catch(z){q.error("[ValidateGameModal] Save failed during close:",z),h(a("validation.state.saveError")),i(!1)}},[te,s,a]),Va=m.useCallback(()=>{i(!1),H(),s()},[H,s]),Ga=m.useCallback(()=>{i(!1)},[]),Ka=m.useCallback(()=>{je&&(I(V,!0),G())},[je,I,V,G]),Xa=m.useCallback(z=>{p(z)},[]),Ya=m.useCallback(()=>{c(!1),U.home.isValid?U.away.isValid||se(1):se(0)},[U.home.isValid,U.away.isValid,se]),qa=m.useCallback(async()=>{c(!1),D[D.length-1]?.isOptional||I(V,!0),await Te()},[D,V,I,Te]),Za=m.useCallback(()=>{u(!1),s()},[s]);return{currentStepIndex:V,currentStepId:L.id,currentStep:L,totalSteps:X,isFirstStep:$,isLastStep:W,stepsMarkedDone:O,goToStep:se,wizardSteps:D,isInSafeMode:j,validationState:b,isDirty:N,completionStatus:k,isValidated:v,validatedInfo:F,pendingScorer:_,scoresheetNotRequired:M,setHomeRosterModifications:A,setAwayRosterModifications:P,setScorer:Q,setScoresheet:ae,isSaving:ye,isFinalizing:le,isLoadingGameDetails:pe,gameDetailsError:Ee,homeNominationList:ce,awayNominationList:de,showUnsavedDialog:n,showRosterWarningDialog:o,showSafeValidationComplete:d,saveError:l,successToast:f,isAddPlayerSheetOpen:g,rosterValidation:U,canMarkCurrentStepDone:je,allPreviousRequiredStepsDone:Ge,isSwipeEnabled:za,attemptClose:Ha,handleFinish:Ua,handleSaveAndClose:Wa,handleDiscardAndClose:Va,handleCancelClose:Ga,goNext:G,handleValidateAndNext:Ka,goBack:ue,handleAddPlayerSheetOpenChange:Xa,handleRosterWarningGoBack:Ya,handleRosterWarningProceed:qa,handleSafeValidationCompleteClose:Za}}const Wr=.3,Oe=300;function Vr({currentStep:t,totalSteps:e,onSwipeNext:s,onSwipePrevious:a,swipeEnabled:n=!0,children:i}){const[o,c]=m.useState("idle"),[d,u]=m.useState(!1),l=m.useRef(t),h=m.useRef(null),f=t<e-1,x=t>0,g=m.useCallback((b,N,k)=>{u(!0),k(b?N:-N),requestAnimationFrame(()=>{requestAnimationFrame(()=>{u(!1),c("entering"),k(0)})}),h.current=setTimeout(()=>{c("idle"),h.current=null},Oe)},[]),{containerRef:p,translateX:y,isDragging:R,containerWidth:S,setTranslateX:j,handlers:C}=Ja({enabled:n,maxSwipeMultiplier:1.5,canSwipe:(b,N)=>!(N==="left"&&!f||N==="right"&&!x),onDragEnd:(b,N)=>{const k=Math.abs(b),v=b<0,F=v&&f||!v&&x,_=N*Wr;return k>_&&F?(c("exiting"),j(v?-N:N),h.current=setTimeout(()=>{p.current&&(l.current+=v?1:-1,v?s?.():a?.(),g(v,N,j))},Oe),!0):!1}});m.useEffect(()=>()=>{h.current&&(clearTimeout(h.current),h.current=null)},[]),m.useLayoutEffect(()=>{if(t!==l.current&&S){const b=t>l.current;if(l.current=t,o==="idle"){j(b?S:-S),c("entering"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{j(0)})});const N=setTimeout(()=>{c("idle"),h.current=null},Oe);return h.current=N,()=>{clearTimeout(N)}}}},[t,S,o,j]);const w=!R&&!d;return r.jsx("div",{ref:p,className:"relative overflow-hidden",...C,children:r.jsx("div",{style:{transform:`translateX(${y}px)`,transition:w?`transform ${Oe}ms cubic-bezier(0.25, 0.1, 0.25, 1)`:"none",cursor:n?R?"grabbing":"grab":"default"},children:i})})}function Gr(t,e,s){return t?s?"bg-warning-500 text-warning-950 ring-2 ring-warning-500 ring-offset-2 dark:ring-offset-surface-card-dark":"bg-primary-500 text-primary-950 ring-2 ring-primary-500 ring-offset-2 dark:ring-offset-surface-card-dark":s?"bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-400 ring-2 ring-warning-400 dark:ring-warning-600":e?"bg-success-500 text-white":"bg-surface-muted dark:bg-surface-subtle-dark text-text-muted dark:text-text-muted-dark"}function Kr({steps:t,currentStepIndex:e,stepsMarkedDone:s,onStepClick:a,clickable:n=!1}){const{t:i}=B();return r.jsx("div",{className:"flex items-center justify-center gap-2",role:"navigation","aria-label":i("common.wizardProgress"),children:t.map((o,c)=>{const d=c===e,u=s.has(c),l=o.isInvalid??!1,h=!o.isOptional&&u&&!l,f=!n,x=()=>{!f&&a&&a(c)},g=y=>{!f&&a&&(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),a(c))},p=[o.label];return d&&p.push(i("common.stepIndicatorCurrent")),h&&p.push(i("common.stepIndicatorDone")),l&&p.push(i("common.stepIndicatorInvalid")),r.jsxs("div",{className:"flex items-center",children:[c>0&&r.jsx("div",{className:`w-8 h-0.5 mx-1 transition-colors ${c<=e?"bg-primary-500":"bg-border-strong dark:bg-border-strong-dark"}`}),r.jsx("button",{type:"button",onClick:x,onKeyDown:g,"aria-disabled":f,"aria-current":d?"step":void 0,"aria-label":p.join(" "),className:`
                relative flex items-center justify-center w-8 h-8 rounded-full
                transition-all duration-200
                ${n?"cursor-pointer hover:scale-110":"cursor-default"}
                ${Gr(d,h,l)}
                focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-surface-card-dark
                aria-disabled:cursor-default aria-disabled:opacity-100
              `,children:l&&!d?r.jsx(yt,{className:"w-4 h-4",strokeWidth:2.5,"aria-hidden":"true"}):h&&!d?r.jsx(We,{className:"w-4 h-4",strokeWidth:3,"aria-hidden":"true"}):r.jsx("span",{className:"text-xs font-semibold",children:c+1})})]},o.id)})})}function Xr(t){const e=t.indoorPlayer?.person;if(e?.displayName)return e.displayName;const s=e?.firstName?.trim()??"",a=e?.lastName?.trim()??"";return[s,a].filter(Boolean).join(" ")}function Yr(t){const e=t.__identity,s=Xr(t),a=t.indoorPlayer?.person;return!e||!s?null:{id:e,displayName:s,firstName:a?.firstName,lastName:a?.lastName,birthday:a?.birthday,licenseCategory:t.indoorPlayerLicenseCategory?.shortName,isNewlyAdded:!1}}function Wt(t){return t?t.map(Yr).filter(e=>e!==null).sort((e,s)=>e.displayName.localeCompare(s.displayName)):[]}function qr({gameId:t,team:e,prefetchedData:s}){const n=Se(l=>l.dataSource)==="demo",i=tr(l=>l.nominationLists),o=s!=null,c=m.useMemo(()=>o?Wt(s?.indoorPlayerNominations):[],[o,s]),d=m.useMemo(()=>{if(o||!n||!t)return null;const l=i[t];return l?l[e]??null:null},[o,n,t,e,i]),u=m.useMemo(()=>d?Wt(d.indoorPlayerNominations):[],[d]);return o?{nominationList:s,players:c,isLoading:!1,isError:!1,error:null,refetch:()=>{}}:n?{nominationList:d,players:u,isLoading:!1,isError:!1,error:null,refetch:()=>{}}:{nominationList:null,players:[],isLoading:!1,isError:!0,error:new Error("Nomination list data not available. Ensure prefetchedData is provided from getGameWithScoresheet()."),refetch:()=>{}}}function qs(t){const e=t.trim();if(!e)return{};const s=e.split(/\s+/),a={},n=s[s.length-1];return n&&/^\d{4}$/.test(n)&&(a.yearOfBirth=n,s.pop()),s.length===1?a.lastName=s[0]:s.length>=2&&(a.firstName=s[0],a.lastName=s.slice(1).join(" ")),a}function Zs(t,e={}){const s=Se(o=>o.dataSource),a=xt(s),n=!!(t.firstName||t.lastName||t.yearOfBirth),i=ft({queryKey:Fe.scorerSearch.search(t),queryFn:async()=>{const o=await a.searchPersons(t);return sr(o,ar,"scorerSearch").items??[]},enabled:e.enabled!==!1&&n,staleTime:gt});return{data:i.data,isLoading:i.isLoading,isError:i.isError,error:i.error}}const Zr=100,Qr=300,Vt="coach-search-listbox";function Jr(t,e){switch(t){case"head":return e("validation.roster.headCoach");case"firstAssistant":return e("validation.roster.firstAssistant");case"secondAssistant":return e("validation.roster.secondAssistant")}}function en({isOpen:t,onClose:e,role:s,onSelectCoach:a}){const{t:n}=B(),[i,o]=m.useState(""),[c,d]=m.useState(-1),u=vt(i,Qr),l=m.useRef(null),h=qs(u),{data:f,isLoading:x,isError:g}=Zs(h,{enabled:t&&u.trim().length>0}),p=m.useCallback(()=>{o(""),d(-1),e()},[e]),y=m.useCallback(w=>{a(w,s),p()},[a,s,p]),R=m.useCallback(w=>{if(!(!f||f.length===0))switch(w.key){case"ArrowDown":w.preventDefault(),d(b=>b<f.length-1?b+1:b);break;case"ArrowUp":w.preventDefault(),d(b=>b>0?b-1:b);break;case"Enter":{const b=f[c];c>=0&&b&&(w.preventDefault(),y(b));break}case"Escape":d(-1);break}},[f,c,y]);m.useEffect(()=>{if(t&&l.current){const w=setTimeout(()=>{l.current?.focus()},Zr);return()=>clearTimeout(w)}},[t]),m.useEffect(()=>{if(c>=0&&f?.[c]){const w=`coach-option-${f[c].__identity}`,b=document.getElementById(w);b?.scrollIntoView&&b.scrollIntoView({block:"nearest",behavior:"smooth"})}},[c,f]);const S=f&&f.length>0,j=u.trim().length>0,C=Jr(s,n);return r.jsxs(Hs,{isOpen:t,onClose:p,titleId:"add-coach-title",children:[r.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[r.jsxs("div",{children:[r.jsx("h2",{id:"add-coach-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:n("validation.roster.addCoach")}),r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:C})]}),r.jsx("button",{onClick:p,"aria-label":n("common.close"),className:`
            p-2 -mr-2 rounded-lg
            text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
            hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
            transition-colors
          `,children:r.jsx(he,{className:"w-5 h-5","aria-hidden":"true"})})]}),r.jsx("div",{className:"flex-shrink-0 p-4 border-b border-border-default dark:border-border-default-dark",children:r.jsx("input",{ref:l,type:"text",value:i,onChange:w=>{o(w.target.value),d(-1)},onKeyDown:R,placeholder:n("validation.roster.searchCoaches"),"aria-label":n("validation.roster.searchCoaches"),role:"combobox","aria-expanded":S&&j?"true":"false","aria-controls":Vt,"aria-activedescendant":c>=0&&f?.[c]?`coach-option-${f[c].__identity}`:void 0,"aria-autocomplete":"list",className:`
            w-full px-4 py-2 rounded-lg
            bg-surface-subtle dark:bg-surface-subtle-dark
            text-text-primary dark:text-text-primary-dark
            placeholder-text-muted dark:placeholder-text-muted-dark
            border border-transparent
            focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
            outline-none transition-colors
          `})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 py-2",children:j?x?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(_e,{size:"md"})}):g?r.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:n("validation.roster.loadCoachesError")}):S?r.jsx("ul",{id:Vt,role:"listbox","aria-label":n("validation.roster.coaches"),className:"space-y-1",children:f.map((w,b)=>{const N=b===c;return r.jsx("li",{id:`coach-option-${w.__identity}`,role:"option","aria-selected":N,children:r.jsxs("button",{type:"button",onClick:()=>y(w),onMouseEnter:()=>d(b),className:`
                      w-full flex items-center justify-between p-3 rounded-lg
                      text-left
                      transition-colors
                      ${N?"bg-primary-50 dark:bg-primary-900/30":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
                    `,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate",children:w.displayName}),r.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[w.associationId&&r.jsxs("span",{children:["ID: ",w.associationId]}),w.birthday&&r.jsxs("span",{children:[n("common.dob"),": ",bt(w.birthday)]})]})]}),r.jsx(Ws,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},w.__identity)})}):r.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:n("validation.roster.noCoachesFound")}):r.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:n("validation.scorerSearch.searchHint")})}),r.jsx("div",{className:"flex-shrink-0 p-4 border-t border-border-default dark:border-border-default-dark",children:r.jsx("button",{type:"button",onClick:p,className:`
            w-full py-3 px-4 rounded-lg
            text-sm font-medium
            text-text-secondary dark:text-text-secondary-dark
            bg-surface-subtle dark:bg-surface-subtle-dark
            hover:bg-gray-200 dark:hover:bg-gray-700
            transition-colors
            focus:outline-none focus:ring-2 focus:ring-primary-500/50
          `,children:n("common.cancel")})})]})}function tn({nominationListId:t,enabled:e=!0}){const s=Se(n=>n.dataSource),a=xt(s);return ft({queryKey:Fe.nominations.possible(t),queryFn:async()=>(await a.getPossiblePlayerNominations(t)).items??[],enabled:e&&!!t,staleTime:gt})}const sn=100,an=200;function rn({isOpen:t,onClose:e,nominationListId:s,excludePlayerIds:a,onAddPlayer:n,onRemovePlayer:i}){const{t:o}=B(),[c,d]=m.useState(""),u=vt(c,an),l=m.useRef(null),[h,f]=m.useState(new Set),{data:x,isLoading:g,isError:p}=tn({nominationListId:s,enabled:t&&!!s}),y=m.useMemo(()=>{if(!x)return[];const w=u.toLowerCase();return x.filter(b=>{const N=b.indoorPlayer?.__identity??"";if(a.includes(N)&&!h.has(N)||b.isAlreadyNominated)return!1;const k=b.indoorPlayer?.person?.lastName?.toLowerCase()??"",v=b.indoorPlayer?.person?.firstName?.toLowerCase()??"";return`${k} ${v}`.includes(w)||v.includes(w)||k.includes(w)})},[x,u,a,h]),R=m.useMemo(()=>{const w=y.map(b=>({id:b.indoorPlayer?.__identity??"",firstName:b.indoorPlayer?.person?.firstName,lastName:b.indoorPlayer?.person?.lastName,birthday:b.indoorPlayer?.person?.birthday}));return Fs(w)},[y]),S=m.useMemo(()=>$s(R),[R]),j=m.useCallback(()=>{d(""),f(new Set),e()},[e]),C=m.useCallback(w=>{const b=w.indoorPlayer?.__identity??"";h.has(b)?(f(N=>{const k=new Set(N);return k.delete(b),k}),i(b)):(f(N=>{const k=new Set(N);return k.add(b),k}),n(w))},[h,n,i]);return m.useEffect(()=>{if(t&&l.current){const w=setTimeout(()=>{l.current?.focus()},sn);return()=>clearTimeout(w)}},[t]),r.jsxs(Hs,{isOpen:t,onClose:j,titleId:"add-player-title",children:[r.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h2",{id:"add-player-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:o("validation.addPlayer")}),h.size>0&&r.jsxs("span",{className:"px-2 py-0.5 text-sm font-medium text-success-700 dark:text-success-400 bg-success-100 dark:bg-success-900/30 rounded-full",children:[h.size," ",o("validation.roster.added")]})]}),r.jsx("button",{onClick:j,"aria-label":o("common.close"),className:`
              p-2 -mr-2 rounded-lg
              text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
              hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
              transition-colors
            `,children:r.jsx(he,{className:"w-5 h-5","aria-hidden":"true"})})]}),r.jsx("div",{className:"flex-shrink-0 p-4 border-b border-border-default dark:border-border-default-dark",children:r.jsx("input",{ref:l,type:"text",value:c,onChange:w=>d(w.target.value),placeholder:o("validation.searchPlayers"),"aria-label":o("validation.searchPlayers"),className:`
              w-full px-4 py-2 rounded-lg
              bg-surface-subtle dark:bg-surface-subtle-dark
              text-text-primary dark:text-text-primary-dark
              placeholder-text-muted dark:placeholder-text-muted-dark
              border border-transparent
              focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
              outline-none transition-colors
            `})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 py-2",children:g?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(_e,{size:"md"})}):p?r.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:o("validation.loadPlayersError")}):y.length===0?r.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:o("validation.noPlayersFound")}):r.jsx("ul",{children:y.map(w=>{const b=w.indoorPlayer?.__identity??"",N=h.has(b),k=R.get(b),v=k?.lastName||w.indoorPlayer?.person?.lastName||"",F=k?.firstInitial||"",_=k?.dob||"",M=N?"text-success-700 dark:text-success-400":"text-text-primary dark:text-text-primary-dark";return r.jsx("li",{children:r.jsxs("button",{onClick:()=>C(w),"aria-pressed":N,className:`
                        group w-full flex items-center justify-between py-2 px-3 rounded-lg
                        text-left transition-colors
                        ${N?"bg-success-50 dark:bg-success-900/20 hover:bg-danger-50 dark:hover:bg-danger-900/20":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
                      `,children:[r.jsx("div",{className:"flex-1 min-w-0",children:r.jsxs("div",{className:"flex items-baseline text-sm font-mono",children:[r.jsx("span",{className:`font-medium ${M}`,style:{minWidth:`${S}ch`},children:v}),r.jsx("span",{className:`ml-2 w-[3ch] ${M}`,children:F}),r.jsx("span",{className:"ml-2 text-text-muted dark:text-text-muted-dark tabular-nums",children:_})]})}),N?r.jsxs("span",{className:"relative flex-shrink-0 ml-2 w-5 h-5",children:[r.jsx(We,{className:"w-5 h-5 text-success-600 dark:text-success-400 absolute inset-0 group-hover:opacity-0 transition-opacity","aria-hidden":"true"}),r.jsx(he,{className:"w-5 h-5 text-danger-500 dark:text-danger-400 absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity","aria-hidden":"true"}),r.jsx("span",{className:"sr-only",children:o("validation.roster.added")})]}):r.jsx(kr,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},w.__identity)})})}),r.jsx("div",{className:"flex-shrink-0 p-4 border-t border-border-default dark:border-border-default-dark",children:r.jsx("button",{type:"button",onClick:j,className:`
              w-full py-3 px-4 rounded-lg
              text-sm font-medium
              text-white bg-primary-500 hover:bg-primary-600
              dark:bg-primary-600 dark:hover:bg-primary-700
              transition-colors
              focus:outline-none focus:ring-2 focus:ring-primary-500/50
            `,children:o("common.done")})})]})}function Ke({label:t,person:e,coachRole:s,readOnly:a,isPendingAddition:n,isPendingRemoval:i,onAdd:o,onRemove:c}){const{t:d}=B(),u=e!=null,l=e?.displayName??d("validation.roster.notAssigned"),h=i&&u,f=n;return r.jsxs("div",{className:`
        flex items-center justify-between py-2 px-3
        ${h?"bg-danger-50 dark:bg-danger-900/20":""}
        ${f?"bg-success-50 dark:bg-success-900/20":""}
      `,"data-testid":`coach-row-${s}`,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("span",{className:"text-xs text-text-muted dark:text-text-muted-dark uppercase tracking-wide",children:t}),r.jsx("p",{className:`
            text-sm truncate
            ${h?"line-through text-danger-600 dark:text-danger-400":""}
            ${f?"text-success-700 dark:text-success-400 font-medium":""}
            ${!u&&!f?"text-text-muted dark:text-text-muted-dark italic":"text-text-primary dark:text-text-primary-dark"}
          `,children:l})]}),!a&&r.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[u&&!h&&r.jsx("button",{type:"button",onClick:c,"aria-label":d("validation.roster.removeCoach"),className:"p-1.5 rounded-md text-text-muted hover:text-danger-600 hover:bg-danger-50 dark:hover:text-danger-400 dark:hover:bg-danger-900/30 transition-colors",children:r.jsx(he,{className:"w-4 h-4","aria-hidden":"true"})}),h&&r.jsx("button",{type:"button",onClick:c,"aria-label":d("validation.roster.undoRemoval"),className:"text-xs px-2 py-1 rounded-md text-danger-600 hover:bg-danger-100 dark:text-danger-400 dark:hover:bg-danger-900/40 transition-colors",children:d("validation.roster.undoRemoval")}),!u&&!f&&r.jsx("button",{type:"button",onClick:o,"aria-label":d("validation.roster.addCoach"),className:"p-1.5 rounded-md text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/30 transition-colors",children:r.jsx(Gs,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}function nn({headCoach:t,firstAssistant:e,secondAssistant:s,readOnly:a=!1,onAddCoach:n,onRemoveCoach:i,pendingAdditions:o,pendingRemovals:c}){const{t:d}=B(),u=o?.get("head")??t,l=o?.get("firstAssistant")??e,h=o?.get("secondAssistant")??s;return r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 divide-y divide-gray-200 dark:divide-gray-700",role:"list","aria-label":d("validation.roster.coaches"),children:[r.jsx(Ke,{label:d("validation.roster.headCoach"),person:u,coachRole:"head",readOnly:a,isPendingAddition:o?.has("head"),isPendingRemoval:c?.has("head"),onAdd:()=>n?.("head"),onRemove:()=>i?.("head")}),r.jsx(Ke,{label:d("validation.roster.firstAssistant"),person:l,coachRole:"firstAssistant",readOnly:a,isPendingAddition:o?.has("firstAssistant"),isPendingRemoval:c?.has("firstAssistant"),onAdd:()=>n?.("firstAssistant"),onRemove:()=>i?.("firstAssistant")}),r.jsx(Ke,{label:d("validation.roster.secondAssistant"),person:h,coachRole:"secondAssistant",readOnly:a,isPendingAddition:o?.has("secondAssistant"),isPendingRemoval:c?.has("secondAssistant"),onAdd:()=>n?.("secondAssistant"),onRemove:()=>i?.("secondAssistant")})]})}function on({player:t,displayData:e,maxLastNameWidth:s,isMarkedForRemoval:a,onRemove:n,onUndoRemoval:i,readOnly:o=!1}){const{t:c}=B(),d=a?"line-through text-text-subtle dark:text-text-subtle-dark":"text-text-primary dark:text-text-primary-dark";return r.jsxs("div",{className:`flex items-center justify-between py-3 px-2 border-b border-border-subtle dark:border-border-subtle-dark last:border-b-0 ${a?"opacity-50":""}`,children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[r.jsxs("div",{className:"flex items-baseline text-sm font-mono",children:[r.jsx("span",{className:d,style:{minWidth:`${s}ch`},children:e.lastName}),r.jsx("span",{className:`ml-2 w-[3ch] ${d}`,children:e.firstInitial}),r.jsx("span",{className:`ml-2 text-text-muted dark:text-text-muted-dark tabular-nums ${a?"line-through":""}`,children:e.dob})]}),r.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[t.licenseCategory&&!a&&r.jsx(Dt,{variant:"neutral",children:t.licenseCategory}),t.isNewlyAdded&&!a&&r.jsx(Dt,{variant:"success",children:c("validation.roster.newlyAdded")})]})]}),!o&&r.jsx("div",{className:"flex-shrink-0 ml-2",children:a?r.jsx("button",{type:"button",onClick:i,className:"p-1.5 rounded-full text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/50 transition-colors","aria-label":c("validation.roster.undoRemoval"),title:c("validation.roster.undoRemoval"),children:r.jsx(Or,{className:"w-4 h-4","aria-hidden":"true"})}):r.jsx("button",{type:"button",onClick:n,className:"p-1.5 rounded-full text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/50 transition-colors","aria-label":c("validation.roster.removePlayer"),title:c("validation.roster.removePlayer"),children:r.jsx(Mr,{className:"w-4 h-4","aria-hidden":"true"})})})]})}const ln=m.lazy(()=>rr(()=>import("./chunk-OCRPanel-DRqLIcdW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])).then(t=>({default:t.OCRPanel})));function Gt({title:t,count:e,countLabel:s,expanded:a,onToggle:n,sectionId:i}){const o=a?Ct:Nt;return r.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-3 px-1 text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 rounded-lg","aria-expanded":a,"aria-controls":i,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(o,{className:"w-5 h-5 text-text-muted dark:text-text-muted-dark","aria-hidden":"true"}),r.jsx("span",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:t})]}),r.jsx("span",{className:"text-xs text-text-muted dark:text-text-muted-dark",children:s.replace("{count}",String(e))})]})}function Qs({team:t,teamName:e,gameId:s,onModificationsChange:a,onAddPlayerSheetOpenChange:n,readOnly:i=!1,initialModifications:o,initialCoachModifications:c,prefetchedNominationList:d}){const{t:u}=B(),{nominationList:l,players:h,isLoading:f,isError:x,refetch:g}=qr({gameId:s,team:t,prefetchedData:d}),{isOCREnabled:p}=$e(),[y,R]=m.useState("players"),[S,j]=m.useState(()=>o?.added??[]),[C,w]=m.useState(()=>new Set(o?.removed??[])),[b,N]=m.useState(()=>c?.added??new Map),[k,v]=m.useState(()=>c?.removed??new Set),[F,_]=m.useState(!1),[M,A]=m.useState(!1),[P,Q]=m.useState("head"),[ae,H]=m.useState(!1),te=m.useRef(a);m.useEffect(()=>{te.current=a},[a]),m.useEffect(()=>{te.current?.({players:{added:S,removed:[...C]},coaches:{added:b,removed:k}})},[S,C,b,k]),m.useEffect(()=>{n?.(F)},[F,n]);const re=m.useCallback(E=>{w(O=>{const I=new Set(O);return I.add(E),I})},[]),ye=m.useCallback(E=>{w(O=>{const I=new Set(O);return I.delete(E),I})},[]),le=m.useCallback(E=>{const O=E.indoorPlayer?.__identity;if(!O)return;const I=E.indoorPlayer?.person,Y={id:O,displayName:I?.displayName??`${I?.firstName??""} ${I?.lastName??""}`.trim(),firstName:I?.firstName,lastName:I?.lastName,birthday:I?.birthday,licenseCategory:E.licenseCategory,isNewlyAdded:!0};j(J=>[...J,Y])},[]),pe=m.useCallback(E=>{j(O=>O.filter(I=>I.id!==E))},[]),Ee=m.useCallback(E=>{Q(E),A(!0)},[]),ce=m.useCallback(E=>{if(b.has(E)){N(O=>{const I=new Map(O);return I.delete(E),I});return}v(O=>{const I=new Set(O);return I.has(E)?I.delete(E):I.add(E),I})},[b]),de=m.useCallback((E,O)=>{const I={id:E.__identity,displayName:E.displayName??"",firstName:E.firstName,lastName:E.lastName,birthday:E.birthday};N(Y=>{const J=new Map(Y);return J.set(O,I),J}),v(Y=>{const J=new Set(Y);return J.delete(O),J})},[]),U=m.useCallback(E=>{if(i){H(!1);return}w(O=>{const I=new Set(O);return E.forEach(Y=>I.delete(Y)),I}),H(!1)},[i]),D=[...h,...S].sort((E,O)=>{if(E.isNewlyAdded&&!O.isNewlyAdded)return 1;if(!E.isNewlyAdded&&O.isNewlyAdded)return-1;const I=E.lastName??E.displayName,Y=O.lastName??O.displayName;return I.localeCompare(Y)}),V=m.useMemo(()=>Fs(D),[D]),L=m.useMemo(()=>$s(V),[V]),X=D.filter(E=>!C.has(E.id)).length,$=l?.coachPerson,W=l?.firstAssistantCoachPerson,G=l?.secondAssistantCoachPerson,ue=m.useMemo(()=>{const E=new Map;return b.forEach((O,I)=>{E.set(I,{__identity:O.id,displayName:O.displayName,firstName:O.firstName,lastName:O.lastName,birthday:O.birthday})}),E},[b]),se=m.useMemo(()=>{let E=0;const O=["head","firstAssistant","secondAssistant"],I={head:$,firstAssistant:W,secondAssistant:G};for(const Y of O){const J=b.has(Y),be=I[Y]&&!k.has(Y);(J||be)&&E++}return E},[$,W,G,b,k]);return f?r.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"status","aria-live":"polite",children:[r.jsx(_e,{size:"md",className:"mb-3"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:u("validation.roster.loadingRoster")})]}):x?r.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"alert",children:[r.jsx(Ie,{className:"w-10 h-10 text-danger-500 mb-3","aria-hidden":"true"}),r.jsx("p",{className:"text-sm text-danger-600 dark:text-danger-400 mb-4",children:u("validation.roster.errorLoading")}),r.jsxs("button",{type:"button",onClick:()=>g(),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[r.jsx(Us,{className:"w-4 h-4","aria-hidden":"true"}),u("common.retry")]})]}):r.jsxs("div",{className:"py-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:e}),r.jsxs("div",{className:"mb-2",children:[r.jsx(Gt,{title:u("validation.roster.coaches"),count:se,countLabel:u("validation.roster.coachCount"),expanded:y==="coaches",onToggle:()=>R("coaches"),sectionId:`coaches-section-${t}`}),y==="coaches"&&r.jsx("div",{id:`coaches-section-${t}`,className:"mt-2",children:r.jsx(nn,{headCoach:$,firstAssistant:W,secondAssistant:G,readOnly:i,onAddCoach:Ee,onRemoveCoach:ce,pendingAdditions:ue,pendingRemovals:k})})]}),r.jsxs("div",{children:[r.jsx(Gt,{title:u("validation.roster.players"),count:X,countLabel:u("validation.roster.playerCount"),expanded:y==="players",onToggle:()=>R("players"),sectionId:`players-section-${t}`}),y==="players"&&r.jsxs("div",{id:`players-section-${t}`,className:"mt-2",children:[D.length===0?r.jsx("div",{className:"py-8 text-center",children:r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:u("validation.roster.emptyRoster")})}):r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:D.map(E=>{const O=V.get(E.id);return r.jsx(on,{player:E,displayData:{lastName:O?.lastName||E.lastName||E.displayName,firstInitial:O?.firstInitial||"",dob:O?.dob||""},maxLastNameWidth:L,isMarkedForRemoval:C.has(E.id),onRemove:i?void 0:()=>re(E.id),onUndoRemoval:i?void 0:()=>ye(E.id),readOnly:i},E.id)})}),(!i||p)&&r.jsxs("div",{className:"mt-4 flex gap-2",children:[!i&&r.jsxs("button",{type:"button",onClick:()=>_(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 hover:bg-primary-100 dark:hover:bg-primary-900/50 rounded-lg border border-primary-200 dark:border-primary-800 transition-colors",children:[r.jsx(Gs,{className:"w-4 h-4","aria-hidden":"true"}),u("validation.roster.addPlayer")]}),p&&r.jsxs("button",{type:"button",onClick:()=>H(!0),className:`flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600 transition-colors ${i?"flex-1":""}`,title:u("validation.ocr.scanScoresheet"),children:[r.jsx(Ve,{className:"w-4 h-4","aria-hidden":"true"}),r.jsx("span",{className:"sr-only",children:u("validation.ocr.scanScoresheet")})]})]})]})]}),!i&&r.jsx(rn,{isOpen:F,onClose:()=>_(!1),nominationListId:l?.__identity??"",excludePlayerIds:h.map(E=>E.id),onAddPlayer:le,onRemovePlayer:pe}),!i&&r.jsx(en,{isOpen:M,onClose:()=>A(!1),role:P,onSelectCoach:de}),p&&r.jsx(m.Suspense,{fallback:null,children:r.jsx(ln,{isOpen:ae,onClose:()=>H(!1),team:t,teamName:e,rosterPlayers:D,onApplyResults:U})})]})}function cn({assignment:t,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:a=!1,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o}){const{homeTeam:c}=pt(t),d=t.refereeGame?.game?.__identity??"";return r.jsx(Qs,{team:"home",teamName:c,gameId:d,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:a,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o})}function dn({assignment:t,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:a=!1,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o}){const{awayTeam:c}=pt(t),d=t.refereeGame?.game?.__identity??"";return r.jsx(Qs,{team:"away",teamName:c,gameId:d,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:a,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o})}function un(t){return`scorer-option-${t}`}function mn({results:t,isLoading:e,isError:s,onSelect:a,highlightedIndex:n=-1,onHighlight:i,listboxId:o}){const{t:c}=B(),d=t&&t.length>0;return e?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(_e,{size:"md"})}):s?r.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:c("validation.scorerSearch.searchError")}):d?r.jsx("ul",{id:o,role:"listbox","aria-label":c("validation.scorerSearch.searchResults"),className:"space-y-1",children:t.map((u,l)=>{const h=l===n;return r.jsx("li",{id:un(u.__identity),role:"option","aria-selected":h,children:r.jsxs("button",{onClick:()=>a(u),onMouseEnter:()=>i?.(l),className:`
                w-full flex items-center justify-between p-3 rounded-lg
                text-left
                transition-colors
                ${h?"bg-primary-50 dark:bg-primary-900/30":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
              `,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate",children:u.displayName}),r.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[u.associationId&&r.jsxs("span",{children:["ID: ",u.associationId]}),u.birthday&&r.jsxs("span",{children:[c("common.dob"),": ",bt(u.birthday)]})]})]}),r.jsx(Ws,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},u.__identity)})}):r.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:c("validation.scorerSearch.noScorersFound")})}function Kt({scorer:t,displayName:e,displayBirthday:s,onClear:a,readOnly:n=!1}){const{t:i}=B(),o=t?.displayName??e??"",c=t?.birthday??s;return r.jsx("div",{className:"mb-4 p-4 bg-primary-50 dark:bg-primary-900/20 rounded-lg border border-primary-200 dark:border-primary-800",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark",children:o}),(t?.associationId||c)&&r.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[t?.associationId&&r.jsxs("span",{children:["ID: ",t.associationId]}),c&&r.jsxs("span",{children:[i("common.dob"),": ",bt(c)]})]})]}),!n&&a&&r.jsx("button",{onClick:a,"aria-label":i("common.close"),className:`
              p-2 rounded-lg
              text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
              hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
              transition-colors
            `,children:r.jsx(he,{className:"w-5 h-5","aria-hidden":"true"})})]})})}const hn=300,fn=100,Xt="scorer-search-listbox",Yt="scorer-search-hint";function pn({selectedScorer:t,onScorerSelect:e,readOnly:s=!1,readOnlyScorerName:a,readOnlyScorerBirthday:n}){const{t:i,tInterpolate:o}=B(),[c,d]=m.useState(""),[u,l]=m.useState(-1),h=vt(c,hn),f=m.useRef(null),x=qs(h),{data:g,isLoading:p,isError:y}=Zs(x);m.useEffect(()=>{if(t)return;const b=setTimeout(()=>{f.current?.focus()},fn);return()=>clearTimeout(b)},[t]),m.useEffect(()=>{if(u>=0&&g?.[u]){const b=`scorer-option-${g[u].__identity}`,N=document.getElementById(b);N?.scrollIntoView&&N.scrollIntoView({block:"nearest",behavior:"smooth"})}},[u,g]);const R=m.useCallback(b=>{e(b),d(""),l(-1)},[e]),S=m.useCallback(b=>{if(!(!g||g.length===0))switch(b.key){case"ArrowDown":b.preventDefault(),l(N=>N<g.length-1?N+1:N);break;case"ArrowUp":b.preventDefault(),l(N=>N>0?N-1:N);break;case"Enter":{const N=g[u];u>=0&&N&&(b.preventDefault(),R(N));break}case"Escape":l(-1);break;case"Home":b.preventDefault(),l(0);break;case"End":b.preventDefault(),l(g.length-1);break}},[g,u,R]),j=m.useCallback(()=>{e(null),d(""),l(-1),f.current?.focus()},[e]),C=g&&g.length>0,w=h.trim()&&!t;return s?r.jsx("div",{className:"py-4",children:t||a?r.jsx(Kt,{scorer:t,displayName:a,displayBirthday:n,readOnly:!0}):r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.noScorerSelected")})}):r.jsxs("div",{className:"py-4",children:[t&&r.jsx(Kt,{scorer:t,onClear:j}),!t&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("input",{ref:f,type:"text",value:c,onChange:b=>{d(b.target.value),l(-1)},onKeyDown:S,placeholder:i("validation.scorerSearch.searchPlaceholder"),"aria-label":i("validation.scorerSearch.searchPlaceholder"),role:"combobox","aria-expanded":C&&w?"true":"false","aria-controls":Xt,"aria-activedescendant":u>=0&&g?.[u]?`scorer-option-${g[u].__identity}`:void 0,"aria-autocomplete":"list","aria-describedby":Yt,className:`
                w-full px-4 py-2 rounded-lg
                bg-surface-subtle dark:bg-surface-subtle-dark
                text-text-primary dark:text-text-primary-dark
                placeholder-text-muted dark:placeholder-text-muted-dark
                border border-transparent
                focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
                outline-none transition-colors
              `}),r.jsx("p",{id:Yt,className:"mt-2 text-xs text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.searchHint")})]}),w&&r.jsx("div",{className:"mt-4",children:r.jsx(mn,{results:g,isLoading:p,isError:y,onSelect:R,highlightedIndex:u,onHighlight:l,listboxId:Xt})}),r.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:w&&!p&&!y&&g&&r.jsx("span",{children:g.length===1?i("validation.scorerSearch.resultsCountOne"):o("validation.scorerSearch.resultsCount",{count:g.length})})})]}),!t&&!w&&r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.noScorerSelected")})]})}function xn({onScorerChange:t,initialScorer:e=null,readOnly:s=!1,readOnlyScorerName:a,readOnlyScorerBirthday:n}){const[i,o]=m.useState(e);m.useEffect(()=>{e&&t?.(e)},[e,t]);const c=d=>{o(d),t?.(d)};return r.jsx(pn,{selectedScorer:i,onScorerSelect:c,readOnly:s,readOnlyScorerName:a,readOnlyScorerBirthday:n})}const gn=".jpg,.jpeg,.png,.pdf",qt=1500,yn=10,bn=90,Nn=100,wn=10;function kn(t){return t<Lt?`${t} B`:t<Bt?`${(t/Lt).toFixed(1)} KB`:`${(t/Bt).toFixed(1)} MB`}function vn({onScoresheetChange:t,readOnly:e=!1,hasScoresheet:s=!1,scoresheetNotRequired:a=!1}){const{t:n}=B(),o=Se(M=>M.dataSource)==="demo",c=m.useRef(t);m.useEffect(()=>{c.current=t},[t]);const[d,u]=m.useState(null),[l,h]=m.useState("idle"),[f,x]=m.useState(null),[g,p]=m.useState(0),y=m.useRef(null),R=m.useRef(null),S=m.useRef({}),j=m.useRef(null),C=m.useRef(!1);m.useEffect(()=>{const M=S.current;return()=>{j.current&&URL.revokeObjectURL(j.current),M.interval&&clearInterval(M.interval),M.timeout&&clearTimeout(M.timeout)}},[]);const w=m.useCallback(M=>nr.includes(M.type)?M.size>ir?n("validation.scoresheetUpload.fileTooLarge"):null:n("validation.scoresheetUpload.invalidFileType"),[n]),b=m.useCallback(M=>{S.current.interval&&clearInterval(S.current.interval),S.current.timeout&&clearTimeout(S.current.timeout),C.current=!0,h("uploading"),p(0),c.current?.(M,!1),S.current.interval=setInterval(()=>{p(A=>A>=bn?(S.current.interval&&clearInterval(S.current.interval),A):A+yn)},qt/wn),S.current.timeout=setTimeout(()=>{S.current.interval&&clearInterval(S.current.interval),p(Nn),h("complete"),C.current=!1,c.current?.(M,!0)},qt)},[]),N=m.useCallback(M=>{if(C.current)return;const A=w(M);if(A){x(A);return}j.current&&URL.revokeObjectURL(j.current),x(null);const P=M.type.startsWith("image/")?URL.createObjectURL(M):null;j.current=P,u({file:M,previewUrl:P}),b(M)},[w,b]),k=m.useCallback(M=>{const A=M.target.files?.[0];A&&N(A),M.target.value=""},[N]),v=m.useCallback(()=>{j.current&&(URL.revokeObjectURL(j.current),j.current=null),S.current.interval&&clearInterval(S.current.interval),S.current.timeout&&clearTimeout(S.current.timeout),C.current=!1,u(null),h("idle"),p(0),x(null),c.current?.(null,!1)},[]),F=m.useCallback(()=>{v(),y.current?.click()},[v]),_=M=>n(`validation.scoresheetUpload.${M}`);return a?r.jsx("div",{className:"py-4",children:r.jsxs("div",{className:"border border-info-200 dark:border-info-800 bg-info-50 dark:bg-info-900/20 rounded-lg p-4 text-center",children:[r.jsx(lr,{className:"w-12 h-12 mx-auto text-info-500 mb-3","aria-hidden":"true"}),r.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1",children:n("validation.scoresheetUpload.notRequired")}),r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:n("validation.scoresheetUpload.notRequiredDescription")})]})}):e?r.jsx("div",{className:"py-4",children:r.jsx("div",{className:"border border-border-default dark:border-border-default-dark rounded-lg p-4 text-center",children:s?r.jsxs(r.Fragment,{children:[r.jsx(Ze,{className:"w-12 h-12 mx-auto text-green-500 mb-3","aria-hidden":"true"}),r.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:n("validation.scoresheetUpload.scoresheetUploaded")})]}):r.jsxs(r.Fragment,{children:[r.jsx(qe,{className:"w-12 h-12 mx-auto text-text-subtle dark:text-text-subtle-dark mb-3","aria-hidden":"true"}),r.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:n("validation.scoresheetUpload.noScoresheet")})]})})}):r.jsxs("div",{className:"py-4",children:[r.jsx("input",{ref:y,type:"file",accept:gn,onChange:k,className:"hidden","aria-label":_("selectFile")}),r.jsx("input",{ref:R,type:"file",accept:"image/jpeg,image/png",capture:"environment",onChange:k,className:"hidden","aria-label":_("takePhoto")}),d?r.jsxs("div",{className:"border border-border-default dark:border-border-default-dark rounded-lg overflow-hidden",children:[d.previewUrl?r.jsx("div",{className:"relative bg-surface-subtle dark:bg-surface-card-dark",children:r.jsx("img",{src:d.previewUrl,alt:_("previewAlt"),className:"w-full max-h-64 object-contain"})}):r.jsxs("div",{className:"bg-surface-subtle dark:bg-surface-card-dark p-8 flex flex-col items-center justify-center",children:[r.jsx(qe,{className:"w-16 h-16 text-text-subtle dark:text-text-subtle-dark mb-2","aria-hidden":"true"}),r.jsx("span",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:"PDF"})]}),r.jsxs("div",{className:"p-4 bg-surface-card dark:bg-surface-card-dark",children:[l==="uploading"&&r.jsxs("div",{className:"mb-3",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted dark:text-text-muted-dark mb-1",children:[r.jsx("span",{children:_("uploading")}),r.jsxs("span",{children:[g,"%"]})]}),r.jsx("div",{className:"h-2 bg-surface-muted dark:bg-surface-subtle-dark rounded-full overflow-hidden",role:"progressbar","aria-valuenow":g,"aria-valuemin":0,"aria-valuemax":100,"aria-label":_("uploading"),children:r.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-200",style:{width:`${g}%`}})})]}),l==="complete"&&r.jsxs("div",{className:"mb-3 flex items-center gap-2 text-green-600 dark:text-green-400",role:"status","aria-live":"polite",children:[r.jsx(Ze,{className:"w-5 h-5","aria-hidden":"true"}),r.jsx("span",{className:"text-sm font-medium",children:_("uploadComplete")})]}),r.jsx("p",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark truncate",children:d.file.name}),r.jsx("p",{className:"text-xs text-text-muted dark:text-text-muted-dark",children:kn(d.file.size)}),r.jsxs("div",{className:"mt-4 flex gap-3",children:[r.jsx("button",{type:"button",onClick:F,disabled:l==="uploading",className:"flex-1 px-4 py-2 text-sm font-medium text-text-secondary dark:text-text-secondary-dark bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_("replace")}),r.jsx("button",{type:"button",onClick:v,disabled:l==="uploading",className:"flex-1 px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_("remove")})]})]})]}):r.jsxs("div",{className:"border-2 border-dashed border-border-strong dark:border-border-strong-dark rounded-lg p-6 text-center",children:[r.jsx(Ft,{className:"w-12 h-12 mx-auto text-text-subtle dark:text-text-subtle-dark mb-4","aria-hidden":"true"}),r.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1",children:_("title")}),r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark mb-4",children:_("description")}),r.jsxs("p",{className:"text-xs text-text-subtle dark:text-text-subtle-dark mb-4",children:[_("acceptedFormats"),"  ",_("maxFileSize")]}),f&&r.jsxs("div",{role:"alert",className:"mb-4 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg flex items-center gap-2",children:[r.jsx(Ie,{className:"w-5 h-5 text-danger-500 flex-shrink-0","aria-hidden":"true"}),r.jsx("span",{className:"text-sm text-danger-700 dark:text-danger-400",children:f})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[r.jsxs("button",{type:"button",onClick:()=>y.current?.click(),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[r.jsx(Ft,{className:"w-4 h-4","aria-hidden":"true"}),_("selectFile")]}),r.jsxs("button",{type:"button",onClick:()=>R.current?.click(),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-text-secondary dark:text-text-secondary-dark bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark rounded-lg transition-colors",children:[r.jsx(Ve,{className:"w-4 h-4","aria-hidden":"true"}),_("takePhoto")]})]})]}),o&&r.jsx("p",{className:"mt-3 text-xs text-center text-text-subtle dark:text-text-subtle-dark",children:_("demoModeNote")})]})}const Cn=60;function An({isOpen:t,onSaveAndClose:e,onDiscard:s,onCancel:a,isSaving:n}){const{t:i}=B(),o=m.useRef(null);return m.useEffect(()=>{t&&o.current&&o.current.querySelector("button")?.focus()},[t]),t?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:Cn},"aria-hidden":"true",children:r.jsxs("div",{ref:o,className:"bg-surface-card dark:bg-surface-card-dark rounded-lg shadow-xl max-w-sm w-full p-6",role:"alertdialog","aria-modal":"true","aria-labelledby":"unsaved-changes-title","aria-describedby":"unsaved-changes-description",children:[r.jsx("h3",{id:"unsaved-changes-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark mb-2",children:i("validation.state.unsavedChangesTitle")}),r.jsx("p",{id:"unsaved-changes-description",className:"text-sm text-text-muted dark:text-text-muted-dark mb-4",children:i("validation.state.unsavedChangesMessage")}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(Z,{variant:"secondary",onClick:a,disabled:n,children:i("validation.state.continueEditing")}),r.jsx(Z,{variant:"danger",onClick:s,disabled:n,children:i("validation.state.discardChanges")}),r.jsx(Z,{variant:"primary",onClick:e,disabled:n,children:i(n?"common.loading":"validation.state.saveAndClose")})]})]})}):null}const Sn=60;function En({isOpen:t,rosterValidation:e,homeTeamName:s,awayTeamName:a,onGoBack:n,onProceedAnyway:i,isProceedingAnyway:o}){const{t:c,tInterpolate:d}=B(),u=m.useRef(null);if(m.useEffect(()=>{t&&u.current&&u.current.querySelector("button")?.focus()},[t]),m.useEffect(()=>{if(!t)return;const p=y=>{y.key==="Escape"&&!o&&n()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[t,o,n]),!t)return null;const{home:l,away:h}=e,f=[],x=[];l.hasHeadCoach||f.push({key:"home-coach",message:c("validation.rosterWarning.missingHeadCoach")}),l.hasMinPlayers||f.push({key:"home-players",message:d("validation.rosterWarning.insufficientPlayers",{count:l.playerCount,required:Je})}),h.hasHeadCoach||x.push({key:"away-coach",message:c("validation.rosterWarning.missingHeadCoach")}),h.hasMinPlayers||x.push({key:"away-players",message:d("validation.rosterWarning.insufficientPlayers",{count:h.playerCount,required:Je})});const g=p=>{p.target===p.currentTarget&&!o&&n()};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:Sn},onClick:g,"aria-hidden":"true",children:r.jsxs("div",{ref:u,className:"bg-surface-card dark:bg-surface-card-dark rounded-lg shadow-xl max-w-md w-full p-6",role:"alertdialog","aria-modal":"true","aria-labelledby":"roster-warning-title","aria-describedby":"roster-warning-description",children:[r.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[r.jsx("div",{className:"flex-shrink-0 p-2 bg-warning-100 dark:bg-warning-900/30 rounded-full",children:r.jsx(yt,{className:"w-6 h-6 text-warning-600 dark:text-warning-400","aria-hidden":"true"})}),r.jsxs("div",{children:[r.jsx("h3",{id:"roster-warning-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:c("validation.rosterWarning.title")}),r.jsx("p",{id:"roster-warning-description",className:"text-sm text-text-muted dark:text-text-muted-dark mt-1",children:c("validation.rosterWarning.description")})]})]}),r.jsxs("div",{className:"space-y-3 mb-6",children:[f.length>0&&r.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-3",children:[r.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-300 mb-1",children:s}),r.jsx("ul",{className:"list-disc list-inside text-sm text-warning-700 dark:text-warning-400 space-y-0.5",children:f.map(p=>r.jsx("li",{children:p.message},p.key))})]}),x.length>0&&r.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-3",children:[r.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-300 mb-1",children:a}),r.jsx("ul",{className:"list-disc list-inside text-sm text-warning-700 dark:text-warning-400 space-y-0.5",children:x.map(p=>r.jsx("li",{children:p.message},p.key))})]})]}),r.jsx("p",{className:"text-xs text-text-muted dark:text-text-muted-dark mb-4",children:c("validation.rosterWarning.forfeitNote")}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(Z,{variant:"secondary",onClick:n,disabled:o,children:c("validation.rosterWarning.goBack")}),r.jsx(Z,{variant:"danger",onClick:i,disabled:o,children:c(o?"common.loading":"validation.rosterWarning.proceedAnyway")})]})]})})}const Zt="safe-validation-complete-title",jn="https://volleymanager.volleyball.ch";function Rn({isOpen:t,onClose:e}){const{t:s}=B(),a=m.useRef(!1),n=m.useCallback(()=>{if(!a.current){a.current=!0;try{window.open(jn,"_blank","noopener,noreferrer"),e()}finally{a.current=!1}}},[e]),i=r.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-success-100 dark:bg-success-900 flex items-center justify-center",children:r.jsx("svg",{className:"w-6 h-6 text-success-600 dark:text-success-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});return r.jsxs(wt,{isOpen:t,onClose:e,titleId:Zt,size:"md",children:[r.jsx(kt,{title:s("settings.safeValidationCompleteTitle"),titleId:Zt,icon:i}),r.jsx("div",{className:"mb-6",children:r.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary-dark",children:s("settings.safeValidationCompleteMessage")})}),r.jsxs(zs,{divider:!0,children:[r.jsx(Z,{variant:"secondary",className:"flex-1 rounded-md",onClick:e,children:s("common.close")}),r.jsx(Z,{variant:"primary",className:"flex-1 rounded-md",onClick:n,children:s("settings.safeValidationCompleteButton")})]})]})}const _n=70;function In({message:t}){return r.jsxs("div",{role:"status","aria-live":"polite",className:"fixed top-4 right-4 bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",style:{zIndex:_n},children:[r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5","aria-hidden":"true",children:[r.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),r.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]}),r.jsx("span",{className:"text-sm font-medium",children:t})]})}function Mn({currentStepId:t,assignment:e,loading:s,validation:a,handlers:n}){const{t:i}=B();return s.isLoading?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("common.loading")})}):s.error?r.jsx("div",{role:"alert",className:"p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",children:r.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:s.error.message})}):r.jsxs(er,{modalName:"ValidateGameModal",onClose:n.onClose,children:[t==="home-roster"&&r.jsx(cn,{assignment:e,onModificationsChange:n.setHomeRosterModifications,onAddPlayerSheetOpenChange:n.onAddPlayerSheetOpenChange,readOnly:a.isValidated||a.isInSafeMode,initialModifications:a.state.homeRoster.playerModifications,initialCoachModifications:a.state.homeRoster.coachModifications,prefetchedNominationList:a.homeNominationList}),t==="away-roster"&&r.jsx(dn,{assignment:e,onModificationsChange:n.setAwayRosterModifications,onAddPlayerSheetOpenChange:n.onAddPlayerSheetOpenChange,readOnly:a.isValidated||a.isInSafeMode,initialModifications:a.state.awayRoster.playerModifications,initialCoachModifications:a.state.awayRoster.coachModifications,prefetchedNominationList:a.awayNominationList}),t==="scorer"&&r.jsx(xn,{onScorerChange:n.setScorer,readOnly:a.isValidated||a.isInSafeMode,readOnlyScorerName:a.validatedInfo?.scorerName,readOnlyScorerBirthday:a.validatedInfo?.scorerBirthday,initialScorer:a.pendingScorer?{__identity:a.pendingScorer.__identity,displayName:a.pendingScorer.displayName,birthday:a.pendingScorer.birthday??""}:null},a.pendingScorer?.__identity??"no-pending-scorer"),t==="scoresheet"&&r.jsx(vn,{onScoresheetChange:n.setScoresheet,readOnly:a.isValidated||a.isInSafeMode,hasScoresheet:a.validatedInfo?.hasScoresheet,scoresheetNotRequired:a.scoresheetNotRequired})]})}function Js({navigation:t,onBack:e,onNext:s,onClose:a,closeLabel:n}){const{t:i}=B();return r.jsxs(r.Fragment,{children:[r.jsx("div",{children:!t.isFirstStep&&r.jsx(Z,{variant:"secondary",onClick:e,children:i("validation.wizard.previous")})}),r.jsx("div",{children:t.isLastStep?r.jsx(Z,{variant:"primary",onClick:a,children:n}):r.jsx(Z,{variant:"primary",onClick:s,children:i("validation.wizard.next")})})]})}function Tn(t){const{t:e}=B();return r.jsx(Js,{...t,closeLabel:e("common.close")})}function On(t){const{t:e}=B();return r.jsx(Js,{...t,closeLabel:e("validation.wizard.dismiss")})}function Pn({navigation:t,state:e,onAttemptClose:s,onBack:a,onValidateAndNext:n,onFinish:i}){const{t:o}=B(),c=e.isFinalizing||e.isLoadingGameDetails||e.hasGameDetailsError,d=c||!e.allPreviousRequiredStepsDone||!e.currentStepIsOptional&&!e.canMarkCurrentStepDone;return r.jsxs(r.Fragment,{children:[r.jsx("div",{children:t.isFirstStep?r.jsx(Z,{variant:"secondary",onClick:s,disabled:e.isFinalizing,children:o("common.cancel")}):r.jsx(Z,{variant:"secondary",onClick:a,disabled:e.isFinalizing,children:o("validation.wizard.previous")})}),r.jsx("div",{children:t.isLastStep?r.jsx(Z,{variant:"success",onClick:()=>i(),disabled:d,title:e.allPreviousRequiredStepsDone?void 0:o("validation.state.markAllStepsTooltip"),children:e.isFinalizing?o("common.loading"):o("validation.wizard.finish")}):r.jsx(Z,{variant:"success",onClick:n,disabled:c||!e.canMarkCurrentStepDone,children:o("validation.wizard.validate")})})]})}const ea=.7,ta=.9,Ln=4,Bn=5,et=Ln/Bn,Dn=180,Fn={electronic:{widthPercent:ea,aspectRatio:et},manuscript:{widthPercent:ta,aspectRatio:et}},sa=.92;function $n(t,e,s,a,n){const i=Fn[n],o=t/e,c=s/a;let d,u,l,h;o>c?(u=e,d=e*c,l=(t-d)/2,h=0):(d=t,u=t/c,l=0,h=(e-u)/2);const f=d*i.widthPercent,x=f/i.aspectRatio,g=(d-f)/2,p=(u-x)/2;return{x:Math.round(l+g),y:Math.round(h+p),width:Math.round(f),height:Math.round(x)}}function zn(t,e,s=sa){const a=document.createElement("canvas");a.width=e.width,a.height=e.height;const n=a.getContext("2d");return n?(n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),new Promise((i,o)=>{a.toBlob(c=>{c?i(c):o(new Error("Failed to create blob from canvas"))},"image/jpeg",s)})):Promise.reject(new Error("Could not get canvas context"))}function aa(t){return t*Math.PI/Dn}function Hn(t,e,s){const a=aa(s),n=Math.abs(Math.sin(a)),i=Math.abs(Math.cos(a));return{width:t*i+e*n,height:t*n+e*i}}function Un(t){return new Promise((e,s)=>{const a=new Image;a.addEventListener("load",()=>e(a)),a.addEventListener("error",n=>s(n)),a.src=t})}async function Wn(t,e,s,a=sa){const n=await Un(t),i=document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new Error("Could not get canvas context");const c=aa(s),{width:d,height:u}=Hn(n.width,n.height,s);i.width=d,i.height=u,o.translate(d/2,u/2),o.rotate(c),o.translate(-n.width/2,-n.height/2),o.drawImage(n,0,0);const l=document.createElement("canvas"),h=l.getContext("2d");if(!h)throw new Error("Could not get cropped canvas context");return l.width=e.width,l.height=e.height,h.drawImage(i,e.x,e.y,e.width,e.height,0,0,e.width,e.height),new Promise((f,x)=>{l.toBlob(g=>{g?f(g):x(new Error("Failed to create blob from canvas"))},"image/jpeg",a)})}const Vn=17,Gn=20,Kn=Vn/Gn,Xn=4,Yn=5,qn=Xn/Yn,Zn=.5,Qn=3,Qt=90;function Jn({imageBlob:t,scoresheetType:e,onConfirm:s,onCancel:a}){const{t:n}=B(),i=m.useMemo(()=>URL.createObjectURL(t),[t]);m.useEffect(()=>()=>URL.revokeObjectURL(i),[i]);const[o,c]=m.useState({x:0,y:0}),[d,u]=m.useState(1),[l,h]=m.useState(0),[f,x]=m.useState(null),[g,p]=m.useState(!1),[y,R]=m.useState(null),S=e==="electronic"?Kn:qn,j=m.useCallback((N,k)=>{x(k)},[]),C=m.useCallback(()=>{h(N=>N-Qt)},[]),w=m.useCallback(()=>{h(N=>N+Qt)},[]),b=m.useCallback(async()=>{if(f){p(!0),R(null);try{const N=await Wn(i,f,l);s(N)}catch(N){console.error("Failed to crop image:",N),R(n("validation.ocr.errors.processingFailed")),p(!1)}}},[f,i,l,s,n]);return r.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-gray-900",children:[r.jsx("div",{className:"relative flex-1",children:r.jsx(cr,{image:i,crop:o,zoom:d,rotation:l,aspect:S,minZoom:Zn,maxZoom:Qn,onCropChange:c,onZoomChange:u,onRotationChange:h,onCropComplete:j,showGrid:!0,classes:{containerClassName:"!absolute !inset-0",cropAreaClassName:"!border-2 !border-white/90"}})}),r.jsxs("div",{className:"flex-shrink-0 py-2 px-4",children:[y&&r.jsxs("div",{className:"flex items-center gap-2 mb-2 px-3 py-2 text-sm text-red-200 bg-red-900/50 rounded",role:"alert",children:[r.jsx(Ie,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),y]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("button",{type:"button",onClick:C,className:"p-2 text-gray-300 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors","aria-label":n("validation.ocr.rotateLeft"),children:r.jsx(Cr,{className:"w-6 h-6","aria-hidden":"true"})}),r.jsx("span",{className:"px-3 py-1 text-sm text-gray-300 bg-white/10 rounded",children:n("validation.ocr.photoGuide.alignScoresheet")}),r.jsx("button",{type:"button",onClick:w,className:"p-2 text-gray-300 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors","aria-label":n("validation.ocr.rotateRight"),children:r.jsx(Sr,{className:"w-6 h-6","aria-hidden":"true"})})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex gap-4 p-4 bg-white dark:bg-gray-800",children:[r.jsxs("button",{type:"button",onClick:a,disabled:g,className:"flex-1 flex items-center justify-center gap-2 min-h-12 px-4 py-3 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-medium transition-colors disabled:opacity-50",children:[r.jsx(he,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.cancel")]}),r.jsxs("button",{type:"button",onClick:b,disabled:g||!f,className:"flex-1 flex items-center justify-center gap-2 min-h-12 px-4 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg font-medium transition-colors disabled:opacity-50",children:[r.jsx(We,{className:"w-5 h-5","aria-hidden":"true"}),n(g?"validation.ocr.processing":"common.confirm")]})]})]})}const ei=100;function ti({scoresheetType:t}){const{t:e}=B(),s=t==="electronic",n={width:`${(s?ea:ta)*ei}%`,aspectRatio:`${et}`},i=e(s?"validation.ocr.photoGuide.electronicHint":"validation.ocr.photoGuide.manuscriptHint");return r.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/40"}),r.jsxs("div",{className:"relative border-2 border-white/80 rounded-lg bg-transparent z-10",style:n,children:[r.jsx("div",{className:"absolute -top-0.5 -left-0.5 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl-lg"}),r.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr-lg"}),r.jsx("div",{className:"absolute -bottom-0.5 -left-0.5 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl-lg"}),r.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-6 h-6 border-b-4 border-r-4 border-white rounded-br-lg"}),r.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[r.jsx("div",{className:"w-8 h-0.5 bg-white/50"}),r.jsx("div",{className:"absolute w-0.5 h-8 bg-white/50"})]}),r.jsx("div",{className:"absolute -bottom-10 left-0 right-0 text-center",children:r.jsx("span",{className:"text-sm text-white/90 bg-black/50 px-3 py-1 rounded-full",children:i})})]}),r.jsx("div",{className:"absolute top-4 left-0 right-0 text-center z-10",children:r.jsx("span",{className:"text-sm font-medium text-white/90 bg-black/50 px-4 py-2 rounded-lg",children:e("validation.ocr.photoGuide.alignScoresheet")})})]})}const si=10,Jt=1024,ai=si*Jt*Jt,ri=["image/jpeg","image/png","image/webp"],ni=".jpg,.jpeg,.png,.webp",ii={facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},es=.92;function oi({isOpen:t,scoresheetType:e,onClose:s,onImageSelected:a}){const{t:n}=B(),i=m.useRef(null),o=m.useRef(null),c=m.useRef(null),[d,u]=m.useState("select"),[l,h]=m.useState(null),[f,x]=m.useState(null),[g,p]=m.useState(!1),y=m.useCallback(()=>{c.current&&(c.current.getTracks().forEach(k=>k.stop()),c.current=null),o.current&&(o.current.srcObject=null)},[]);m.useEffect(()=>()=>{y()},[y]),m.useEffect(()=>{d==="camera"&&c.current&&o.current&&(o.current.srcObject=c.current,o.current.play().catch(console.error))},[d]),m.useEffect(()=>{if(!t)return;const k=v=>{v.key==="Escape"&&(d==="camera"?(y(),u("select")):d==="crop"?(x(null),u("select")):s())};return document.addEventListener("keydown",k),()=>document.removeEventListener("keydown",k)},[t,d,s,y]);const R=m.useCallback(async()=>{h(null),p(!1);try{const k=await navigator.mediaDevices.getUserMedia({video:ii,audio:!1});c.current=k,u("camera")}catch(k){console.error("Camera access error:",k),p(!0),h(n("validation.ocr.errors.cameraNotAvailable"))}},[n]),S=m.useCallback(async()=>{const k=o.current;if(!k)return;const v=document.createElement("canvas");v.width=k.videoWidth,v.height=k.videoHeight;const F=v.getContext("2d");if(!F)return;F.drawImage(k,0,0,v.width,v.height);const _=$n(k.videoWidth,k.videoHeight,k.clientWidth,k.clientHeight,e);try{const M=await zn(v,_,es);y(),x(M),u("crop")}catch(M){console.error("Failed to crop captured image:",M),v.toBlob(A=>{A&&(y(),x(A),u("crop"))},"image/jpeg",es)}},[y,e]),j=m.useCallback(k=>{const v=k.target.files?.[0];if(v){if(k.target.value="",h(null),!ri.includes(v.type)){h(n("validation.scoresheetUpload.invalidFileType"));return}if(v.size>ai){h(n("validation.ocr.errors.imageTooLarge"));return}x(v),u("crop")}},[n]),C=m.useCallback(()=>{h(null),i.current?.click()},[]),w=m.useCallback(k=>{a(k)},[a]),b=m.useCallback(()=>{x(null),u("select")},[]),N=m.useCallback(()=>{y(),u("select")},[y]);return t?d==="crop"&&f?r.jsx(Jn,{imageBlob:f,scoresheetType:e,onConfirm:w,onCancel:b}):d==="camera"?r.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-gray-900",children:[r.jsxs("div",{className:"relative flex-1 min-h-0 overflow-hidden",children:[r.jsx("video",{ref:o,className:"w-full h-full object-cover bg-gray-800",autoPlay:!0,playsInline:!0,muted:!0}),r.jsx(ti,{scoresheetType:e})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-6 py-4 bg-gray-900 safe-area-bottom",children:[r.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 text-white bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition-colors",children:n("validation.ocr.cancel")}),r.jsx("button",{type:"button",onClick:S,className:"w-16 h-16 rounded-full bg-white hover:bg-gray-100 flex items-center justify-center transition-colors","aria-label":n("validation.ocr.takePhoto"),children:r.jsx("div",{className:"w-12 h-12 rounded-full bg-danger-500"})}),r.jsx("div",{className:"w-20"})]})]}):r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-capture-title",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-sm w-full mx-4 overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{id:"ocr-capture-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("validation.ocr.scanScoresheet")}),r.jsx("button",{type:"button",onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":n("common.close"),children:r.jsx(he,{className:"w-5 h-5","aria-hidden":"true"})})]}),r.jsxs("div",{className:"p-4 space-y-4",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n("validation.ocr.scanScoresheetDescription")}),l&&r.jsxs("div",{className:"flex items-center gap-2 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",role:"alert",children:[r.jsx(Ie,{className:"w-5 h-5 text-danger-500 flex-shrink-0","aria-hidden":"true"}),r.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:l})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("button",{type:"button",onClick:g?C:R,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors font-medium",children:[r.jsx(Ve,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.takePhoto")]}),r.jsxs("button",{type:"button",onClick:C,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 hover:bg-primary-100 dark:hover:bg-primary-900/50 border border-primary-200 dark:border-primary-800 rounded-lg transition-colors font-medium",children:[r.jsx(Vs,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.selectImage")]}),r.jsx("button",{type:"button",onClick:s,className:"w-full px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors font-medium",children:n("validation.ocr.cancel")})]}),r.jsx("input",{ref:i,type:"file",accept:ni,onChange:j,className:"hidden","aria-hidden":"true"})]})]})}):null}const li="https://volleykit-proxy.takishima.workers.dev/ocr",ts=95,ss=50,ci=8,as=20,rs=10,di=20,ui=40,mi=80,hi=100;class ns{#r;#e=!1;#s;#t=null;constructor(e,s){this.#r=e,this.#s=s??li}#a(e,s){this.#r?.({status:e,progress:s})}async initialize(){if(!this.#e){this.#a("Initializing Mistral OCR...",0);try{const e=this.#s.replace("/ocr","/health");this.#t=new AbortController;const s=await fetch(e,{method:"GET",signal:this.#t.signal});if(this.#t=null,!s.ok)throw new Error("OCR service health check failed");this.#a("Mistral OCR ready",rs),this.#e=!0}catch(e){if(this.#t=null,e instanceof Error&&e.name==="AbortError")throw new Error("OCR cancelled");console.warn("OCR service health check failed, will attempt OCR anyway:",e),this.#a("Mistral OCR ready (health check skipped)",rs),this.#e=!0}}}#n(e){const n=new DOMParser().parseFromString(e,"text/html").querySelector("table");if(!n)return[e];const i=[],o=n.querySelectorAll("tr");for(const c of o){const d=c.querySelectorAll("th, td"),u=Array.from(d).map(l=>l.textContent?.trim()??"").filter(l=>l.length>0);u.length>0&&i.push(u.join("	"))}return i}#i(e){return typeof e=="string"?e:typeof e=="object"&&e!==null&&typeof e.content=="string"?e.content:(console.warn("Unexpected table format:",e),"")}#o(e,s){if(!s||s.length===0)return e;let a=e;for(let n=0;n<s.length;n++){const i=s[n];if(!i)continue;const o=`[tbl-${n}.html](tbl-${n}.html)`,c=this.#i(i),u=this.#n(c).join(`
`);a=a.replace(o,u)}return a}#l(e){const s=e.pages.map(o=>this.#o(o.markdown,o.tables??[])).join(`

--- Page Break ---

`).trim(),n=s.split(`
`).map((o,c)=>{const u=o.split(/\s+/).filter(l=>l.length>0).map((l,h)=>({text:l,confidence:ts,bbox:{x0:h*ss,y0:c*as,x1:h*ss+l.length*ci,y1:(c+1)*as}}));return{text:o,confidence:ts,words:u}}),i=n.flatMap(o=>o.words);return{fullText:s,lines:n,words:i,hasPreciseBoundingBoxes:!1}}async recognize(e){if(!this.#e)throw new Error("MistralOCR not initialized. Call initialize() first.");this.#a("Uploading image...",di),this.#t=new AbortController;try{const s=new FormData;s.append("image",e,"scoresheet.jpg"),this.#a("Processing with Mistral OCR...",ui);const a=await fetch(this.#s,{method:"POST",body:s,signal:this.#t.signal});if(this.#a("Receiving results...",mi),!a.ok){const i=await a.json().catch(()=>({}));throw new Error(i.error??`OCR request failed: ${a.status}`)}const n=await a.json();return this.#a("Processing complete",hi),this.#l(n)}catch(s){throw s instanceof Error&&s.name==="AbortError"?new Error("OCR cancelled"):s}finally{this.#t=null}}async terminate(){this.#t&&(this.#t.abort(),this.#t=null),this.#e=!1}}const fi=1500,pi=200,xi=300,is=95,os=50,gi=8,ls=20,yi=50,bi=60,Ni=90,wi=100,ki=`VBC Heimteam	VBC Gastteam
N.	Name of the player	License	N.	Name of the player	License
1	MLLER ANNA	OK	3	SCHMIDT LISA	OK
4	WEBER MARIE	OK	7	FISCHER JULIA	OK
6	SCHNEIDER LAURA	OK	9	MEYER SARAH	OK
8	ZIMMERMANN NINA	OK	11	WAGNER EMMA	OK
10	HUBER LENA	OK	13	BECKER MILA	OK
12	KELLER SOPHIE	OK	15	HOFFMANN PAULA	OK
LIBERO
L1	2 BRUNNER LEA	OK	L1	5 KOCH CLARA	OK
OFFICIAL MEMBERS ADMITTED ON THE BENCH
C	Hans Trainer	C	Peter Coach
AC	Maria Assistentin	AC	Sandra Helper`;function vi(t){const s=t.split(`
`).map((a,n)=>{const i=a.split(/\s+/).filter(o=>o.length>0);return{text:a,confidence:is,words:i.map((o,c)=>({text:o,confidence:is,bbox:{x0:c*os,y0:n*ls,x1:c*os+o.length*gi,y1:(n+1)*ls}}))}});return{fullText:t,lines:s,words:s.flatMap(a=>a.words),hasPreciseBoundingBoxes:!1}}const Ci=vi(ki);class cs{#r;#e=!1;constructor(e){this.#r=e}#s(e,s){this.#r?.({status:e,progress:s})}async initialize(){this.#e||(this.#s("Initializing stub OCR...",0),await new Promise(e=>setTimeout(e,pi)),this.#s("Stub OCR ready",yi),this.#e=!0)}async recognize(e){if(!this.#e)throw new Error("StubOCR not initialized. Call initialize() first.");return this.#s("Processing image...",bi),await new Promise(s=>setTimeout(s,fi)),this.#s("Extracting text...",Ni),await new Promise(s=>setTimeout(s,xi)),this.#s("Complete",wi),Ci}async terminate(){this.#e=!1}}const Ai=3e3,tt="https://volleykit-proxy.ngn-damien.workers.dev/ocr";async function Si(){try{const t=tt.replace("/ocr","/health");return(await fetch(t,{method:"GET",signal:AbortSignal.timeout(Ai)})).ok}catch{return!1}}const Ei={create(t){return new ns(t,tt)},async createWithFallback(t){return await Si()?new ns(t,tt):(console.warn("OCR proxy not available, falling back to stub implementation"),new cs(t))},createStub(t){return new cs(t)}},ra=99,na=2,ds=3,ji=.6,st=new Set(["C","AC","AC2","AC3","AC4","M"]),Ri={O:"0",o:"0",Q:"0",D:"0",I:"1",l:"1",i:"1","|":"1",Z:"2",z:"2",E:"3",A:"4",S:"5",s:"5",G:"6",b:"6",T:"7",B:"8",g:"9",q:"9"},_i={0:"O",1:"I","|":"I",5:"S",8:"B","@":"A","&":"A","":"E","":"L","":"C"};function Ii(t){return t.split("").map(e=>Ri[e]??e).join("")}function Mi(t){return t.split("").map(e=>_i[e]??e).join("")}function Ti(t){if(!t)return null;const e=t.trim(),s=Ii(e),a=/^(\d{1,2})$/.exec(s);if(a){const n=parseInt(a[1],10);if(n>=1&&n<=ra)return n}return null}function Ne(t){return t?Mi(t).toLowerCase().split(/[\s-]+/).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}function At(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=Ne(s[0]);return{lastName:o,firstName:"",displayName:o}}const a=Ne(s[0]),n=s.slice(1).map(Ne).join(" "),i=`${n} ${a}`;return{lastName:a,firstName:n,displayName:i}}function at(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=Ne(s[0]);return{lastName:o,firstName:"",displayName:o}}const a=Ne(s[s.length-1]),n=s.slice(0,-1).map(Ne).join(" "),i=`${n} ${a}`;return{lastName:a,firstName:n,displayName:i}}const Oi=3,St=[/punkte.*points.*punti/i,/lizenz.*licence.*licenza/i,/spieler.*joueur.*giocatore/i,/name.*nom.*nome/i,/mannschaft.*equipe.*squadra/i,/offizielle.*officiels.*ufficiali/i,/kapitn.*capitaine.*capitano/i,/trainer.*entraneur.*allenatore/i,/aader\/ou\/o/i],Pi=10,Li=[/^[\d\s.]+$/,/^["T:\s]+$/i,/^\d+$/];function Bi(t){const e=t.trim();return e.length<2||e.length>=Pi&&/^[\d\s]+$/.test(e)?!0:Li.some(s=>s.test(e))}function Di(t){const e=t.split(`
`),s=e.some(o=>St.some(c=>c.test(o))),n=e.filter(o=>o.includes("	")).length>=Oi,i=/[A-Z]\.\s*[A-Za-z-]+[A-Z]\.\s*[A-Za-z-]+/.test(t);return s&&(n||i)}function Fi(t){if(!t||t.trim().length===0)return[];const e=[],s=/([a-z-])([A-Z]\.)/g,i=t.replace(s,"$1|||$2").replace(/([a-z-])([A-Z][a-z-])/g,"$1|||$2").split("|||").filter(o=>o.trim().length>0);for(const o of i){const c=o.trim();c.length>=2&&e.push(c)}return e}function $i(t){if(!t||t.trim().length===0)return[];const e=[];let s=t;for(;s.length>0;){const a=s.match(/^(\d{1,2})\.(\d{1,2})\.((?:19|20)\d{2})/);if(a){e.push(a[0]),s=s.substring(a[0].length);continue}const n=s.match(/^(\d{1,2})\.(\d{1,2})\.(\d{2})/);if(n){e.push(n[0]),s=s.substring(n[0].length);continue}s=s.substring(1)}return e}const ia=["VTV","TV","VBC","BC","VC","SC","FC","STV","TSV","USC","US"],zi=3;function Hi(t){return t.replace(/aader\/ou\/o\s*B?\s*/gi," ").replace(/punkte[\s\S]*?punti\s*/i," ").replace(/\s+/g," ").trim()}function Ui(t){const s=t.trim().split(/\s+/);for(;s.length>1&&/^\d+$/.test(s[s.length-1]);)s.pop();return s.join(" ")}function Wi(t,e,s){const a=t.substring(e+s.length).trim();let n=a.length;for(const o of ia){const c=a.toUpperCase().indexOf(` ${o} `);c>=0&&c<n&&(n=c)}const i=a.substring(0,n).trim();return Ui(`${s} ${i}`)}function Vi(t,e,s){const a=e===0||/\s/.test(t[e-1]),n=e+s,i=n>=t.length||/\s/.test(t[n]);return a&&i}function Gi(t){const e=Hi(t),s=e.toUpperCase();for(const a of ia){const n=s.indexOf(a);if(n<0||!Vi(e,n,a.length))continue;const i=Wi(e,n,a);if(i.length>zi)return i}return null}function Ki(t){return t.every(e=>St.some(s=>s.test(e)))}function Xi(t){const e=t.split(`
`);for(const s of e){if(!s.includes("	"))continue;const a=s.split("	").map(i=>i.trim());if(Ki(a))continue;const n=[];for(const i of a){const o=Gi(i);o&&!n.includes(o)&&n.push(o)}if(n.length>=2)return{teamA:n[0],teamB:n[1]};if(n.length===1)return{teamA:n[0],teamB:""}}return{teamA:"",teamB:""}}const Yi=14,qi=14,Zi=3,Qi=/^\d{1,2}\.\d{1,2}\.\d{2,4}$/,Ji=/^[A-Za-z-]/,oa=/^\d{1,2}$/;function us(t,e){let s=e,a="",n=null,i="";if(s<t.length&&Qi.test(t[s])&&(a=t[s],s++),s<t.length&&oa.test(t[s])&&(n=parseInt(t[s],10),n>ra&&(n=null),s++),s<t.length&&Ji.test(t[s])&&(i=t[s],s++),!i)return{player:null,nextIndex:s};const o=At(i);return{player:{shirtNumber:n,lastName:o.lastName,firstName:o.firstName,displayName:o.displayName,rawName:i,licenseStatus:"",birthDate:a||void 0},nextIndex:s}}function eo(t){const e=t.split("	").map(i=>i.trim()).filter(i=>i.length>0);if(e.length<Zi)return{teamA:null,teamB:null};let s=0;oa.test(e[0])&&parseInt(e[0],10)<=qi&&(s=1);const a=us(e,s);s=a.nextIndex;const n=us(e,s);return{teamA:a.player,teamB:n.player}}function to(t){const e=t.split("	").map(i=>i.trim()).filter(i=>i.length>0);let s=null,a=null,n=0;if(n<e.length){const i=e[n].toUpperCase();if(st.has(i)&&(n++,n<e.length&&/^[A-Za-z-]/.test(e[n]))){const o=e[n],c=at(o);s={role:i,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:o},n++}}if(n<e.length){const i=e[n].toUpperCase();if(st.has(i)&&(n++,n<e.length&&/^[A-Za-z-]/.test(e[n]))){const o=e[n],c=at(o);a={role:i,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:o},n++}}return{teamA:s,teamB:a}}const so=/[A-Z]\.\s*[A-Za-z-]+[A-Z]\.\s*[A-Za-z-]+/,ao=/\d{1,2}\.\d{1,2}\.\d{2,4}.*\d{1,2}\.\d{1,2}\.\d{2,4}/,ro=/^[CA]C?\d?\t/i;function no(t,e){const s=At(t);return{shirtNumber:null,lastName:s.lastName,firstName:s.firstName,displayName:s.displayName,rawName:t,licenseStatus:"",birthDate:e}}function io(t){const e=[],s=[],a=[],n=[],i=Math.ceil(t.length/2);for(let o=0;o<t.length;o++){const c=t[o],d=o<i;if(so.test(c)){const u=Fi(c);d?e.push(...u):s.push(...u)}if(ao.test(c)){const u=$i(c);d?a.push(...u):n.push(...u)}}return{firstHalfNames:e,secondHalfNames:s,firstHalfDates:a,secondHalfDates:n}}function ms(t,e,s){for(let a=0;a<e.length&&!(t.players.length>=Yi);a++){const n=no(e[a],s[a]);t.players.push(n)}}function oo(t,e,s,a,n){if(e||ro.test(t)){const i=to(t);return i.teamA&&a.officials.push(i.teamA),i.teamB&&n.officials.push(i.teamB),!0}if(s){const i=eo(t);return i.teamA&&a.players.push(i.teamA),i.teamB&&n.players.push(i.teamB),!0}return!1}function lo(t){return!!(Bi(t)||St.some(e=>e.test(t))&&!t.includes("	"))}function co(t){return Et(t)?"libero":jt(t)?"officials":Rt(t)?"end":null}function uo(t,e){const s=[];return t.players.length===0&&s.push("No players found for Team A"),e.players.length===0&&s.push("No players found for Team B"),t.officials.length===0&&e.officials.length===0&&s.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),s}function mo(t){const e=t.split(`
`).map(d=>d.trim()),s=Xi(t),a={name:s.teamA,players:[],officials:[]},n={name:s.teamB,players:[],officials:[]};let i=!1,o=!1;for(const d of e){if(lo(d))continue;const u=co(d);if(u==="end")break;if(u==="libero"){i=!0,o=!1;continue}if(u==="officials"){o=!0,i=!1;continue}if(!d.includes("	")||oo(d,o,i,a,n))continue;const l=d.split("	"),h=io(l);ms(a,h.firstHalfNames,h.firstHalfDates),ms(n,h.secondHalfNames,h.secondHalfDates)}const c=uo(a,n);return{teamA:a,teamB:n,warnings:c}}const la=/^(\d{1,2})[\s.:_-]+([A-Za-z-][A-Za-z-\s]*)/,ca=/^([0-9OoIlZzSsGgBb]{1,2})[\s.:_-]+([A-Za-z-][A-Za-z-\s]*)/,ho=/^(C|AC\d?)[\s.:_-]+([a-z-][a-z-\s]*)/i;function fo(t){const e=t.toUpperCase();return e.includes("TEAM A")||e.includes("TEAM B")||e.includes("QUIPE A")||e.includes("QUIPE B")||e.includes("MANNSCHAFT A")||e.includes("MANNSCHAFT B")||e.includes("HOME")||e.includes("AWAY")||e.includes("HEIM")||e.includes("GAST")}function Et(t){return t.toUpperCase().includes("LIBERO")}function jt(t){const e=t.toUpperCase();return e.includes("OFFICIAL")||e.startsWith("COACH")||/^TRAINER\b/.test(e)}function Rt(t){const e=t.toUpperCase();return e.includes("SIGNATURE")||e.includes("CAPTAIN")||e.includes("REFEREE")||e.includes("ARBITRE")}function po(t){let e=la.exec(t);if(e||(e=ca.exec(t)),!e)return null;const s=e[1],a=e[2].trim(),n=Ti(s);if(a.length<na)return null;const i=At(a);return{shirtNumber:n,lastName:i.lastName,firstName:i.firstName,displayName:i.displayName,rawName:a,licenseStatus:""}}function hs(t){const e=ho.exec(t);if(!e)return null;const s=e[1].toUpperCase(),a=e[2].trim();if(!st.has(s)||a.length<na)return null;const n=at(a);return{role:s,lastName:n.lastName,firstName:n.firstName,displayName:n.displayName,rawName:a}}function da(t){const e=t.trim();if(e.length<ds||la.test(e)||ca.test(e)||Et(e)||jt(e)||Rt(e))return null;const s=(e.match(/[A-Za-z-]/g)??[]).length;return s>=ds&&s/e.length>ji?e:null}const xo=["TEAM A","QUIPE A","MANNSCHAFT A","HOME","HEIM"],go=["TEAM B","QUIPE B","MANNSCHAFT B","AWAY","GAST"],yo=/TEAM\s*A|QUIPE\s*A|MANNSCHAFT\s*A|HOME|HEIM/i,bo=/TEAM\s*B|QUIPE\s*B|MANNSCHAFT\s*B|AWAY|GAST/i;function No(t){return xo.some(e=>t.includes(e))}function wo(t){return go.some(e=>t.includes(e))}function fs(t,e){const s=t.replace(e,"").trim();return da(s)??""}function ko(t,e){const s=t.toUpperCase();if(No(s)){const a=fs(t,yo);return a&&(e.teamAName=a),{team:"A",isTeamA:!0}}if(wo(s)){const a=fs(t,bo);return a&&(e.teamBName=a),{team:"B",isTeamA:!1}}return null}function vo(t){const e={teamALines:[],teamBLines:[],teamAName:"",teamBName:""};let s=null,a=!1;for(const n of t){const i=n.trim();if(i){if(fo(i)){const o=ko(i,e);if(o){s=o.team,o.isTeamA&&(a=!0);continue}}if(!a&&!e.teamAName){const o=da(i);if(o){e.teamAName=o,s="A";continue}}s===null&&(s="A"),s==="A"?e.teamALines.push(i):e.teamBLines.push(i)}}return e}function ps(t,e){const s={name:e,players:[],officials:[]},a=[];let n=!1;for(const i of t){if(jt(i)){n=!0;continue}if(Rt(i))break;if(!Et(i))if(n){const o=hs(i);o&&s.officials.push(o)}else{const o=po(i);if(o){s.players.push(o);continue}const c=hs(i);c&&s.officials.push(c)}}return{team:s,warnings:a}}function Co(t){const e=[],s={name:"",players:[],officials:[]};if(!t||typeof t!="string")return e.push("No OCR text provided"),{teamA:{...s},teamB:{...s},warnings:e};const a=t.split(`
`).map(c=>c.trim()).filter(c=>c.length>0);if(a.length===0)return e.push("OCR text contains no lines"),{teamA:{...s},teamB:{...s},warnings:e};if(Di(t))return mo(t);const n=vo(a),i=ps(n.teamALines,n.teamAName),o=ps(n.teamBLines,n.teamBName);return e.push(...i.warnings),e.push(...o.warnings),i.team.players.length===0&&e.push("No players found for Team A"),o.team.players.length===0&&n.teamBLines.length>0&&e.push("No players found for Team B"),{teamA:i.team,teamB:o.team,warnings:e}}const ge=3,Me=6,ua=2,ma=4,ha=0,fa=1,pa=2,xa=3,ga=4,ya=5,ba=2,Na=3,Ao=3,So=3,rt=3,nt=99,Eo=4,jo=50,xs=new Set(["NOT","LFP","OK","NE","PEN"]),Ro=5;function _o(t){if(!t||t.includes("	"))return null;const s=t.trim().split(/\s+/);if(s.length<Ro)return null;const a=s[0];if(!/^\d{1,2}$/.test(a))return null;const n=parseInt(a,10);if(n<1||n>nt)return null;let i=-1;for(let g=2;g<s.length-2;g++)if(xs.has(s[g].toUpperCase())){i=g;break}if(i===-1)return null;const o=s[i],c=s.slice(1,i);if(c.length===0)return null;const d=s[i+1];if(!d||!/^\d{1,2}$/.test(d))return null;const u=parseInt(d,10);if(u<1||u>nt)return null;const l=s.slice(i+2);if(l.length===0)return null;const h=l[l.length-1];let f="",x=l;return xs.has(h.toUpperCase())&&(f=h,x=l.slice(0,-1)),x.length===0?null:{teamAParts:[a,c.join(" "),o],teamBParts:[d,x.join(" "),f]}}function _t(t){if(!t||t.includes("	"))return null;const e=t.trim(),s=e.search(/\s{3,}/);if(s===-1)return null;const a=e.slice(s).search(/\S/);if(a===-1)return null;const n=e.slice(0,s),i=e.slice(s+a),o=n.replace(/^[AB]\s+/,"").trim(),c=i.replace(/^[AB]\s+/,"").trim();return o.length>=rt&&c.length>=rt?[o,c]:null}function we(t){return t?t.toLowerCase().split(/[\s-]+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}function it(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=we(s[0]);return{lastName:o,firstName:"",displayName:o}}const a=we(s[0]),n=s.slice(1).map(we).join(" "),i=`${n} ${a}`;return{lastName:a,firstName:n,displayName:i}}function Io(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=we(s[0]);return{lastName:o,firstName:"",displayName:o}}const a=we(s[s.length-1]),n=s.slice(0,-1).map(we).join(" "),i=`${n} ${a}`;return{lastName:a,firstName:n,displayName:i}}function Mo(t){if(!t||typeof t!="string")return null;const e=t.trim(),s=/^L\d?\s+(\d{1,2})$/.exec(e);return s?parseInt(s[1],10):null}function To(t){if(!t||typeof t!="string")return{number:null,name:""};const e=t.trim(),s=/^(\d{1,2})\s+(\S[\s\S]*?)$/.exec(e);return s?{number:parseInt(s[1],10),name:s[2].trim()}:{number:null,name:e}}function wa(t){const e=t.toUpperCase();return e.includes("OFFICIAL MEMBERS")||e.includes("ADMITTED ON THE BENCH")}function ka(t){const e=t.toUpperCase();return e.includes("SIGNATURES")||e.includes("TEAM CAPTAIN")}function va(t,e){return t.toUpperCase().includes("LIBERO")&&e.length<=2}const Oo=new Set(["C","AC","AC2","AC3","AC4","M"]);function Po(t){return Oo.has(t.toUpperCase().trim())}function gs(t){const e=t.toUpperCase();return e.includes("LIBERO")||e.includes("N.")||e.includes("NAME OF THE PLAYER")}function Lo(t){const e=/[a-zA-Z]{3,}/;return t.some(s=>e.test(s))}function Bo(t,e){const s=Math.max(0,e-So);for(let a=e-1;a>=s;a--){const n=t[a];if(!n)continue;const i=n.split("	").filter(c=>c.trim().length>0);if(i.length>=2&&Lo(i)||_t(n))return a}return-1}function Do(t){const e=t.split("	");if(e.length<ge)return!1;const s=e[0].trim();if(!/^\d{1,2}$/.test(s))return!1;const a=parseInt(s,10);if(a<1||a>nt)return!1;const n=e[1].trim();return/^[A-Z\s]+$/.test(n)&&n.length>rt}function Ca(t){for(let e=0;e<t.length;e++){const s=t[e];if(!s)continue;const a=s.toUpperCase();if(a.includes("NAME OF THE PLAYER")||a.includes("N.")&&a.includes("NAME"))return{startIndex:e+1,teamNamesIndex:Bo(t,e)}}for(let e=0;e<t.length;e++){const s=t[e];if(s&&Do(s))return{startIndex:e,teamNamesIndex:e-1}}return{startIndex:0,teamNamesIndex:-1}}function ke(t){return t.replace(/^[AB]\s+/,"").trim()}function Aa(t,e){if(e<0||e>=t.length)return{teamAName:"",teamBName:""};const s=t[e];if(!s)return{teamAName:"",teamBName:""};const a=s.split("	").map(i=>i.trim()).filter(i=>i.length>0);if(a.length>=2)return{teamAName:ke(a[0]),teamBName:ke(a[1])};const n=_t(s);return n?{teamAName:n[0],teamBName:n[1]}:a.length===1?{teamAName:ke(a[0]),teamBName:""}:{teamAName:"",teamBName:""}}function me(t,e){const s=t[e],a=t[e+1],n=t[e+2];if(!s||!a)return null;const i=parseInt(s,10);if(isNaN(i))return null;const o=it(a);return{shirtNumber:i,lastName:o.lastName,firstName:o.firstName,displayName:o.displayName,rawName:a,licenseStatus:n||""}}function ve(t,e,s,a){const n=t[e],i=t[s];if(!n||!i)return null;const o=Mo(n);if(o===null){const d=To(i);if(d.name){const u=it(d.name);return{shirtNumber:d.number,lastName:u.lastName,firstName:u.firstName,displayName:u.displayName,rawName:d.name,licenseStatus:t[a]||""}}return null}const c=it(i);return{shirtNumber:o,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:i,licenseStatus:t[a]||""}}function Ce(t,e,s){const a=t[e],n=t[s];if(!a||!Po(a)||!n)return null;const i=Io(n);return{role:a.toUpperCase(),lastName:i.lastName,firstName:i.firstName,displayName:i.displayName,rawName:n}}function It(t){return t.teamAColumnEnded||t.seenTwoColumnPlayers}function Sa(t,e,s){if(s.headerRowsParsed===0&&!gs(e)){if(t.length>=2)s.teamA.name=ke(t[0]),s.teamB.name=ke(t[1]);else if(t.length===1){const a=_t(e);a?(s.teamA.name=a[0],s.teamB.name=a[1]):s.teamA.name=ke(t[0])}return s.headerRowsParsed++,"header"}return gs(e)?"players":(s.headerRowsParsed++,s.headerRowsParsed>Ao?"players":"header")}function Fo(t,e,s){if(t.length<ge){const n=_o(e);if(n){s.seenTwoColumnPlayers=!0;const i=me(n.teamAParts,0);i&&s.teamA.players.push(i);const o=me(n.teamBParts,0);o&&s.teamB.players.push(o)}return}if(t.length>=Me){s.seenTwoColumnPlayers=!0;const n=me(t,0);n&&s.teamA.players.push(n);const i=me(t,ge);i&&s.teamB.players.push(i)}else{const n=me(t,0);n&&(It(s)?(s.teamAColumnEnded=!0,s.teamB.players.push(n)):s.teamA.players.push(n))}}function $o(t,e){if(t.length<ge)return;if(t.length>=Me){const a=ve(t,ha,fa,pa);a&&e.teamA.players.push(a);const n=ve(t,xa,ga,ya);n&&e.teamB.players.push(n)}else{const a=ve(t,0,1,2);a&&(It(e)?e.teamB.players.push(a):e.teamA.players.push(a))}}function zo(t,e){if(t.length<ua)return;if(t.length>=ma){const a=Ce(t,0,1);a&&e.teamA.officials.push(a);const n=Ce(t,ba,Na);n&&e.teamB.officials.push(n)}else{const a=Ce(t,0,1);a&&(It(e)?e.teamB.officials.push(a):e.teamA.officials.push(a))}}function Ho(t,e){if(ka(t)){e.section="done";return}if(e.section==="done")return;if(wa(t)){e.section="officials";return}const s=t.split("	").map(a=>a.trim());if(va(t,s)){e.section="libero";return}switch(e.section){case"header":e.section=Sa(s,t,e);break;case"players":Fo(s,t,e);break;case"libero":$o(s,e);break;case"officials":zo(s,e);break}}function Uo(t){const e=[],s={section:"header",headerRowsParsed:0,teamA:{name:"",players:[],officials:[]},teamB:{name:"",players:[],officials:[]},seenTwoColumnPlayers:!1,teamAColumnEnded:!1};if(!t||typeof t!="string")return e.push("No OCR text provided"),{teamA:s.teamA,teamB:s.teamB,warnings:e};const a=t.split(`
`).map(l=>l.trim()).filter(l=>l.length>0),{startIndex:n,teamNamesIndex:i}=Ca(a);n>0&&e.push(`Skipped ${n} lines of non-player data (score/set information)`);const{teamAName:o,teamBName:c}=Aa(a,i);s.teamA.name=o,s.teamB.name=c;const d=o.length>0||c.length>0;s.section=d?"players":"header";const u=a.slice(n);if(u.length===0)return e.push("OCR text contains no lines"),{teamA:s.teamA,teamB:s.teamB,warnings:e};for(const l of u)Ho(l,s);return s.teamA.players.length===0&&e.push("No players found for Team A"),s.teamB.players.length===0&&e.push("No players found for Team B"),s.teamA.officials.length===0&&s.teamB.officials.length===0&&e.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),{teamA:s.teamA,teamB:s.teamB,warnings:e}}function Wo(t,e){if(t.text.includes("	")||!e.isValid||!t.words||t.words.length===0)return t.text;const s=[...t.words].sort((i,o)=>i.bbox.x0-o.bbox.x0),a=[],n=[];for(const i of s)(i.bbox.x0+i.bbox.x1)/2<e.midpoint?a.push(i.text):n.push(i.text);return a.length===0||n.length===0?t.text:`${a.join(" ")}	${n.join(" ")}`}function Vo(t){const e=[],s=[];for(const o of t){if(!o.words||o.words.length<Eo||o.text.split("	").filter(f=>f.trim().length>0).length<Me)continue;const u=[...o.words].sort((f,x)=>f.bbox.x0-x.bbox.x0);let l=0,h=-1;for(let f=0;f<u.length-1;f++){const x=u[f+1].bbox.x0-u[f].bbox.x1;x>l&&(l=x,h=f)}if(h>=0&&l>jo){const f=u[h].bbox.x1,x=u[h+1].bbox.x0;e.push(f),s.push(x)}}if(e.length<2||s.length<2)return{midpoint:0,isValid:!1};const a=e.reduce((o,c)=>o+c,0)/e.length,n=s.reduce((o,c)=>o+c,0)/s.length;return{midpoint:(a+n)/2,isValid:!0}}function Mt(t,e){return!e.isValid||!t.words||t.words.length===0?"B":t.words.reduce((a,n)=>a+n.bbox.x0,0)/t.words.length<e.midpoint?"A":"B"}function Go(t,e){if(t.length<ge)return;if(t.length>=Me){e.seenTwoColumnPlayers=!0;const a=me(t,0);a&&e.teamA.players.push(a);const n=me(t,ge);n&&e.teamB.players.push(n)}else{const a=me(t,0);a&&e.currentLine?Mt(e.currentLine,e.columnBoundary)==="A"?e.teamA.players.push(a):(e.teamAColumnEnded=!0,e.teamB.players.push(a)):a&&(e.seenTwoColumnPlayers?(e.teamAColumnEnded=!0,e.teamB.players.push(a)):e.teamA.players.push(a))}}function Ko(t,e){if(t.length<ge)return;if(t.length>=Me){const a=ve(t,ha,fa,pa);a&&e.teamA.players.push(a);const n=ve(t,xa,ga,ya);n&&e.teamB.players.push(n)}else{const a=ve(t,0,1,2);a&&e.currentLine?Mt(e.currentLine,e.columnBoundary)==="A"?e.teamA.players.push(a):e.teamB.players.push(a):a&&(e.teamAColumnEnded||e.seenTwoColumnPlayers?e.teamB.players.push(a):e.teamA.players.push(a))}}function Xo(t,e){if(t.length<ua)return;if(t.length>=ma){const a=Ce(t,0,1);a&&e.teamA.officials.push(a);const n=Ce(t,ba,Na);n&&e.teamB.officials.push(n)}else{const a=Ce(t,0,1);a&&e.currentLine?Mt(e.currentLine,e.columnBoundary)==="A"?e.teamA.officials.push(a):e.teamB.officials.push(a):a&&(e.teamAColumnEnded||e.seenTwoColumnPlayers?e.teamB.officials.push(a):e.teamA.officials.push(a))}}function Yo(t,e,s){if(e.currentLine=s,ka(t)){e.section="done";return}if(e.section==="done")return;if(wa(t)){e.section="officials";return}const a=t.split("	").map(n=>n.trim());if(va(t,a)){e.section="libero";return}switch(e.section){case"header":e.section=Sa(a,t,e);break;case"players":Go(a,e);break;case"libero":Ko(a,e);break;case"officials":Xo(a,e);break}}function qo(t,e){if((e?.type??"electronic")==="manuscript")return Co(t.fullText);const a=[];if(!t.lines||t.lines.length===0){const p=Uo(t.fullText);return{...p,warnings:["No OCR line data available, using text-only parsing",...p.warnings]}}const n=Vo(t.lines);n.isValid||a.push("Could not determine column boundaries from bounding boxes, using heuristic fallback");const i={section:"header",headerRowsParsed:0,teamA:{name:"",players:[],officials:[]},teamB:{name:"",players:[],officials:[]},seenTwoColumnPlayers:!1,teamAColumnEnded:!1,columnBoundary:n},o=[],c=new Map;for(const p of t.lines){const y=p.text.trim();if(!y)continue;const R=Wo(p,n);o.push(R),c.set(y,p),R!==y&&c.set(R,p)}const d=o.length>0?o:t.fullText.split(`
`).map(p=>p.trim()).filter(p=>p.length>0),{startIndex:u,teamNamesIndex:l}=Ca(d);u>0&&a.push(`Skipped ${u} lines of non-player data (score/set information)`);const{teamAName:h,teamBName:f}=Aa(d,l);i.teamA.name=h,i.teamB.name=f;const x=h.length>0||f.length>0;i.section=x?"players":"header";const g=d.slice(u);if(g.length===0)return a.push("OCR text contains no lines"),{teamA:i.teamA,teamB:i.teamB,warnings:a};for(const p of g){const y=c.get(p);Yo(p,i,y)}return i.teamA.players.length===0&&a.push("No players found for Team A"),i.teamB.players.length===0&&a.push("No players found for Team B"),i.teamA.officials.length===0&&i.teamB.officials.length===0&&a.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),{teamA:i.teamA,teamB:i.teamB,warnings:a}}function Zo(){const[t,e]=m.useState(!1),[s,a]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(null),[d,u]=m.useState(null),l=m.useRef(null),h=m.useCallback(async(g,p="electronic")=>{e(!0),a(null),i(null),c(null),u(null);try{const y=Ei.create(j=>{a(j)});l.current=y,await y.initialize();const R=await y.recognize(g),S=qo(R,{type:p});return await y.terminate(),l.current=null,i(S),c(R),e(!1),S}catch(y){const R=y instanceof Error?y:new Error(String(y));return R.message!=="OCR cancelled"&&u(R),e(!1),l.current=null,null}},[]),f=m.useCallback(async()=>{if(l.current){try{await l.current.terminate()}catch{}l.current=null}e(!1),a(null)},[]),x=m.useCallback(()=>{e(!1),a(null),i(null),c(null),u(null)},[]);return{isProcessing:t,progress:s,result:n,ocrResult:o,error:d,processImage:h,cancel:f,reset:x}}function Qo(t,e){return t.officials.filter(s=>s.role===e).length}function ys(t){return t.officials.some(e=>e.role==="AC3")}function bs(t){return Qo(t,"M")>=2}function Jo(){const[t,e]=m.useState({isOpen:!1,type:null}),s=m.useCallback(n=>{ys(n.teamA)||ys(n.teamB)?e({isOpen:!0,type:"ac3"}):(bs(n.teamA)||bs(n.teamB))&&e({isOpen:!0,type:"multipleDoctors"})},[]),a=m.useCallback(()=>{e({isOpen:!1,type:null})},[]);return{easterEgg:t,checkForEasterEggs:s,dismissEasterEgg:a}}const Ns=["#f94144","#f3722c","#f8961e","#f9c74f","#90be6d","#43aa8b","#4d908e","#577590","#277da1","#9b5de5"],el=100,tl=.3,ws=.99,sl=.015,al=8,rl=8,nl=200,il=.3,ol=10,ll=8,cl=8,ks=.5,dl=.2,ul=.6,vs=2,ml=4;function hl(t=3e3){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const e=document.createElement("canvas");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e);const s=()=>{e.width=window.innerWidth,e.height=window.innerHeight};s(),window.addEventListener("resize",s);const a=e.getContext("2d");if(!a){e.parentNode&&e.parentNode.removeChild(e);return}const n=[],i=e.width/2;for(let u=0;u<el;u++){const l=Math.random()*Math.PI*2,h=al+Math.random()*rl;n.push({x:i+(Math.random()-ks)*nl,y:e.height*il,vx:Math.cos(l)*h,vy:Math.sin(l)*h-ol,color:Ns[Math.floor(Math.random()*Ns.length)],size:ll+Math.random()*cl,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-ks)*dl,opacity:1})}let o;const c=Date.now(),d=()=>{const u=Date.now()-c;if(u>t||n.every(l=>l.opacity<=0)){cancelAnimationFrame(o),window.removeEventListener("resize",s),e.parentNode&&e.parentNode.removeChild(e);return}a.clearRect(0,0,e.width,e.height);for(const l of n)l.vy+=tl,l.vx*=ws,l.vy*=ws,l.x+=l.vx,l.y+=l.vy,l.rotation+=l.rotationSpeed,u>t*ul&&(l.opacity-=sl),l.opacity>0&&(a.save(),a.translate(l.x,l.y),a.rotate(l.rotation),a.globalAlpha=Math.max(0,l.opacity),a.fillStyle=l.color,a.fillRect(-l.size/vs,-l.size/ml,l.size,l.size/vs),a.restore());o=requestAnimationFrame(d)};d()}const fl=3e3;function pl({isOpen:t,type:e,onClose:s}){const{t:a}=B();m.useEffect(()=>{t&&hl(fl)},[t]);const n=`easter-egg-${e}-title`,i=()=>{switch(e){case"ac3":return r.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center",children:r.jsx(yr,{className:"w-6 h-6 text-amber-600 dark:text-amber-400","aria-hidden":"true"})});case"multipleDoctors":return r.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:r.jsx(_r,{className:"w-6 h-6 text-red-600 dark:text-red-400","aria-hidden":"true"})})}};return r.jsxs(wt,{isOpen:t,onClose:s,titleId:n,size:"sm",zIndex:70,children:[r.jsx(kt,{title:a(`easterEggs.${e}.title`),titleId:n,icon:i()}),r.jsx("p",{className:"text-text-secondary dark:text-text-secondary-dark mb-6",children:a(`easterEggs.${e}.message`)}),r.jsx(zs,{children:r.jsx("button",{type:"button",onClick:s,className:"w-full px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:a("easterEggs.dismiss")})})]})}function oe(t){return Array.isArray?Array.isArray(t):Ra(t)==="[object Array]"}function xl(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function gl(t){return t==null?"":xl(t)}function ne(t){return typeof t=="string"}function Ea(t){return typeof t=="number"}function yl(t){return t===!0||t===!1||bl(t)&&Ra(t)=="[object Boolean]"}function ja(t){return typeof t=="object"}function bl(t){return ja(t)&&t!==null}function ee(t){return t!=null}function Xe(t){return!t.trim().length}function Ra(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Nl="Incorrect 'index' type",wl=t=>`Invalid value for key ${t}`,kl=t=>`Pattern length exceeds max of ${t}.`,vl=t=>`Missing ${t} property in key`,Cl=t=>`Property 'weight' in key '${t}' must be a positive integer`,Cs=Object.prototype.hasOwnProperty;class Al{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(a=>{let n=_a(a);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(a=>{a.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function _a(t){let e=null,s=null,a=null,n=1,i=null;if(ne(t)||oe(t))a=t,e=As(t),s=ot(t);else{if(!Cs.call(t,"name"))throw new Error(vl("name"));const o=t.name;if(a=o,Cs.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(Cl(o));e=As(o),s=ot(o),i=t.getFn}return{path:e,id:s,weight:n,src:a,getFn:i}}function As(t){return oe(t)?t:t.split(".")}function ot(t){return oe(t)?t.join("."):t}function Sl(t,e){let s=[],a=!1;const n=(i,o,c)=>{if(ee(i))if(!o[c])s.push(i);else{let d=o[c];const u=i[d];if(!ee(u))return;if(c===o.length-1&&(ne(u)||Ea(u)||yl(u)))s.push(gl(u));else if(oe(u)){a=!0;for(let l=0,h=u.length;l<h;l+=1)n(u[l],o,c+1)}else o.length&&n(u,o,c+1)}};return n(t,ne(e)?e.split("."):e,0),a?s:s[0]}const El={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},jl={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},Rl={location:0,threshold:.6,distance:100},_l={useExtendedSearch:!1,getFn:Sl,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var T={...jl,...El,...Rl,..._l};const Il=/[^ ]+/g;function Ml(t=1,e=3){const s=new Map,a=Math.pow(10,e);return{get(n){const i=n.match(Il).length;if(s.has(i))return s.get(i);const o=1/Math.pow(i,.5*t),c=parseFloat(Math.round(o*a)/a);return s.set(i,c),c},clear(){s.clear()}}}class Tt{constructor({getFn:e=T.getFn,fieldNormWeight:s=T.fieldNormWeight}={}){this.norm=Ml(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,a)=>{this._keysMap[s.id]=a})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,ne(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();ne(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,a=this.size();s<a;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!ee(e)||Xe(e))return;let a={v:e,i:s,n:this.norm.get(e)};this.records.push(a)}_addObject(e,s){let a={i:s,$:{}};this.keys.forEach((n,i)=>{let o=n.getFn?n.getFn(e):this.getFn(e,n.path);if(ee(o)){if(oe(o)){let c=[];const d=[{nestedArrIndex:-1,value:o}];for(;d.length;){const{nestedArrIndex:u,value:l}=d.pop();if(ee(l))if(ne(l)&&!Xe(l)){let h={v:l,i:u,n:this.norm.get(l)};c.push(h)}else oe(l)&&l.forEach((h,f)=>{d.push({nestedArrIndex:f,value:h})})}a.$[i]=c}else if(ne(o)&&!Xe(o)){let c={v:o,n:this.norm.get(o)};a.$[i]=c}}}),this.records.push(a)}toJSON(){return{keys:this.keys,records:this.records}}}function Ia(t,e,{getFn:s=T.getFn,fieldNormWeight:a=T.fieldNormWeight}={}){const n=new Tt({getFn:s,fieldNormWeight:a});return n.setKeys(t.map(_a)),n.setSources(e),n.create(),n}function Tl(t,{getFn:e=T.getFn,fieldNormWeight:s=T.fieldNormWeight}={}){const{keys:a,records:n}=t,i=new Tt({getFn:e,fieldNormWeight:s});return i.setKeys(a),i.setIndexRecords(n),i}function Pe(t,{errors:e=0,currentLocation:s=0,expectedLocation:a=0,distance:n=T.distance,ignoreLocation:i=T.ignoreLocation}={}){const o=e/t.length;if(i)return o;const c=Math.abs(a-s);return n?o+c/n:c?1:o}function Ol(t=[],e=T.minMatchCharLength){let s=[],a=-1,n=-1,i=0;for(let o=t.length;i<o;i+=1){let c=t[i];c&&a===-1?a=i:!c&&a!==-1&&(n=i-1,n-a+1>=e&&s.push([a,n]),a=-1)}return t[i-1]&&i-a>=e&&s.push([a,i-1]),s}const xe=32;function Pl(t,e,s,{location:a=T.location,distance:n=T.distance,threshold:i=T.threshold,findAllMatches:o=T.findAllMatches,minMatchCharLength:c=T.minMatchCharLength,includeMatches:d=T.includeMatches,ignoreLocation:u=T.ignoreLocation}={}){if(e.length>xe)throw new Error(kl(xe));const l=e.length,h=t.length,f=Math.max(0,Math.min(a,h));let x=i,g=f;const p=c>1||d,y=p?Array(h):[];let R;for(;(R=t.indexOf(e,g))>-1;){let N=Pe(e,{currentLocation:R,expectedLocation:f,distance:n,ignoreLocation:u});if(x=Math.min(N,x),g=R+l,p){let k=0;for(;k<l;)y[R+k]=1,k+=1}}g=-1;let S=[],j=1,C=l+h;const w=1<<l-1;for(let N=0;N<l;N+=1){let k=0,v=C;for(;k<v;)Pe(e,{errors:N,currentLocation:f+v,expectedLocation:f,distance:n,ignoreLocation:u})<=x?k=v:C=v,v=Math.floor((C-k)/2+k);C=v;let F=Math.max(1,f-v+1),_=o?h:Math.min(f+v,h)+l,M=Array(_+2);M[_+1]=(1<<N)-1;for(let P=_;P>=F;P-=1){let Q=P-1,ae=s[t.charAt(Q)];if(p&&(y[Q]=+!!ae),M[P]=(M[P+1]<<1|1)&ae,N&&(M[P]|=(S[P+1]|S[P])<<1|1|S[P+1]),M[P]&w&&(j=Pe(e,{errors:N,currentLocation:Q,expectedLocation:f,distance:n,ignoreLocation:u}),j<=x)){if(x=j,g=Q,g<=f)break;F=Math.max(1,2*f-g)}}if(Pe(e,{errors:N+1,currentLocation:f,expectedLocation:f,distance:n,ignoreLocation:u})>x)break;S=M}const b={isMatch:g>=0,score:Math.max(.001,j)};if(p){const N=Ol(y,c);N.length?d&&(b.indices=N):b.isMatch=!1}return b}function Ll(t){let e={};for(let s=0,a=t.length;s<a;s+=1){const n=t.charAt(s);e[n]=(e[n]||0)|1<<a-s-1}return e}const ze=String.prototype.normalize?(t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(t=>t);class Ma{constructor(e,{location:s=T.location,threshold:a=T.threshold,distance:n=T.distance,includeMatches:i=T.includeMatches,findAllMatches:o=T.findAllMatches,minMatchCharLength:c=T.minMatchCharLength,isCaseSensitive:d=T.isCaseSensitive,ignoreDiacritics:u=T.ignoreDiacritics,ignoreLocation:l=T.ignoreLocation}={}){if(this.options={location:s,threshold:a,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:d,ignoreDiacritics:u,ignoreLocation:l},e=d?e:e.toLowerCase(),e=u?ze(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(x,g)=>{this.chunks.push({pattern:x,alphabet:Ll(x),startIndex:g})},f=this.pattern.length;if(f>xe){let x=0;const g=f%xe,p=f-g;for(;x<p;)h(this.pattern.substr(x,xe),x),x+=xe;if(g){const y=f-xe;h(this.pattern.substr(y),y)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:a,includeMatches:n}=this.options;if(e=s?e:e.toLowerCase(),e=a?ze(e):e,this.pattern===e){let p={isMatch:!0,score:0};return n&&(p.indices=[[0,e.length-1]]),p}const{location:i,distance:o,threshold:c,findAllMatches:d,minMatchCharLength:u,ignoreLocation:l}=this.options;let h=[],f=0,x=!1;this.chunks.forEach(({pattern:p,alphabet:y,startIndex:R})=>{const{isMatch:S,score:j,indices:C}=Pl(e,p,y,{location:i+R,distance:o,threshold:c,findAllMatches:d,minMatchCharLength:u,includeMatches:n,ignoreLocation:l});S&&(x=!0),f+=j,S&&C&&(h=[...h,...C])});let g={isMatch:x,score:x?f/this.chunks.length:1};return x&&n&&(g.indices=h),g}}class fe{constructor(e){this.pattern=e}static isMultiMatch(e){return Ss(e,this.multiRegex)}static isSingleMatch(e){return Ss(e,this.singleRegex)}search(){}}function Ss(t,e){const s=t.match(e);return s?s[1]:null}class Bl extends fe{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Dl extends fe{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const a=e.indexOf(this.pattern)===-1;return{isMatch:a,score:a?0:1,indices:[0,e.length-1]}}}class Fl extends fe{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class $l extends fe{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class zl extends fe{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Hl extends fe{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Ta extends fe{constructor(e,{location:s=T.location,threshold:a=T.threshold,distance:n=T.distance,includeMatches:i=T.includeMatches,findAllMatches:o=T.findAllMatches,minMatchCharLength:c=T.minMatchCharLength,isCaseSensitive:d=T.isCaseSensitive,ignoreDiacritics:u=T.ignoreDiacritics,ignoreLocation:l=T.ignoreLocation}={}){super(e),this._bitapSearch=new Ma(e,{location:s,threshold:a,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:d,ignoreDiacritics:u,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Oa extends fe{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,a;const n=[],i=this.pattern.length;for(;(a=e.indexOf(this.pattern,s))>-1;)s=a+i,n.push([a,s-1]);const o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}const lt=[Bl,Oa,Fl,$l,Hl,zl,Dl,Ta],Es=lt.length,Ul=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Wl="|";function Vl(t,e={}){return t.split(Wl).map(s=>{let a=s.trim().split(Ul).filter(i=>i&&!!i.trim()),n=[];for(let i=0,o=a.length;i<o;i+=1){const c=a[i];let d=!1,u=-1;for(;!d&&++u<Es;){const l=lt[u];let h=l.isMultiMatch(c);h&&(n.push(new l(h,e)),d=!0)}if(!d)for(u=-1;++u<Es;){const l=lt[u];let h=l.isSingleMatch(c);if(h){n.push(new l(h,e));break}}}return n})}const Gl=new Set([Ta.type,Oa.type]);class Kl{constructor(e,{isCaseSensitive:s=T.isCaseSensitive,ignoreDiacritics:a=T.ignoreDiacritics,includeMatches:n=T.includeMatches,minMatchCharLength:i=T.minMatchCharLength,ignoreLocation:o=T.ignoreLocation,findAllMatches:c=T.findAllMatches,location:d=T.location,threshold:u=T.threshold,distance:l=T.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:a,includeMatches:n,minMatchCharLength:i,findAllMatches:c,ignoreLocation:o,location:d,threshold:u,distance:l},e=s?e:e.toLowerCase(),e=a?ze(e):e,this.pattern=e,this.query=Vl(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:a,isCaseSensitive:n,ignoreDiacritics:i}=this.options;e=n?e:e.toLowerCase(),e=i?ze(e):e;let o=0,c=[],d=0;for(let u=0,l=s.length;u<l;u+=1){const h=s[u];c.length=0,o=0;for(let f=0,x=h.length;f<x;f+=1){const g=h[f],{isMatch:p,indices:y,score:R}=g.search(e);if(p){if(o+=1,d+=R,a){const S=g.constructor.type;Gl.has(S)?c=[...c,...y]:c.push(y)}}else{d=0,o=0,c.length=0;break}}if(o){let f={isMatch:!0,score:d/o};return a&&(f.indices=c),f}}return{isMatch:!1,score:1}}}const ct=[];function Xl(...t){ct.push(...t)}function dt(t,e){for(let s=0,a=ct.length;s<a;s+=1){let n=ct[s];if(n.condition(t,e))return new n(t,e)}return new Ma(t,e)}const He={AND:"$and",OR:"$or"},ut={PATH:"$path",PATTERN:"$val"},mt=t=>!!(t[He.AND]||t[He.OR]),Yl=t=>!!t[ut.PATH],ql=t=>!oe(t)&&ja(t)&&!mt(t),js=t=>({[He.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Pa(t,e,{auto:s=!0}={}){const a=n=>{let i=Object.keys(n);const o=Yl(n);if(!o&&i.length>1&&!mt(n))return a(js(n));if(ql(n)){const d=o?n[ut.PATH]:i[0],u=o?n[ut.PATTERN]:n[d];if(!ne(u))throw new Error(wl(d));const l={keyId:ot(d),pattern:u};return s&&(l.searcher=dt(u,e)),l}let c={children:[],operator:i[0]};return i.forEach(d=>{const u=n[d];oe(u)&&u.forEach(l=>{c.children.push(a(l))})}),c};return mt(t)||(t=js(t)),a(t)}function Zl(t,{ignoreFieldNorm:e=T.ignoreFieldNorm}){t.forEach(s=>{let a=1;s.matches.forEach(({key:n,norm:i,score:o})=>{const c=n?n.weight:null;a*=Math.pow(o===0&&c?Number.EPSILON:o,(c||1)*(e?1:i))}),s.score=a})}function Ql(t,e){const s=t.matches;e.matches=[],ee(s)&&s.forEach(a=>{if(!ee(a.indices)||!a.indices.length)return;const{indices:n,value:i}=a;let o={indices:n,value:i};a.key&&(o.key=a.key.src),a.idx>-1&&(o.refIndex=a.idx),e.matches.push(o)})}function Jl(t,e){e.score=t.score}function ec(t,e,{includeMatches:s=T.includeMatches,includeScore:a=T.includeScore}={}){const n=[];return s&&n.push(Ql),a&&n.push(Jl),t.map(i=>{const{idx:o}=i,c={item:e[o],refIndex:o};return n.length&&n.forEach(d=>{d(i,c)}),c})}class ie{constructor(e,s={},a){this.options={...T,...s},this.options.useExtendedSearch,this._keyStore=new Al(this.options.keys),this.setCollection(e,a)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof Tt))throw new Error(Nl);this._myIndex=s||Ia(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){ee(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let a=0,n=this._docs.length;a<n;a+=1){const i=this._docs[a];e(i,a)&&(this.removeAt(a),a-=1,n-=1,s.push(i))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:a,includeScore:n,shouldSort:i,sortFn:o,ignoreFieldNorm:c}=this.options;let d=ne(e)?ne(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Zl(d,{ignoreFieldNorm:c}),i&&d.sort(o),Ea(s)&&s>-1&&(d=d.slice(0,s)),ec(d,this._docs,{includeMatches:a,includeScore:n})}_searchStringList(e){const s=dt(e,this.options),{records:a}=this._myIndex,n=[];return a.forEach(({v:i,i:o,n:c})=>{if(!ee(i))return;const{isMatch:d,score:u,indices:l}=s.searchIn(i);d&&n.push({item:i,idx:o,matches:[{score:u,value:i,norm:c,indices:l}]})}),n}_searchLogical(e){const s=Pa(e,this.options),a=(c,d,u)=>{if(!c.children){const{keyId:h,searcher:f}=c,x=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(d,h),searcher:f});return x&&x.length?[{idx:u,item:d,matches:x}]:[]}const l=[];for(let h=0,f=c.children.length;h<f;h+=1){const x=c.children[h],g=a(x,d,u);if(g.length)l.push(...g);else if(c.operator===He.AND)return[]}return l},n=this._myIndex.records,i={},o=[];return n.forEach(({$:c,i:d})=>{if(ee(c)){let u=a(s,c,d);u.length&&(i[d]||(i[d]={idx:d,item:c,matches:[]},o.push(i[d])),u.forEach(({matches:l})=>{i[d].matches.push(...l)}))}}),o}_searchObjectList(e){const s=dt(e,this.options),{keys:a,records:n}=this._myIndex,i=[];return n.forEach(({$:o,i:c})=>{if(!ee(o))return;let d=[];a.forEach((u,l)=>{d.push(...this._findMatches({key:u,value:o[l],searcher:s}))}),d.length&&i.push({idx:c,item:o,matches:d})}),i}_findMatches({key:e,value:s,searcher:a}){if(!ee(s))return[];let n=[];if(oe(s))s.forEach(({v:i,i:o,n:c})=>{if(!ee(i))return;const{isMatch:d,score:u,indices:l}=a.searchIn(i);d&&n.push({score:u,key:e,value:i,idx:o,norm:c,indices:l})});else{const{v:i,n:o}=s,{isMatch:c,score:d,indices:u}=a.searchIn(i);c&&n.push({score:d,key:e,value:i,norm:o,indices:u})}return n}}ie.version="7.1.0";ie.createIndex=Ia;ie.parseIndex=Tl;ie.config=T;ie.parseQuery=Pa;Xl(Kl);const tc=50,Rs=.6,_s=.4,La=90,Ba=85,Da=95,sc=.4,Fa=.6,Re={threshold:sc,ignoreLocation:!0,includeScore:!0},Ot=100,$a=new Set(["de","del","della","di","du","von","van","den","der","la","le","las","los","dos","da","das"]);function ac(t){const e=new Map;for(const s of t){const a=[s.firstName??"",s.lastName??""].filter(x=>x&&x.trim()).join(" "),n=Ae(a),i=n?n.split(" ").filter(x=>x.length>=2||$a.has(x)):[],o=i.length>0?new ie(i,Re):null,c=Ae(s.lastName??""),d=c?c.split(" ").filter(x=>x.length>1):[],u=d.length>0?new ie(d,Re):null,l=Ae(s.firstName??""),h=l?l.split(" ").filter(x=>x.length>1):[],f=h.length>0?new ie(h,Re):null;e.set(s.id,{fullNameWords:i,fullNameFuse:o,lastNameWords:d,lastNameFuse:u,firstNameWords:h,firstNameFuse:f})}return e}function Ae(t){return t?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function Ue(t){return Ae(t)}function ht(t){const e=Ue(t);return e?e.split(" ").filter(s=>s.length>=2||$a.has(s)):[]}function rc(t,e){const s=ht(t),a=ht(e);if(s.length===0||a.length===0)return 0;const n=new ie(a,Re);let i=0;const o=new Set;for(const d of s){const u=n.search(d);for(const l of u){const h=l.refIndex;if(o.has(h))continue;const f=1-(l.score??1);if(f>0){i+=f,o.add(h);break}}}const c=Math.max(s.length,a.length);return Math.round(i/c*Da)}function Is(t,e){const s=Ue(t),a=Ue(e);if(!s||!a)return 0;if(s===a)return Ot;if(s.includes(a)||a.includes(s)){const l=s.length<a.length?s:a,h=s.length>=a.length?s:a;return Math.round(l.length/h.length*La)}const n=s.split(" ").filter(l=>l.length>1),i=a.split(" ").filter(l=>l.length>1);if(i.length===0)return 0;const o=new ie(i,Re);let c=0;const d=new Set;for(const l of n){const h=o.search(l);for(const f of h){const x=f.refIndex;if(d.has(x))continue;const g=1-(f.score??1);if(g>Fa){c+=g,d.add(x);break}}}const u=Math.max(n.length,i.length);return u===0?0:Math.round(c/u*Ba)}function nc(t,e,s){const a=ht(t);if(a.length===0||e.length===0||!s)return 0;let n=0;const i=new Set;for(const c of a){const d=s.search(c);for(const u of d){const l=u.refIndex;if(i.has(l))continue;const h=1-(u.score??1);if(h>0){n+=h,i.add(l);break}}}const o=Math.max(a.length,e.length);return Math.round(n/o*Da)}function Ms(t,e,s,a){const n=Ue(t);if(!n||!e)return 0;if(n===e)return Ot;if(n.includes(e)||e.includes(n)){const u=n.length<e.length?n:e,l=n.length>=e.length?n:e;return Math.round(u.length/l.length*La)}const i=n.split(" ").filter(u=>u.length>1);if(s.length===0||!a)return 0;let o=0;const c=new Set;for(const u of i){const l=a.search(u);for(const h of l){const f=h.refIndex;if(c.has(f))continue;const x=1-(h.score??1);if(x>Fa){o+=x,c.add(f);break}}}const d=Math.max(i.length,s.length);return d===0?0:Math.round(o/d*Ba)}function Ts(t,e){return[t,e].filter(s=>s&&s.trim()).join(" ")}function ic(t,e,s,a){let n=null,i=0;const o=Ts(t.firstName,t.lastName);for(const c of e){if(s.has(c.id))continue;let d,u;const l=a?.get(c.id);if(l){const f=Ae(c.lastName??""),x=Ae(c.firstName??""),g=Ms(t.lastName,f,l.lastNameWords,l.lastNameFuse),p=Ms(t.firstName,x,l.firstNameWords,l.firstNameFuse);d=g*Rs+p*_s,u=nc(o,l.fullNameWords,l.fullNameFuse)}else{const f=Is(t.lastName,c.lastName??""),x=Is(t.firstName,c.firstName??"");d=f*Rs+x*_s;const g=Ts(c.firstName??"",c.lastName??"");u=rc(o,g)}const h=Math.max(d,u);h>i&&(i=h,n=c)}return i<tc?{player:null,confidence:0}:{player:n,confidence:Math.min(Ot,Math.round(i))}}function Le(t,e){const s=[],a=new Set,n=ac(e);for(const o of t){const{player:c,confidence:d}=ic(o,e,a,n);c?(a.add(c.id),s.push({status:"match",ocrPlayer:o,rosterPlayerId:c.id,rosterPlayerName:c.displayName,confidence:d})):s.push({status:"ocr-only",ocrPlayer:o,rosterPlayerId:null,rosterPlayerName:null,confidence:0})}for(const o of e)a.has(o.id)||s.push({status:"roster-only",ocrPlayer:null,rosterPlayerId:o.id,rosterPlayerName:o.displayName,confidence:0});const i={match:0,"ocr-only":1,"roster-only":2};return s.sort((o,c)=>i[o.status]-i[c.status]),s}function oc(t,e){switch(t){case"match":return{icon:We,iconColor:"text-success-500",bgColor:"bg-success-50 dark:bg-success-900/20",borderColor:"border-success-200 dark:border-success-800",label:e("validation.ocr.comparison.matched")};case"ocr-only":return{icon:yt,iconColor:"text-warning-500",bgColor:"bg-warning-50 dark:bg-warning-900/20",borderColor:"border-warning-200 dark:border-warning-800",label:e("validation.ocr.comparison.ocrOnly")};case"roster-only":return{icon:pr,iconColor:"text-danger-500",bgColor:"bg-danger-50 dark:bg-danger-900/20",borderColor:"border-danger-200 dark:border-danger-800",label:e("validation.ocr.comparison.rosterOnly")}}}function Ye({result:t,isSelected:e,onToggle:s,isSelectable:a}){const{t:n,tInterpolate:i}=B(),o=oc(t.status,n),c=o.icon,d=t.status==="roster-only"?t.rosterPlayerName:t.ocrPlayer?.displayName,u=t.status==="match"?t.rosterPlayerName:null;return r.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${o.bgColor} ${o.borderColor}`,children:[a&&r.jsx("input",{type:"checkbox",checked:e,onChange:s,className:"w-4 h-4 text-primary-500 border-gray-300 rounded focus:ring-primary-500 focus:ring-2","aria-label":`Select ${d}`}),r.jsx("div",{className:`flex-shrink-0 ${o.iconColor}`,children:r.jsx(c,{className:"w-5 h-5","aria-hidden":"true"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(or,{className:"w-4 h-4 text-gray-400 flex-shrink-0","aria-hidden":"true"}),r.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:d})]}),u&&r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate",children:u})]}),r.jsxs("div",{className:"flex flex-col items-end gap-1",children:[r.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${o.bgColor} ${o.iconColor}`,children:o.label}),t.confidence>0&&r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("validation.ocr.comparison.confidence",{score:String(t.confidence)})})]})]})}function Be({results:t,selectedPlayerIds:e,onTogglePlayer:s,onSelectAll:a,onDeselectAll:n,readOnly:i=!1}){const{t:o,tInterpolate:c}=B(),{matched:d,ocrOnly:u,rosterOnly:l}=m.useMemo(()=>({matched:t.filter(p=>p.status==="match"),ocrOnly:t.filter(p=>p.status==="ocr-only"),rosterOnly:t.filter(p=>p.status==="roster-only")}),[t]),h=d.length,f=e.size,x=h>0&&f===h,g=!i&&h>0&&a&&n;return t.length===0?r.jsx("div",{className:"py-8 text-center",children:r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o("validation.ocr.comparison.noMatches")})}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[d.length>0&&r.jsx("span",{className:"px-2 py-1 bg-success-50 dark:bg-success-900/20 text-success-700 dark:text-success-400 rounded-full",children:c("validation.ocr.comparison.matchedCount",{count:String(d.length)})}),u.length>0&&r.jsx("span",{className:"px-2 py-1 bg-warning-50 dark:bg-warning-900/20 text-warning-700 dark:text-warning-400 rounded-full",children:c("validation.ocr.comparison.ocrOnlyCount",{count:String(u.length)})}),l.length>0&&r.jsx("span",{className:"px-2 py-1 bg-danger-50 dark:bg-danger-900/20 text-danger-700 dark:text-danger-400 rounded-full",children:c("validation.ocr.comparison.rosterOnlyCount",{count:String(l.length)})})]}),g&&r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{type:"button",onClick:x?n:a,className:"text-xs text-primary-600 dark:text-primary-400 hover:underline",children:o(x?"validation.ocr.comparison.deselectAll":"validation.ocr.comparison.selectAll")}),r.jsxs("span",{className:"text-xs text-gray-400",children:["(",f,"/",h,")"]})]}),d.length>0&&r.jsx("div",{className:"space-y-2",children:d.map(p=>r.jsx(Ye,{result:p,isSelected:p.rosterPlayerId?e.has(p.rosterPlayerId):!1,onToggle:()=>p.rosterPlayerId&&s(p.rosterPlayerId),isSelectable:!i&&!!p.rosterPlayerId},p.rosterPlayerId??p.ocrPlayer?.rawName))}),u.length>0&&r.jsx("div",{className:"space-y-2",children:u.map(p=>r.jsx(Ye,{result:p,isSelected:!1,onToggle:()=>{},isSelectable:!1},`ocr-only-${p.ocrPlayer?.rawName??p.ocrPlayer?.displayName}`))}),l.length>0&&r.jsx("div",{className:"space-y-2",children:l.map(p=>r.jsx(Ye,{result:p,isSelected:!1,onToggle:()=>{},isSelectable:!1},p.rosterPlayerId))})]})}function Os(t){return t.map(e=>({shirtNumber:null,lastName:e.lastName,firstName:e.firstName,displayName:e.displayName,rawName:e.rawName,licenseStatus:""}))}function Ps(t){return t.map(e=>({id:e.id,displayName:e.displayName,firstName:e.firstName,lastName:e.lastName}))}function lc({isOpen:t,homeTeamName:e,awayTeamName:s,homeRosterPlayers:a,awayRosterPlayers:n,homeRosterCoaches:i,awayRosterCoaches:o,onSkip:c,onComplete:d,onClose:u}){const{t:l}=B(),{processImage:h,progress:f,error:x,reset:g,ocrResult:p}=Zo(),{easterEgg:y,checkForEasterEggs:R,dismissEasterEgg:S}=Jo(),[j,C]=m.useState("intro"),[w,b]=m.useState(!1),[N,k]=m.useState("electronic"),[v,F]=m.useState(null),[_,M]=m.useState(null),[A,P]=m.useState(null),[Q,ae]=m.useState(null),[H,te]=m.useState(null),[re,ye]=m.useState(new Set(["home-players","away-players"])),le=m.useRef(!1);m.useEffect(()=>{if(!t||w)return;const L=X=>{X.key==="Escape"&&u()};return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[t,w,u]),m.useEffect(()=>{t&&(C("intro"),k("electronic"),F(null),M(null),P(null),ae(null),H&&URL.revokeObjectURL(H),te(null),ye(new Set(["home-players","away-players"])),g())},[t,g]),m.useEffect(()=>()=>{H&&URL.revokeObjectURL(H)},[H]),m.useEffect(()=>{p&&ae(p)},[p]);const pe=m.useCallback(L=>{const X=L.teamA.name.toLowerCase(),$=L.teamB.name.toLowerCase(),W=e.toLowerCase(),G=s.toLowerCase(),ue=X.includes(W)||W.includes(X),se=X.includes(G)||G.includes(X),E=$.includes(W)||W.includes($),O=$.includes(G)||G.includes($);return ue&&!se?{homeOCR:L.teamA,awayOCR:L.teamB}:se&&!ue?{homeOCR:L.teamB,awayOCR:L.teamA}:E&&!O?{homeOCR:L.teamB,awayOCR:L.teamA}:O&&!E?{homeOCR:L.teamA,awayOCR:L.teamB}:{homeOCR:L.teamA,awayOCR:L.teamB}},[e,s]),Ee=m.useCallback(async L=>{if(le.current)return;le.current=!0,b(!1),C("processing");const X=URL.createObjectURL(L);te(X);try{const $=await h(L,N);if($){P($);const{homeOCR:W,awayOCR:G}=pe($);if(W.players.length===0&&G.players.length===0){C("error");return}const ue=Le(W.players,a.map(I=>({id:I.id,displayName:I.displayName,firstName:I.firstName,lastName:I.lastName}))),se=Le(Os(W.officials),Ps(i)),E=Le(G.players,n.map(I=>({id:I.id,displayName:I.displayName,firstName:I.firstName,lastName:I.lastName}))),O=Le(Os(G.officials),Ps(o));F({teamName:e,ocrTeamName:W.name,playerResults:ue,coachResults:se}),M({teamName:s,ocrTeamName:G.name,playerResults:E,coachResults:O}),R($),C("results")}else C("error")}catch{C("error")}finally{le.current=!1}},[h,N,pe,e,s,a,n,i,o,R]),ce=m.useCallback(()=>{g(),F(null),M(null),P(null),ae(null),H&&URL.revokeObjectURL(H),te(null),C("capture"),b(!0)},[g,H]),de=m.useCallback(L=>{k(L),C("capture"),b(!0)},[]),U=m.useCallback(L=>{ye(X=>{const $=new Set(X);return $.has(L)?$.delete(L):$.add(L),$})},[]);if(!t)return null;const D=L=>{const X=L.filter(W=>W.status==="ocr-only").length,$=L.filter(W=>W.status==="roster-only").length;return X+$},V=(v?D(v.playerResults)+D(v.coachResults):0)+(_?D(_.playerResults)+D(_.coachResults):0);return r.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col bg-white dark:bg-gray-900",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-entry-title",children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("div",{children:r.jsx("h1",{id:"ocr-entry-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scanScoresheet")})}),r.jsx("button",{type:"button",onClick:u,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":l("common.close"),children:r.jsx(he,{className:"w-5 h-5","aria-hidden":"true"})})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[j==="intro"&&r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",children:[r.jsx(Ve,{className:"w-16 h-16 text-primary-400 dark:text-primary-500 mb-4","aria-hidden":"true"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:l("validation.ocr.scanScoresheet")}),r.jsx("p",{className:"text-center text-gray-600 dark:text-gray-300 max-w-md mb-6",children:l("validation.ocr.scoresheetType.title")}),r.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-sm mb-6",children:[r.jsxs("button",{type:"button",onClick:()=>de("electronic"),className:"w-full flex items-start gap-4 p-4 bg-white dark:bg-gray-800 border-2 border-primary-500 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors text-left",children:[r.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-primary-100 dark:bg-primary-900/30",children:r.jsx(qe,{className:"w-6 h-6 text-primary-600 dark:text-primary-400","aria-hidden":"true"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("span",{className:"block text-base font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scoresheetType.electronic")}),r.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:l("validation.ocr.scoresheetType.electronicDescription")})]})]}),r.jsxs("button",{type:"button",onClick:()=>de("manuscript"),className:"w-full flex items-start gap-4 p-4 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary-300 dark:hover:border-primary-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[r.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-700",children:r.jsx(Nr,{className:"w-6 h-6 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("span",{className:"block text-base font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scoresheetType.manuscript")}),r.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:l("validation.ocr.scoresheetType.manuscriptDescription")})]})]})]}),r.jsxs("button",{type:"button",onClick:c,className:"flex items-center justify-center gap-2 px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[r.jsx(jr,{className:"w-4 h-4","aria-hidden":"true"}),l("tour.actions.skip")]})]}),j==="processing"&&r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",role:"status","aria-live":"polite",children:[r.jsx(_e,{size:"lg",className:"mb-6"}),r.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:l("validation.ocr.processing")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:f?.status??l("validation.ocr.processingDescription")}),f&&f.progress>0&&r.jsx("div",{className:"w-64 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mt-6 overflow-hidden",children:r.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-300",style:{width:`${f.progress}%`}})})]}),j==="results"&&r.jsxs("div",{className:"max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center gap-2 text-success-600 dark:text-success-400 mb-4",children:[r.jsx(Ze,{className:"w-6 h-6","aria-hidden":"true"}),r.jsx("span",{className:"text-lg font-medium",children:l("validation.ocr.scanComplete")})]}),V>0&&r.jsx("div",{className:"mb-4 p-3 bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg",children:r.jsxs("p",{className:"text-sm text-warning-700 dark:text-warning-400",children:[V," discrepancies found"]})}),v&&r.jsxs("div",{className:"mb-6",children:[r.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:[v.teamName,v.ocrTeamName&&v.ocrTeamName!==v.teamName&&r.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(OCR: ",v.ocrTeamName,")"]})]}),r.jsx(De,{title:l("validation.ocr.players"),count:v.playerResults.length,discrepancies:D(v.playerResults),expanded:re.has("home-players"),onToggle:()=>U("home-players"),sectionId:"home-players",children:r.jsx(Be,{results:v.playerResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})}),v.coachResults.length>0&&r.jsx(De,{title:l("validation.ocr.coaches"),count:v.coachResults.length,discrepancies:D(v.coachResults),expanded:re.has("home-coaches"),onToggle:()=>U("home-coaches"),sectionId:"home-coaches",children:r.jsx(Be,{results:v.coachResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})})]}),_&&r.jsxs("div",{className:"mb-6",children:[r.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:[_.teamName,_.ocrTeamName&&_.ocrTeamName!==_.teamName&&r.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(OCR: ",_.ocrTeamName,")"]})]}),r.jsx(De,{title:l("validation.ocr.players"),count:_.playerResults.length,discrepancies:D(_.playerResults),expanded:re.has("away-players"),onToggle:()=>U("away-players"),sectionId:"away-players",children:r.jsx(Be,{results:_.playerResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})}),_.coachResults.length>0&&r.jsx(De,{title:l("validation.ocr.coaches"),count:_.coachResults.length,discrepancies:D(_.coachResults),expanded:re.has("away-coaches"),onToggle:()=>U("away-coaches"),sectionId:"away-coaches",children:r.jsx(Be,{results:_.coachResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})})]}),A&&r.jsx(cc,{data:A,ocrResult:Q,imageUrl:H,expanded:re.has("raw-ocr-data"),onToggle:()=>U("raw-ocr-data")})]}),j==="error"&&r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",role:"alert",children:[r.jsx(Ie,{className:"w-16 h-16 text-danger-500 mb-6","aria-hidden":"true"}),r.jsx("p",{className:"text-lg font-medium text-danger-700 dark:text-danger-400 mb-2",children:l("validation.ocr.scanFailed")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center max-w-md mb-6",children:x?.message??l("validation.ocr.errors.processingFailed")}),r.jsxs("button",{type:"button",onClick:ce,className:"flex items-center gap-2 px-6 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors font-medium",children:[r.jsx(Us,{className:"w-5 h-5","aria-hidden":"true"}),l("validation.ocr.retryCapture")]})]})]}),j==="results"&&r.jsxs("div",{className:"flex gap-3 px-4 py-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{type:"button",onClick:ce,className:"flex-1 px-4 py-3 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:l("validation.ocr.retryCapture")}),r.jsx("button",{type:"button",onClick:d,className:"flex-1 px-4 py-3 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:l("validation.ocr.continueToValidation")})]}),r.jsx(oi,{isOpen:w,scoresheetType:N,onClose:()=>{b(!1),j==="capture"&&C("intro")},onImageSelected:Ee}),y.type&&r.jsx(pl,{isOpen:y.isOpen,type:y.type,onClose:S})]})}function De({title:t,count:e,discrepancies:s,expanded:a,onToggle:n,sectionId:i,children:o}){const c=a?Ct:Nt;return r.jsxs("div",{className:"mb-3",children:[r.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-expanded":a,"aria-controls":i,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(c,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),r.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",e,")"]})]}),s>0&&r.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-400",children:[s," discrepancies"]})]}),a&&r.jsx("div",{id:i,className:"mt-2 pl-6",children:o})]})}function cc({data:t,ocrResult:e,imageUrl:s,expanded:a,onToggle:n}){const{t:i}=B(),o=a?Ct:Nt;return r.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-2 px-3 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-expanded":a,"aria-controls":"raw-ocr-data",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(o,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("validation.ocr.rawData.title")})]})}),a&&r.jsxs("div",{id:"raw-ocr-data",className:"mt-3 space-y-4",children:[s&&e&&r.jsx(dc,{imageUrl:s,ocrResult:e,parsedData:t}),r.jsx(Ls,{team:t.teamA,label:i("validation.ocr.rawData.teamA")}),r.jsx(Ls,{team:t.teamB,label:i("validation.ocr.rawData.teamB")})]})]})}function Ls({team:t,label:e}){const{t:s}=B();return r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[r.jsxs("div",{className:"mb-2",children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:e}),r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"-"})]}),t.players.length>0&&r.jsxs("div",{className:"mb-3",children:[r.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[s("validation.ocr.rawData.players")," (",t.players.length,")"]}),r.jsx("div",{className:"mt-1 overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[r.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.shirtNumber")}),r.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.name")}),r.jsx("th",{scope:"col",className:"text-left font-medium",children:s("validation.ocr.rawData.licenseStatus")})]})}),r.jsx("tbody",{children:t.players.map(a=>r.jsxs("tr",{className:"text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("td",{className:"pr-2 py-0.5",children:a.shirtNumber??"-"}),r.jsx("td",{className:"pr-2 py-0.5 font-mono",children:a.rawName||a.displayName}),r.jsx("td",{className:"py-0.5",children:a.licenseStatus||"-"})]},`${a.shirtNumber}-${a.rawName||a.displayName}`))})]})})]}),t.officials.length>0&&r.jsxs("div",{children:[r.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[s("validation.ocr.rawData.officials")," (",t.officials.length,")"]}),r.jsx("div",{className:"mt-1 overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[r.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.role")}),r.jsx("th",{scope:"col",className:"text-left font-medium",children:s("validation.ocr.rawData.name")})]})}),r.jsx("tbody",{children:t.officials.map(a=>r.jsxs("tr",{className:"text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("td",{className:"pr-2 py-0.5",children:a.role}),r.jsx("td",{className:"py-0.5 font-mono",children:a.rawName||a.displayName})]},`${a.role}-${a.rawName||a.displayName}`))})]})})]})]})}function dc({imageUrl:t,ocrResult:e,parsedData:s}){const{t:a}=B(),n=m.useRef(null),[i,o]=m.useState(null),[c,d]=m.useState(0),[u,l]=m.useState(!0),h=m.useMemo(()=>{const p=new Set;return[...s.teamA.players,...s.teamB.players].forEach(y=>{y.rawName&&p.add(y.rawName.toLowerCase()),y.displayName&&p.add(y.displayName.toLowerCase()),y.lastName&&p.add(y.lastName.toLowerCase())}),[...s.teamA.officials,...s.teamB.officials].forEach(y=>{y.rawName&&p.add(y.rawName.toLowerCase()),y.displayName&&p.add(y.displayName.toLowerCase()),y.lastName&&p.add(y.lastName.toLowerCase())}),p},[s]),f=m.useCallback(p=>{const y=p.toLowerCase();return h.has(y)},[h]),x=m.useCallback(p=>{const y=p.currentTarget;o({width:y.naturalWidth,height:y.naturalHeight}),n.current&&d(n.current.offsetWidth)},[]),g=m.useMemo(()=>!i||c===0?1:c/i.width,[i,c]);return r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Vs,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:a("validation.ocr.rawData.imageOverlay")})]}),e.hasPreciseBoundingBoxes&&r.jsx("button",{type:"button",onClick:()=>l(!u),className:"text-xs px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:a(u?"validation.ocr.rawData.hideOverlay":"validation.ocr.rawData.showOverlay")})]}),e.hasPreciseBoundingBoxes&&r.jsxs("div",{className:"flex items-center gap-4 mb-2 text-xs",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-3 h-3 rounded border-2 border-success-500 bg-success-500/20"}),r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a("validation.ocr.rawData.matchedWords")})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-3 h-3 rounded border-2 border-gray-400 bg-gray-400/20"}),r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a("validation.ocr.rawData.otherWords")})]})]}),r.jsxs("div",{ref:n,className:"relative overflow-auto max-h-96 rounded border border-gray-200 dark:border-gray-700",children:[r.jsx("img",{src:t,alt:a("validation.ocr.rawData.capturedImage"),onLoad:x,className:"w-full h-auto"}),e.hasPreciseBoundingBoxes&&u&&i&&r.jsx("svg",{className:"absolute top-0 left-0 pointer-events-none",style:{width:i.width*g,height:i.height*g},viewBox:`0 0 ${i.width} ${i.height}`,preserveAspectRatio:"none",children:e.words.map(p=>{const y=f(p.text);return r.jsx("g",{children:r.jsx("rect",{x:p.bbox.x0,y:p.bbox.y0,width:p.bbox.x1-p.bbox.x0,height:p.bbox.y1-p.bbox.y0,fill:y?"rgba(34, 197, 94, 0.2)":"rgba(156, 163, 175, 0.15)",stroke:y?"#22c55e":"#9ca3af",strokeWidth:y?2:1,rx:2})},`${p.bbox.x0}-${p.bbox.y0}-${p.bbox.x1}-${p.bbox.y1}`)})})]}),r.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.words.length," ",a("validation.ocr.rawData.wordsDetected"),"  ",e.words.filter(p=>f(p.text)).length," ",a("validation.ocr.rawData.wordsMatched")]}),!e.hasPreciseBoundingBoxes&&e.fullText&&r.jsxs("div",{className:"mt-3",children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:a("validation.ocr.rawData.rawText")})}),r.jsx("pre",{className:"text-xs text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-900 p-3 rounded border border-gray-200 dark:border-gray-700 overflow-auto max-h-64 whitespace-pre-wrap break-words",children:e.fullText})]})]})}function Bs(t){if(!t)return[];const e=[];for(const s of t){const a=s.__identity,n=s.indoorPlayer?.person,i=n?.displayName??[n?.firstName,n?.lastName].filter(Boolean).join(" ");!a||!i||e.push({id:a,displayName:i,firstName:n?.firstName,lastName:n?.lastName})}return e.sort((s,a)=>s.displayName.localeCompare(a.displayName))}function Ds(t){if(!t)return[];const e=[],s=t.coachPerson;s?.__identity&&s.displayName&&e.push({id:s.__identity,displayName:s.displayName,firstName:s.firstName,lastName:s.lastName,role:"head"});const a=t.firstAssistantCoachPerson;a?.__identity&&a.displayName&&e.push({id:a.__identity,displayName:a.displayName,firstName:a.firstName,lastName:a.lastName,role:"firstAssistant"});const n=t.secondAssistantCoachPerson;return n?.__identity&&n.displayName&&e.push({id:n.__identity,displayName:n.displayName,firstName:n.firstName,lastName:n.lastName,role:"secondAssistant"}),e}function uc({assignment:t,isOpen:e,onClose:s}){const{t:a,tInterpolate:n}=B(),i=$e(M=>M.isOCREnabled),[o,c]=m.useState(null),d=t.__identity,u=o===d,l=Ur({assignment:t,isOpen:e,onClose:s}),{homeTeam:h,awayTeam:f}=pt(t),x="validate-game-title",g=`${h} ${a("common.vs")} ${f}`,p=m.useMemo(()=>Bs(l.homeNominationList?.indoorPlayerNominations),[l.homeNominationList]),y=m.useMemo(()=>Bs(l.awayNominationList?.indoorPlayerNominations),[l.awayNominationList]),R=m.useMemo(()=>Ds(l.homeNominationList),[l.homeNominationList]),S=m.useMemo(()=>Ds(l.awayNominationList),[l.awayNominationList]),j=m.useCallback(()=>{c(d)},[d]),C=m.useCallback(()=>{c(d)},[d]),w=m.useCallback(()=>{c(d)},[d]),b=e&&i&&!u&&!l.isLoadingGameDetails,N={isFirstStep:l.isFirstStep,isLastStep:l.isLastStep},k={isFinalizing:l.isFinalizing,isLoadingGameDetails:l.isLoadingGameDetails,hasGameDetailsError:!!l.gameDetailsError,canMarkCurrentStepDone:l.canMarkCurrentStepDone,allPreviousRequiredStepsDone:l.allPreviousRequiredStepsDone,currentStepIsOptional:l.currentStep.isOptional??!1},v={isLoading:l.isLoadingGameDetails,error:l.gameDetailsError},F={isValidated:l.isValidated,isInSafeMode:l.isInSafeMode,validatedInfo:l.validatedInfo,pendingScorer:l.pendingScorer,scoresheetNotRequired:l.scoresheetNotRequired,state:l.validationState,homeNominationList:l.homeNominationList,awayNominationList:l.awayNominationList},_={setHomeRosterModifications:l.setHomeRosterModifications,setAwayRosterModifications:l.setAwayRosterModifications,setScorer:l.setScorer,setScoresheet:l.setScoresheet,onAddPlayerSheetOpenChange:l.handleAddPlayerSheetOpenChange,onClose:s};return r.jsxs(r.Fragment,{children:[l.successToast&&r.jsx(In,{message:l.successToast}),r.jsxs(wt,{isOpen:e,onClose:l.attemptClose,titleId:x,size:"lg",isLoading:l.showUnsavedDialog||l.showRosterWarningDialog,children:[r.jsx(kt,{title:a("assignments.validateGame"),titleId:x,subtitle:g,onClose:l.attemptClose}),l.isValidated&&l.validatedInfo&&r.jsxs("div",{role:"status",className:"mb-4 p-3 bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 rounded-lg",children:[r.jsx("p",{className:"text-sm font-medium text-success-700 dark:text-success-400",children:a("validation.wizard.alreadyValidated")}),r.jsx("p",{className:"text-xs text-success-600 dark:text-success-500 mt-1",children:n("validation.wizard.validatedBy",{scorer:l.validatedInfo.scorerName})})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx(Kr,{steps:l.wizardSteps,currentStepIndex:l.currentStepIndex,stepsMarkedDone:l.stepsMarkedDone,clickable:!l.isFinalizing,onStepClick:l.goToStep}),r.jsx("p",{className:"text-center text-xs text-text-muted dark:text-text-muted-dark mt-2",children:n("validation.wizard.stepOf",{current:l.currentStepIndex+1,total:l.totalSteps})})]}),r.jsx(Vr,{currentStep:l.currentStepIndex,totalSteps:l.totalSteps,onSwipeNext:l.goNext,onSwipePrevious:l.goBack,swipeEnabled:l.isSwipeEnabled,children:r.jsx("div",{className:"max-h-80 overflow-y-auto",children:r.jsx(Mn,{currentStepId:l.currentStepId,assignment:t,loading:v,validation:F,handlers:_})})}),l.saveError&&r.jsxs("div",{role:"alert",className:"mt-4 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",children:[r.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:l.saveError}),r.jsxs("div",{className:"mt-2 flex gap-3",children:[r.jsx("button",{type:"button",onClick:()=>l.handleFinish(),className:"text-sm font-medium text-danger-600 dark:text-danger-400 hover:text-danger-700 dark:hover:text-danger-300",children:a("common.retry")}),r.jsx("button",{type:"button",onClick:l.handleDiscardAndClose,className:"text-sm font-medium text-text-muted dark:text-text-muted-dark hover:text-text-secondary dark:hover:text-text-secondary-dark",children:a("validation.state.discardAndClose")})]})]}),l.isSaving&&r.jsx("div",{className:"mt-4 text-center text-sm text-text-muted dark:text-text-muted-dark",children:a("validation.wizard.saving")}),r.jsx("div",{className:"flex justify-between gap-3 pt-4 border-t border-border-default dark:border-border-default-dark mt-4",children:l.isValidated?r.jsx(Tn,{navigation:N,onBack:l.goBack,onNext:l.goNext,onClose:s}):l.isInSafeMode?r.jsx(On,{navigation:N,onBack:l.goBack,onNext:l.goNext,onClose:s}):r.jsx(Pn,{navigation:N,state:k,onAttemptClose:l.attemptClose,onBack:l.goBack,onValidateAndNext:l.handleValidateAndNext,onFinish:l.handleFinish})})]}),r.jsx(An,{isOpen:l.showUnsavedDialog,onSaveAndClose:l.handleSaveAndClose,onDiscard:l.handleDiscardAndClose,onCancel:l.handleCancelClose,isSaving:l.isSaving}),r.jsx(En,{isOpen:l.showRosterWarningDialog,rosterValidation:l.rosterValidation,homeTeamName:h,awayTeamName:f,onGoBack:l.handleRosterWarningGoBack,onProceedAnyway:l.handleRosterWarningProceed,isProceedingAnyway:l.isFinalizing}),r.jsx(Rn,{isOpen:l.showSafeValidationComplete,onClose:l.handleSafeValidationCompleteClose}),r.jsx(lc,{isOpen:b,homeTeamName:h,awayTeamName:f,homeRosterPlayers:p,awayRosterPlayers:y,homeRosterCoaches:R,awayRosterCoaches:S,onSkip:j,onComplete:C,onClose:w})]})}const mc=m.memo(uc),Cc=Object.freeze(Object.defineProperty({__proto__:null,ValidateGameModal:mc},Symbol.toStringTag,{value:"Module"}));export{Ve as C,oi as O,Be as P,Cc as V,Ze as a,Le as c,Zo as u};
