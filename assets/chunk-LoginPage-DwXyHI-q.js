import{j as e,a as r}from"./chunk-state-CZJejFfH.js";import{c as re,u as A,e as ne,h as se,o as de,ak as le,ac as ie,b9 as oe,B as C,aj as ce,ba as ue}from"./index-Chtz2jaU.js";import{e as xe,v as me}from"./chunk-calendar-helpers-BxSzLMW3.js";import{u as he}from"./chunk-router-CqUdIx6-.js";const fe=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],M=re("refresh-cw",fe);function Y({errorMessage:i,showUpdateHint:l,updateAvailable:h,onUpdate:o,isUpdating:d,isCheckingForUpdate:f}){const{t:c}=A(),g=()=>{d||o()};return e.jsxs("div",{role:"alert",className:"rounded-lg border border-danger-200 bg-danger-50 p-3 dark:border-danger-800 dark:bg-danger-900/20",children:[e.jsx("p",{className:"text-sm text-danger-600 dark:text-danger-400",children:i}),l&&e.jsx("div",{className:"mt-3 border-t border-danger-200 pt-3 dark:border-danger-700",children:f?e.jsx("p",{className:"text-xs text-danger-500 dark:text-danger-400",children:c("settings.checking")}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-danger-500 dark:text-danger-400",children:c(h?"auth.loginFailedUpdateAvailable":"auth.loginFailedTryUpdate")}),e.jsxs("button",{type:"button",onClick:g,disabled:d,"aria-busy":d,className:"mt-2 inline-flex items-center gap-1.5 rounded-md bg-danger-100 px-3 py-1.5 text-xs font-medium text-danger-700 transition-colors hover:bg-danger-200 focus:outline-none focus:ring-2 focus:ring-danger-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-danger-800/50 dark:text-danger-300 dark:hover:bg-danger-800",children:[d&&e.jsx(M,{className:"h-3 w-3 animate-spin","aria-hidden":"true"}),c(d?"auth.updating":"auth.updateNow")]})]})})]})}function ge({onUpdate:i}){const[l,h]=r.useState(!1),{t:o}=A(),d=async()=>{if(!l){h(!0);try{await i()}finally{h(!1)}}};return e.jsxs("div",{role:"alert","aria-live":"assertive",className:"mb-6 rounded-lg border border-warning-300 bg-warning-50 p-4 dark:border-warning-700 dark:bg-warning-900/30",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{className:"mt-0.5 h-5 w-5 flex-shrink-0 text-warning-600 dark:text-warning-400","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-200",children:o("auth.updateRequired")}),e.jsx("p",{className:"mt-1 text-sm text-warning-700 dark:text-warning-300",children:o("auth.updateRequiredDescription")})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsxs("button",{type:"button",onClick:d,disabled:l,"aria-busy":l,className:"inline-flex items-center gap-2 rounded-md bg-warning-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-warning-700 focus:outline-none focus:ring-2 focus:ring-warning-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-warning-500 dark:hover:bg-warning-600",children:[l&&e.jsx(M,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}),o(l?"auth.updating":"auth.updateNow")]})})]})}const pe=1e3;function be(){const i=he(),{login:l,loginWithCalendar:h,status:o,error:d,lockedUntil:f,setDemoAuthenticated:c,clearStaleSession:g}=ne(se(t=>({login:t.login,loginWithCalendar:t.loginWithCalendar,status:t.status,error:t.error,lockedUntil:t.lockedUntil,setDemoAuthenticated:t.setDemoAuthenticated,clearStaleSession:t.clearStaleSession}))),V=de(t=>t.initializeDemoData),{t:a}=A(),{needRefresh:x,updateApp:S,checkForUpdate:_,isChecking:W}=le(),[k,O]=r.useState(!1),[y,P]=r.useState(!1),[u,H]=r.useState("calendar"),[T,G]=r.useState(""),[$,J]=r.useState(""),[v,b]=r.useState(null),[Q,q]=r.useState(!1),[j,E]=r.useState(null),w=r.useRef(null),L=r.useRef(null),R=r.useRef(null),p=r.useRef(!1),U=r.useRef(null),n=o==="loading"||Q,B=r.useCallback(()=>{V("SV"),c(),i("/")},[V,c,i]);r.useEffect(()=>()=>{U.current?.abort()},[]),r.useEffect(()=>{g();const t=()=>{document.visibilityState==="visible"&&g()},s=m=>{m.persisted&&g()};return document.addEventListener("visibilitychange",t),window.addEventListener("pageshow",s),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("pageshow",s)}},[g]),r.useEffect(()=>{if(!f||f<=0){E(null);return}E(f);const t=setInterval(()=>{E(s=>!s||s<=1?(clearInterval(t),null):s-1)},pe);return()=>clearInterval(t)},[f]),r.useEffect(()=>{const t=d||v;t&&!k&&!x&&(O(!0),_()),t||O(!1)},[d,v,k,x,_]);const z=r.useCallback(async()=>{if(!y){P(!0);try{await S()}finally{P(!1)}}},[y,S]),D=j!==null&&j>0;function X(t){J(t.target.value),v&&b(null)}async function Z(t){t.preventDefault(),t.stopPropagation(),await F()}async function F(){if(!(p.current||n)&&!(L.current&&!L.current.reportValidity())){p.current=!0;try{const t=w.current?.value||"";await l(T,t)&&(w.current&&(w.current.value=""),i("/"))}finally{p.current=!1}}}async function ee(t){t.preventDefault(),t.stopPropagation(),await I()}async function I(){if(p.current||n||R.current&&!R.current.reportValidity())return;const t=xe($);if(!t){b("auth.invalidCalendarCode");return}U.current?.abort();const s=new AbortController;U.current=s,p.current=!0,q(!0),b(null);try{const m=await me(t,s.signal);if(s.signal.aborted)return;if(!m.valid){b(m.error??"auth.calendarValidationFailed");return}await h(t),i("/")}catch(m){if(m instanceof Error&&m.name==="AbortError")return;b("auth.calendarValidationFailed")}finally{p.current=!1,s.signal.aborted||q(!1)}}function te(t){t.key==="Enter"&&!n&&(t.preventDefault(),F())}function ae(t){t.key==="Enter"&&!n&&(t.preventDefault(),I())}function K(t){return t===ue?a("auth.noRefereeRole"):t==="auth.invalidCalendarCode"?a("auth.invalidCalendarCode"):t==="auth.calendarNotFound"?a("auth.calendarNotFound"):t==="auth.calendarValidationFailed"?a("auth.calendarValidationFailed"):D&&j?`${a("auth.accountLocked")} - ${a("auth.lockoutRemainingTime")} ${j} ${a("auth.lockoutSeconds")}`:t}const N=u==="calendar"?v:d;return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-surface-page dark:bg-surface-page-dark px-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx(ie,{className:"mb-6"}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(oe,{className:"w-16 h-16 text-primary-600 dark:text-primary-400 mx-auto","aria-hidden":"true"}),e.jsx("h1",{className:"mt-4 text-3xl font-bold text-text-primary dark:text-text-primary-dark",children:"VolleyKit"}),e.jsx("p",{className:"mt-2 text-text-muted dark:text-text-muted-dark",children:a("auth.subtitle")})]}),x&&e.jsx(ge,{onUpdate:S}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex mb-6 bg-surface-subtle dark:bg-surface-subtle-dark rounded-lg p-1",role:"tablist","aria-label":"Login mode",children:[e.jsx("button",{type:"button",role:"tab","aria-selected":u==="calendar","aria-controls":"calendar-login-panel",id:"calendar-login-tab","data-testid":"calendar-login-tab",onClick:()=>H("calendar"),className:`flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors ${u==="calendar"?"bg-surface-card dark:bg-surface-card-dark text-text-primary dark:text-text-primary-dark shadow-sm":"text-text-muted dark:text-text-muted-dark hover:text-text-secondary dark:hover:text-text-secondary-dark"}`,children:a("auth.calendarMode")}),e.jsx("button",{type:"button",role:"tab","aria-selected":u==="full","aria-controls":"full-login-panel",id:"full-login-tab","data-testid":"full-login-tab",onClick:()=>H("full"),className:`flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors ${u==="full"?"bg-surface-card dark:bg-surface-card-dark text-text-primary dark:text-text-primary-dark shadow-sm":"text-text-muted dark:text-text-muted-dark hover:text-text-secondary dark:hover:text-text-secondary-dark"}`,children:a("auth.fullLogin")})]}),u==="full"&&e.jsx("div",{id:"full-login-panel",role:"tabpanel","aria-labelledby":"full-login-tab",children:e.jsxs("form",{ref:L,onSubmit:Z,method:"post",action:"https://volleymanager.volleyball.ch",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-text-secondary dark:text-text-secondary-dark mb-2",children:a("auth.username")}),e.jsx("input",{id:"username",name:"username","data-testid":"username-input",type:"text",value:T,onChange:t=>G(t.target.value),autoComplete:"username",required:!0,disabled:n,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-text-secondary dark:text-text-secondary-dark mb-2",children:a("auth.password")}),e.jsx("input",{id:"password",name:"password","data-testid":"password-input",type:"password",ref:w,autoComplete:"current-password",required:!0,disabled:n,onKeyDown:te,className:"input"})]}),N&&e.jsx(Y,{errorMessage:K(N),showUpdateHint:k&&!D,updateAvailable:x,onUpdate:z,isUpdating:y,isCheckingForUpdate:W}),e.jsx(C,{type:"button",variant:"primary",fullWidth:!0,loading:n,disabled:D||x,onClick:F,"data-testid":"login-button",children:a(n?"auth.loggingIn":"auth.loginButton")}),e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-border-strong dark:border-border-strong-dark"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"bg-surface-card dark:bg-surface-card-dark px-2 text-text-muted dark:text-text-muted-dark",children:a("auth.or")})})]}),e.jsx(C,{variant:"secondary",onClick:B,disabled:n,fullWidth:!0,"data-testid":"demo-button",children:a("auth.demoMode")})]})}),u==="calendar"&&e.jsx("div",{id:"calendar-login-panel",role:"tabpanel","aria-labelledby":"calendar-login-tab",children:e.jsxs("form",{ref:R,onSubmit:ee,method:"post",className:"space-y-6",children:[e.jsx("div",{className:"p-3 rounded-lg bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800",children:e.jsx("p",{className:"text-sm text-primary-700 dark:text-primary-300",children:a("auth.calendarModeInfo")})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"calendar-input",className:"block text-sm font-medium text-text-secondary dark:text-text-secondary-dark mb-2",children:a("auth.calendarInputLabel")}),e.jsx("input",{id:"calendar-input","data-testid":"calendar-input",type:"text",value:$,onChange:X,placeholder:a("auth.calendarInputPlaceholder"),required:!0,disabled:n,onKeyDown:ae,className:"input"}),e.jsx("p",{className:"mt-2 text-xs text-text-muted dark:text-text-muted-dark",children:a("auth.calendarModeHint")})]}),N&&e.jsx(Y,{errorMessage:K(N),showUpdateHint:k,updateAvailable:x,onUpdate:z,isUpdating:y,isCheckingForUpdate:W}),e.jsx(C,{type:"button",variant:"primary",fullWidth:!0,loading:n,disabled:x,onClick:I,"data-testid":"calendar-login-button",children:a(n?"auth.enteringCalendarMode":"auth.enterCalendarMode")}),e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-border-strong dark:border-border-strong-dark"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"bg-surface-card dark:bg-surface-card-dark px-2 text-text-muted dark:text-text-muted-dark",children:a("auth.or")})})]}),e.jsx(C,{variant:"secondary",onClick:B,disabled:n,fullWidth:!0,"data-testid":"demo-button",children:a("auth.demoMode")})]})})]}),e.jsx("p",{className:"mt-6 text-center text-xs text-text-subtle dark:text-text-subtle-dark",children:u==="full"?e.jsxs(e.Fragment,{children:[a("auth.loginInfo"),e.jsx("br",{}),a("auth.privacyNote")]}):a("auth.calendarModeInfo")}),e.jsx("p",{className:"mt-4 text-center",children:e.jsxs("a",{href:ce(),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-text-muted dark:text-text-muted-dark hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[a("auth.learnHowItWorks")," â†’"]})})]})})}const we=Object.freeze(Object.defineProperty({__proto__:null,LoginPage:be},Symbol.toStringTag,{value:"Module"}));export{we as L,M as R};
