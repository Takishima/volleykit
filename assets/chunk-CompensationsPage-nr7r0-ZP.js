const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-EditCompensationModal-e_cAfEL8.js","assets/chunk-state-CZJejFfH.js","assets/index-CfFSvfQz.js","assets/chunk-router-CqUdIx6-.js","assets/chunk-validation-Cdg1t4SS.js","assets/index-KyjH_G7Q.css","assets/chunk-ModalErrorBoundary-MREtD_xN.js","assets/chunk-useCompensations-CXZPnRo8.js","assets/chunk-PdfLanguageModal-8DMl31xp.js"])))=>i.map(i=>d[i]);
import{z as M,u as E,E as O,F as D,G as B,I as H,J as _,K as U,e as W,h as z,N as K,O as $,P as q,Q as A,R as J,T as Q,_ as V}from"./index-CfFSvfQz.js";import{a as i,j as e}from"./chunk-state-CZJejFfH.js";import{T as Y}from"./chunk-compensations-BxlPJvCO.js";import{g as X,E as Z,M as ee,F as te,u as se,a as ne,b as ae,P as oe,T as ie,c as re,W as ce,S as de}from"./chunk-ModalErrorBoundary-MREtD_xN.js";import{i as R,d as le,c as me}from"./chunk-PdfLanguageModal-8DMl31xp.js";import{u as xe}from"./chunk-useCompensations-CXZPnRo8.js";import"./chunk-router-CqUdIx6-.js";import"./chunk-validation-Cdg1t4SS.js";function ue(t,d){const s=+M(t)-+M(d);return s<0?-1:s>0?1:s}function pe(t,d){const s=+M(t)-+M(d);return s>0?-1:s<0?1:s}function ge({compensation:t,onClick:d,disableExpansion:s,dataTour:r}){const{t:n}=E(),w=O(),c=t.refereeGame?.game,a=t.convocationCompensation,u=c?.startingDateTime?D(c.startingDateTime):null,h=c?.encounter?.teamHome?.name||n("common.unknown"),y=c?.encounter?.teamAway?.name||n("common.unknown"),b=c?.number,k=c?.group?.phase?.league?.gender,j=c?.group?.phase?.league?.leagueCategory?.name,p=X(t.refereePosition,n),C=(a?.gameCompensation||0)+(a?.travelExpenses||0),l=a?.paymentDone,P=!R(t)&&!l;return e.jsx(Z,{data:t,onClick:d,disableExpansion:s,dataTour:r,renderCompact:(S,{expandArrow:F})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-text-muted dark:text-text-muted-dark min-w-[4rem]",children:[e.jsx("div",{children:u?_(u,"MMM d",{locale:w}):n("common.unknownDate")}),u&&e.jsx("div",{className:"text-text-subtle dark:text-text-subtle-dark",children:_(u,"HH:mm")}),b&&e.jsxs("div",{className:"text-text-subtle dark:text-text-subtle-dark",children:["#",b]})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate text-sm flex items-center gap-1",children:[e.jsxs("span",{className:"truncate",children:[h," ",n("common.vs")," ",y]}),k==="m"&&e.jsx(ee,{className:"w-3 h-3 flex-shrink-0 text-blue-500 dark:text-blue-400","aria-label":n("common.men")}),k==="f"&&e.jsx(te,{className:"w-3 h-3 flex-shrink-0 text-pink-500 dark:text-pink-400","aria-label":n("common.women")})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm font-bold ${l?"text-success-500 dark:text-success-400":"text-warning-500 dark:text-warning-400"}`,children:C.toFixed(0)}),F]})]}),renderDetails:()=>a&&e.jsxs("div",{className:"px-2 pb-2 pt-0 border-t border-border-subtle dark:border-border-subtle-dark space-y-1 text-sm",children:[e.jsxs("div",{className:"pt-2 pb-1 border-b border-border-subtle dark:border-border-subtle-dark",children:[e.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark",children:h}),e.jsxs("div",{className:"text-text-secondary dark:text-text-muted-dark",children:[n("common.vs")," ",y]}),(j||p)&&e.jsxs("div",{className:"text-xs text-text-subtle dark:text-text-subtle-dark mt-1 flex items-center gap-1",children:[j&&e.jsx("span",{children:j}),j&&p&&e.jsx("span",{children:"â€¢"}),p&&e.jsx("span",{children:p})]})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsxs("span",{className:"text-text-muted dark:text-text-muted-dark",children:[n("compensations.total"),":"]}),e.jsxs("span",{className:`font-bold ${l?"text-success-500 dark:text-success-400":"text-warning-500 dark:text-warning-400"}`,children:[n("common.currencyChf")," ",C.toFixed(2)]})]}),a.gameCompensation!==void 0&&a.gameCompensation>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[n("compensations.gameFee"),":"]}),e.jsxs("span",{className:"text-text-secondary dark:text-text-muted-dark",children:[n("common.currencyChf")," ",a.gameCompensation.toFixed(2)]})]}),a.travelExpenses!==void 0&&a.travelExpenses>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[n("compensations.travel"),":"]}),e.jsxs("span",{className:"text-text-secondary dark:text-text-muted-dark",children:[n("common.currencyChf")," ",a.travelExpenses.toFixed(2)]})]}),a.distanceInMetres!==void 0&&a.distanceInMetres>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[n("compensations.distance"),":"]}),e.jsxs("span",{className:"text-text-secondary dark:text-text-muted-dark",children:[B(a.distanceInMetres)," ",n("common.distanceUnit")]})]}),e.jsxs("div",{className:"flex justify-between text-xs pt-1",children:[e.jsxs("span",{className:"text-text-subtle dark:text-text-subtle-dark",children:[n("compensations.status"),":"]}),e.jsx("span",{className:l?"text-success-500 dark:text-success-400":"text-warning-500 dark:text-warning-400",children:n(l?"compensations.paid":"compensations.pending")})]}),P&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs pt-2 text-text-muted dark:text-text-muted-dark",children:[e.jsx(H,{className:"w-3 h-3 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{children:n("compensations.editingRestrictedByRegion")})]})]})})}const fe=i.memo(ge);function he(){const{t}=E(),{guard:d,isDemoMode:s}=se(),r=ne(),n=ae(async(a,u)=>{u.debug("Generating PDF for:",a.__identity),await le(a.__identity),u.debug("PDF downloaded successfully:",a.__identity)},{logContext:"useCompensationActions",errorMessage:"compensations.pdfDownloadFailed"}),w=i.useCallback(a=>{d({context:"useCompensationActions",action:"editing compensation"})||r.open(a)},[d,r]),c=i.useCallback(async a=>{if(s){U.info(t("compensations.pdfNotAvailableDemo"));return}await n.execute(a)},[s,t,n]);return{editCompensationModal:{isOpen:r.isOpen,compensation:r.data,open:w,close:r.close},handleGeneratePDF:c}}const be=i.lazy(()=>V(()=>import("./chunk-EditCompensationModal-e_cAfEL8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(t=>({default:t.EditCompensationModal})));function ke(t){switch(t){case"closed":return!0;case"pendingPast":case"pendingFuture":return!1}}function je(t){return t!=="pendingFuture"}function Fe(){const[t,d]=i.useState("pendingPast"),{t:s}=E(),{editCompensationModal:r,handleGeneratePDF:n}=he(),{isAssociationSwitching:w,isCalendarMode:c}=W(z(o=>({isAssociationSwitching:o.isAssociationSwitching,isCalendarMode:o.isCalendarMode()}))),{showDummyData:a}=K("compensations"),u=i.useMemo(()=>ke(t),[t]),{data:h,isLoading:y,error:b,refetch:k}=xe(u),j=w||y,p=i.useMemo(()=>$(),[]),C=i.useMemo(()=>new Date,[]),l=i.useMemo(()=>{if(a)return[Y];if(!h)return h;const o=h.filter(m=>{const f=m.refereeGame?.game?.startingDateTime;if(!f)return!0;const x=D(f);return!(x<p.from||x>p.to||t==="pendingPast"&&x>C||t==="pendingFuture"&&x<=C)}),N=je(t)?pe:ue;return[...o].sort((m,f)=>{const x=m.refereeGame?.game?.startingDateTime,T=f.refereeGame?.game?.startingDateTime;return!x&&!T?0:x?T?N(D(x),D(T)):-1:1})},[a,h,t,p,C]),v=i.useMemo(()=>!l||l.length===0?[]:q(l,o=>o.refereeGame?.game?.startingDateTime),[l]),P=[{id:"pendingPast",label:s("compensations.pendingPast")},{id:"pendingFuture",label:s("compensations.pendingFuture")},{id:"closed",label:s("compensations.closed")}],S=i.useCallback(o=>{d(o)},[]),F=i.useCallback(o=>{const g=me(o,{onEditCompensation:r.open,onGeneratePDF:n});return{left:R(o)?[g.editCompensation,g.generatePDF]:[g.generatePDF]}},[r.open,n]),G=i.useCallback(async()=>{await k()},[k]),I=()=>{switch(t){case"pendingPast":return{title:s("compensations.noPendingPastTitle"),description:s("compensations.noPendingPastDescription")};case"pendingFuture":return{title:s("compensations.noPendingFutureTitle"),description:s("compensations.noPendingFutureDescription")};case"closed":return{title:s("compensations.noClosedTitle"),description:s("compensations.noClosedDescription")}}},L=()=>{if(j&&!a)return e.jsx(J,{message:s("compensations.loading")});if(b)return e.jsx(Q,{message:b instanceof Error?b.message:s("compensations.errorLoading"),onRetry:()=>k()});if(v.length===0){const{title:o,description:g}=I();return e.jsx(A,{icon:"wallet",title:o,description:g})}return e.jsx("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:v.map((o,g)=>{const N=v.slice(0,g).reduce((m,f)=>m+f.items.length,0);return e.jsxs(i.Fragment,{children:[v.length>1&&e.jsx(ce,{week:o.week}),o.items.map((m,f)=>e.jsx(de,{swipeConfig:F(m),children:({isDrawerOpen:x})=>e.jsx(fe,{compensation:m,disableExpansion:x,dataTour:N+f===0?"compensation-card":void 0})},m.__identity))]},o.week.key)})})};return c?e.jsx("div",{className:"space-y-3",children:e.jsx(A,{icon:"wallet",title:s("compensations.unavailableInCalendarModeTitle"),description:s("compensations.unavailableInCalendarModeDescription")})}):e.jsx(oe,{onRefresh:G,children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(ie,{tabs:P,activeTab:t,onTabChange:S,ariaLabel:s("compensations.title")}),e.jsx(re,{tabId:t,activeTab:t,children:L()}),r.compensation&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(be,{isOpen:r.isOpen,onClose:r.close,compensation:r.compensation})})]})})}export{Fe as CompensationsPage};
