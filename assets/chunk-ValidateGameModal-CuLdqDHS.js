import{a as m,u as Fs,b as ht,j as a}from"./chunk-state-CZJejFfH.js";import{l as Jr,C as He,d as ft,f as ea}from"./chunk-ModalErrorBoundary-CVUa1eGT.js";import{c as G,l as q,e as Se,p as pt,q as be,A as xt,u as B,a3 as $s,an as gt,o as ta,a_ as sa,a$ as ra,ad as me,U as Re,b0 as yt,b1 as zs,b2 as Hs,b3 as bt,b4 as aa,b5 as na,b6 as Bt,b7 as Dt,B as Z,M as Nt,a as wt,b as Us}from"./index-DShG9lOl.js";import"./chunk-router-CqUdIx6-.js";import{R as Ws,U as ia}from"./chunk-ExchangePage-CdR5D5T1.js";import{u as vt,I as oa}from"./chunk-useDebouncedValue-CXkpADur.js";import{B as la}from"./chunk-useTravelTime-3K7nXw5h.js";import{C as _e}from"./chunk-AssignmentsPage-D5Mvv1gA.js";import{R as Vs}from"./chunk-LoginPage-CSI0bR8g.js";import{F as qe}from"./chunk-PdfLanguageModal-Cn6K3f0r.js";import{C as ca}from"./chunk-cropper-l1UCu5Q8.js";import"./chunk-validation-Cdg1t4SS.js";import"./chunk-ojp-client-BsgnYdl9.js";import"./chunk-pdf-form-filler-Ca-lmKkD.js";import"./chunk-assignments-DBz14qIH.js";import"./chunk-SafeModeWarningModal-DWD1GYxt.js";import"./chunk-calendar-helpers-BxNquy6J.js";const da=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],kt=G("camera",da);const ua=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Gs=G("chevron-right",ua);const ma=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ct=G("chevron-up",ma);const ha=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ye=G("circle-check-big",ha);const fa=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],pa=G("circle-x",fa);const xa=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ks=G("image",xa);const ga=[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]],ya=G("party-popper",ga);const ba=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Na=G("pen-tool",ba);const wa=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],va=G("plus",wa);const ka=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ca=G("rotate-ccw",ka);const Aa=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Sa=G("rotate-cw",Aa);const Ea=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],ja=G("skip-forward",Ea);const Ra=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],_a=G("stethoscope",Ra);const Ia=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Ma=G("trash-2",Ia);const Ta=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Oa=G("undo-2",Ta);const Pa=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ft=G("upload",Pa);const La=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Xs=G("user-plus",La);function $t(){return{homeRoster:{reviewed:!1,playerModifications:{added:[],removed:[]},coachModifications:{added:new Map,removed:new Set}},awayRoster:{reviewed:!1,playerModifications:{added:[],removed:[]},coachModifications:{added:new Map,removed:new Set}},scorer:{selected:null},scoresheet:{file:null,uploaded:!1}}}function Ze(t){return t.added.length>0||t.removed.length>0}function qs(t,e){const s=t.indoorPlayerNominations?.map(o=>o.__identity).filter(o=>!!o)??[],r=new Set(e.removed),n=s.filter(o=>!r.has(o)),i=e.added.map(o=>o.id);return[...n,...i]}function Ys(t){return t.added.size>0||t.removed.size>0}function Zs(t,e){if(!Ys(e))return;const s={},r={head:"coachPerson",firstAssistant:"firstAssistantCoachPerson",secondAssistant:"secondAssistantCoachPerson"};for(const n of["head","firstAssistant","secondAssistant"]){const i=e.added.get(n);if(i){s[n]=i.id;continue}if(e.removed.has(n)){s[n]="";continue}const o=t[r[n]]?.__identity;o&&(s[n]=o)}return s}async function zt(t,e,s,r,n){const i=Ze(r),o=n?Ys(n):!1;if(!i&&!o){q.debug("[VS] skip roster save: no modifications");return}if(!s?.__identity||!s.team?.__identity){q.debug("[VS] skip roster save: missing nomination list or team ID");return}const c=qs(s,r),d=n?Zs(s,n):void 0;await t.updateNominationList(s.__identity,e,s.team.__identity,c,d)}async function Ba(t,e,s,r,n){if(!r||!s?.__identity){q.debug("[VS] skip scorer save: no scorer or scoresheet ID");return}await t.updateScoresheet(s.__identity,e,r,s.isSimpleScoresheet??!1,n)}async function Ht(t,e,s,r,n){if(!s?.__identity||!s.team?.__identity){q.debug("[VS] skip roster finalize: missing nomination list or team ID");return}const i=qs(s,r),o=n?Zs(s,n):void 0;await t.finalizeNominationList(s.__identity,e,s.team.__identity,i,s.nominationListValidation?.__identity,o)}async function Da(t,e,s,r,n){if(!r||!s?.__identity){q.debug("[VS] skip scoresheet finalize: no scorer or scoresheet ID");return}await t.finalizeScoresheet(s.__identity,e,r,n,s.scoresheetValidation?.__identity,s.isSimpleScoresheet??!1)}function Fa(t){const[e,s]=m.useState($t),[r,n]=m.useState(!1),[i,o]=m.useState(!1),c=m.useRef(!1),d=m.useRef(!1),u=m.useRef(void 0),l=Se(S=>S.dataSource),h=pt(l),f=Fs(),x=ht({queryKey:be.validation.gameDetail(t??""),queryFn:async()=>t?h.getGameWithScoresheet(t):null,enabled:!!t,staleTime:xt}),g=m.useMemo(()=>({homeRoster:e.homeRoster.reviewed,awayRoster:e.awayRoster.reviewed,scorer:e.scorer.selected!==null,scoresheet:!0}),[e.homeRoster.reviewed,e.awayRoster.reviewed,e.scorer.selected]),p=m.useMemo(()=>g.homeRoster&&g.awayRoster&&g.scorer,[g]),y=m.useMemo(()=>!!x.data?.scoresheet?.closedAt,[x.data]),R=m.useMemo(()=>{const S=x.data?.scoresheet;if(!S?.closedAt)return null;const L=S.writerPerson;return{validatedAt:S.closedAt,scorerName:L?.displayName??"Unknown",scorerBirthday:L?.birthday,hasScoresheet:!!S.hasFile}},[x.data]),E=m.useMemo(()=>{if(y)return null;const S=x.data?.scoresheet?.writerPerson;return S?.__identity?{__identity:S.__identity,displayName:S.displayName??"Unknown",birthday:S.birthday}:null},[x.data,y]),j=m.useMemo(()=>x.data?.group?.hasNoScoresheet??!1,[x.data]),A=m.useMemo(()=>x.data?.nominationListOfTeamHome??null,[x.data?.nominationListOfTeamHome]),N=m.useMemo(()=>x.data?.nominationListOfTeamAway??null,[x.data?.nominationListOfTeamAway]),w=m.useMemo(()=>Ze(e.homeRoster.playerModifications)||Ze(e.awayRoster.playerModifications)||e.homeRoster.coachModifications.added.size>0||e.homeRoster.coachModifications.removed.size>0||e.awayRoster.coachModifications.added.size>0||e.awayRoster.coachModifications.removed.size>0||e.scorer.selected!==null||e.scoresheet.file!==null,[e]),b=m.useCallback(S=>{s(L=>({...L,homeRoster:{...L.homeRoster,playerModifications:S.players,coachModifications:S.coaches,reviewed:!0}}))},[]),v=m.useCallback(S=>{s(L=>({...L,awayRoster:{...L.awayRoster,playerModifications:S.players,coachModifications:S.coaches,reviewed:!0}}))},[]),k=m.useCallback(S=>{s(L=>({...L,scorer:{selected:S}}))},[]),F=m.useCallback((S,L)=>{s(V=>({...V,scoresheet:{file:S,uploaded:L}}))},[]),_=m.useCallback(()=>{s($t())},[]),I=m.useCallback(async()=>{if(c.current){q.debug("[VS] save skip: in progress");return}c.current=!0,n(!0);try{const S=x.data;if(!t||!S){q.warn("[VS] no game data for save");return}let L=u.current;!L&&e.scoresheet.file&&(L=(await h.uploadResource(e.scoresheet.file))[0]?.__identity,u.current=L,q.debug("[VS] PDF uploaded:",L)),await zt(h,t,S.nominationListOfTeamHome,e.homeRoster.playerModifications,e.homeRoster.coachModifications),await zt(h,t,S.nominationListOfTeamAway,e.awayRoster.playerModifications,e.awayRoster.coachModifications),await Ba(h,t,S.scoresheet,e.scorer.selected?.__identity,L),await f.invalidateQueries({queryKey:be.validation.gameDetail(t)}),q.debug("[VS] save done")}catch(S){throw q.error("[VS] save failed:",S),S}finally{c.current=!1,n(!1)}},[t,x.data,e,h,f]),$=m.useCallback(async()=>{if(d.current){q.debug("[VS] finalize skip: in progress");return}d.current=!0,o(!0);try{const S=x.data;if(!t||!S){q.warn("[VS] no game data for finalize");return}let L=u.current;!L&&e.scoresheet.file&&(L=(await h.uploadResource(e.scoresheet.file))[0]?.__identity,u.current=L,q.debug("[VS] PDF uploaded:",L)),await Ht(h,t,S.nominationListOfTeamHome,e.homeRoster.playerModifications,e.homeRoster.coachModifications),await Ht(h,t,S.nominationListOfTeamAway,e.awayRoster.playerModifications,e.awayRoster.coachModifications),await Da(h,t,S.scoresheet,e.scorer.selected?.__identity,L),await f.invalidateQueries({queryKey:be.validation.gameDetail(t)}),q.debug("[VS] finalize done")}catch(S){throw q.error("[VS] finalize failed:",S),S}finally{d.current=!1,o(!1)}},[t,x.data,e,h,f]);return{state:e,isDirty:w,completionStatus:g,isAllRequiredComplete:p,isValidated:y,validatedInfo:R,pendingScorer:E,scoresheetNotRequired:j,setHomeRosterModifications:b,setAwayRosterModifications:v,setScorer:k,setScoresheet:F,reset:_,saveProgress:I,finalizeValidation:$,isSaving:r,isFinalizing:i,isLoadingGameDetails:x.isLoading,gameDetailsError:x.error,homeNominationList:A,awayNominationList:N}}const Qe=6;function Ut(t,e,s){if(!t)return{isValid:!0,playerCount:0,hasHeadCoach:!0,hasMinPlayers:!0};const r=t.indoorPlayerNominations?.length??0,n=e.added.length,i=e.removed.length,o=r+n-i,c=!!t.coachPerson,d=s.removed.has("head"),l=s.added.has("head")||c&&!d,h=o>=Qe;return{isValid:l&&h,playerCount:o,hasHeadCoach:l,hasMinPlayers:h}}function $a(t,e,s,r,n,i){const o=Ut(t,e,s),c=Ut(r,n,i);return{home:o,away:c,allValid:o.isValid&&c.isValid}}function za({steps:t,initialStepIndex:e=0,onStepChange:s}){if(t.length===0)throw new Error("useWizardNavigation: steps array cannot be empty");const r=Math.max(0,Math.min(e,t.length-1)),[n,i]=m.useState(r),[o,c]=m.useState(()=>new Set),d=t.length,u=n===0,l=n===d-1,h=!l,f=!u,x=m.useMemo(()=>{const A=t[n];if(!A)throw new Error(`useWizardNavigation: step at index ${n} not found`);return A},[t,n]),g=m.useCallback(A=>{const N=Math.max(0,Math.min(A,t.length-1));N!==n&&(s?.(n,N),i(N))},[n,t.length,s]),p=m.useCallback((A,N)=>{c(w=>{if(N&&w.has(A)||!N&&!w.has(A))return w;const b=new Set(w);return N?b.add(A):b.delete(A),b})},[]),y=m.useCallback(()=>{h&&g(n+1)},[h,n,g]),R=m.useCallback(()=>{f&&g(n-1)},[f,n,g]),E=m.useCallback(()=>{i(0),c(new Set)},[]),j=m.useMemo(()=>{for(let A=0;A<t.length;A++)if(!t[A]?.isOptional&&!o.has(A))return!1;return!0},[t,o]);return{currentStepIndex:n,currentStep:x,totalSteps:d,isFirstStep:u,isLastStep:l,goNext:y,goBack:R,goToStep:g,resetToStart:E,canGoNext:h,canGoBack:f,stepsMarkedDone:o,setStepDone:p,allRequiredStepsDone:j}}const Ha=3e3;function Ua({assignment:t,isOpen:e,onClose:s}){const{t:r}=B(),[n,i]=m.useState(!1),[o,c]=m.useState(!1),[d,u]=m.useState(!1),[l,h]=m.useState(null),[f,x]=m.useState(null),[g,p]=m.useState(!1),y=Se(U=>U.dataSource),R=$s(U=>U.isSafeModeEnabled),E=y!=="demo"&&R,j=Fs(),A=t.refereeGame?.game?.__identity,{state:N,isDirty:w,completionStatus:b,isValidated:v,validatedInfo:k,pendingScorer:F,scoresheetNotRequired:_,setHomeRosterModifications:I,setAwayRosterModifications:$,setScorer:S,setScoresheet:L,reset:V,saveProgress:K,finalizeValidation:le,isSaving:ie,isFinalizing:fe,isLoadingGameDetails:ce,gameDetailsError:ge,homeNominationList:ee,awayNominationList:re}=Fa(A),de=t.refereeGame?.game?.scoresheet?.closedAt,te=v||!!de,Y=k??(de?{validatedAt:de,scorerName:"â€”",scorerBirthday:void 0,hasScoresheet:!1}:null),W=m.useMemo(()=>$a(ee,N.homeRoster.playerModifications,N.homeRoster.coachModifications,re,N.awayRoster.playerModifications,N.awayRoster.coachModifications),[ee,re,N.homeRoster.playerModifications,N.homeRoster.coachModifications,N.awayRoster.playerModifications,N.awayRoster.coachModifications]),T=m.useMemo(()=>[{id:"home-roster",label:r("validation.homeRoster"),isInvalid:!W.home.isValid},{id:"away-roster",label:r("validation.awayRoster"),isInvalid:!W.away.isValid},{id:"scorer",label:r("validation.scorer")},{id:"scoresheet",label:r("validation.scoresheet"),isOptional:!0}],[r,W.home.isValid,W.away.isValid]),{currentStepIndex:D,currentStep:z,totalSteps:C,isFirstStep:O,isLastStep:P,goNext:H,goBack:X,goToStep:se,resetToStart:J,stepsMarkedDone:Ue,setStepDone:ye}=za({steps:T}),Pt=m.useRef(w),We=m.useRef(!1),Me=m.useRef(null);m.useEffect(()=>{Pt.current=w},[w]),m.useEffect(()=>()=>{Me.current&&(clearTimeout(Me.current),Me.current=null)},[]),m.useEffect(()=>{e&&(A&&j.invalidateQueries({queryKey:be.validation.gameDetail(A)}),h(null),x(null),c(!1),u(!1),V(),J())},[e,V,J,A,j]);const Ee=m.useMemo(()=>T[D]?.id==="scorer"?b.scorer:!0,[D,T,b.scorer]),Ve=m.useMemo(()=>{for(let U=0;U<D;U++)if(!T[U]?.isOptional&&!Ue.has(U))return!1;return!0},[T,D,Ue]),Hr=!fe&&!ce&&!g,Ur=m.useCallback(()=>{te?s():Pt.current?i(!0):s()},[s,te]),Te=m.useCallback(async()=>{We.current=!0,h(null);try{E?(await K(),u(!0)):(await le(),x(r("validation.state.saveSuccess")),Me.current=setTimeout(()=>{x(null)},Ha),s())}catch(U){const Lt=U instanceof Error?U.message:r("validation.state.saveError");h(Lt)}finally{We.current=!1}},[E,K,le,r,s]),Wr=m.useCallback(async()=>{if(We.current)return;const U=T[T.length-1];if(!(!U?.isOptional&&!Ee)&&Ve){if(!W.allValid){c(!0);return}U?.isOptional||ye(D,!0),await Te()}},[T,Ee,Ve,W.allValid,D,ye,Te]),Vr=m.useCallback(async()=>{try{await K(),i(!1),s()}catch(U){q.error("[ValidateGameModal] Save failed during close:",U),h(r("validation.state.saveError")),i(!1)}},[K,s,r]),Gr=m.useCallback(()=>{i(!1),V(),s()},[V,s]),Kr=m.useCallback(()=>{i(!1)},[]),Xr=m.useCallback(()=>{Ee&&(ye(D,!0),H())},[Ee,ye,D,H]),qr=m.useCallback(U=>{p(U)},[]),Yr=m.useCallback(()=>{c(!1),W.home.isValid?W.away.isValid||se(1):se(0)},[W.home.isValid,W.away.isValid,se]),Zr=m.useCallback(async()=>{c(!1),T[T.length-1]?.isOptional||ye(D,!0),await Te()},[T,D,ye,Te]),Qr=m.useCallback(()=>{u(!1),s()},[s]);return{currentStepIndex:D,currentStepId:z.id,currentStep:z,totalSteps:C,isFirstStep:O,isLastStep:P,stepsMarkedDone:Ue,goToStep:se,wizardSteps:T,validationState:N,isDirty:w,completionStatus:b,isValidated:te,validatedInfo:Y,pendingScorer:F,scoresheetNotRequired:_,setHomeRosterModifications:I,setAwayRosterModifications:$,setScorer:S,setScoresheet:L,isSaving:ie,isFinalizing:fe,isLoadingGameDetails:ce,gameDetailsError:ge,homeNominationList:ee,awayNominationList:re,showUnsavedDialog:n,showRosterWarningDialog:o,showSafeValidationComplete:d,saveError:l,successToast:f,isAddPlayerSheetOpen:g,rosterValidation:W,canMarkCurrentStepDone:Ee,allPreviousRequiredStepsDone:Ve,isSwipeEnabled:Hr,attemptClose:Ur,handleFinish:Wr,handleSaveAndClose:Vr,handleDiscardAndClose:Gr,handleCancelClose:Kr,goNext:H,handleValidateAndNext:Xr,goBack:X,handleAddPlayerSheetOpenChange:qr,handleRosterWarningGoBack:Yr,handleRosterWarningProceed:Zr,handleSafeValidationCompleteClose:Qr}}const Wa=.3,Oe=300;function Va({currentStep:t,totalSteps:e,onSwipeNext:s,onSwipePrevious:r,swipeEnabled:n=!0,children:i}){const[o,c]=m.useState("idle"),[d,u]=m.useState(!1),l=m.useRef(t),h=m.useRef(null),f=t<e-1,x=t>0,g=m.useCallback((w,b,v)=>{u(!0),v(w?b:-b),requestAnimationFrame(()=>{requestAnimationFrame(()=>{u(!1),c("entering"),v(0)})}),h.current=setTimeout(()=>{c("idle"),h.current=null},Oe)},[]),{containerRef:p,translateX:y,isDragging:R,containerWidth:E,setTranslateX:j,handlers:A}=Jr({enabled:n,maxSwipeMultiplier:1.5,canSwipe:(w,b)=>!(b==="left"&&!f||b==="right"&&!x),onDragEnd:(w,b)=>{const v=Math.abs(w),k=w<0,F=k&&f||!k&&x,_=b*Wa;return v>_&&F?(c("exiting"),j(k?-b:b),h.current=setTimeout(()=>{p.current&&(l.current+=k?1:-1,k?s?.():r?.(),g(k,b,j))},Oe),!0):!1}});m.useEffect(()=>()=>{h.current&&(clearTimeout(h.current),h.current=null)},[]),m.useLayoutEffect(()=>{if(t!==l.current&&E){const w=t>l.current;if(l.current=t,o==="idle"){j(w?E:-E),c("entering"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{j(0)})});const b=setTimeout(()=>{c("idle"),h.current=null},Oe);return h.current=b,()=>{clearTimeout(b)}}}},[t,E,o,j]);const N=!R&&!d;return a.jsx("div",{ref:p,className:"relative overflow-hidden",...A,children:a.jsx("div",{style:{transform:`translateX(${y}px)`,transition:N?`transform ${Oe}ms cubic-bezier(0.25, 0.1, 0.25, 1)`:"none",cursor:n?R?"grabbing":"grab":"default"},children:i})})}function Ga(t,e,s){return t?s?"bg-warning-500 text-warning-950 ring-2 ring-warning-500 ring-offset-2 dark:ring-offset-surface-card-dark":"bg-primary-500 text-primary-950 ring-2 ring-primary-500 ring-offset-2 dark:ring-offset-surface-card-dark":s?"bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-400 ring-2 ring-warning-400 dark:ring-warning-600":e?"bg-success-500 text-white":"bg-surface-muted dark:bg-surface-subtle-dark text-text-muted dark:text-text-muted-dark"}function Ka({steps:t,currentStepIndex:e,stepsMarkedDone:s,onStepClick:r,clickable:n=!1}){const{t:i}=B();return a.jsx("div",{className:"flex items-center justify-center gap-2",role:"navigation","aria-label":i("common.wizardProgress"),children:t.map((o,c)=>{const d=c===e,u=s.has(c),l=o.isInvalid??!1,h=!o.isOptional&&u&&!l,f=!n,x=()=>{!f&&r&&r(c)},g=y=>{!f&&r&&(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),r(c))},p=[o.label];return d&&p.push(i("common.stepIndicatorCurrent")),h&&p.push(i("common.stepIndicatorDone")),l&&p.push(i("common.stepIndicatorInvalid")),a.jsxs("div",{className:"flex items-center",children:[c>0&&a.jsx("div",{className:`w-8 h-0.5 mx-1 transition-colors ${c<=e?"bg-primary-500":"bg-border-strong dark:bg-border-strong-dark"}`}),a.jsx("button",{type:"button",onClick:x,onKeyDown:g,"aria-disabled":f,"aria-current":d?"step":void 0,"aria-label":p.join(" "),className:`
                relative flex items-center justify-center w-8 h-8 rounded-full
                transition-all duration-200
                ${n?"cursor-pointer hover:scale-110":"cursor-default"}
                ${Ga(d,h,l)}
                focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-surface-card-dark
                aria-disabled:cursor-default aria-disabled:opacity-100
              `,children:l&&!d?a.jsx(gt,{className:"w-4 h-4",strokeWidth:2.5,"aria-hidden":"true"}):h&&!d?a.jsx(He,{className:"w-4 h-4",strokeWidth:3,"aria-hidden":"true"}):a.jsx("span",{className:"text-xs font-semibold",children:c+1})})]},o.id)})})}function Xa(t){const e=t.indoorPlayer?.person;if(e?.displayName)return e.displayName;const s=e?.firstName?.trim()??"",r=e?.lastName?.trim()??"";return[s,r].filter(Boolean).join(" ")}function qa(t){const e=t.__identity,s=Xa(t),r=t.indoorPlayer?.person;return!e||!s?null:{id:e,displayName:s,firstName:r?.firstName,lastName:r?.lastName,birthday:r?.birthday,licenseCategory:t.indoorPlayerLicenseCategory?.shortName,isNewlyAdded:!1}}function Wt(t){return t?t.map(qa).filter(e=>e!==null).sort((e,s)=>e.displayName.localeCompare(s.displayName)):[]}function Ya({gameId:t,team:e,prefetchedData:s}){const n=Se(l=>l.dataSource)==="demo",i=ta(l=>l.nominationLists),o=s!=null,c=m.useMemo(()=>o?Wt(s?.indoorPlayerNominations):[],[o,s]),d=m.useMemo(()=>{if(o||!n||!t)return null;const l=i[t];return l?l[e]??null:null},[o,n,t,e,i]),u=m.useMemo(()=>d?Wt(d.indoorPlayerNominations):[],[d]);return o?{nominationList:s,players:c,isLoading:!1,isError:!1,error:null,refetch:()=>{}}:n?{nominationList:d,players:u,isLoading:!1,isError:!1,error:null,refetch:()=>{}}:{nominationList:null,players:[],isLoading:!1,isError:!0,error:new Error("Nomination list data not available. Ensure prefetchedData is provided from getGameWithScoresheet()."),refetch:()=>{}}}function Qs(t){const e=t.trim();if(!e)return{};const s=e.split(/\s+/),r={},n=s[s.length-1];return n&&/^\d{4}$/.test(n)&&(r.yearOfBirth=n,s.pop()),s.length===1?r.lastName=s[0]:s.length>=2&&(r.firstName=s[0],r.lastName=s.slice(1).join(" ")),r}function Js(t,e={}){const s=Se(o=>o.dataSource),r=pt(s),n=!!(t.firstName||t.lastName||t.yearOfBirth),i=ht({queryKey:be.scorerSearch.search(t),queryFn:async()=>{const o=await r.searchPersons(t);return sa(o,ra,"scorerSearch").items??[]},enabled:e.enabled!==!1&&n,staleTime:xt});return{data:i.data,isLoading:i.isLoading,isError:i.isError,error:i.error}}const Za=100,Qa=300,Vt="coach-search-listbox";function Ja(t,e){switch(t){case"head":return e("validation.roster.headCoach");case"firstAssistant":return e("validation.roster.firstAssistant");case"secondAssistant":return e("validation.roster.secondAssistant")}}function en({isOpen:t,onClose:e,role:s,onSelectCoach:r}){const{t:n}=B(),[i,o]=m.useState(""),[c,d]=m.useState(-1),u=vt(i,Qa),l=m.useRef(null),h=Qs(u),{data:f,isLoading:x,isError:g}=Js(h,{enabled:t&&u.trim().length>0}),p=m.useCallback(()=>{o(""),d(-1),e()},[e]),y=m.useCallback(N=>{r(N,s),p()},[r,s,p]),R=m.useCallback(N=>{if(!(!f||f.length===0))switch(N.key){case"ArrowDown":N.preventDefault(),d(w=>w<f.length-1?w+1:w);break;case"ArrowUp":N.preventDefault(),d(w=>w>0?w-1:w);break;case"Enter":{const w=f[c];c>=0&&w&&(N.preventDefault(),y(w));break}case"Escape":d(-1);break}},[f,c,y]);m.useEffect(()=>{if(t&&l.current){const N=setTimeout(()=>{l.current?.focus()},Za);return()=>clearTimeout(N)}},[t]),m.useEffect(()=>{if(c>=0&&f?.[c]){const N=`coach-option-${f[c].__identity}`,w=document.getElementById(N);w?.scrollIntoView&&w.scrollIntoView({block:"nearest",behavior:"smooth"})}},[c,f]);const E=f&&f.length>0,j=u.trim().length>0,A=Ja(s,n);return a.jsxs(Ws,{isOpen:t,onClose:p,titleId:"add-coach-title",children:[a.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[a.jsxs("div",{children:[a.jsx("h2",{id:"add-coach-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:n("validation.roster.addCoach")}),a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:A})]}),a.jsx("button",{onClick:p,"aria-label":n("common.close"),className:`
            p-2 -mr-2 rounded-lg
            text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
            hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
            transition-colors
          `,children:a.jsx(me,{className:"w-5 h-5","aria-hidden":"true"})})]}),a.jsx("div",{className:"flex-shrink-0 p-4 border-b border-border-default dark:border-border-default-dark",children:a.jsx("input",{ref:l,type:"text",value:i,onChange:N=>{o(N.target.value),d(-1)},onKeyDown:R,placeholder:n("validation.roster.searchCoaches"),"aria-label":n("validation.roster.searchCoaches"),role:"combobox","aria-expanded":E&&j?"true":"false","aria-controls":Vt,"aria-activedescendant":c>=0&&f?.[c]?`coach-option-${f[c].__identity}`:void 0,"aria-autocomplete":"list",className:`
            w-full px-4 py-2 rounded-lg
            bg-surface-subtle dark:bg-surface-subtle-dark
            text-text-primary dark:text-text-primary-dark
            placeholder-text-muted dark:placeholder-text-muted-dark
            border border-transparent
            focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
            outline-none transition-colors
          `})}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 py-2",children:j?x?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx(Re,{size:"md"})}):g?a.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:n("validation.roster.loadCoachesError")}):E?a.jsx("ul",{id:Vt,role:"listbox","aria-label":n("validation.roster.coaches"),className:"space-y-1",children:f.map((N,w)=>{const b=w===c;return a.jsx("li",{id:`coach-option-${N.__identity}`,role:"option","aria-selected":b,children:a.jsxs("button",{type:"button",onClick:()=>y(N),onMouseEnter:()=>d(w),className:`
                      w-full flex items-center justify-between p-3 rounded-lg
                      text-left
                      transition-colors
                      ${b?"bg-primary-50 dark:bg-primary-900/30":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
                    `,children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate",children:N.displayName}),a.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[N.associationId&&a.jsxs("span",{children:["ID: ",N.associationId]}),N.birthday&&a.jsxs("span",{children:[n("common.dob"),": ",yt(N.birthday)]})]})]}),a.jsx(Gs,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},N.__identity)})}):a.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:n("validation.roster.noCoachesFound")}):a.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:n("validation.scorerSearch.searchHint")})}),a.jsx("div",{className:"flex-shrink-0 p-4 border-t border-border-default dark:border-border-default-dark",children:a.jsx("button",{type:"button",onClick:p,className:`
            w-full py-3 px-4 rounded-lg
            text-sm font-medium
            text-text-secondary dark:text-text-secondary-dark
            bg-surface-subtle dark:bg-surface-subtle-dark
            hover:bg-gray-200 dark:hover:bg-gray-700
            transition-colors
            focus:outline-none focus:ring-2 focus:ring-primary-500/50
          `,children:n("common.cancel")})})]})}function tn({nominationListId:t,enabled:e=!0}){const s=Se(n=>n.dataSource),r=pt(s);return ht({queryKey:be.nominations.possible(t),queryFn:async()=>(await r.getPossiblePlayerNominations(t)).items??[],enabled:e&&!!t,staleTime:xt})}const sn=100,rn=200;function an({isOpen:t,onClose:e,nominationListId:s,excludePlayerIds:r,onAddPlayer:n,onRemovePlayer:i}){const{t:o}=B(),[c,d]=m.useState(""),u=vt(c,rn),l=m.useRef(null),[h,f]=m.useState(new Set),{data:x,isLoading:g,isError:p}=tn({nominationListId:s,enabled:t&&!!s}),y=m.useMemo(()=>{if(!x)return[];const N=u.toLowerCase();return x.filter(w=>{const b=w.indoorPlayer?.__identity??"";if(r.includes(b)&&!h.has(b)||w.isAlreadyNominated)return!1;const v=w.indoorPlayer?.person?.lastName?.toLowerCase()??"",k=w.indoorPlayer?.person?.firstName?.toLowerCase()??"";return`${v} ${k}`.includes(N)||k.includes(N)||v.includes(N)})},[x,u,r,h]),R=m.useMemo(()=>{const N=y.map(w=>({id:w.indoorPlayer?.__identity??"",firstName:w.indoorPlayer?.person?.firstName,lastName:w.indoorPlayer?.person?.lastName,birthday:w.indoorPlayer?.person?.birthday}));return zs(N)},[y]),E=m.useMemo(()=>Hs(R),[R]),j=m.useCallback(()=>{d(""),f(new Set),e()},[e]),A=m.useCallback(N=>{const w=N.indoorPlayer?.__identity??"";h.has(w)?(f(b=>{const v=new Set(b);return v.delete(w),v}),i(w)):(f(b=>{const v=new Set(b);return v.add(w),v}),n(N))},[h,n,i]);return m.useEffect(()=>{if(t&&l.current){const N=setTimeout(()=>{l.current?.focus()},sn);return()=>clearTimeout(N)}},[t]),a.jsxs(Ws,{isOpen:t,onClose:j,titleId:"add-player-title",children:[a.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h2",{id:"add-player-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:o("validation.addPlayer")}),h.size>0&&a.jsxs("span",{className:"px-2 py-0.5 text-sm font-medium text-success-700 dark:text-success-400 bg-success-100 dark:bg-success-900/30 rounded-full",children:[h.size," ",o("validation.roster.added")]})]}),a.jsx("button",{onClick:j,"aria-label":o("common.close"),className:`
              p-2 -mr-2 rounded-lg
              text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
              hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
              transition-colors
            `,children:a.jsx(me,{className:"w-5 h-5","aria-hidden":"true"})})]}),a.jsx("div",{className:"flex-shrink-0 p-4 border-b border-border-default dark:border-border-default-dark",children:a.jsx("input",{ref:l,type:"text",value:c,onChange:N=>d(N.target.value),placeholder:o("validation.searchPlayers"),"aria-label":o("validation.searchPlayers"),className:`
              w-full px-4 py-2 rounded-lg
              bg-surface-subtle dark:bg-surface-subtle-dark
              text-text-primary dark:text-text-primary-dark
              placeholder-text-muted dark:placeholder-text-muted-dark
              border border-transparent
              focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
              outline-none transition-colors
            `})}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 py-2",children:g?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx(Re,{size:"md"})}):p?a.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:o("validation.loadPlayersError")}):y.length===0?a.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:o("validation.noPlayersFound")}):a.jsx("ul",{children:y.map(N=>{const w=N.indoorPlayer?.__identity??"",b=h.has(w),v=R.get(w),k=v?.lastName||N.indoorPlayer?.person?.lastName||"",F=v?.firstInitial||"",_=v?.dob||"",I=b?"text-success-700 dark:text-success-400":"text-text-primary dark:text-text-primary-dark";return a.jsx("li",{children:a.jsxs("button",{onClick:()=>A(N),"aria-pressed":b,className:`
                        group w-full flex items-center justify-between py-2 px-3 rounded-lg
                        text-left transition-colors
                        ${b?"bg-success-50 dark:bg-success-900/20 hover:bg-danger-50 dark:hover:bg-danger-900/20":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
                      `,children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-baseline text-sm font-mono",children:[a.jsx("span",{className:`font-medium ${I}`,style:{minWidth:`${E}ch`},children:k}),a.jsx("span",{className:`ml-2 w-[3ch] ${I}`,children:F}),a.jsx("span",{className:"ml-2 text-text-muted dark:text-text-muted-dark tabular-nums",children:_})]})}),b?a.jsxs("span",{className:"relative flex-shrink-0 ml-2 w-5 h-5",children:[a.jsx(He,{className:"w-5 h-5 text-success-600 dark:text-success-400 absolute inset-0 group-hover:opacity-0 transition-opacity","aria-hidden":"true"}),a.jsx(me,{className:"w-5 h-5 text-danger-500 dark:text-danger-400 absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity","aria-hidden":"true"}),a.jsx("span",{className:"sr-only",children:o("validation.roster.added")})]}):a.jsx(va,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},N.__identity)})})}),a.jsx("div",{className:"flex-shrink-0 p-4 border-t border-border-default dark:border-border-default-dark",children:a.jsx("button",{type:"button",onClick:j,className:`
              w-full py-3 px-4 rounded-lg
              text-sm font-medium
              text-white bg-primary-500 hover:bg-primary-600
              dark:bg-primary-600 dark:hover:bg-primary-700
              transition-colors
              focus:outline-none focus:ring-2 focus:ring-primary-500/50
            `,children:o("common.done")})})]})}function Ge({label:t,person:e,coachRole:s,readOnly:r,isPendingAddition:n,isPendingRemoval:i,onAdd:o,onRemove:c}){const{t:d}=B(),u=e!=null,l=e?.displayName??d("validation.roster.notAssigned"),h=i&&u,f=n;return a.jsxs("div",{className:`
        flex items-center justify-between py-2 px-3
        ${h?"bg-danger-50 dark:bg-danger-900/20":""}
        ${f?"bg-success-50 dark:bg-success-900/20":""}
      `,"data-testid":`coach-row-${s}`,children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"text-xs text-text-muted dark:text-text-muted-dark uppercase tracking-wide",children:t}),a.jsx("p",{className:`
            text-sm truncate
            ${h?"line-through text-danger-600 dark:text-danger-400":""}
            ${f?"text-success-700 dark:text-success-400 font-medium":""}
            ${!u&&!f?"text-text-muted dark:text-text-muted-dark italic":"text-text-primary dark:text-text-primary-dark"}
          `,children:l})]}),!r&&a.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[u&&!h&&a.jsx("button",{type:"button",onClick:c,"aria-label":d("validation.roster.removeCoach"),className:"p-1.5 rounded-md text-text-muted hover:text-danger-600 hover:bg-danger-50 dark:hover:text-danger-400 dark:hover:bg-danger-900/30 transition-colors",children:a.jsx(me,{className:"w-4 h-4","aria-hidden":"true"})}),h&&a.jsx("button",{type:"button",onClick:c,"aria-label":d("validation.roster.undoRemoval"),className:"text-xs px-2 py-1 rounded-md text-danger-600 hover:bg-danger-100 dark:text-danger-400 dark:hover:bg-danger-900/40 transition-colors",children:d("validation.roster.undoRemoval")}),!u&&!f&&a.jsx("button",{type:"button",onClick:o,"aria-label":d("validation.roster.addCoach"),className:"p-1.5 rounded-md text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/30 transition-colors",children:a.jsx(Xs,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}function nn({headCoach:t,firstAssistant:e,secondAssistant:s,readOnly:r=!1,onAddCoach:n,onRemoveCoach:i,pendingAdditions:o,pendingRemovals:c}){const{t:d}=B(),u=o?.get("head")??t,l=o?.get("firstAssistant")??e,h=o?.get("secondAssistant")??s;return a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 divide-y divide-gray-200 dark:divide-gray-700",role:"list","aria-label":d("validation.roster.coaches"),children:[a.jsx(Ge,{label:d("validation.roster.headCoach"),person:u,coachRole:"head",readOnly:r,isPendingAddition:o?.has("head"),isPendingRemoval:c?.has("head"),onAdd:()=>n?.("head"),onRemove:()=>i?.("head")}),a.jsx(Ge,{label:d("validation.roster.firstAssistant"),person:l,coachRole:"firstAssistant",readOnly:r,isPendingAddition:o?.has("firstAssistant"),isPendingRemoval:c?.has("firstAssistant"),onAdd:()=>n?.("firstAssistant"),onRemove:()=>i?.("firstAssistant")}),a.jsx(Ge,{label:d("validation.roster.secondAssistant"),person:h,coachRole:"secondAssistant",readOnly:r,isPendingAddition:o?.has("secondAssistant"),isPendingRemoval:c?.has("secondAssistant"),onAdd:()=>n?.("secondAssistant"),onRemove:()=>i?.("secondAssistant")})]})}function on({player:t,displayData:e,maxLastNameWidth:s,isMarkedForRemoval:r,onRemove:n,onUndoRemoval:i,readOnly:o=!1}){const{t:c}=B(),d=r?"line-through text-text-subtle dark:text-text-subtle-dark":"text-text-primary dark:text-text-primary-dark";return a.jsxs("div",{className:`flex items-center justify-between py-3 px-2 border-b border-border-subtle dark:border-border-subtle-dark last:border-b-0 ${r?"opacity-50":""}`,children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[a.jsxs("div",{className:"flex items-baseline text-sm font-mono",children:[a.jsx("span",{className:d,style:{minWidth:`${s}ch`},children:e.lastName}),a.jsx("span",{className:`ml-2 w-[3ch] ${d}`,children:e.firstInitial}),a.jsx("span",{className:`ml-2 text-text-muted dark:text-text-muted-dark tabular-nums ${r?"line-through":""}`,children:e.dob})]}),t.isNewlyAdded&&!r&&a.jsx(la,{variant:"success",children:c("validation.roster.newlyAdded")})]}),!o&&a.jsx("div",{className:"flex-shrink-0 ml-2",children:r?a.jsx("button",{type:"button",onClick:i,className:"p-1.5 rounded-full text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/50 transition-colors","aria-label":c("validation.roster.undoRemoval"),title:c("validation.roster.undoRemoval"),children:a.jsx(Oa,{className:"w-4 h-4","aria-hidden":"true"})}):a.jsx("button",{type:"button",onClick:n,className:"p-1.5 rounded-full text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/50 transition-colors","aria-label":c("validation.roster.removePlayer"),title:c("validation.roster.removePlayer"),children:a.jsx(Ma,{className:"w-4 h-4","aria-hidden":"true"})})})]})}function Gt({title:t,count:e,countLabel:s,expanded:r,onToggle:n,sectionId:i}){const o=r?Ct:bt;return a.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-3 px-1 text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 rounded-lg","aria-expanded":r,"aria-controls":i,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(o,{className:"w-5 h-5 text-text-muted dark:text-text-muted-dark","aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:t})]}),a.jsx("span",{className:"text-xs text-text-muted dark:text-text-muted-dark",children:s.replace("{count}",String(e))})]})}function er({team:t,teamName:e,gameId:s,onModificationsChange:r,onAddPlayerSheetOpenChange:n,readOnly:i=!1,initialModifications:o,initialCoachModifications:c,prefetchedNominationList:d}){const{t:u}=B(),{nominationList:l,players:h,isLoading:f,isError:x,refetch:g}=Ya({gameId:s,team:t,prefetchedData:d}),[p,y]=m.useState("players"),[R,E]=m.useState(()=>o?.added??[]),[j,A]=m.useState(()=>new Set(o?.removed??[])),[N,w]=m.useState(()=>c?.added??new Map),[b,v]=m.useState(()=>c?.removed??new Set),[k,F]=m.useState(!1),[_,I]=m.useState(!1),[$,S]=m.useState("head"),L=m.useRef(r);m.useEffect(()=>{L.current=r},[r]),m.useEffect(()=>{L.current?.({players:{added:R,removed:[...j]},coaches:{added:N,removed:b}})},[R,j,N,b]),m.useEffect(()=>{n?.(k)},[k,n]);const V=m.useCallback(C=>{A(O=>{const P=new Set(O);return P.add(C),P})},[]),K=m.useCallback(C=>{A(O=>{const P=new Set(O);return P.delete(C),P})},[]),le=m.useCallback(C=>{const O=C.indoorPlayer?.__identity;if(!O)return;const P=C.indoorPlayer?.person,H={id:O,displayName:P?.displayName??`${P?.firstName??""} ${P?.lastName??""}`.trim(),firstName:P?.firstName,lastName:P?.lastName,birthday:P?.birthday,licenseCategory:C.licenseCategory,isNewlyAdded:!0};E(X=>[...X,H])},[]),ie=m.useCallback(C=>{E(O=>O.filter(P=>P.id!==C))},[]),fe=m.useCallback(C=>{S(C),I(!0)},[]),ce=m.useCallback(C=>{if(N.has(C)){w(O=>{const P=new Map(O);return P.delete(C),P});return}v(O=>{const P=new Set(O);return P.has(C)?P.delete(C):P.add(C),P})},[N]),ge=m.useCallback((C,O)=>{const P={id:C.__identity,displayName:C.displayName??"",firstName:C.firstName,lastName:C.lastName,birthday:C.birthday};w(H=>{const X=new Map(H);return X.set(O,P),X}),v(H=>{const X=new Set(H);return X.delete(O),X})},[]),ee=[...h,...R].sort((C,O)=>{if(C.isNewlyAdded&&!O.isNewlyAdded)return 1;if(!C.isNewlyAdded&&O.isNewlyAdded)return-1;const P=C.lastName??C.displayName,H=O.lastName??O.displayName;return P.localeCompare(H)}),re=m.useMemo(()=>zs(ee),[ee]),de=m.useMemo(()=>Hs(re),[re]),te=ee.filter(C=>!j.has(C.id)).length,Y=l?.coachPerson,W=l?.firstAssistantCoachPerson,T=l?.secondAssistantCoachPerson,D=m.useMemo(()=>{const C=new Map;return N.forEach((O,P)=>{C.set(P,{__identity:O.id,displayName:O.displayName,firstName:O.firstName,lastName:O.lastName,birthday:O.birthday})}),C},[N]),z=m.useMemo(()=>{let C=0;const O=["head","firstAssistant","secondAssistant"],P={head:Y,firstAssistant:W,secondAssistant:T};for(const H of O){const X=N.has(H),se=P[H]&&!b.has(H);(X||se)&&C++}return C},[Y,W,T,N,b]);return f?a.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"status","aria-live":"polite",children:[a.jsx(Re,{size:"md",className:"mb-3"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:u("validation.roster.loadingRoster")})]}):x?a.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"alert",children:[a.jsx(_e,{className:"w-10 h-10 text-danger-500 mb-3","aria-hidden":"true"}),a.jsx("p",{className:"text-sm text-danger-600 dark:text-danger-400 mb-4",children:u("validation.roster.errorLoading")}),a.jsxs("button",{type:"button",onClick:()=>g(),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[a.jsx(Vs,{className:"w-4 h-4","aria-hidden":"true"}),u("common.retry")]})]}):a.jsxs("div",{className:"py-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:e}),a.jsxs("div",{className:"mb-2",children:[a.jsx(Gt,{title:u("validation.roster.coaches"),count:z,countLabel:u("validation.roster.coachCount"),expanded:p==="coaches",onToggle:()=>y("coaches"),sectionId:`coaches-section-${t}`}),p==="coaches"&&a.jsx("div",{id:`coaches-section-${t}`,className:"mt-2",children:a.jsx(nn,{headCoach:Y,firstAssistant:W,secondAssistant:T,readOnly:i,onAddCoach:fe,onRemoveCoach:ce,pendingAdditions:D,pendingRemovals:b})})]}),a.jsxs("div",{children:[a.jsx(Gt,{title:u("validation.roster.players"),count:te,countLabel:u("validation.roster.playerCount"),expanded:p==="players",onToggle:()=>y("players"),sectionId:`players-section-${t}`}),p==="players"&&a.jsxs("div",{id:`players-section-${t}`,className:"mt-2",children:[ee.length===0?a.jsx("div",{className:"py-8 text-center",children:a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:u("validation.roster.emptyRoster")})}):a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:ee.map(C=>{const O=re.get(C.id);return a.jsx(on,{player:C,displayData:{lastName:O?.lastName||C.lastName||C.displayName,firstInitial:O?.firstInitial||"",dob:O?.dob||""},maxLastNameWidth:de,isMarkedForRemoval:j.has(C.id),onRemove:i?void 0:()=>V(C.id),onUndoRemoval:i?void 0:()=>K(C.id),readOnly:i},C.id)})}),!i&&a.jsx("div",{className:"mt-4 flex gap-2",children:a.jsxs("button",{type:"button",onClick:()=>F(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 hover:bg-primary-100 dark:hover:bg-primary-900/50 rounded-lg border border-primary-200 dark:border-primary-800 transition-colors",children:[a.jsx(Xs,{className:"w-4 h-4","aria-hidden":"true"}),u("validation.roster.addPlayer")]})})]})]}),!i&&a.jsx(an,{isOpen:k,onClose:()=>F(!1),nominationListId:l?.__identity??"",excludePlayerIds:h.map(C=>C.id),onAddPlayer:le,onRemovePlayer:ie}),!i&&a.jsx(en,{isOpen:_,onClose:()=>I(!1),role:$,onSelectCoach:ge})]})}function ln({assignment:t,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:r=!1,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o}){const{homeTeam:c}=ft(t),d=t.refereeGame?.game?.__identity??"";return a.jsx(er,{team:"home",teamName:c,gameId:d,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:r,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o})}function cn({assignment:t,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:r=!1,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o}){const{awayTeam:c}=ft(t),d=t.refereeGame?.game?.__identity??"";return a.jsx(er,{team:"away",teamName:c,gameId:d,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:r,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o})}function dn(t){return`scorer-option-${t}`}function un({results:t,isLoading:e,isError:s,onSelect:r,highlightedIndex:n=-1,onHighlight:i,listboxId:o}){const{t:c}=B(),d=t&&t.length>0;return e?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx(Re,{size:"md"})}):s?a.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:c("validation.scorerSearch.searchError")}):d?a.jsx("ul",{id:o,role:"listbox","aria-label":c("validation.scorerSearch.searchResults"),className:"space-y-1",children:t.map((u,l)=>{const h=l===n;return a.jsx("li",{id:dn(u.__identity),role:"option","aria-selected":h,children:a.jsxs("button",{onClick:()=>r(u),onMouseEnter:()=>i?.(l),className:`
                w-full flex items-center justify-between p-3 rounded-lg
                text-left
                transition-colors
                ${h?"bg-primary-50 dark:bg-primary-900/30":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
              `,children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate",children:u.displayName}),a.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[u.associationId&&a.jsxs("span",{children:["ID: ",u.associationId]}),u.birthday&&a.jsxs("span",{children:[c("common.dob"),": ",yt(u.birthday)]})]})]}),a.jsx(Gs,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},u.__identity)})}):a.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:c("validation.scorerSearch.noScorersFound")})}function Kt({scorer:t,displayName:e,displayBirthday:s,onClear:r,readOnly:n=!1}){const{t:i}=B(),o=t?.displayName??e??"",c=t?.birthday??s;return a.jsx("div",{className:"mb-4 p-4 bg-primary-50 dark:bg-primary-900/20 rounded-lg border border-primary-200 dark:border-primary-800",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark",children:o}),(t?.associationId||c)&&a.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[t?.associationId&&a.jsxs("span",{children:["ID: ",t.associationId]}),c&&a.jsxs("span",{children:[i("common.dob"),": ",yt(c)]})]})]}),!n&&r&&a.jsx("button",{onClick:r,"aria-label":i("common.close"),className:`
              p-2 rounded-lg
              text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
              hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
              transition-colors
            `,children:a.jsx(me,{className:"w-5 h-5","aria-hidden":"true"})})]})})}const mn=300,hn=100,Xt="scorer-search-listbox",qt="scorer-search-hint";function fn({selectedScorer:t,onScorerSelect:e,readOnly:s=!1,readOnlyScorerName:r,readOnlyScorerBirthday:n}){const{t:i,tInterpolate:o}=B(),[c,d]=m.useState(""),[u,l]=m.useState(-1),h=vt(c,mn),f=m.useRef(null),x=Qs(h),{data:g,isLoading:p,isError:y}=Js(x);m.useEffect(()=>{if(t)return;const w=setTimeout(()=>{f.current?.focus()},hn);return()=>clearTimeout(w)},[t]),m.useEffect(()=>{if(u>=0&&g?.[u]){const w=`scorer-option-${g[u].__identity}`,b=document.getElementById(w);b?.scrollIntoView&&b.scrollIntoView({block:"nearest",behavior:"smooth"})}},[u,g]);const R=m.useCallback(w=>{e(w),d(""),l(-1)},[e]),E=m.useCallback(w=>{if(!(!g||g.length===0))switch(w.key){case"ArrowDown":w.preventDefault(),l(b=>b<g.length-1?b+1:b);break;case"ArrowUp":w.preventDefault(),l(b=>b>0?b-1:b);break;case"Enter":{const b=g[u];u>=0&&b&&(w.preventDefault(),R(b));break}case"Escape":l(-1);break;case"Home":w.preventDefault(),l(0);break;case"End":w.preventDefault(),l(g.length-1);break}},[g,u,R]),j=m.useCallback(()=>{e(null),d(""),l(-1),f.current?.focus()},[e]),A=g&&g.length>0,N=h.trim()&&!t;return s?a.jsx("div",{className:"py-4",children:t||r?a.jsx(Kt,{scorer:t,displayName:r,displayBirthday:n,readOnly:!0}):a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.noScorerSelected")})}):a.jsxs("div",{className:"py-4",children:[t&&a.jsx(Kt,{scorer:t,onClear:j}),!t&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("input",{ref:f,type:"text",value:c,onChange:w=>{d(w.target.value),l(-1)},onKeyDown:E,placeholder:i("validation.scorerSearch.searchPlaceholder"),"aria-label":i("validation.scorerSearch.searchPlaceholder"),role:"combobox","aria-expanded":A&&N?"true":"false","aria-controls":Xt,"aria-activedescendant":u>=0&&g?.[u]?`scorer-option-${g[u].__identity}`:void 0,"aria-autocomplete":"list","aria-describedby":qt,className:`
                w-full px-4 py-2 rounded-lg
                bg-surface-subtle dark:bg-surface-subtle-dark
                text-text-primary dark:text-text-primary-dark
                placeholder-text-muted dark:placeholder-text-muted-dark
                border border-transparent
                focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
                outline-none transition-colors
              `}),a.jsx("p",{id:qt,className:"mt-2 text-xs text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.searchHint")})]}),N&&a.jsx("div",{className:"mt-4",children:a.jsx(un,{results:g,isLoading:p,isError:y,onSelect:R,highlightedIndex:u,onHighlight:l,listboxId:Xt})}),a.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:N&&!p&&!y&&g&&a.jsx("span",{children:g.length===1?i("validation.scorerSearch.resultsCountOne"):o("validation.scorerSearch.resultsCount",{count:g.length})})})]}),!t&&!N&&a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.noScorerSelected")})]})}function pn({onScorerChange:t,initialScorer:e=null,readOnly:s=!1,readOnlyScorerName:r,readOnlyScorerBirthday:n}){const[i,o]=m.useState(e);m.useEffect(()=>{e&&t?.(e)},[e,t]);const c=d=>{o(d),t?.(d)};return a.jsx(fn,{selectedScorer:i,onScorerSelect:c,readOnly:s,readOnlyScorerName:r,readOnlyScorerBirthday:n})}const xn=".jpg,.jpeg,.png,.pdf",Yt=1500,gn=10,yn=90,bn=100,Nn=10;function wn(t){return t<Bt?`${t} B`:t<Dt?`${(t/Bt).toFixed(1)} KB`:`${(t/Dt).toFixed(1)} MB`}function vn({onScoresheetChange:t,readOnly:e=!1,hasScoresheet:s=!1,scoresheetNotRequired:r=!1}){const{t:n}=B(),o=Se(I=>I.dataSource)==="demo",c=m.useRef(t);m.useEffect(()=>{c.current=t},[t]);const[d,u]=m.useState(null),[l,h]=m.useState("idle"),[f,x]=m.useState(null),[g,p]=m.useState(0),y=m.useRef(null),R=m.useRef(null),E=m.useRef({}),j=m.useRef(null),A=m.useRef(!1);m.useEffect(()=>{const I=E.current;return()=>{j.current&&URL.revokeObjectURL(j.current),I.interval&&clearInterval(I.interval),I.timeout&&clearTimeout(I.timeout)}},[]);const N=m.useCallback(I=>aa.includes(I.type)?I.size>na?n("validation.scoresheetUpload.fileTooLarge"):null:n("validation.scoresheetUpload.invalidFileType"),[n]),w=m.useCallback(I=>{E.current.interval&&clearInterval(E.current.interval),E.current.timeout&&clearTimeout(E.current.timeout),A.current=!0,h("uploading"),p(0),c.current?.(I,!1),E.current.interval=setInterval(()=>{p($=>$>=yn?(E.current.interval&&clearInterval(E.current.interval),$):$+gn)},Yt/Nn),E.current.timeout=setTimeout(()=>{E.current.interval&&clearInterval(E.current.interval),p(bn),h("complete"),A.current=!1,c.current?.(I,!0)},Yt)},[]),b=m.useCallback(I=>{if(A.current)return;const $=N(I);if($){x($);return}j.current&&URL.revokeObjectURL(j.current),x(null);const S=I.type.startsWith("image/")?URL.createObjectURL(I):null;j.current=S,u({file:I,previewUrl:S}),w(I)},[N,w]),v=m.useCallback(I=>{const $=I.target.files?.[0];$&&b($),I.target.value=""},[b]),k=m.useCallback(()=>{j.current&&(URL.revokeObjectURL(j.current),j.current=null),E.current.interval&&clearInterval(E.current.interval),E.current.timeout&&clearTimeout(E.current.timeout),A.current=!1,u(null),h("idle"),p(0),x(null),c.current?.(null,!1)},[]),F=m.useCallback(()=>{k(),y.current?.click()},[k]),_=I=>n(`validation.scoresheetUpload.${I}`);return r?a.jsx("div",{className:"py-4",children:a.jsxs("div",{className:"border border-info-200 dark:border-info-800 bg-info-50 dark:bg-info-900/20 rounded-lg p-4 text-center",children:[a.jsx(oa,{className:"w-12 h-12 mx-auto text-info-500 mb-3","aria-hidden":"true"}),a.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1",children:n("validation.scoresheetUpload.notRequired")}),a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:n("validation.scoresheetUpload.notRequiredDescription")})]})}):e?a.jsx("div",{className:"py-4",children:a.jsx("div",{className:"border border-border-default dark:border-border-default-dark rounded-lg p-4 text-center",children:s?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{className:"w-12 h-12 mx-auto text-green-500 mb-3","aria-hidden":"true"}),a.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:n("validation.scoresheetUpload.scoresheetUploaded")})]}):a.jsxs(a.Fragment,{children:[a.jsx(qe,{className:"w-12 h-12 mx-auto text-text-subtle dark:text-text-subtle-dark mb-3","aria-hidden":"true"}),a.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:n("validation.scoresheetUpload.noScoresheet")})]})})}):a.jsxs("div",{className:"py-4",children:[a.jsx("input",{ref:y,type:"file",accept:xn,onChange:v,className:"hidden","aria-label":_("selectFile")}),a.jsx("input",{ref:R,type:"file",accept:"image/jpeg,image/png",capture:"environment",onChange:v,className:"hidden","aria-label":_("takePhoto")}),d?a.jsxs("div",{className:"border border-border-default dark:border-border-default-dark rounded-lg overflow-hidden",children:[d.previewUrl?a.jsx("div",{className:"relative bg-surface-subtle dark:bg-surface-card-dark",children:a.jsx("img",{src:d.previewUrl,alt:_("previewAlt"),className:"w-full max-h-64 object-contain"})}):a.jsxs("div",{className:"bg-surface-subtle dark:bg-surface-card-dark p-8 flex flex-col items-center justify-center",children:[a.jsx(qe,{className:"w-16 h-16 text-text-subtle dark:text-text-subtle-dark mb-2","aria-hidden":"true"}),a.jsx("span",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:"PDF"})]}),a.jsxs("div",{className:"p-4 bg-surface-card dark:bg-surface-card-dark",children:[l==="uploading"&&a.jsxs("div",{className:"mb-3",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted dark:text-text-muted-dark mb-1",children:[a.jsx("span",{children:_("uploading")}),a.jsxs("span",{children:[g,"%"]})]}),a.jsx("div",{className:"h-2 bg-surface-muted dark:bg-surface-subtle-dark rounded-full overflow-hidden",role:"progressbar","aria-valuenow":g,"aria-valuemin":0,"aria-valuemax":100,"aria-label":_("uploading"),children:a.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-200",style:{width:`${g}%`}})})]}),l==="complete"&&a.jsxs("div",{className:"mb-3 flex items-center gap-2 text-green-600 dark:text-green-400",role:"status","aria-live":"polite",children:[a.jsx(Ye,{className:"w-5 h-5","aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium",children:_("uploadComplete")})]}),a.jsx("p",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark truncate",children:d.file.name}),a.jsx("p",{className:"text-xs text-text-muted dark:text-text-muted-dark",children:wn(d.file.size)}),a.jsxs("div",{className:"mt-4 flex gap-3",children:[a.jsx("button",{type:"button",onClick:F,disabled:l==="uploading",className:"flex-1 px-4 py-2 text-sm font-medium text-text-secondary dark:text-text-secondary-dark bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_("replace")}),a.jsx("button",{type:"button",onClick:k,disabled:l==="uploading",className:"flex-1 px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_("remove")})]})]})]}):a.jsxs("div",{className:"border-2 border-dashed border-border-strong dark:border-border-strong-dark rounded-lg p-6 text-center",children:[a.jsx(Ft,{className:"w-12 h-12 mx-auto text-text-subtle dark:text-text-subtle-dark mb-4","aria-hidden":"true"}),a.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1",children:_("title")}),a.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark mb-4",children:_("description")}),a.jsxs("p",{className:"text-xs text-text-subtle dark:text-text-subtle-dark mb-4",children:[_("acceptedFormats")," â€¢ ",_("maxFileSize")]}),f&&a.jsxs("div",{role:"alert",className:"mb-4 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg flex items-center gap-2",children:[a.jsx(_e,{className:"w-5 h-5 text-danger-500 flex-shrink-0","aria-hidden":"true"}),a.jsx("span",{className:"text-sm text-danger-700 dark:text-danger-400",children:f})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[a.jsxs("button",{type:"button",onClick:()=>y.current?.click(),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[a.jsx(Ft,{className:"w-4 h-4","aria-hidden":"true"}),_("selectFile")]}),a.jsxs("button",{type:"button",onClick:()=>R.current?.click(),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-text-secondary dark:text-text-secondary-dark bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark rounded-lg transition-colors",children:[a.jsx(kt,{className:"w-4 h-4","aria-hidden":"true"}),_("takePhoto")]})]})]}),o&&a.jsx("p",{className:"mt-3 text-xs text-center text-text-subtle dark:text-text-subtle-dark",children:_("demoModeNote")})]})}const kn=60;function Cn({isOpen:t,onSaveAndClose:e,onDiscard:s,onCancel:r,isSaving:n}){const{t:i}=B(),o=m.useRef(null);return m.useEffect(()=>{t&&o.current&&o.current.querySelector("button")?.focus()},[t]),t?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:kn},"aria-hidden":"true",children:a.jsxs("div",{ref:o,className:"bg-surface-card dark:bg-surface-card-dark rounded-lg shadow-xl max-w-sm w-full p-6",role:"alertdialog","aria-modal":"true","aria-labelledby":"unsaved-changes-title","aria-describedby":"unsaved-changes-description",children:[a.jsx("h3",{id:"unsaved-changes-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark mb-2",children:i("validation.state.unsavedChangesTitle")}),a.jsx("p",{id:"unsaved-changes-description",className:"text-sm text-text-muted dark:text-text-muted-dark mb-4",children:i("validation.state.unsavedChangesMessage")}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx(Z,{variant:"secondary",onClick:r,disabled:n,children:i("validation.state.continueEditing")}),a.jsx(Z,{variant:"danger",onClick:s,disabled:n,children:i("validation.state.discardChanges")}),a.jsx(Z,{variant:"primary",onClick:e,disabled:n,children:i(n?"common.loading":"validation.state.saveAndClose")})]})]})}):null}const An=60;function Sn({isOpen:t,rosterValidation:e,homeTeamName:s,awayTeamName:r,onGoBack:n,onProceedAnyway:i,isProceedingAnyway:o}){const{t:c,tInterpolate:d}=B(),u=m.useRef(null);if(m.useEffect(()=>{t&&u.current&&u.current.querySelector("button")?.focus()},[t]),m.useEffect(()=>{if(!t)return;const p=y=>{y.key==="Escape"&&!o&&n()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[t,o,n]),!t)return null;const{home:l,away:h}=e,f=[],x=[];l.hasHeadCoach||f.push({key:"home-coach",message:c("validation.rosterWarning.missingHeadCoach")}),l.hasMinPlayers||f.push({key:"home-players",message:d("validation.rosterWarning.insufficientPlayers",{count:l.playerCount,required:Qe})}),h.hasHeadCoach||x.push({key:"away-coach",message:c("validation.rosterWarning.missingHeadCoach")}),h.hasMinPlayers||x.push({key:"away-players",message:d("validation.rosterWarning.insufficientPlayers",{count:h.playerCount,required:Qe})});const g=p=>{p.target===p.currentTarget&&!o&&n()};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:An},onClick:g,"aria-hidden":"true",children:a.jsxs("div",{ref:u,className:"bg-surface-card dark:bg-surface-card-dark rounded-lg shadow-xl max-w-md w-full p-6",role:"alertdialog","aria-modal":"true","aria-labelledby":"roster-warning-title","aria-describedby":"roster-warning-description",children:[a.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[a.jsx("div",{className:"flex-shrink-0 p-2 bg-warning-100 dark:bg-warning-900/30 rounded-full",children:a.jsx(gt,{className:"w-6 h-6 text-warning-600 dark:text-warning-400","aria-hidden":"true"})}),a.jsxs("div",{children:[a.jsx("h3",{id:"roster-warning-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:c("validation.rosterWarning.title")}),a.jsx("p",{id:"roster-warning-description",className:"text-sm text-text-muted dark:text-text-muted-dark mt-1",children:c("validation.rosterWarning.description")})]})]}),a.jsxs("div",{className:"space-y-3 mb-6",children:[f.length>0&&a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-3",children:[a.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-300 mb-1",children:s}),a.jsx("ul",{className:"list-disc list-inside text-sm text-warning-700 dark:text-warning-400 space-y-0.5",children:f.map(p=>a.jsx("li",{children:p.message},p.key))})]}),x.length>0&&a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-3",children:[a.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-300 mb-1",children:r}),a.jsx("ul",{className:"list-disc list-inside text-sm text-warning-700 dark:text-warning-400 space-y-0.5",children:x.map(p=>a.jsx("li",{children:p.message},p.key))})]})]}),a.jsx("p",{className:"text-xs text-text-muted dark:text-text-muted-dark mb-4",children:c("validation.rosterWarning.forfeitNote")}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx(Z,{variant:"secondary",onClick:n,disabled:o,children:c("validation.rosterWarning.goBack")}),a.jsx(Z,{variant:"danger",onClick:i,disabled:o,children:c(o?"common.loading":"validation.rosterWarning.proceedAnyway")})]})]})})}const Zt="safe-validation-complete-title",En="https://volleymanager.volleyball.ch";function jn({isOpen:t,onClose:e}){const{t:s}=B(),r=m.useRef(!1),n=m.useCallback(()=>{if(!r.current){r.current=!0;try{window.open(En,"_blank","noopener,noreferrer"),e()}finally{r.current=!1}}},[e]),i=a.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-success-100 dark:bg-success-900 flex items-center justify-center",children:a.jsx("svg",{className:"w-6 h-6 text-success-600 dark:text-success-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});return a.jsxs(Nt,{isOpen:t,onClose:e,titleId:Zt,size:"md",children:[a.jsx(wt,{title:s("settings.safeValidationCompleteTitle"),titleId:Zt,icon:i}),a.jsx("div",{className:"mb-6",children:a.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary-dark",children:s("settings.safeValidationCompleteMessage")})}),a.jsxs(Us,{divider:!0,children:[a.jsx(Z,{variant:"secondary",className:"flex-1 rounded-md",onClick:e,children:s("common.close")}),a.jsx(Z,{variant:"primary",className:"flex-1 rounded-md",onClick:n,children:s("settings.safeValidationCompleteButton")})]})]})}const Rn=70;function _n({message:t}){return a.jsxs("div",{role:"status","aria-live":"polite",className:"fixed top-4 right-4 bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",style:{zIndex:Rn},children:[a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5","aria-hidden":"true",children:[a.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),a.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]}),a.jsx("span",{className:"text-sm font-medium",children:t})]})}function In({currentStepId:t,assignment:e,loading:s,validation:r,handlers:n}){const{t:i}=B();return s.isLoading?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("common.loading")})}):s.error?a.jsx("div",{role:"alert",className:"p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",children:a.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:s.error.message})}):a.jsxs(ea,{modalName:"ValidateGameModal",onClose:n.onClose,children:[t==="home-roster"&&a.jsx(ln,{assignment:e,onModificationsChange:n.setHomeRosterModifications,onAddPlayerSheetOpenChange:n.onAddPlayerSheetOpenChange,readOnly:r.isValidated,initialModifications:r.state.homeRoster.playerModifications,initialCoachModifications:r.state.homeRoster.coachModifications,prefetchedNominationList:r.homeNominationList}),t==="away-roster"&&a.jsx(cn,{assignment:e,onModificationsChange:n.setAwayRosterModifications,onAddPlayerSheetOpenChange:n.onAddPlayerSheetOpenChange,readOnly:r.isValidated,initialModifications:r.state.awayRoster.playerModifications,initialCoachModifications:r.state.awayRoster.coachModifications,prefetchedNominationList:r.awayNominationList}),t==="scorer"&&a.jsx(pn,{onScorerChange:n.setScorer,readOnly:r.isValidated,readOnlyScorerName:r.validatedInfo?.scorerName,readOnlyScorerBirthday:r.validatedInfo?.scorerBirthday,initialScorer:r.pendingScorer?{__identity:r.pendingScorer.__identity,displayName:r.pendingScorer.displayName,birthday:r.pendingScorer.birthday??""}:null},r.pendingScorer?.__identity??"no-pending-scorer"),t==="scoresheet"&&a.jsx(vn,{onScoresheetChange:n.setScoresheet,readOnly:r.isValidated,hasScoresheet:r.validatedInfo?.hasScoresheet,scoresheetNotRequired:r.scoresheetNotRequired})]})}function Mn({navigation:t,onBack:e,onNext:s,onClose:r,closeLabel:n}){const{t:i}=B();return a.jsxs(a.Fragment,{children:[a.jsx("div",{children:!t.isFirstStep&&a.jsx(Z,{variant:"secondary",onClick:e,children:i("validation.wizard.previous")})}),a.jsx("div",{children:t.isLastStep?a.jsx(Z,{variant:"primary",onClick:r,children:n}):a.jsx(Z,{variant:"primary",onClick:s,children:i("validation.wizard.next")})})]})}function Tn(t){const{t:e}=B();return a.jsx(Mn,{...t,closeLabel:e("common.close")})}function On({navigation:t,state:e,onAttemptClose:s,onBack:r,onValidateAndNext:n,onFinish:i}){const{t:o}=B(),c=e.isFinalizing||e.isLoadingGameDetails||e.hasGameDetailsError,d=c||!e.allPreviousRequiredStepsDone||!e.currentStepIsOptional&&!e.canMarkCurrentStepDone;return a.jsxs(a.Fragment,{children:[a.jsx("div",{children:t.isFirstStep?a.jsx(Z,{variant:"secondary",onClick:s,disabled:e.isFinalizing,children:o("common.cancel")}):a.jsx(Z,{variant:"secondary",onClick:r,disabled:e.isFinalizing,children:o("validation.wizard.previous")})}),a.jsx("div",{children:t.isLastStep?a.jsx(Z,{variant:"success",onClick:()=>i(),disabled:d,title:e.allPreviousRequiredStepsDone?void 0:o("validation.state.markAllStepsTooltip"),children:e.isFinalizing?o("common.loading"):o("validation.wizard.finish")}):a.jsx(Z,{variant:"success",onClick:n,disabled:c||!e.canMarkCurrentStepDone,children:o("validation.wizard.validate")})})]})}const tr=.7,sr=.9,Pn=4,Ln=5,Je=Pn/Ln,Bn=180,Dn={electronic:{widthPercent:tr,aspectRatio:Je},manuscript:{widthPercent:sr,aspectRatio:Je}},rr=.92;function Fn(t,e,s,r,n){const i=Dn[n],o=t/e,c=s/r;let d,u,l,h;o>c?(u=e,d=e*c,l=(t-d)/2,h=0):(d=t,u=t/c,l=0,h=(e-u)/2);const f=d*i.widthPercent,x=f/i.aspectRatio,g=(d-f)/2,p=(u-x)/2;return{x:Math.round(l+g),y:Math.round(h+p),width:Math.round(f),height:Math.round(x)}}function $n(t,e,s=rr){const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const n=r.getContext("2d");return n?(n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),new Promise((i,o)=>{r.toBlob(c=>{c?i(c):o(new Error("Failed to create blob from canvas"))},"image/jpeg",s)})):Promise.reject(new Error("Could not get canvas context"))}function ar(t){return t*Math.PI/Bn}function zn(t,e,s){const r=ar(s),n=Math.abs(Math.sin(r)),i=Math.abs(Math.cos(r));return{width:t*i+e*n,height:t*n+e*i}}function Hn(t){return new Promise((e,s)=>{const r=new Image;r.addEventListener("load",()=>e(r)),r.addEventListener("error",n=>s(n)),r.src=t})}async function Un(t,e,s,r=rr){const n=await Hn(t),i=document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new Error("Could not get canvas context");const c=ar(s),{width:d,height:u}=zn(n.width,n.height,s);i.width=d,i.height=u,o.translate(d/2,u/2),o.rotate(c),o.translate(-n.width/2,-n.height/2),o.drawImage(n,0,0);const l=document.createElement("canvas"),h=l.getContext("2d");if(!h)throw new Error("Could not get cropped canvas context");return l.width=e.width,l.height=e.height,h.drawImage(i,e.x,e.y,e.width,e.height,0,0,e.width,e.height),new Promise((f,x)=>{l.toBlob(g=>{g?f(g):x(new Error("Failed to create blob from canvas"))},"image/jpeg",r)})}const Wn=17,Vn=20,Gn=Wn/Vn,Kn=4,Xn=5,qn=Kn/Xn,Yn=.5,Zn=3,Qt=90;function Qn({imageBlob:t,scoresheetType:e,onConfirm:s,onCancel:r}){const{t:n}=B(),i=m.useMemo(()=>URL.createObjectURL(t),[t]);m.useEffect(()=>()=>URL.revokeObjectURL(i),[i]);const[o,c]=m.useState({x:0,y:0}),[d,u]=m.useState(1),[l,h]=m.useState(0),[f,x]=m.useState(null),[g,p]=m.useState(!1),[y,R]=m.useState(null),E=e==="electronic"?Gn:qn,j=m.useCallback((b,v)=>{x(v)},[]),A=m.useCallback(()=>{h(b=>b-Qt)},[]),N=m.useCallback(()=>{h(b=>b+Qt)},[]),w=m.useCallback(async()=>{if(f){p(!0),R(null);try{const b=await Un(i,f,l);s(b)}catch(b){console.error("Failed to crop image:",b),R(n("validation.ocr.errors.processingFailed")),p(!1)}}},[f,i,l,s,n]);return a.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-gray-900",children:[a.jsx("div",{className:"relative flex-1",children:a.jsx(ca,{image:i,crop:o,zoom:d,rotation:l,aspect:E,minZoom:Yn,maxZoom:Zn,onCropChange:c,onZoomChange:u,onRotationChange:h,onCropComplete:j,showGrid:!0,classes:{containerClassName:"!absolute !inset-0",cropAreaClassName:"!border-2 !border-white/90"}})}),a.jsxs("div",{className:"flex-shrink-0 py-2 px-4",children:[y&&a.jsxs("div",{className:"flex items-center gap-2 mb-2 px-3 py-2 text-sm text-red-200 bg-red-900/50 rounded",role:"alert",children:[a.jsx(_e,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),y]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("button",{type:"button",onClick:A,className:"p-2 text-gray-300 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors","aria-label":n("validation.ocr.rotateLeft"),children:a.jsx(Ca,{className:"w-6 h-6","aria-hidden":"true"})}),a.jsx("span",{className:"px-3 py-1 text-sm text-gray-300 bg-white/10 rounded",children:n("validation.ocr.photoGuide.alignScoresheet")}),a.jsx("button",{type:"button",onClick:N,className:"p-2 text-gray-300 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors","aria-label":n("validation.ocr.rotateRight"),children:a.jsx(Sa,{className:"w-6 h-6","aria-hidden":"true"})})]})]}),a.jsxs("div",{className:"flex-shrink-0 flex gap-4 p-4 bg-white dark:bg-gray-800",children:[a.jsxs("button",{type:"button",onClick:r,disabled:g,className:"flex-1 flex items-center justify-center gap-2 min-h-12 px-4 py-3 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-medium transition-colors disabled:opacity-50",children:[a.jsx(me,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.cancel")]}),a.jsxs("button",{type:"button",onClick:w,disabled:g||!f,className:"flex-1 flex items-center justify-center gap-2 min-h-12 px-4 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg font-medium transition-colors disabled:opacity-50",children:[a.jsx(He,{className:"w-5 h-5","aria-hidden":"true"}),n(g?"validation.ocr.processing":"common.confirm")]})]})]})}const Jn=100;function ei({scoresheetType:t}){const{t:e}=B(),s=t==="electronic",n={width:`${(s?tr:sr)*Jn}%`,aspectRatio:`${Je}`},i=e(s?"validation.ocr.photoGuide.electronicHint":"validation.ocr.photoGuide.manuscriptHint");return a.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40"}),a.jsxs("div",{className:"relative border-2 border-white/80 rounded-lg bg-transparent z-10",style:n,children:[a.jsx("div",{className:"absolute -top-0.5 -left-0.5 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl-lg"}),a.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr-lg"}),a.jsx("div",{className:"absolute -bottom-0.5 -left-0.5 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl-lg"}),a.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-6 h-6 border-b-4 border-r-4 border-white rounded-br-lg"}),a.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[a.jsx("div",{className:"w-8 h-0.5 bg-white/50"}),a.jsx("div",{className:"absolute w-0.5 h-8 bg-white/50"})]}),a.jsx("div",{className:"absolute -bottom-10 left-0 right-0 text-center",children:a.jsx("span",{className:"text-sm text-white/90 bg-black/50 px-3 py-1 rounded-full",children:i})})]}),a.jsx("div",{className:"absolute top-4 left-0 right-0 text-center z-10",children:a.jsx("span",{className:"text-sm font-medium text-white/90 bg-black/50 px-4 py-2 rounded-lg",children:e("validation.ocr.photoGuide.alignScoresheet")})})]})}const ti=10,Jt=1024,si=ti*Jt*Jt,ri=["image/jpeg","image/png","image/webp"],ai=".jpg,.jpeg,.png,.webp",ni={facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},es=.92;function ii({isOpen:t,scoresheetType:e,onClose:s,onImageSelected:r}){const{t:n}=B(),i=m.useRef(null),o=m.useRef(null),c=m.useRef(null),[d,u]=m.useState("select"),[l,h]=m.useState(null),[f,x]=m.useState(null),[g,p]=m.useState(!1),y=m.useCallback(()=>{c.current&&(c.current.getTracks().forEach(v=>v.stop()),c.current=null),o.current&&(o.current.srcObject=null)},[]);m.useEffect(()=>()=>{y()},[y]),m.useEffect(()=>{d==="camera"&&c.current&&o.current&&(o.current.srcObject=c.current,o.current.play().catch(console.error))},[d]),m.useEffect(()=>{if(!t)return;const v=k=>{k.key==="Escape"&&(d==="camera"?(y(),u("select")):d==="crop"?(x(null),u("select")):s())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[t,d,s,y]);const R=m.useCallback(async()=>{h(null),p(!1);try{const v=await navigator.mediaDevices.getUserMedia({video:ni,audio:!1});c.current=v,u("camera")}catch(v){console.error("Camera access error:",v),p(!0),h(n("validation.ocr.errors.cameraNotAvailable"))}},[n]),E=m.useCallback(async()=>{const v=o.current;if(!v)return;const k=document.createElement("canvas");k.width=v.videoWidth,k.height=v.videoHeight;const F=k.getContext("2d");if(!F)return;F.drawImage(v,0,0,k.width,k.height);const _=Fn(v.videoWidth,v.videoHeight,v.clientWidth,v.clientHeight,e);try{const I=await $n(k,_,es);y(),x(I),u("crop")}catch(I){console.error("Failed to crop captured image:",I),k.toBlob($=>{$&&(y(),x($),u("crop"))},"image/jpeg",es)}},[y,e]),j=m.useCallback(v=>{const k=v.target.files?.[0];if(k){if(v.target.value="",h(null),!ri.includes(k.type)){h(n("validation.scoresheetUpload.invalidFileType"));return}if(k.size>si){h(n("validation.ocr.errors.imageTooLarge"));return}x(k),u("crop")}},[n]),A=m.useCallback(()=>{h(null),i.current?.click()},[]),N=m.useCallback(v=>{r(v)},[r]),w=m.useCallback(()=>{x(null),u("select")},[]),b=m.useCallback(()=>{y(),u("select")},[y]);return t?d==="crop"&&f?a.jsx(Qn,{imageBlob:f,scoresheetType:e,onConfirm:N,onCancel:w}):d==="camera"?a.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-gray-900",children:[a.jsxs("div",{className:"relative flex-1 min-h-0 overflow-hidden",children:[a.jsx("video",{ref:o,className:"w-full h-full object-cover bg-gray-800",autoPlay:!0,playsInline:!0,muted:!0}),a.jsx(ei,{scoresheetType:e})]}),a.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-6 py-4 bg-gray-900 safe-area-bottom",children:[a.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-white bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition-colors",children:n("validation.ocr.cancel")}),a.jsx("button",{type:"button",onClick:E,className:"w-16 h-16 rounded-full bg-white hover:bg-gray-100 flex items-center justify-center transition-colors","aria-label":n("validation.ocr.takePhoto"),children:a.jsx("div",{className:"w-12 h-12 rounded-full bg-danger-500"})}),a.jsx("div",{className:"w-20"})]})]}):a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-capture-title",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-sm w-full mx-4 overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("h2",{id:"ocr-capture-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("validation.ocr.scanScoresheet")}),a.jsx("button",{type:"button",onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":n("common.close"),children:a.jsx(me,{className:"w-5 h-5","aria-hidden":"true"})})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n("validation.ocr.scanScoresheetDescription")}),l&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",role:"alert",children:[a.jsx(_e,{className:"w-5 h-5 text-danger-500 flex-shrink-0","aria-hidden":"true"}),a.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:l})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("button",{type:"button",onClick:g?A:R,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors font-medium",children:[a.jsx(kt,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.takePhoto")]}),a.jsxs("button",{type:"button",onClick:A,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 hover:bg-primary-100 dark:hover:bg-primary-900/50 border border-primary-200 dark:border-primary-800 rounded-lg transition-colors font-medium",children:[a.jsx(Ks,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.selectImage")]}),a.jsx("button",{type:"button",onClick:s,className:"w-full px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors font-medium",children:n("validation.ocr.cancel")})]}),a.jsx("input",{ref:i,type:"file",accept:ai,onChange:j,className:"hidden","aria-hidden":"true"})]})]})}):null}const oi="https://volleykit-proxy.takishima.workers.dev/ocr",ts=95,ss=50,li=8,rs=20,as=10,ci=20,di=40,ui=80,mi=100;class ns{#a;#e=!1;#s;#t=null;constructor(e,s){this.#a=e,this.#s=s??oi}#r(e,s){this.#a?.({status:e,progress:s})}async initialize(){if(!this.#e){this.#r("Initializing Mistral OCR...",0);try{const e=this.#s.replace("/ocr","/health");this.#t=new AbortController;const s=await fetch(e,{method:"GET",signal:this.#t.signal});if(this.#t=null,!s.ok)throw new Error("OCR service health check failed");this.#r("Mistral OCR ready",as),this.#e=!0}catch(e){if(this.#t=null,e instanceof Error&&e.name==="AbortError")throw new Error("OCR cancelled",{cause:e});console.warn("OCR service health check failed, will attempt OCR anyway:",e),this.#r("Mistral OCR ready (health check skipped)",as),this.#e=!0}}}#n(e){const n=new DOMParser().parseFromString(e,"text/html").querySelector("table");if(!n)return[e];const i=[],o=n.querySelectorAll("tr");for(const c of o){const d=c.querySelectorAll("th, td"),u=Array.from(d).map(l=>l.textContent?.trim()??"").filter(l=>l.length>0);u.length>0&&i.push(u.join("	"))}return i}#i(e){return typeof e=="string"?e:typeof e=="object"&&e!==null&&typeof e.content=="string"?e.content:(console.warn("Unexpected table format:",e),"")}#o(e,s){if(!s||s.length===0)return e;let r=e;for(let n=0;n<s.length;n++){const i=s[n];if(!i)continue;const o=`[tbl-${n}.html](tbl-${n}.html)`,c=this.#i(i),u=this.#n(c).join(`
`);r=r.replace(o,u)}return r}#l(e){const s=e.pages.map(o=>this.#o(o.markdown,o.tables??[])).join(`

--- Page Break ---

`).trim(),n=s.split(`
`).map((o,c)=>{const u=o.split(/\s+/).filter(l=>l.length>0).map((l,h)=>({text:l,confidence:ts,bbox:{x0:h*ss,y0:c*rs,x1:h*ss+l.length*li,y1:(c+1)*rs}}));return{text:o,confidence:ts,words:u}}),i=n.flatMap(o=>o.words);return{fullText:s,lines:n,words:i,hasPreciseBoundingBoxes:!1}}async recognize(e){if(!this.#e)throw new Error("MistralOCR not initialized. Call initialize() first.");this.#r("Uploading image...",ci),this.#t=new AbortController;try{const s=new FormData;s.append("image",e,"scoresheet.jpg"),this.#r("Processing with Mistral OCR...",di);const r=await fetch(this.#s,{method:"POST",body:s,signal:this.#t.signal});if(this.#r("Receiving results...",ui),!r.ok){const i=await r.json().catch(()=>({}));throw new Error(i.error??`OCR request failed: ${r.status}`)}const n=await r.json();return this.#r("Processing complete",mi),this.#l(n)}catch(s){throw s instanceof Error&&s.name==="AbortError"?new Error("OCR cancelled",{cause:s}):s}finally{this.#t=null}}async terminate(){this.#t&&(this.#t.abort(),this.#t=null),this.#e=!1}}const hi=1500,fi=200,pi=300,is=95,os=50,xi=8,ls=20,gi=50,yi=60,bi=90,Ni=100,wi=`VBC Heimteam	VBC Gastteam
N.	Name of the player	License	N.	Name of the player	License
1	MÃœLLER ANNA	OK	3	SCHMIDT LISA	OK
4	WEBER MARIE	OK	7	FISCHER JULIA	OK
6	SCHNEIDER LAURA	OK	9	MEYER SARAH	OK
8	ZIMMERMANN NINA	OK	11	WAGNER EMMA	OK
10	HUBER LENA	OK	13	BECKER MILA	OK
12	KELLER SOPHIE	OK	15	HOFFMANN PAULA	OK
LIBERO
L1	2 BRUNNER LEA	OK	L1	5 KOCH CLARA	OK
OFFICIAL MEMBERS ADMITTED ON THE BENCH
C	Hans Trainer	C	Peter Coach
AC	Maria Assistentin	AC	Sandra Helper`;function vi(t){const s=t.split(`
`).map((r,n)=>{const i=r.split(/\s+/).filter(o=>o.length>0);return{text:r,confidence:is,words:i.map((o,c)=>({text:o,confidence:is,bbox:{x0:c*os,y0:n*ls,x1:c*os+o.length*xi,y1:(n+1)*ls}}))}});return{fullText:t,lines:s,words:s.flatMap(r=>r.words),hasPreciseBoundingBoxes:!1}}const ki=vi(wi);class cs{#a;#e=!1;constructor(e){this.#a=e}#s(e,s){this.#a?.({status:e,progress:s})}async initialize(){this.#e||(this.#s("Initializing stub OCR...",0),await new Promise(e=>setTimeout(e,fi)),this.#s("Stub OCR ready",gi),this.#e=!0)}async recognize(e){if(!this.#e)throw new Error("StubOCR not initialized. Call initialize() first.");return this.#s("Processing image...",yi),await new Promise(s=>setTimeout(s,hi)),this.#s("Extracting text...",bi),await new Promise(s=>setTimeout(s,pi)),this.#s("Complete",Ni),ki}async terminate(){this.#e=!1}}const Ci=3e3,et="https://volleykit-proxy.ngn-damien.workers.dev/ocr";async function Ai(){try{const t=et.replace("/ocr","/health");return(await fetch(t,{method:"GET",signal:AbortSignal.timeout(Ci)})).ok}catch{return!1}}const Si={create(t){return new ns(t,et)},async createWithFallback(t){return await Ai()?new ns(t,et):(console.warn("OCR proxy not available, falling back to stub implementation"),new cs(t))},createStub(t){return new cs(t)}},nr=99,ir=2,ds=3,Ei=.6,tt=new Set(["C","AC","AC2","AC3","AC4","M"]),ji={O:"0",o:"0",Q:"0",D:"0",I:"1",l:"1",i:"1","|":"1",Z:"2",z:"2",E:"3",A:"4",S:"5",s:"5",G:"6",b:"6",T:"7",B:"8",g:"9",q:"9"},Ri={0:"O",1:"I","|":"I",5:"S",8:"B","@":"A","&":"A","â‚¬":"E","Â£":"L","Â¢":"C"};function _i(t){return t.split("").map(e=>ji[e]??e).join("")}function Ii(t){return t.split("").map(e=>Ri[e]??e).join("")}function Mi(t){if(!t)return null;const e=t.trim(),s=_i(e),r=/^(\d{1,2})$/.exec(s);if(r){const n=parseInt(r[1],10);if(n>=1&&n<=nr)return n}return null}function Ne(t){return t?Ii(t).toLowerCase().split(/[\s-]+/).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}function At(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=Ne(s[0]);return{lastName:o,firstName:"",displayName:o}}const r=Ne(s[0]),n=s.slice(1).map(Ne).join(" "),i=`${n} ${r}`;return{lastName:r,firstName:n,displayName:i}}function st(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=Ne(s[0]);return{lastName:o,firstName:"",displayName:o}}const r=Ne(s[s.length-1]),n=s.slice(0,-1).map(Ne).join(" "),i=`${n} ${r}`;return{lastName:r,firstName:n,displayName:i}}const Ti=3,St=[/punkte.*points.*punti/i,/lizenz.*licence.*licenza/i,/spieler.*joueur.*giocatore/i,/name.*nom.*nome/i,/mannschaft.*equipe.*squadra/i,/offizielle.*officiels.*ufficiali/i,/kapitÃ¤n.*capitaine.*capitano/i,/trainer.*entraÃ®neur.*allenatore/i,/aader\/ou\/o/i],Oi=10,Pi=[/^[\d\s.]+$/,/^["T:\s]+$/i,/^\d+$/];function Li(t){const e=t.trim();return e.length<2||e.length>=Oi&&/^[\d\s]+$/.test(e)?!0:Pi.some(s=>s.test(e))}function Bi(t){const e=t.split(`
`),s=e.some(o=>St.some(c=>c.test(o))),n=e.filter(o=>o.includes("	")).length>=Ti,i=/[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+/.test(t);return s&&(n||i)}function Di(t){if(!t||t.trim().length===0)return[];const e=[],s=/([a-zÃ -Ã¿])([A-Z]\.)/g,i=t.replace(s,"$1|||$2").replace(/([a-zÃ -Ã¿])([A-Z][a-zÃ -Ã¿])/g,"$1|||$2").split("|||").filter(o=>o.trim().length>0);for(const o of i){const c=o.trim();c.length>=2&&e.push(c)}return e}function Fi(t){if(!t||t.trim().length===0)return[];const e=[];let s=t;for(;s.length>0;){const r=s.match(/^(\d{1,2})\.(\d{1,2})\.((?:19|20)\d{2})/);if(r){e.push(r[0]),s=s.substring(r[0].length);continue}const n=s.match(/^(\d{1,2})\.(\d{1,2})\.(\d{2})/);if(n){e.push(n[0]),s=s.substring(n[0].length);continue}s=s.substring(1)}return e}const or=["VTV","TV","VBC","BC","VC","SC","FC","STV","TSV","USC","US"],$i=3;function zi(t){return t.replace(/aader\/ou\/o\s*B?\s*/gi," ").replace(/punkte[\s\S]*?punti\s*/i," ").replace(/\s+/g," ").trim()}function Hi(t){const s=t.trim().split(/\s+/);for(;s.length>1&&/^\d+$/.test(s[s.length-1]);)s.pop();return s.join(" ")}function Ui(t,e,s){const r=t.substring(e+s.length).trim();let n=r.length;for(const o of or){const c=r.toUpperCase().indexOf(` ${o} `);c>=0&&c<n&&(n=c)}const i=r.substring(0,n).trim();return Hi(`${s} ${i}`)}function Wi(t,e,s){const r=e===0||/\s/.test(t[e-1]),n=e+s,i=n>=t.length||/\s/.test(t[n]);return r&&i}function Vi(t){const e=zi(t),s=e.toUpperCase();for(const r of or){const n=s.indexOf(r);if(n<0||!Wi(e,n,r.length))continue;const i=Ui(e,n,r);if(i.length>$i)return i}return null}function Gi(t){return t.every(e=>St.some(s=>s.test(e)))}function Ki(t){const e=t.split(`
`);for(const s of e){if(!s.includes("	"))continue;const r=s.split("	").map(i=>i.trim());if(Gi(r))continue;const n=[];for(const i of r){const o=Vi(i);o&&!n.includes(o)&&n.push(o)}if(n.length>=2)return{teamA:n[0],teamB:n[1]};if(n.length===1)return{teamA:n[0],teamB:""}}return{teamA:"",teamB:""}}const Xi=14,qi=14,Yi=3,Zi=/^\d{1,2}\.\d{1,2}\.\d{2,4}$/,Qi=/^[A-Za-zÃ€-Ã¿]/,lr=/^\d{1,2}$/;function us(t,e){let s=e,r="",n=null,i="";if(s<t.length&&Zi.test(t[s])&&(r=t[s],s++),s<t.length&&lr.test(t[s])&&(n=parseInt(t[s],10),n>nr&&(n=null),s++),s<t.length&&Qi.test(t[s])&&(i=t[s],s++),!i)return{player:null,nextIndex:s};const o=At(i);return{player:{shirtNumber:n,lastName:o.lastName,firstName:o.firstName,displayName:o.displayName,rawName:i,licenseStatus:"",birthDate:r||void 0},nextIndex:s}}function Ji(t){const e=t.split("	").map(i=>i.trim()).filter(i=>i.length>0);if(e.length<Yi)return{teamA:null,teamB:null};let s=0;lr.test(e[0])&&parseInt(e[0],10)<=qi&&(s=1);const r=us(e,s);s=r.nextIndex;const n=us(e,s);return{teamA:r.player,teamB:n.player}}function eo(t){const e=t.split("	").map(i=>i.trim()).filter(i=>i.length>0);let s=null,r=null,n=0;if(n<e.length){const i=e[n].toUpperCase();if(tt.has(i)&&(n++,n<e.length&&/^[A-Za-zÃ€-Ã¿]/.test(e[n]))){const o=e[n],c=st(o);s={role:i,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:o},n++}}if(n<e.length){const i=e[n].toUpperCase();if(tt.has(i)&&(n++,n<e.length&&/^[A-Za-zÃ€-Ã¿]/.test(e[n]))){const o=e[n],c=st(o);r={role:i,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:o}}}return{teamA:s,teamB:r}}const to=/[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+/,so=/\d{1,2}\.\d{1,2}\.\d{2,4}.*\d{1,2}\.\d{1,2}\.\d{2,4}/,ro=/^[CA]C?\d?\t/i;function ao(t,e){const s=At(t);return{shirtNumber:null,lastName:s.lastName,firstName:s.firstName,displayName:s.displayName,rawName:t,licenseStatus:"",birthDate:e}}function no(t){const e=[],s=[],r=[],n=[],i=Math.ceil(t.length/2);for(let o=0;o<t.length;o++){const c=t[o],d=o<i;if(to.test(c)){const u=Di(c);d?e.push(...u):s.push(...u)}if(so.test(c)){const u=Fi(c);d?r.push(...u):n.push(...u)}}return{firstHalfNames:e,secondHalfNames:s,firstHalfDates:r,secondHalfDates:n}}function ms(t,e,s){for(let r=0;r<e.length&&!(t.players.length>=Xi);r++){const n=ao(e[r],s[r]);t.players.push(n)}}function io(t,e,s,r,n){if(e||ro.test(t)){const i=eo(t);return i.teamA&&r.officials.push(i.teamA),i.teamB&&n.officials.push(i.teamB),!0}if(s){const i=Ji(t);return i.teamA&&r.players.push(i.teamA),i.teamB&&n.players.push(i.teamB),!0}return!1}function oo(t){return!!(Li(t)||St.some(e=>e.test(t))&&!t.includes("	"))}function lo(t){return Et(t)?"libero":jt(t)?"officials":Rt(t)?"end":null}function co(t,e){const s=[];return t.players.length===0&&s.push("No players found for Team A"),e.players.length===0&&s.push("No players found for Team B"),t.officials.length===0&&e.officials.length===0&&s.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),s}function uo(t){const e=t.split(`
`).map(d=>d.trim()),s=Ki(t),r={name:s.teamA,players:[],officials:[]},n={name:s.teamB,players:[],officials:[]};let i=!1,o=!1;for(const d of e){if(oo(d))continue;const u=lo(d);if(u==="end")break;if(u==="libero"){i=!0,o=!1;continue}if(u==="officials"){o=!0,i=!1;continue}if(!d.includes("	")||io(d,o,i,r,n))continue;const l=d.split("	"),h=no(l);ms(r,h.firstHalfNames,h.firstHalfDates),ms(n,h.secondHalfNames,h.secondHalfDates)}const c=co(r,n);return{teamA:r,teamB:n,warnings:c}}const cr=/^(\d{1,2})[\s.:_-]+([A-Za-zÃ€-Ã¿][A-Za-zÃ€-Ã¿\s]*)/,dr=/^([0-9OoIlZzSsGgBb]{1,2})[\s.:_-]+([A-Za-zÃ€-Ã¿][A-Za-zÃ€-Ã¿\s]*)/,mo=/^(C|AC\d?)[\s.:_-]+([a-zÃ -Ã¿][a-zÃ -Ã¿\s]*)/i;function ho(t){const e=t.toUpperCase();return e.includes("TEAM A")||e.includes("TEAM B")||e.includes("Ã‰QUIPE A")||e.includes("Ã‰QUIPE B")||e.includes("MANNSCHAFT A")||e.includes("MANNSCHAFT B")||e.includes("HOME")||e.includes("AWAY")||e.includes("HEIM")||e.includes("GAST")}function Et(t){return t.toUpperCase().includes("LIBERO")}function jt(t){const e=t.toUpperCase();return e.includes("OFFICIAL")||e.startsWith("COACH")||/^TRAINER\b/.test(e)}function Rt(t){const e=t.toUpperCase();return e.includes("SIGNATURE")||e.includes("CAPTAIN")||e.includes("REFEREE")||e.includes("ARBITRE")}function fo(t){let e=cr.exec(t);if(e||(e=dr.exec(t)),!e)return null;const s=e[1],r=e[2].trim(),n=Mi(s);if(r.length<ir)return null;const i=At(r);return{shirtNumber:n,lastName:i.lastName,firstName:i.firstName,displayName:i.displayName,rawName:r,licenseStatus:""}}function hs(t){const e=mo.exec(t);if(!e)return null;const s=e[1].toUpperCase(),r=e[2].trim();if(!tt.has(s)||r.length<ir)return null;const n=st(r);return{role:s,lastName:n.lastName,firstName:n.firstName,displayName:n.displayName,rawName:r}}function ur(t){const e=t.trim();if(e.length<ds||cr.test(e)||dr.test(e)||Et(e)||jt(e)||Rt(e))return null;const s=(e.match(/[A-Za-zÃ€-Ã¿]/g)??[]).length;return s>=ds&&s/e.length>Ei?e:null}const po=["TEAM A","Ã‰QUIPE A","MANNSCHAFT A","HOME","HEIM"],xo=["TEAM B","Ã‰QUIPE B","MANNSCHAFT B","AWAY","GAST"],go=/TEAM\s*A|Ã‰QUIPE\s*A|MANNSCHAFT\s*A|HOME|HEIM/i,yo=/TEAM\s*B|Ã‰QUIPE\s*B|MANNSCHAFT\s*B|AWAY|GAST/i;function bo(t){return po.some(e=>t.includes(e))}function No(t){return xo.some(e=>t.includes(e))}function fs(t,e){const s=t.replace(e,"").trim();return ur(s)??""}function wo(t,e){const s=t.toUpperCase();if(bo(s)){const r=fs(t,go);return r&&(e.teamAName=r),{team:"A",isTeamA:!0}}if(No(s)){const r=fs(t,yo);return r&&(e.teamBName=r),{team:"B",isTeamA:!1}}return null}function vo(t){const e={teamALines:[],teamBLines:[],teamAName:"",teamBName:""};let s=null,r=!1;for(const n of t){const i=n.trim();if(i){if(ho(i)){const o=wo(i,e);if(o){s=o.team,o.isTeamA&&(r=!0);continue}}if(!r&&!e.teamAName){const o=ur(i);if(o){e.teamAName=o,s="A";continue}}s===null&&(s="A"),s==="A"?e.teamALines.push(i):e.teamBLines.push(i)}}return e}function ps(t,e){const s={name:e,players:[],officials:[]},r=[];let n=!1;for(const i of t){if(jt(i)){n=!0;continue}if(Rt(i))break;if(!Et(i))if(n){const o=hs(i);o&&s.officials.push(o)}else{const o=fo(i);if(o){s.players.push(o);continue}const c=hs(i);c&&s.officials.push(c)}}return{team:s,warnings:r}}function ko(t){const e=[],s={name:"",players:[],officials:[]};if(!t||typeof t!="string")return e.push("No OCR text provided"),{teamA:{...s},teamB:{...s},warnings:e};const r=t.split(`
`).map(c=>c.trim()).filter(c=>c.length>0);if(r.length===0)return e.push("OCR text contains no lines"),{teamA:{...s},teamB:{...s},warnings:e};if(Bi(t))return uo(t);const n=vo(r),i=ps(n.teamALines,n.teamAName),o=ps(n.teamBLines,n.teamBName);return e.push(...i.warnings),e.push(...o.warnings),i.team.players.length===0&&e.push("No players found for Team A"),o.team.players.length===0&&n.teamBLines.length>0&&e.push("No players found for Team B"),{teamA:i.team,teamB:o.team,warnings:e}}const xe=3,Ie=6,mr=2,hr=4,fr=0,pr=1,xr=2,gr=3,yr=4,br=5,Nr=2,wr=3,Co=3,Ao=3,rt=3,at=99,So=4,Eo=50,xs=new Set(["NOT","LFP","OK","NE","PEN"]),jo=5;function Ro(t){if(!t||t.includes("	"))return null;const s=t.trim().split(/\s+/);if(s.length<jo)return null;const r=s[0];if(!/^\d{1,2}$/.test(r))return null;const n=parseInt(r,10);if(n<1||n>at)return null;let i=-1;for(let g=2;g<s.length-2;g++)if(xs.has(s[g].toUpperCase())){i=g;break}if(i===-1)return null;const o=s[i],c=s.slice(1,i);if(c.length===0)return null;const d=s[i+1];if(!d||!/^\d{1,2}$/.test(d))return null;const u=parseInt(d,10);if(u<1||u>at)return null;const l=s.slice(i+2);if(l.length===0)return null;const h=l[l.length-1];let f="",x=l;return xs.has(h.toUpperCase())&&(f=h,x=l.slice(0,-1)),x.length===0?null:{teamAParts:[r,c.join(" "),o],teamBParts:[d,x.join(" "),f]}}function _t(t){if(!t||t.includes("	"))return null;const e=t.trim(),s=e.search(/\s{3,}/);if(s===-1)return null;const r=e.slice(s).search(/\S/);if(r===-1)return null;const n=e.slice(0,s),i=e.slice(s+r),o=n.replace(/^[AB]\s+/,"").trim(),c=i.replace(/^[AB]\s+/,"").trim();return o.length>=rt&&c.length>=rt?[o,c]:null}function we(t){return t?t.toLowerCase().split(/[\s-]+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}function nt(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=we(s[0]);return{lastName:o,firstName:"",displayName:o}}const r=we(s[0]),n=s.slice(1).map(we).join(" "),i=`${n} ${r}`;return{lastName:r,firstName:n,displayName:i}}function _o(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=we(s[0]);return{lastName:o,firstName:"",displayName:o}}const r=we(s[s.length-1]),n=s.slice(0,-1).map(we).join(" "),i=`${n} ${r}`;return{lastName:r,firstName:n,displayName:i}}function Io(t){if(!t||typeof t!="string")return null;const e=t.trim(),s=/^L\d?\s+(\d{1,2})$/.exec(e);return s?parseInt(s[1],10):null}function Mo(t){if(!t||typeof t!="string")return{number:null,name:""};const e=t.trim(),s=/^(\d{1,2})\s+(\S[\s\S]*?)$/.exec(e);return s?{number:parseInt(s[1],10),name:s[2].trim()}:{number:null,name:e}}function vr(t){const e=t.toUpperCase();return e.includes("OFFICIAL MEMBERS")||e.includes("ADMITTED ON THE BENCH")}function kr(t){const e=t.toUpperCase();return e.includes("SIGNATURES")||e.includes("TEAM CAPTAIN")}function Cr(t,e){return t.toUpperCase().includes("LIBERO")&&e.length<=2}const To=new Set(["C","AC","AC2","AC3","AC4","M"]);function Oo(t){return To.has(t.toUpperCase().trim())}function gs(t){const e=t.toUpperCase();return e.includes("LIBERO")||e.includes("N.")||e.includes("NAME OF THE PLAYER")}function Po(t){const e=/[a-zA-Z]{3,}/;return t.some(s=>e.test(s))}function Lo(t,e){const s=Math.max(0,e-Ao);for(let r=e-1;r>=s;r--){const n=t[r];if(!n)continue;const i=n.split("	").filter(c=>c.trim().length>0);if(i.length>=2&&Po(i)||_t(n))return r}return-1}function Bo(t){const e=t.split("	");if(e.length<xe)return!1;const s=e[0].trim();if(!/^\d{1,2}$/.test(s))return!1;const r=parseInt(s,10);if(r<1||r>at)return!1;const n=e[1].trim();return/^[A-Z\s]+$/.test(n)&&n.length>rt}function Ar(t){for(let e=0;e<t.length;e++){const s=t[e];if(!s)continue;const r=s.toUpperCase();if(r.includes("NAME OF THE PLAYER")||r.includes("N.")&&r.includes("NAME"))return{startIndex:e+1,teamNamesIndex:Lo(t,e)}}for(let e=0;e<t.length;e++){const s=t[e];if(s&&Bo(s))return{startIndex:e,teamNamesIndex:e-1}}return{startIndex:0,teamNamesIndex:-1}}function ve(t){return t.replace(/^[AB]\s+/,"").trim()}function Sr(t,e){if(e<0||e>=t.length)return{teamAName:"",teamBName:""};const s=t[e];if(!s)return{teamAName:"",teamBName:""};const r=s.split("	").map(i=>i.trim()).filter(i=>i.length>0);if(r.length>=2)return{teamAName:ve(r[0]),teamBName:ve(r[1])};const n=_t(s);return n?{teamAName:n[0],teamBName:n[1]}:r.length===1?{teamAName:ve(r[0]),teamBName:""}:{teamAName:"",teamBName:""}}function ue(t,e){const s=t[e],r=t[e+1],n=t[e+2];if(!s||!r)return null;const i=parseInt(s,10);if(isNaN(i))return null;const o=nt(r);return{shirtNumber:i,lastName:o.lastName,firstName:o.firstName,displayName:o.displayName,rawName:r,licenseStatus:n||""}}function ke(t,e,s,r){const n=t[e],i=t[s];if(!n||!i)return null;const o=Io(n);if(o===null){const d=Mo(i);if(d.name){const u=nt(d.name);return{shirtNumber:d.number,lastName:u.lastName,firstName:u.firstName,displayName:u.displayName,rawName:d.name,licenseStatus:t[r]||""}}return null}const c=nt(i);return{shirtNumber:o,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:i,licenseStatus:t[r]||""}}function Ce(t,e,s){const r=t[e],n=t[s];if(!r||!Oo(r)||!n)return null;const i=_o(n);return{role:r.toUpperCase(),lastName:i.lastName,firstName:i.firstName,displayName:i.displayName,rawName:n}}function It(t){return t.teamAColumnEnded||t.seenTwoColumnPlayers}function Er(t,e,s){if(s.headerRowsParsed===0&&!gs(e)){if(t.length>=2)s.teamA.name=ve(t[0]),s.teamB.name=ve(t[1]);else if(t.length===1){const r=_t(e);r?(s.teamA.name=r[0],s.teamB.name=r[1]):s.teamA.name=ve(t[0])}return s.headerRowsParsed++,"header"}return gs(e)?"players":(s.headerRowsParsed++,s.headerRowsParsed>Co?"players":"header")}function Do(t,e,s){if(t.length<xe){const n=Ro(e);if(n){s.seenTwoColumnPlayers=!0;const i=ue(n.teamAParts,0);i&&s.teamA.players.push(i);const o=ue(n.teamBParts,0);o&&s.teamB.players.push(o)}return}if(t.length>=Ie){s.seenTwoColumnPlayers=!0;const n=ue(t,0);n&&s.teamA.players.push(n);const i=ue(t,xe);i&&s.teamB.players.push(i)}else{const n=ue(t,0);n&&(It(s)?(s.teamAColumnEnded=!0,s.teamB.players.push(n)):s.teamA.players.push(n))}}function Fo(t,e){if(t.length<xe)return;if(t.length>=Ie){const r=ke(t,fr,pr,xr);r&&e.teamA.players.push(r);const n=ke(t,gr,yr,br);n&&e.teamB.players.push(n)}else{const r=ke(t,0,1,2);r&&(It(e)?e.teamB.players.push(r):e.teamA.players.push(r))}}function $o(t,e){if(t.length<mr)return;if(t.length>=hr){const r=Ce(t,0,1);r&&e.teamA.officials.push(r);const n=Ce(t,Nr,wr);n&&e.teamB.officials.push(n)}else{const r=Ce(t,0,1);r&&(It(e)?e.teamB.officials.push(r):e.teamA.officials.push(r))}}function zo(t,e){if(kr(t)){e.section="done";return}if(e.section==="done")return;if(vr(t)){e.section="officials";return}const s=t.split("	").map(r=>r.trim());if(Cr(t,s)){e.section="libero";return}switch(e.section){case"header":e.section=Er(s,t,e);break;case"players":Do(s,t,e);break;case"libero":Fo(s,e);break;case"officials":$o(s,e);break}}function Ho(t){const e=[],s={section:"header",headerRowsParsed:0,teamA:{name:"",players:[],officials:[]},teamB:{name:"",players:[],officials:[]},seenTwoColumnPlayers:!1,teamAColumnEnded:!1};if(!t||typeof t!="string")return e.push("No OCR text provided"),{teamA:s.teamA,teamB:s.teamB,warnings:e};const r=t.split(`
`).map(l=>l.trim()).filter(l=>l.length>0),{startIndex:n,teamNamesIndex:i}=Ar(r);n>0&&e.push(`Skipped ${n} lines of non-player data (score/set information)`);const{teamAName:o,teamBName:c}=Sr(r,i);s.teamA.name=o,s.teamB.name=c;const d=o.length>0||c.length>0;s.section=d?"players":"header";const u=r.slice(n);if(u.length===0)return e.push("OCR text contains no lines"),{teamA:s.teamA,teamB:s.teamB,warnings:e};for(const l of u)zo(l,s);return s.teamA.players.length===0&&e.push("No players found for Team A"),s.teamB.players.length===0&&e.push("No players found for Team B"),s.teamA.officials.length===0&&s.teamB.officials.length===0&&e.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),{teamA:s.teamA,teamB:s.teamB,warnings:e}}function Uo(t,e){if(t.text.includes("	")||!e.isValid||!t.words||t.words.length===0)return t.text;const s=[...t.words].sort((i,o)=>i.bbox.x0-o.bbox.x0),r=[],n=[];for(const i of s)(i.bbox.x0+i.bbox.x1)/2<e.midpoint?r.push(i.text):n.push(i.text);return r.length===0||n.length===0?t.text:`${r.join(" ")}	${n.join(" ")}`}function Wo(t){const e=[],s=[];for(const o of t){if(!o.words||o.words.length<So||o.text.split("	").filter(f=>f.trim().length>0).length<Ie)continue;const u=[...o.words].sort((f,x)=>f.bbox.x0-x.bbox.x0);let l=0,h=-1;for(let f=0;f<u.length-1;f++){const x=u[f+1].bbox.x0-u[f].bbox.x1;x>l&&(l=x,h=f)}if(h>=0&&l>Eo){const f=u[h].bbox.x1,x=u[h+1].bbox.x0;e.push(f),s.push(x)}}if(e.length<2||s.length<2)return{midpoint:0,isValid:!1};const r=e.reduce((o,c)=>o+c,0)/e.length,n=s.reduce((o,c)=>o+c,0)/s.length;return{midpoint:(r+n)/2,isValid:!0}}function Mt(t,e){return!e.isValid||!t.words||t.words.length===0?"B":t.words.reduce((r,n)=>r+n.bbox.x0,0)/t.words.length<e.midpoint?"A":"B"}function Vo(t,e){if(t.length<xe)return;if(t.length>=Ie){e.seenTwoColumnPlayers=!0;const r=ue(t,0);r&&e.teamA.players.push(r);const n=ue(t,xe);n&&e.teamB.players.push(n)}else{const r=ue(t,0);r&&e.currentLine?Mt(e.currentLine,e.columnBoundary)==="A"?e.teamA.players.push(r):(e.teamAColumnEnded=!0,e.teamB.players.push(r)):r&&(e.seenTwoColumnPlayers?(e.teamAColumnEnded=!0,e.teamB.players.push(r)):e.teamA.players.push(r))}}function Go(t,e){if(t.length<xe)return;if(t.length>=Ie){const r=ke(t,fr,pr,xr);r&&e.teamA.players.push(r);const n=ke(t,gr,yr,br);n&&e.teamB.players.push(n)}else{const r=ke(t,0,1,2);r&&e.currentLine?Mt(e.currentLine,e.columnBoundary)==="A"?e.teamA.players.push(r):e.teamB.players.push(r):r&&(e.teamAColumnEnded||e.seenTwoColumnPlayers?e.teamB.players.push(r):e.teamA.players.push(r))}}function Ko(t,e){if(t.length<mr)return;if(t.length>=hr){const r=Ce(t,0,1);r&&e.teamA.officials.push(r);const n=Ce(t,Nr,wr);n&&e.teamB.officials.push(n)}else{const r=Ce(t,0,1);r&&e.currentLine?Mt(e.currentLine,e.columnBoundary)==="A"?e.teamA.officials.push(r):e.teamB.officials.push(r):r&&(e.teamAColumnEnded||e.seenTwoColumnPlayers?e.teamB.officials.push(r):e.teamA.officials.push(r))}}function Xo(t,e,s){if(e.currentLine=s,kr(t)){e.section="done";return}if(e.section==="done")return;if(vr(t)){e.section="officials";return}const r=t.split("	").map(n=>n.trim());if(Cr(t,r)){e.section="libero";return}switch(e.section){case"header":e.section=Er(r,t,e);break;case"players":Vo(r,e);break;case"libero":Go(r,e);break;case"officials":Ko(r,e);break}}function qo(t,e){if((e?.type??"electronic")==="manuscript")return ko(t.fullText);const r=[];if(!t.lines||t.lines.length===0){const p=Ho(t.fullText);return{...p,warnings:["No OCR line data available, using text-only parsing",...p.warnings]}}const n=Wo(t.lines);n.isValid||r.push("Could not determine column boundaries from bounding boxes, using heuristic fallback");const i={section:"header",headerRowsParsed:0,teamA:{name:"",players:[],officials:[]},teamB:{name:"",players:[],officials:[]},seenTwoColumnPlayers:!1,teamAColumnEnded:!1,columnBoundary:n},o=[],c=new Map;for(const p of t.lines){const y=p.text.trim();if(!y)continue;const R=Uo(p,n);o.push(R),c.set(y,p),R!==y&&c.set(R,p)}const d=o.length>0?o:t.fullText.split(`
`).map(p=>p.trim()).filter(p=>p.length>0),{startIndex:u,teamNamesIndex:l}=Ar(d);u>0&&r.push(`Skipped ${u} lines of non-player data (score/set information)`);const{teamAName:h,teamBName:f}=Sr(d,l);i.teamA.name=h,i.teamB.name=f;const x=h.length>0||f.length>0;i.section=x?"players":"header";const g=d.slice(u);if(g.length===0)return r.push("OCR text contains no lines"),{teamA:i.teamA,teamB:i.teamB,warnings:r};for(const p of g){const y=c.get(p);Xo(p,i,y)}return i.teamA.players.length===0&&r.push("No players found for Team A"),i.teamB.players.length===0&&r.push("No players found for Team B"),i.teamA.officials.length===0&&i.teamB.officials.length===0&&r.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),{teamA:i.teamA,teamB:i.teamB,warnings:r}}function Yo(){const[t,e]=m.useState(!1),[s,r]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(null),[d,u]=m.useState(null),l=m.useRef(null),h=m.useCallback(async(g,p="electronic")=>{e(!0),r(null),i(null),c(null),u(null);try{const y=Si.create(j=>{r(j)});l.current=y,await y.initialize();const R=await y.recognize(g),E=qo(R,{type:p});return await y.terminate(),l.current=null,i(E),c(R),e(!1),E}catch(y){const R=y instanceof Error?y:new Error(String(y));return R.message!=="OCR cancelled"&&u(R),e(!1),l.current=null,null}},[]),f=m.useCallback(async()=>{if(l.current){try{await l.current.terminate()}catch{}l.current=null}e(!1),r(null)},[]),x=m.useCallback(()=>{e(!1),r(null),i(null),c(null),u(null)},[]);return{isProcessing:t,progress:s,result:n,ocrResult:o,error:d,processImage:h,cancel:f,reset:x}}function Zo(t,e){return t.officials.filter(s=>s.role===e).length}function ys(t){return t.officials.some(e=>e.role==="AC3")}function bs(t){return Zo(t,"M")>=2}function Qo(){const[t,e]=m.useState({isOpen:!1,type:null}),s=m.useCallback(n=>{ys(n.teamA)||ys(n.teamB)?e({isOpen:!0,type:"ac3"}):(bs(n.teamA)||bs(n.teamB))&&e({isOpen:!0,type:"multipleDoctors"})},[]),r=m.useCallback(()=>{e({isOpen:!1,type:null})},[]);return{easterEgg:t,checkForEasterEggs:s,dismissEasterEgg:r}}const Ns=["#f94144","#f3722c","#f8961e","#f9c74f","#90be6d","#43aa8b","#4d908e","#577590","#277da1","#9b5de5"],Jo=100,el=.3,ws=.99,tl=.015,sl=8,rl=8,al=200,nl=.3,il=10,ol=8,ll=8,vs=.5,cl=.2,dl=.6,ks=2,ul=4;function ml(t=3e3){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const e=document.createElement("canvas");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e);const s=()=>{e.width=window.innerWidth,e.height=window.innerHeight};s(),window.addEventListener("resize",s);const r=e.getContext("2d");if(!r){e.parentNode&&e.parentNode.removeChild(e);return}const n=[],i=e.width/2;for(let u=0;u<Jo;u++){const l=Math.random()*Math.PI*2,h=sl+Math.random()*rl;n.push({x:i+(Math.random()-vs)*al,y:e.height*nl,vx:Math.cos(l)*h,vy:Math.sin(l)*h-il,color:Ns[Math.floor(Math.random()*Ns.length)],size:ol+Math.random()*ll,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-vs)*cl,opacity:1})}let o;const c=Date.now(),d=()=>{const u=Date.now()-c;if(u>t||n.every(l=>l.opacity<=0)){cancelAnimationFrame(o),window.removeEventListener("resize",s),e.parentNode&&e.parentNode.removeChild(e);return}r.clearRect(0,0,e.width,e.height);for(const l of n)l.vy+=el,l.vx*=ws,l.vy*=ws,l.x+=l.vx,l.y+=l.vy,l.rotation+=l.rotationSpeed,u>t*dl&&(l.opacity-=tl),l.opacity>0&&(r.save(),r.translate(l.x,l.y),r.rotate(l.rotation),r.globalAlpha=Math.max(0,l.opacity),r.fillStyle=l.color,r.fillRect(-l.size/ks,-l.size/ul,l.size,l.size/ks),r.restore());o=requestAnimationFrame(d)};d()}const hl=3e3;function fl({isOpen:t,type:e,onClose:s}){const{t:r}=B();m.useEffect(()=>{t&&ml(hl)},[t]);const n=`easter-egg-${e}-title`,i=()=>{switch(e){case"ac3":return a.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center",children:a.jsx(ya,{className:"w-6 h-6 text-amber-600 dark:text-amber-400","aria-hidden":"true"})});case"multipleDoctors":return a.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:a.jsx(_a,{className:"w-6 h-6 text-red-600 dark:text-red-400","aria-hidden":"true"})})}};return a.jsxs(Nt,{isOpen:t,onClose:s,titleId:n,size:"sm",zIndex:70,children:[a.jsx(wt,{title:r(`easterEggs.${e}.title`),titleId:n,icon:i()}),a.jsx("p",{className:"text-text-secondary dark:text-text-secondary-dark mb-6",children:r(`easterEggs.${e}.message`)}),a.jsx(Us,{children:a.jsx("button",{type:"button",onClick:s,className:"w-full px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:r("easterEggs.dismiss")})})]})}function oe(t){return Array.isArray?Array.isArray(t):_r(t)==="[object Array]"}function pl(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function xl(t){return t==null?"":pl(t)}function ae(t){return typeof t=="string"}function jr(t){return typeof t=="number"}function gl(t){return t===!0||t===!1||yl(t)&&_r(t)=="[object Boolean]"}function Rr(t){return typeof t=="object"}function yl(t){return Rr(t)&&t!==null}function Q(t){return t!=null}function Ke(t){return!t.trim().length}function _r(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const bl="Incorrect 'index' type",Nl=t=>`Invalid value for key ${t}`,wl=t=>`Pattern length exceeds max of ${t}.`,vl=t=>`Missing ${t} property in key`,kl=t=>`Property 'weight' in key '${t}' must be a positive integer`,Cs=Object.prototype.hasOwnProperty;class Cl{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(r=>{let n=Ir(r);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(r=>{r.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ir(t){let e=null,s=null,r=null,n=1,i=null;if(ae(t)||oe(t))r=t,e=As(t),s=it(t);else{if(!Cs.call(t,"name"))throw new Error(vl("name"));const o=t.name;if(r=o,Cs.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(kl(o));e=As(o),s=it(o),i=t.getFn}return{path:e,id:s,weight:n,src:r,getFn:i}}function As(t){return oe(t)?t:t.split(".")}function it(t){return oe(t)?t.join("."):t}function Al(t,e){let s=[],r=!1;const n=(i,o,c)=>{if(Q(i))if(!o[c])s.push(i);else{let d=o[c];const u=i[d];if(!Q(u))return;if(c===o.length-1&&(ae(u)||jr(u)||gl(u)))s.push(xl(u));else if(oe(u)){r=!0;for(let l=0,h=u.length;l<h;l+=1)n(u[l],o,c+1)}else o.length&&n(u,o,c+1)}};return n(t,ae(e)?e.split("."):e,0),r?s:s[0]}const Sl={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},El={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},jl={location:0,threshold:.6,distance:100},Rl={useExtendedSearch:!1,getFn:Al,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var M={...El,...Sl,...jl,...Rl};const _l=/[^ ]+/g;function Il(t=1,e=3){const s=new Map,r=Math.pow(10,e);return{get(n){const i=n.match(_l).length;if(s.has(i))return s.get(i);const o=1/Math.pow(i,.5*t),c=parseFloat(Math.round(o*r)/r);return s.set(i,c),c},clear(){s.clear()}}}class Tt{constructor({getFn:e=M.getFn,fieldNormWeight:s=M.fieldNormWeight}={}){this.norm=Il(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,r)=>{this._keysMap[s.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,ae(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();ae(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,r=this.size();s<r;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!Q(e)||Ke(e))return;let r={v:e,i:s,n:this.norm.get(e)};this.records.push(r)}_addObject(e,s){let r={i:s,$:{}};this.keys.forEach((n,i)=>{let o=n.getFn?n.getFn(e):this.getFn(e,n.path);if(Q(o)){if(oe(o)){let c=[];const d=[{nestedArrIndex:-1,value:o}];for(;d.length;){const{nestedArrIndex:u,value:l}=d.pop();if(Q(l))if(ae(l)&&!Ke(l)){let h={v:l,i:u,n:this.norm.get(l)};c.push(h)}else oe(l)&&l.forEach((h,f)=>{d.push({nestedArrIndex:f,value:h})})}r.$[i]=c}else if(ae(o)&&!Ke(o)){let c={v:o,n:this.norm.get(o)};r.$[i]=c}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function Mr(t,e,{getFn:s=M.getFn,fieldNormWeight:r=M.fieldNormWeight}={}){const n=new Tt({getFn:s,fieldNormWeight:r});return n.setKeys(t.map(Ir)),n.setSources(e),n.create(),n}function Ml(t,{getFn:e=M.getFn,fieldNormWeight:s=M.fieldNormWeight}={}){const{keys:r,records:n}=t,i=new Tt({getFn:e,fieldNormWeight:s});return i.setKeys(r),i.setIndexRecords(n),i}function Pe(t,{errors:e=0,currentLocation:s=0,expectedLocation:r=0,distance:n=M.distance,ignoreLocation:i=M.ignoreLocation}={}){const o=e/t.length;if(i)return o;const c=Math.abs(r-s);return n?o+c/n:c?1:o}function Tl(t=[],e=M.minMatchCharLength){let s=[],r=-1,n=-1,i=0;for(let o=t.length;i<o;i+=1){let c=t[i];c&&r===-1?r=i:!c&&r!==-1&&(n=i-1,n-r+1>=e&&s.push([r,n]),r=-1)}return t[i-1]&&i-r>=e&&s.push([r,i-1]),s}const pe=32;function Ol(t,e,s,{location:r=M.location,distance:n=M.distance,threshold:i=M.threshold,findAllMatches:o=M.findAllMatches,minMatchCharLength:c=M.minMatchCharLength,includeMatches:d=M.includeMatches,ignoreLocation:u=M.ignoreLocation}={}){if(e.length>pe)throw new Error(wl(pe));const l=e.length,h=t.length,f=Math.max(0,Math.min(r,h));let x=i,g=f;const p=c>1||d,y=p?Array(h):[];let R;for(;(R=t.indexOf(e,g))>-1;){let b=Pe(e,{currentLocation:R,expectedLocation:f,distance:n,ignoreLocation:u});if(x=Math.min(b,x),g=R+l,p){let v=0;for(;v<l;)y[R+v]=1,v+=1}}g=-1;let E=[],j=1,A=l+h;const N=1<<l-1;for(let b=0;b<l;b+=1){let v=0,k=A;for(;v<k;)Pe(e,{errors:b,currentLocation:f+k,expectedLocation:f,distance:n,ignoreLocation:u})<=x?v=k:A=k,k=Math.floor((A-v)/2+v);A=k;let F=Math.max(1,f-k+1),_=o?h:Math.min(f+k,h)+l,I=Array(_+2);I[_+1]=(1<<b)-1;for(let S=_;S>=F;S-=1){let L=S-1,V=s[t.charAt(L)];if(p&&(y[L]=+!!V),I[S]=(I[S+1]<<1|1)&V,b&&(I[S]|=(E[S+1]|E[S])<<1|1|E[S+1]),I[S]&N&&(j=Pe(e,{errors:b,currentLocation:L,expectedLocation:f,distance:n,ignoreLocation:u}),j<=x)){if(x=j,g=L,g<=f)break;F=Math.max(1,2*f-g)}}if(Pe(e,{errors:b+1,currentLocation:f,expectedLocation:f,distance:n,ignoreLocation:u})>x)break;E=I}const w={isMatch:g>=0,score:Math.max(.001,j)};if(p){const b=Tl(y,c);b.length?d&&(w.indices=b):w.isMatch=!1}return w}function Pl(t){let e={};for(let s=0,r=t.length;s<r;s+=1){const n=t.charAt(s);e[n]=(e[n]||0)|1<<r-s-1}return e}const Fe=String.prototype.normalize?(t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(t=>t);class Tr{constructor(e,{location:s=M.location,threshold:r=M.threshold,distance:n=M.distance,includeMatches:i=M.includeMatches,findAllMatches:o=M.findAllMatches,minMatchCharLength:c=M.minMatchCharLength,isCaseSensitive:d=M.isCaseSensitive,ignoreDiacritics:u=M.ignoreDiacritics,ignoreLocation:l=M.ignoreLocation}={}){if(this.options={location:s,threshold:r,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:d,ignoreDiacritics:u,ignoreLocation:l},e=d?e:e.toLowerCase(),e=u?Fe(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(x,g)=>{this.chunks.push({pattern:x,alphabet:Pl(x),startIndex:g})},f=this.pattern.length;if(f>pe){let x=0;const g=f%pe,p=f-g;for(;x<p;)h(this.pattern.substr(x,pe),x),x+=pe;if(g){const y=f-pe;h(this.pattern.substr(y),y)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n}=this.options;if(e=s?e:e.toLowerCase(),e=r?Fe(e):e,this.pattern===e){let p={isMatch:!0,score:0};return n&&(p.indices=[[0,e.length-1]]),p}const{location:i,distance:o,threshold:c,findAllMatches:d,minMatchCharLength:u,ignoreLocation:l}=this.options;let h=[],f=0,x=!1;this.chunks.forEach(({pattern:p,alphabet:y,startIndex:R})=>{const{isMatch:E,score:j,indices:A}=Ol(e,p,y,{location:i+R,distance:o,threshold:c,findAllMatches:d,minMatchCharLength:u,includeMatches:n,ignoreLocation:l});E&&(x=!0),f+=j,E&&A&&(h=[...h,...A])});let g={isMatch:x,score:x?f/this.chunks.length:1};return x&&n&&(g.indices=h),g}}class he{constructor(e){this.pattern=e}static isMultiMatch(e){return Ss(e,this.multiRegex)}static isSingleMatch(e){return Ss(e,this.singleRegex)}search(){}}function Ss(t,e){const s=t.match(e);return s?s[1]:null}class Ll extends he{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Bl extends he{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const r=e.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,e.length-1]}}}class Dl extends he{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Fl extends he{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class $l extends he{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class zl extends he{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Or extends he{constructor(e,{location:s=M.location,threshold:r=M.threshold,distance:n=M.distance,includeMatches:i=M.includeMatches,findAllMatches:o=M.findAllMatches,minMatchCharLength:c=M.minMatchCharLength,isCaseSensitive:d=M.isCaseSensitive,ignoreDiacritics:u=M.ignoreDiacritics,ignoreLocation:l=M.ignoreLocation}={}){super(e),this._bitapSearch=new Tr(e,{location:s,threshold:r,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:d,ignoreDiacritics:u,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Pr extends he{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,r;const n=[],i=this.pattern.length;for(;(r=e.indexOf(this.pattern,s))>-1;)s=r+i,n.push([r,s-1]);const o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}const ot=[Ll,Pr,Dl,Fl,zl,$l,Bl,Or],Es=ot.length,Hl=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Ul="|";function Wl(t,e={}){return t.split(Ul).map(s=>{let r=s.trim().split(Hl).filter(i=>i&&!!i.trim()),n=[];for(let i=0,o=r.length;i<o;i+=1){const c=r[i];let d=!1,u=-1;for(;!d&&++u<Es;){const l=ot[u];let h=l.isMultiMatch(c);h&&(n.push(new l(h,e)),d=!0)}if(!d)for(u=-1;++u<Es;){const l=ot[u];let h=l.isSingleMatch(c);if(h){n.push(new l(h,e));break}}}return n})}const Vl=new Set([Or.type,Pr.type]);class Gl{constructor(e,{isCaseSensitive:s=M.isCaseSensitive,ignoreDiacritics:r=M.ignoreDiacritics,includeMatches:n=M.includeMatches,minMatchCharLength:i=M.minMatchCharLength,ignoreLocation:o=M.ignoreLocation,findAllMatches:c=M.findAllMatches,location:d=M.location,threshold:u=M.threshold,distance:l=M.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:i,findAllMatches:c,ignoreLocation:o,location:d,threshold:u,distance:l},e=s?e:e.toLowerCase(),e=r?Fe(e):e,this.pattern=e,this.query=Wl(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:i}=this.options;e=n?e:e.toLowerCase(),e=i?Fe(e):e;let o=0,c=[],d=0;for(let u=0,l=s.length;u<l;u+=1){const h=s[u];c.length=0,o=0;for(let f=0,x=h.length;f<x;f+=1){const g=h[f],{isMatch:p,indices:y,score:R}=g.search(e);if(p){if(o+=1,d+=R,r){const E=g.constructor.type;Vl.has(E)?c=[...c,...y]:c.push(y)}}else{d=0,o=0,c.length=0;break}}if(o){let f={isMatch:!0,score:d/o};return r&&(f.indices=c),f}}return{isMatch:!1,score:1}}}const lt=[];function Kl(...t){lt.push(...t)}function ct(t,e){for(let s=0,r=lt.length;s<r;s+=1){let n=lt[s];if(n.condition(t,e))return new n(t,e)}return new Tr(t,e)}const $e={AND:"$and",OR:"$or"},dt={PATH:"$path",PATTERN:"$val"},ut=t=>!!(t[$e.AND]||t[$e.OR]),Xl=t=>!!t[dt.PATH],ql=t=>!oe(t)&&Rr(t)&&!ut(t),js=t=>({[$e.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Lr(t,e,{auto:s=!0}={}){const r=n=>{let i=Object.keys(n);const o=Xl(n);if(!o&&i.length>1&&!ut(n))return r(js(n));if(ql(n)){const d=o?n[dt.PATH]:i[0],u=o?n[dt.PATTERN]:n[d];if(!ae(u))throw new Error(Nl(d));const l={keyId:it(d),pattern:u};return s&&(l.searcher=ct(u,e)),l}let c={children:[],operator:i[0]};return i.forEach(d=>{const u=n[d];oe(u)&&u.forEach(l=>{c.children.push(r(l))})}),c};return ut(t)||(t=js(t)),r(t)}function Yl(t,{ignoreFieldNorm:e=M.ignoreFieldNorm}){t.forEach(s=>{let r=1;s.matches.forEach(({key:n,norm:i,score:o})=>{const c=n?n.weight:null;r*=Math.pow(o===0&&c?Number.EPSILON:o,(c||1)*(e?1:i))}),s.score=r})}function Zl(t,e){const s=t.matches;e.matches=[],Q(s)&&s.forEach(r=>{if(!Q(r.indices)||!r.indices.length)return;const{indices:n,value:i}=r;let o={indices:n,value:i};r.key&&(o.key=r.key.src),r.idx>-1&&(o.refIndex=r.idx),e.matches.push(o)})}function Ql(t,e){e.score=t.score}function Jl(t,e,{includeMatches:s=M.includeMatches,includeScore:r=M.includeScore}={}){const n=[];return s&&n.push(Zl),r&&n.push(Ql),t.map(i=>{const{idx:o}=i,c={item:e[o],refIndex:o};return n.length&&n.forEach(d=>{d(i,c)}),c})}class ne{constructor(e,s={},r){this.options={...M,...s},this.options.useExtendedSearch,this._keyStore=new Cl(this.options.keys),this.setCollection(e,r)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof Tt))throw new Error(bl);this._myIndex=s||Mr(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Q(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let r=0,n=this._docs.length;r<n;r+=1){const i=this._docs[r];e(i,r)&&(this.removeAt(r),r-=1,n-=1,s.push(i))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:r,includeScore:n,shouldSort:i,sortFn:o,ignoreFieldNorm:c}=this.options;let d=ae(e)?ae(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Yl(d,{ignoreFieldNorm:c}),i&&d.sort(o),jr(s)&&s>-1&&(d=d.slice(0,s)),Jl(d,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(e){const s=ct(e,this.options),{records:r}=this._myIndex,n=[];return r.forEach(({v:i,i:o,n:c})=>{if(!Q(i))return;const{isMatch:d,score:u,indices:l}=s.searchIn(i);d&&n.push({item:i,idx:o,matches:[{score:u,value:i,norm:c,indices:l}]})}),n}_searchLogical(e){const s=Lr(e,this.options),r=(c,d,u)=>{if(!c.children){const{keyId:h,searcher:f}=c,x=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(d,h),searcher:f});return x&&x.length?[{idx:u,item:d,matches:x}]:[]}const l=[];for(let h=0,f=c.children.length;h<f;h+=1){const x=c.children[h],g=r(x,d,u);if(g.length)l.push(...g);else if(c.operator===$e.AND)return[]}return l},n=this._myIndex.records,i={},o=[];return n.forEach(({$:c,i:d})=>{if(Q(c)){let u=r(s,c,d);u.length&&(i[d]||(i[d]={idx:d,item:c,matches:[]},o.push(i[d])),u.forEach(({matches:l})=>{i[d].matches.push(...l)}))}}),o}_searchObjectList(e){const s=ct(e,this.options),{keys:r,records:n}=this._myIndex,i=[];return n.forEach(({$:o,i:c})=>{if(!Q(o))return;let d=[];r.forEach((u,l)=>{d.push(...this._findMatches({key:u,value:o[l],searcher:s}))}),d.length&&i.push({idx:c,item:o,matches:d})}),i}_findMatches({key:e,value:s,searcher:r}){if(!Q(s))return[];let n=[];if(oe(s))s.forEach(({v:i,i:o,n:c})=>{if(!Q(i))return;const{isMatch:d,score:u,indices:l}=r.searchIn(i);d&&n.push({score:u,key:e,value:i,idx:o,norm:c,indices:l})});else{const{v:i,n:o}=s,{isMatch:c,score:d,indices:u}=r.searchIn(i);c&&n.push({score:d,key:e,value:i,norm:o,indices:u})}return n}}ne.version="7.1.0";ne.createIndex=Mr;ne.parseIndex=Ml;ne.config=M;ne.parseQuery=Lr;Kl(Gl);const ec=50,Rs=.6,_s=.4,Br=90,Dr=85,Fr=95,tc=.4,$r=.6,je={threshold:tc,ignoreLocation:!0,includeScore:!0},Ot=100,zr=new Set(["de","del","della","di","du","von","van","den","der","la","le","las","los","dos","da","das"]);function sc(t){const e=new Map;for(const s of t){const r=[s.firstName??"",s.lastName??""].filter(x=>x&&x.trim()).join(" "),n=Ae(r),i=n?n.split(" ").filter(x=>x.length>=2||zr.has(x)):[],o=i.length>0?new ne(i,je):null,c=Ae(s.lastName??""),d=c?c.split(" ").filter(x=>x.length>1):[],u=d.length>0?new ne(d,je):null,l=Ae(s.firstName??""),h=l?l.split(" ").filter(x=>x.length>1):[],f=h.length>0?new ne(h,je):null;e.set(s.id,{fullNameWords:i,fullNameFuse:o,lastNameWords:d,lastNameFuse:u,firstNameWords:h,firstNameFuse:f})}return e}function Ae(t){return t?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function ze(t){return Ae(t)}function mt(t){const e=ze(t);return e?e.split(" ").filter(s=>s.length>=2||zr.has(s)):[]}function rc(t,e){const s=mt(t),r=mt(e);if(s.length===0||r.length===0)return 0;const n=new ne(r,je);let i=0;const o=new Set;for(const d of s){const u=n.search(d);for(const l of u){const h=l.refIndex;if(o.has(h))continue;const f=1-(l.score??1);if(f>0){i+=f,o.add(h);break}}}const c=Math.max(s.length,r.length);return Math.round(i/c*Fr)}function Is(t,e){const s=ze(t),r=ze(e);if(!s||!r)return 0;if(s===r)return Ot;if(s.includes(r)||r.includes(s)){const l=s.length<r.length?s:r,h=s.length>=r.length?s:r;return Math.round(l.length/h.length*Br)}const n=s.split(" ").filter(l=>l.length>1),i=r.split(" ").filter(l=>l.length>1);if(i.length===0)return 0;const o=new ne(i,je);let c=0;const d=new Set;for(const l of n){const h=o.search(l);for(const f of h){const x=f.refIndex;if(d.has(x))continue;const g=1-(f.score??1);if(g>$r){c+=g,d.add(x);break}}}const u=Math.max(n.length,i.length);return u===0?0:Math.round(c/u*Dr)}function ac(t,e,s){const r=mt(t);if(r.length===0||e.length===0||!s)return 0;let n=0;const i=new Set;for(const c of r){const d=s.search(c);for(const u of d){const l=u.refIndex;if(i.has(l))continue;const h=1-(u.score??1);if(h>0){n+=h,i.add(l);break}}}const o=Math.max(r.length,e.length);return Math.round(n/o*Fr)}function Ms(t,e,s,r){const n=ze(t);if(!n||!e)return 0;if(n===e)return Ot;if(n.includes(e)||e.includes(n)){const u=n.length<e.length?n:e,l=n.length>=e.length?n:e;return Math.round(u.length/l.length*Br)}const i=n.split(" ").filter(u=>u.length>1);if(s.length===0||!r)return 0;let o=0;const c=new Set;for(const u of i){const l=r.search(u);for(const h of l){const f=h.refIndex;if(c.has(f))continue;const x=1-(h.score??1);if(x>$r){o+=x,c.add(f);break}}}const d=Math.max(i.length,s.length);return d===0?0:Math.round(o/d*Dr)}function Ts(t,e){return[t,e].filter(s=>s&&s.trim()).join(" ")}function nc(t,e,s,r){let n=null,i=0;const o=Ts(t.firstName,t.lastName);for(const c of e){if(s.has(c.id))continue;let d,u;const l=r?.get(c.id);if(l){const f=Ae(c.lastName??""),x=Ae(c.firstName??""),g=Ms(t.lastName,f,l.lastNameWords,l.lastNameFuse),p=Ms(t.firstName,x,l.firstNameWords,l.firstNameFuse);d=g*Rs+p*_s,u=ac(o,l.fullNameWords,l.fullNameFuse)}else{const f=Is(t.lastName,c.lastName??""),x=Is(t.firstName,c.firstName??"");d=f*Rs+x*_s;const g=Ts(c.firstName??"",c.lastName??"");u=rc(o,g)}const h=Math.max(d,u);h>i&&(i=h,n=c)}return i<ec?{player:null,confidence:0}:{player:n,confidence:Math.min(Ot,Math.round(i))}}function Le(t,e){const s=[],r=new Set,n=sc(e);for(const o of t){const{player:c,confidence:d}=nc(o,e,r,n);c?(r.add(c.id),s.push({status:"match",ocrPlayer:o,rosterPlayerId:c.id,rosterPlayerName:c.displayName,confidence:d})):s.push({status:"ocr-only",ocrPlayer:o,rosterPlayerId:null,rosterPlayerName:null,confidence:0})}for(const o of e)r.has(o.id)||s.push({status:"roster-only",ocrPlayer:null,rosterPlayerId:o.id,rosterPlayerName:o.displayName,confidence:0});const i={match:0,"ocr-only":1,"roster-only":2};return s.sort((o,c)=>i[o.status]-i[c.status]),s}function ic(t,e){switch(t){case"match":return{icon:He,iconColor:"text-success-500",bgColor:"bg-success-50 dark:bg-success-900/20",borderColor:"border-success-200 dark:border-success-800",label:e("validation.ocr.comparison.matched")};case"ocr-only":return{icon:gt,iconColor:"text-warning-500",bgColor:"bg-warning-50 dark:bg-warning-900/20",borderColor:"border-warning-200 dark:border-warning-800",label:e("validation.ocr.comparison.ocrOnly")};case"roster-only":return{icon:pa,iconColor:"text-danger-500",bgColor:"bg-danger-50 dark:bg-danger-900/20",borderColor:"border-danger-200 dark:border-danger-800",label:e("validation.ocr.comparison.rosterOnly")}}}function Xe({result:t,isSelected:e,onToggle:s,isSelectable:r}){const{t:n,tInterpolate:i}=B(),o=ic(t.status,n),c=o.icon,d=t.status==="roster-only"?t.rosterPlayerName:t.ocrPlayer?.displayName,u=t.status==="match"?t.rosterPlayerName:null;return a.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${o.bgColor} ${o.borderColor}`,children:[r&&a.jsx("input",{type:"checkbox",checked:e,onChange:s,className:"w-4 h-4 text-primary-500 border-gray-300 rounded focus:ring-primary-500 focus:ring-2","aria-label":`Select ${d}`}),a.jsx("div",{className:`flex-shrink-0 ${o.iconColor}`,children:a.jsx(c,{className:"w-5 h-5","aria-hidden":"true"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ia,{className:"w-4 h-4 text-gray-400 flex-shrink-0","aria-hidden":"true"}),a.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:d})]}),u&&a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate",children:u})]}),a.jsxs("div",{className:"flex flex-col items-end gap-1",children:[a.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${o.bgColor} ${o.iconColor}`,children:o.label}),t.confidence>0&&a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("validation.ocr.comparison.confidence",{score:String(t.confidence)})})]})]})}function Be({results:t,selectedPlayerIds:e,onTogglePlayer:s,onSelectAll:r,onDeselectAll:n,readOnly:i=!1}){const{t:o,tInterpolate:c}=B(),{matched:d,ocrOnly:u,rosterOnly:l}=m.useMemo(()=>({matched:t.filter(p=>p.status==="match"),ocrOnly:t.filter(p=>p.status==="ocr-only"),rosterOnly:t.filter(p=>p.status==="roster-only")}),[t]),h=d.length,f=e.size,x=h>0&&f===h,g=!i&&h>0&&r&&n;return t.length===0?a.jsx("div",{className:"py-8 text-center",children:a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o("validation.ocr.comparison.noMatches")})}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[d.length>0&&a.jsx("span",{className:"px-2 py-1 bg-success-50 dark:bg-success-900/20 text-success-700 dark:text-success-400 rounded-full",children:c("validation.ocr.comparison.matchedCount",{count:String(d.length)})}),u.length>0&&a.jsx("span",{className:"px-2 py-1 bg-warning-50 dark:bg-warning-900/20 text-warning-700 dark:text-warning-400 rounded-full",children:c("validation.ocr.comparison.ocrOnlyCount",{count:String(u.length)})}),l.length>0&&a.jsx("span",{className:"px-2 py-1 bg-danger-50 dark:bg-danger-900/20 text-danger-700 dark:text-danger-400 rounded-full",children:c("validation.ocr.comparison.rosterOnlyCount",{count:String(l.length)})})]}),g&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{type:"button",onClick:x?n:r,className:"text-xs text-primary-600 dark:text-primary-400 hover:underline",children:o(x?"validation.ocr.comparison.deselectAll":"validation.ocr.comparison.selectAll")}),a.jsxs("span",{className:"text-xs text-gray-400",children:["(",f,"/",h,")"]})]}),d.length>0&&a.jsx("div",{className:"space-y-2",children:d.map(p=>a.jsx(Xe,{result:p,isSelected:p.rosterPlayerId?e.has(p.rosterPlayerId):!1,onToggle:()=>p.rosterPlayerId&&s(p.rosterPlayerId),isSelectable:!i&&!!p.rosterPlayerId},p.rosterPlayerId??p.ocrPlayer?.rawName))}),u.length>0&&a.jsx("div",{className:"space-y-2",children:u.map(p=>a.jsx(Xe,{result:p,isSelected:!1,onToggle:()=>{},isSelectable:!1},`ocr-only-${p.ocrPlayer?.rawName??p.ocrPlayer?.displayName}`))}),l.length>0&&a.jsx("div",{className:"space-y-2",children:l.map(p=>a.jsx(Xe,{result:p,isSelected:!1,onToggle:()=>{},isSelectable:!1},p.rosterPlayerId))})]})}function Os(t){return t.map(e=>({shirtNumber:null,lastName:e.lastName,firstName:e.firstName,displayName:e.displayName,rawName:e.rawName,licenseStatus:""}))}function Ps(t){return t.map(e=>({id:e.id,displayName:e.displayName,firstName:e.firstName,lastName:e.lastName}))}function oc({isOpen:t,homeTeamName:e,awayTeamName:s,homeRosterPlayers:r,awayRosterPlayers:n,homeRosterCoaches:i,awayRosterCoaches:o,onSkip:c,onComplete:d,onClose:u}){const{t:l}=B(),{processImage:h,progress:f,error:x,reset:g,ocrResult:p}=Yo(),{easterEgg:y,checkForEasterEggs:R,dismissEasterEgg:E}=Qo(),[j,A]=m.useState("intro"),[N,w]=m.useState(!1),[b,v]=m.useState("electronic"),[k,F]=m.useState(null),[_,I]=m.useState(null),[$,S]=m.useState(null),[L,V]=m.useState(null),[K,le]=m.useState(null),[ie,fe]=m.useState(new Set(["home-players","away-players"])),ce=m.useRef(!1);m.useEffect(()=>{if(!t||N)return;const T=D=>{D.key==="Escape"&&u()};return document.addEventListener("keydown",T),()=>document.removeEventListener("keydown",T)},[t,N,u]),m.useEffect(()=>{t&&(A("intro"),v("electronic"),F(null),I(null),S(null),V(null),K&&URL.revokeObjectURL(K),le(null),fe(new Set(["home-players","away-players"])),g())},[t,g]),m.useEffect(()=>()=>{K&&URL.revokeObjectURL(K)},[K]),m.useEffect(()=>{p&&V(p)},[p]);const ge=m.useCallback(T=>{const D=T.teamA.name.toLowerCase(),z=T.teamB.name.toLowerCase(),C=e.toLowerCase(),O=s.toLowerCase(),P=D.includes(C)||C.includes(D),H=D.includes(O)||O.includes(D),X=z.includes(C)||C.includes(z),se=z.includes(O)||O.includes(z);return P&&!H?{homeOCR:T.teamA,awayOCR:T.teamB}:H&&!P?{homeOCR:T.teamB,awayOCR:T.teamA}:X&&!se?{homeOCR:T.teamB,awayOCR:T.teamA}:se&&!X?{homeOCR:T.teamA,awayOCR:T.teamB}:{homeOCR:T.teamA,awayOCR:T.teamB}},[e,s]),ee=m.useCallback(async T=>{if(ce.current)return;ce.current=!0,w(!1),A("processing");const D=URL.createObjectURL(T);le(D);try{const z=await h(T,b);if(z){S(z);const{homeOCR:C,awayOCR:O}=ge(z);if(C.players.length===0&&O.players.length===0){A("error");return}const P=Le(C.players,r.map(J=>({id:J.id,displayName:J.displayName,firstName:J.firstName,lastName:J.lastName}))),H=Le(Os(C.officials),Ps(i)),X=Le(O.players,n.map(J=>({id:J.id,displayName:J.displayName,firstName:J.firstName,lastName:J.lastName}))),se=Le(Os(O.officials),Ps(o));F({teamName:e,ocrTeamName:C.name,playerResults:P,coachResults:H}),I({teamName:s,ocrTeamName:O.name,playerResults:X,coachResults:se}),R(z),A("results")}else A("error")}catch{A("error")}finally{ce.current=!1}},[h,b,ge,e,s,r,n,i,o,R]),re=m.useCallback(()=>{g(),F(null),I(null),S(null),V(null),K&&URL.revokeObjectURL(K),le(null),A("capture"),w(!0)},[g,K]),de=m.useCallback(T=>{v(T),A("capture"),w(!0)},[]),te=m.useCallback(T=>{fe(D=>{const z=new Set(D);return z.has(T)?z.delete(T):z.add(T),z})},[]);if(!t)return null;const Y=T=>{const D=T.filter(C=>C.status==="ocr-only").length,z=T.filter(C=>C.status==="roster-only").length;return D+z},W=(k?Y(k.playerResults)+Y(k.coachResults):0)+(_?Y(_.playerResults)+Y(_.coachResults):0);return a.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col bg-white dark:bg-gray-900",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-entry-title",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("div",{children:a.jsx("h1",{id:"ocr-entry-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scanScoresheet")})}),a.jsx("button",{type:"button",onClick:u,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":l("common.close"),children:a.jsx(me,{className:"w-5 h-5","aria-hidden":"true"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[j==="intro"&&a.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",children:[a.jsx(kt,{className:"w-16 h-16 text-primary-400 dark:text-primary-500 mb-4","aria-hidden":"true"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:l("validation.ocr.scanScoresheet")}),a.jsx("p",{className:"text-center text-gray-600 dark:text-gray-300 max-w-md mb-6",children:l("validation.ocr.scoresheetType.title")}),a.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-sm mb-6",children:[a.jsxs("button",{type:"button",onClick:()=>de("electronic"),className:"w-full flex items-start gap-4 p-4 bg-white dark:bg-gray-800 border-2 border-primary-500 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors text-left",children:[a.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-primary-100 dark:bg-primary-900/30",children:a.jsx(qe,{className:"w-6 h-6 text-primary-600 dark:text-primary-400","aria-hidden":"true"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"block text-base font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scoresheetType.electronic")}),a.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:l("validation.ocr.scoresheetType.electronicDescription")})]})]}),a.jsxs("button",{type:"button",onClick:()=>de("manuscript"),className:"w-full flex items-start gap-4 p-4 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary-300 dark:hover:border-primary-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[a.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-700",children:a.jsx(Na,{className:"w-6 h-6 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"block text-base font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scoresheetType.manuscript")}),a.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:l("validation.ocr.scoresheetType.manuscriptDescription")})]})]})]}),a.jsxs("button",{type:"button",onClick:c,className:"flex items-center justify-center gap-2 px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[a.jsx(ja,{className:"w-4 h-4","aria-hidden":"true"}),l("tour.actions.skip")]})]}),j==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",role:"status","aria-live":"polite",children:[a.jsx(Re,{size:"lg",className:"mb-6"}),a.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:l("validation.ocr.processing")}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:f?.status??l("validation.ocr.processingDescription")}),f&&f.progress>0&&a.jsx("div",{className:"w-64 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mt-6 overflow-hidden",children:a.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-300",style:{width:`${f.progress}%`}})})]}),j==="results"&&a.jsxs("div",{className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-2 text-success-600 dark:text-success-400 mb-4",children:[a.jsx(Ye,{className:"w-6 h-6","aria-hidden":"true"}),a.jsx("span",{className:"text-lg font-medium",children:l("validation.ocr.scanComplete")})]}),W>0&&a.jsx("div",{className:"mb-4 p-3 bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg",children:a.jsxs("p",{className:"text-sm text-warning-700 dark:text-warning-400",children:[W," discrepancies found"]})}),k&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:[k.teamName,k.ocrTeamName&&k.ocrTeamName!==k.teamName&&a.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(OCR: ",k.ocrTeamName,")"]})]}),a.jsx(De,{title:l("validation.ocr.players"),count:k.playerResults.length,discrepancies:Y(k.playerResults),expanded:ie.has("home-players"),onToggle:()=>te("home-players"),sectionId:"home-players",children:a.jsx(Be,{results:k.playerResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})}),k.coachResults.length>0&&a.jsx(De,{title:l("validation.ocr.coaches"),count:k.coachResults.length,discrepancies:Y(k.coachResults),expanded:ie.has("home-coaches"),onToggle:()=>te("home-coaches"),sectionId:"home-coaches",children:a.jsx(Be,{results:k.coachResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})})]}),_&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:[_.teamName,_.ocrTeamName&&_.ocrTeamName!==_.teamName&&a.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(OCR: ",_.ocrTeamName,")"]})]}),a.jsx(De,{title:l("validation.ocr.players"),count:_.playerResults.length,discrepancies:Y(_.playerResults),expanded:ie.has("away-players"),onToggle:()=>te("away-players"),sectionId:"away-players",children:a.jsx(Be,{results:_.playerResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})}),_.coachResults.length>0&&a.jsx(De,{title:l("validation.ocr.coaches"),count:_.coachResults.length,discrepancies:Y(_.coachResults),expanded:ie.has("away-coaches"),onToggle:()=>te("away-coaches"),sectionId:"away-coaches",children:a.jsx(Be,{results:_.coachResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})})]}),$&&a.jsx(lc,{data:$,ocrResult:L,imageUrl:K,expanded:ie.has("raw-ocr-data"),onToggle:()=>te("raw-ocr-data")})]}),j==="error"&&a.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",role:"alert",children:[a.jsx(_e,{className:"w-16 h-16 text-danger-500 mb-6","aria-hidden":"true"}),a.jsx("p",{className:"text-lg font-medium text-danger-700 dark:text-danger-400 mb-2",children:l("validation.ocr.scanFailed")}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center max-w-md mb-6",children:x?.message??l("validation.ocr.errors.processingFailed")}),a.jsxs("button",{type:"button",onClick:re,className:"flex items-center gap-2 px-6 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors font-medium",children:[a.jsx(Vs,{className:"w-5 h-5","aria-hidden":"true"}),l("validation.ocr.retryCapture")]})]})]}),j==="results"&&a.jsxs("div",{className:"flex gap-3 px-4 py-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:re,className:"flex-1 px-4 py-3 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:l("validation.ocr.retryCapture")}),a.jsx("button",{type:"button",onClick:d,className:"flex-1 px-4 py-3 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:l("validation.ocr.continueToValidation")})]}),a.jsx(ii,{isOpen:N,scoresheetType:b,onClose:()=>{w(!1),j==="capture"&&A("intro")},onImageSelected:ee}),y.type&&a.jsx(fl,{isOpen:y.isOpen,type:y.type,onClose:E})]})}function De({title:t,count:e,discrepancies:s,expanded:r,onToggle:n,sectionId:i,children:o}){const c=r?Ct:bt;return a.jsxs("div",{className:"mb-3",children:[a.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-expanded":r,"aria-controls":i,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t}),a.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",e,")"]})]}),s>0&&a.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-400",children:[s," discrepancies"]})]}),r&&a.jsx("div",{id:i,className:"mt-2 pl-6",children:o})]})}function lc({data:t,ocrResult:e,imageUrl:s,expanded:r,onToggle:n}){const{t:i}=B(),o=r?Ct:bt;return a.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-2 px-3 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-expanded":r,"aria-controls":"raw-ocr-data",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(o,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("validation.ocr.rawData.title")})]})}),r&&a.jsxs("div",{id:"raw-ocr-data",className:"mt-3 space-y-4",children:[s&&e&&a.jsx(cc,{imageUrl:s,ocrResult:e,parsedData:t}),a.jsx(Ls,{team:t.teamA,label:i("validation.ocr.rawData.teamA")}),a.jsx(Ls,{team:t.teamB,label:i("validation.ocr.rawData.teamB")})]})]})}function Ls({team:t,label:e}){const{t:s}=B();return a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:e}),a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"-"})]}),t.players.length>0&&a.jsxs("div",{className:"mb-3",children:[a.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[s("validation.ocr.rawData.players")," (",t.players.length,")"]}),a.jsx("div",{className:"mt-1 overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[a.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.shirtNumber")}),a.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.name")}),a.jsx("th",{scope:"col",className:"text-left font-medium",children:s("validation.ocr.rawData.licenseStatus")})]})}),a.jsx("tbody",{children:t.players.map(r=>a.jsxs("tr",{className:"text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("td",{className:"pr-2 py-0.5",children:r.shirtNumber??"-"}),a.jsx("td",{className:"pr-2 py-0.5 font-mono",children:r.rawName||r.displayName}),a.jsx("td",{className:"py-0.5",children:r.licenseStatus||"-"})]},`${r.shirtNumber}-${r.rawName||r.displayName}`))})]})})]}),t.officials.length>0&&a.jsxs("div",{children:[a.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[s("validation.ocr.rawData.officials")," (",t.officials.length,")"]}),a.jsx("div",{className:"mt-1 overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[a.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.role")}),a.jsx("th",{scope:"col",className:"text-left font-medium",children:s("validation.ocr.rawData.name")})]})}),a.jsx("tbody",{children:t.officials.map(r=>a.jsxs("tr",{className:"text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("td",{className:"pr-2 py-0.5",children:r.role}),a.jsx("td",{className:"py-0.5 font-mono",children:r.rawName||r.displayName})]},`${r.role}-${r.rawName||r.displayName}`))})]})})]})]})}function cc({imageUrl:t,ocrResult:e,parsedData:s}){const{t:r}=B(),n=m.useRef(null),[i,o]=m.useState(null),[c,d]=m.useState(0),[u,l]=m.useState(!0),h=m.useMemo(()=>{const p=new Set;return[...s.teamA.players,...s.teamB.players].forEach(y=>{y.rawName&&p.add(y.rawName.toLowerCase()),y.displayName&&p.add(y.displayName.toLowerCase()),y.lastName&&p.add(y.lastName.toLowerCase())}),[...s.teamA.officials,...s.teamB.officials].forEach(y=>{y.rawName&&p.add(y.rawName.toLowerCase()),y.displayName&&p.add(y.displayName.toLowerCase()),y.lastName&&p.add(y.lastName.toLowerCase())}),p},[s]),f=m.useCallback(p=>{const y=p.toLowerCase();return h.has(y)},[h]),x=m.useCallback(p=>{const y=p.currentTarget;o({width:y.naturalWidth,height:y.naturalHeight}),n.current&&d(n.current.offsetWidth)},[]),g=m.useMemo(()=>!i||c===0?1:c/i.width,[i,c]);return a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),a.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:r("validation.ocr.rawData.imageOverlay")})]}),e.hasPreciseBoundingBoxes&&a.jsx("button",{type:"button",onClick:()=>l(!u),className:"text-xs px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:r(u?"validation.ocr.rawData.hideOverlay":"validation.ocr.rawData.showOverlay")})]}),e.hasPreciseBoundingBoxes&&a.jsxs("div",{className:"flex items-center gap-4 mb-2 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-3 rounded border-2 border-success-500 bg-success-500/20"}),a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r("validation.ocr.rawData.matchedWords")})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-3 rounded border-2 border-gray-400 bg-gray-400/20"}),a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r("validation.ocr.rawData.otherWords")})]})]}),a.jsxs("div",{ref:n,className:"relative overflow-auto max-h-96 rounded border border-gray-200 dark:border-gray-700",children:[a.jsx("img",{src:t,alt:r("validation.ocr.rawData.capturedImage"),onLoad:x,className:"w-full h-auto"}),e.hasPreciseBoundingBoxes&&u&&i&&a.jsx("svg",{className:"absolute top-0 left-0 pointer-events-none",style:{width:i.width*g,height:i.height*g},viewBox:`0 0 ${i.width} ${i.height}`,preserveAspectRatio:"none",children:e.words.map(p=>{const y=f(p.text);return a.jsx("g",{children:a.jsx("rect",{x:p.bbox.x0,y:p.bbox.y0,width:p.bbox.x1-p.bbox.x0,height:p.bbox.y1-p.bbox.y0,fill:y?"rgba(34, 197, 94, 0.2)":"rgba(156, 163, 175, 0.15)",stroke:y?"#22c55e":"#9ca3af",strokeWidth:y?2:1,rx:2})},`${p.bbox.x0}-${p.bbox.y0}-${p.bbox.x1}-${p.bbox.y1}`)})})]}),a.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.words.length," ",r("validation.ocr.rawData.wordsDetected")," â€¢ ",e.words.filter(p=>f(p.text)).length," ",r("validation.ocr.rawData.wordsMatched")]}),!e.hasPreciseBoundingBoxes&&e.fullText&&a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"flex items-center gap-2 mb-2",children:a.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:r("validation.ocr.rawData.rawText")})}),a.jsx("pre",{className:"text-xs text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-900 p-3 rounded border border-gray-200 dark:border-gray-700 overflow-auto max-h-64 whitespace-pre-wrap break-words",children:e.fullText})]})]})}function Bs(t){if(!t)return[];const e=[];for(const s of t){const r=s.__identity,n=s.indoorPlayer?.person,i=n?.displayName??[n?.firstName,n?.lastName].filter(Boolean).join(" ");!r||!i||e.push({id:r,displayName:i,firstName:n?.firstName,lastName:n?.lastName})}return e.sort((s,r)=>s.displayName.localeCompare(r.displayName))}function Ds(t){if(!t)return[];const e=[],s=t.coachPerson;s?.__identity&&s.displayName&&e.push({id:s.__identity,displayName:s.displayName,firstName:s.firstName,lastName:s.lastName,role:"head"});const r=t.firstAssistantCoachPerson;r?.__identity&&r.displayName&&e.push({id:r.__identity,displayName:r.displayName,firstName:r.firstName,lastName:r.lastName,role:"firstAssistant"});const n=t.secondAssistantCoachPerson;return n?.__identity&&n.displayName&&e.push({id:n.__identity,displayName:n.displayName,firstName:n.firstName,lastName:n.lastName,role:"secondAssistant"}),e}function dc({assignment:t,isOpen:e,onClose:s}){const{t:r,tInterpolate:n}=B(),i=$s(I=>I.isOCREnabled),[o,c]=m.useState(null),d=t.__identity,u=o===d,l=Ua({assignment:t,isOpen:e,onClose:s}),{homeTeam:h,awayTeam:f}=ft(t),x="validate-game-title",g=`${h} ${r("common.vs")} ${f}`,p=m.useMemo(()=>Bs(l.homeNominationList?.indoorPlayerNominations),[l.homeNominationList]),y=m.useMemo(()=>Bs(l.awayNominationList?.indoorPlayerNominations),[l.awayNominationList]),R=m.useMemo(()=>Ds(l.homeNominationList),[l.homeNominationList]),E=m.useMemo(()=>Ds(l.awayNominationList),[l.awayNominationList]),j=m.useCallback(()=>{c(d)},[d]),A=m.useCallback(()=>{c(d)},[d]),N=m.useCallback(()=>{c(d)},[d]),w=e&&i&&!u&&!l.isLoadingGameDetails,b={isFirstStep:l.isFirstStep,isLastStep:l.isLastStep},v={isFinalizing:l.isFinalizing,isLoadingGameDetails:l.isLoadingGameDetails,hasGameDetailsError:!!l.gameDetailsError,canMarkCurrentStepDone:l.canMarkCurrentStepDone,allPreviousRequiredStepsDone:l.allPreviousRequiredStepsDone,currentStepIsOptional:l.currentStep.isOptional??!1},k={isLoading:l.isLoadingGameDetails,error:l.gameDetailsError},F={isValidated:l.isValidated,validatedInfo:l.validatedInfo,pendingScorer:l.pendingScorer,scoresheetNotRequired:l.scoresheetNotRequired,state:l.validationState,homeNominationList:l.homeNominationList,awayNominationList:l.awayNominationList},_={setHomeRosterModifications:l.setHomeRosterModifications,setAwayRosterModifications:l.setAwayRosterModifications,setScorer:l.setScorer,setScoresheet:l.setScoresheet,onAddPlayerSheetOpenChange:l.handleAddPlayerSheetOpenChange,onClose:s};return a.jsxs(a.Fragment,{children:[l.successToast&&a.jsx(_n,{message:l.successToast}),a.jsxs(Nt,{isOpen:e,onClose:l.attemptClose,titleId:x,size:"lg",isLoading:l.showUnsavedDialog||l.showRosterWarningDialog,children:[a.jsx(wt,{title:r("assignments.validateGame"),titleId:x,subtitle:g,onClose:l.attemptClose}),l.isValidated&&l.validatedInfo&&a.jsxs("div",{role:"status",className:"mb-4 p-3 bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium text-success-700 dark:text-success-400",children:r("validation.wizard.alreadyValidated")}),a.jsx("p",{className:"text-xs text-success-600 dark:text-success-500 mt-1",children:n("validation.wizard.validatedBy",{scorer:l.validatedInfo.scorerName})})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx(Ka,{steps:l.wizardSteps,currentStepIndex:l.currentStepIndex,stepsMarkedDone:l.stepsMarkedDone,clickable:!l.isFinalizing,onStepClick:l.goToStep}),a.jsx("p",{className:"text-center text-xs text-text-muted dark:text-text-muted-dark mt-2",children:n("validation.wizard.stepOf",{current:l.currentStepIndex+1,total:l.totalSteps})})]}),a.jsx(Va,{currentStep:l.currentStepIndex,totalSteps:l.totalSteps,onSwipeNext:l.goNext,onSwipePrevious:l.goBack,swipeEnabled:l.isSwipeEnabled,children:a.jsx("div",{className:"max-h-80 overflow-y-auto",children:a.jsx(In,{currentStepId:l.currentStepId,assignment:t,loading:k,validation:F,handlers:_})})}),l.saveError&&a.jsxs("div",{role:"alert",className:"mt-4 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",children:[a.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:l.saveError}),a.jsxs("div",{className:"mt-2 flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>l.handleFinish(),className:"text-sm font-medium text-danger-600 dark:text-danger-400 hover:text-danger-700 dark:hover:text-danger-300",children:r("common.retry")}),a.jsx("button",{type:"button",onClick:l.handleDiscardAndClose,className:"text-sm font-medium text-text-muted dark:text-text-muted-dark hover:text-text-secondary dark:hover:text-text-secondary-dark",children:r("validation.state.discardAndClose")})]})]}),l.isSaving&&a.jsx("div",{className:"mt-4 text-center text-sm text-text-muted dark:text-text-muted-dark",children:r("validation.wizard.saving")}),a.jsx("div",{className:"flex justify-between gap-3 pt-4 border-t border-border-default dark:border-border-default-dark mt-4",children:l.isValidated?a.jsx(Tn,{navigation:b,onBack:l.goBack,onNext:l.goNext,onClose:s}):a.jsx(On,{navigation:b,state:v,onAttemptClose:l.attemptClose,onBack:l.goBack,onValidateAndNext:l.handleValidateAndNext,onFinish:l.handleFinish})})]}),a.jsx(Cn,{isOpen:l.showUnsavedDialog,onSaveAndClose:l.handleSaveAndClose,onDiscard:l.handleDiscardAndClose,onCancel:l.handleCancelClose,isSaving:l.isSaving}),a.jsx(Sn,{isOpen:l.showRosterWarningDialog,rosterValidation:l.rosterValidation,homeTeamName:h,awayTeamName:f,onGoBack:l.handleRosterWarningGoBack,onProceedAnyway:l.handleRosterWarningProceed,isProceedingAnyway:l.isFinalizing}),a.jsx(jn,{isOpen:l.showSafeValidationComplete,onClose:l.handleSafeValidationCompleteClose}),a.jsx(oc,{isOpen:w,homeTeamName:h,awayTeamName:f,homeRosterPlayers:p,awayRosterPlayers:y,homeRosterCoaches:R,awayRosterCoaches:E,onSkip:j,onComplete:A,onClose:N})]})}const jc=m.memo(dc);export{jc as ValidateGameModal};
