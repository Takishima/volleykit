import{a,j as e}from"./chunk-state-CZJejFfH.js";import{u as K,c as A,C as $,a as q,P as G,O as H}from"./chunk-ValidateGameModal-C9_A2mBi.js";import{u as J,L as Q}from"./index-DYoVkUM4.js";import{C as U}from"./chunk-AssignmentsPage-DbTrEFlD.js";import{R as V}from"./chunk-LoginPage-Di6oaLXB.js";import"./chunk-ModalErrorBoundary-pS9-pWA4.js";import"./chunk-ExchangePage-Dt1OqDSy.js";import"./chunk-ojp-client-DxbWmnJM.js";import"./chunk-useTravelTime-CVtcoeLr.js";import"./chunk-router-CqUdIx6-.js";import"./chunk-pdf-form-filler-tgwy6GI7.js";import"./chunk-useDebouncedValue-1uPHeecN.js";import"./chunk-PdfLanguageModal-C2LkDRZK.js";import"./chunk-cropper-l1UCu5Q8.js";import"./chunk-validation-Cdg1t4SS.js";import"./chunk-assignments-DBz14qIH.js";import"./chunk-SafeModeWarningModal-Y4G1nx_U.js";import"./chunk-calendar-helpers-Cj09CQ0e.js";function xe({team:k,teamName:o,rosterPlayers:m,onApplyResults:C,onClose:n,isOpen:b,scoresheetType:P="electronic"}){const{t:l}=J(),{processImage:v,progress:u,error:I,reset:N}=K(),[c,i]=a.useState("capture"),[x,p]=a.useState(!1),[h,d]=a.useState(new Set),[g,S]=a.useState(null),w=a.useRef(!1);a.useEffect(()=>{if(!b||x)return;const t=s=>{s.key==="Escape"&&n()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[b,x,n]);const y=a.useCallback(t=>{const s=t.teamA.name.toLowerCase().includes(o.toLowerCase())||o.toLowerCase().includes(t.teamA.name.toLowerCase()),r=t.teamB.name.toLowerCase().includes(o.toLowerCase())||o.toLowerCase().includes(t.teamB.name.toLowerCase());return s&&!r?t.teamA:r&&!s?t.teamB:k==="home"?t.teamA:t.teamB},[k,o]),j=a.useMemo(()=>{if(!g)return[];const t=y(g);if(!t)return[];const s=m.map(r=>({id:r.id,displayName:r.displayName,firstName:r.firstName,lastName:r.lastName}));return A(t.players,s)},[g,m,y]),R=a.useCallback(t=>{const s=t.filter(r=>r.status==="match"&&r.rosterPlayerId).map(r=>r.rosterPlayerId);d(new Set(s))},[]),E=a.useCallback(async t=>{if(!w.current){w.current=!0,p(!1),i("processing");try{const s=await v(t);if(s){S(s);const r=y(s);if(!r||r.players.length===0){i("error");return}const z=m.map(f=>({id:f.id,displayName:f.displayName,firstName:f.firstName,lastName:f.lastName})),F=A(r.players,z);R(F),i("results")}else i("error")}catch{i("error")}finally{w.current=!1}}},[v,y,m,R]),M=a.useCallback(t=>{d(s=>{const r=new Set(s);return r.has(t)?r.delete(t):r.add(t),r})},[]),T=a.useCallback(()=>{const t=j.filter(s=>s.status==="match"&&s.rosterPlayerId).map(s=>s.rosterPlayerId);d(new Set(t))},[j]),B=a.useCallback(()=>{d(new Set)},[]),D=a.useCallback(()=>{C(Array.from(h)),n()},[C,n,h]),L=a.useCallback(()=>{N(),S(null),d(new Set),i("capture"),p(!0)},[N]),O=a.useCallback(()=>{p(!0)},[]);return b?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-panel-title",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[e.jsx("h2",{id:"ocr-panel-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scanScoresheet")}),e.jsx("button",{type:"button",onClick:n,className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:l("validation.ocr.cancel")})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[c==="capture"&&!x&&e.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",children:[e.jsx($,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mb-4","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 text-center mb-4",children:l("validation.ocr.scanScoresheetDescription")}),e.jsx("button",{type:"button",onClick:O,className:"px-6 py-3 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-lg transition-colors",children:l("validation.ocr.scanScoresheet")})]}),c==="processing"&&e.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"status","aria-live":"polite",children:[e.jsx(Q,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:l("validation.ocr.processing")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:u?.status??l("validation.ocr.processingDescription")}),u&&u.progress>0&&e.jsx("div",{className:"w-48 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mt-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-300",style:{width:`${u.progress}%`}})})]}),c==="results"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-success-600 dark:text-success-400",children:[e.jsx(q,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:l("validation.ocr.scanComplete")})]}),g&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:o}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:l("validation.ocr.comparison.title")}),e.jsx(G,{results:j,selectedPlayerIds:h,onTogglePlayer:M,onSelectAll:T,onDeselectAll:B})]}),c==="error"&&e.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"alert",children:[e.jsx(U,{className:"w-12 h-12 text-danger-500 mb-4","aria-hidden":"true"}),e.jsx("p",{className:"text-sm font-medium text-danger-700 dark:text-danger-400 mb-2",children:l("validation.ocr.scanFailed")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mb-4",children:I?.message??l("validation.ocr.errors.processingFailed")}),e.jsxs("button",{type:"button",onClick:L,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"}),l("validation.ocr.retryCapture")]})]})]}),c==="results"&&e.jsxs("div",{className:"flex gap-3 p-4 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:L,className:"flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:l("validation.ocr.retryCapture")}),e.jsx("button",{type:"button",onClick:D,disabled:h.size===0,className:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed rounded-lg transition-colors",children:l("validation.ocr.useResults")})]})]}),e.jsx(H,{isOpen:x,scoresheetType:P,onClose:()=>p(!1),onImageSelected:E})]}):null}export{xe as OCRPanel};
