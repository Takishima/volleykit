import{e as C,h as P,C as x,_ as k,f as W,S as Z}from"./index-CpUrTfAV.js";function G(){const{user:t,activeOccupationId:e,dataSource:n}=C(P(r=>({user:r.user,activeOccupationId:r.activeOccupationId,dataSource:r.dataSource})));return n==="calendar"?x:(t?.occupations?.find(r=>r.id===e)??t?.occupations?.[0])?.associationCode}class c extends Error{code;constructor(e,n){super(e),this.name="TransportApiError",this.code=n}}let f=null;async function b(){return f||(f=await k(()=>import("./chunk-index-CeoRQD-C.js"),[])),f}const j="https://api.opentransportdata.swiss/ojp20",A=1200;let I=0;async function J(){const e=Date.now()-I;if(e<A){const n=A-e;await new Promise(i=>setTimeout(i,n))}I=Date.now()}function Q(){return"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6IjAxZWZlYWJjYTUyYzQ1Mjk5NGNiM2M5OTNlZDYzMzFiIiwiaCI6Im11cm11cjEyOCJ9"!=="your_api_key_here"}async function X(t,e,n={}){const i="eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6IjAxZWZlYWJjYTUyYzQ1Mjk5NGNiM2M5OTNlZDYzMzFiIiwiaCI6Im11cm11cjEyOCJ9";await J();try{const{SDK:r,TripRequest:o,Place:s}=await b(),m=r.create("VolleyKit",{url:j,authToken:i},"de"),h=s.initWithCoords(t.longitude,t.latitude),_=s.initWithCoords(e.longitude,e.latitude),l=o.initWithPlaces(h,_),O=n.departureTime??new Date;l.setDepartureDatetime(O),l.setPublicTransportRequest();const d=await l.fetchResponse(m);if(!d.ok)throw new c(d.error.message,"API_ERROR");const g=d.value.tripResult??[];if(g.length===0)throw new c("No route found between locations","NO_ROUTE");const N=g.map(y=>y.trip),a=V(N,n.targetArrivalTime),R=S(a.duration),v=B(a),L=H(a),M=u(a),D=E(a);return{durationMinutes:R,departureTime:a.startTime,arrivalTime:M,transfers:a.transfers,originStation:v,destinationStation:L,finalWalkingMinutes:D,tripData:n.includeTrips?a:void 0}}catch(r){if(r instanceof c)throw r;const o=r instanceof Error?r.message:"Unknown transport API error";throw new c(o,"API_ERROR")}}function Y(t){if(!t)return;const e=t.match(/sloid:(\d+)/);if(e)return e[1];if(/^\d+$/.test(t))return t}const p=[/\bPLATFORM_[A-Z_]+\b/g,/\b[A-Z_]*WHEELCHAIR[A-Z_]*\b/g,/\bALTERNATIVE_TRANSPORT\b/g,/\bSHUTTLE_BUS\b/g,/\bRAIL_REPLACEMENT\b/g];function F(t){return p.some(e=>{e.lastIndex=0;const n=t.match(e);return n!==null&&n[0]===t})}function U(t){if(!t||F(t))return;let e=t;for(const n of p)n.lastIndex=0,e=e.replace(n,"");return e=e.replace(/\s+/g," ").trim(),e||void 0}function z(t){const e=t.stopPointName.text,n=U(t.nameSuffix?.text);return n?`${e} ${n}`:e}function w(t){if(!t)return;const e=Y(t.stopPointRef);if(e)return{id:e,name:z(t)}}function K(t){for(const e of t.leg)if(e.timedLeg)return e.timedLeg}function q(t){for(let e=t.leg.length-1;e>=0;e--){const n=t.leg[e];if(n?.timedLeg)return n.timedLeg}}function E(t){let e=-1;for(let i=t.leg.length-1;i>=0;i--)if(t.leg[i]?.timedLeg){e=i;break}if(e===-1)return 0;let n=0;for(let i=e+1;i<t.leg.length;i++){const r=t.leg[i];r?.continuousLeg?.duration&&(n+=S(r.continuousLeg.duration))}return n}function u(t){const e=E(t);if(e===0)return t.endTime;const n=new Date(t.endTime);return n.setMinutes(n.getMinutes()+e),n.toISOString()}function B(t){const e=K(t);return w(e?.legBoard)}function H(t){const e=q(t);return w(e?.legAlight)}function V(t,e){if(!e)return t[0];const n=e.getTime(),i=t.filter(r=>new Date(u(r)).getTime()<=n);return i.length===0?t[0]:i.reduce((r,o)=>{if(o.transfers<r.transfers)return o;if(o.transfers>r.transfers)return r;const s=new Date(u(r)).getTime();return new Date(u(o)).getTime()>s?o:r})}function T(t,e){const n=t.indexOf(e);if(n===-1)return 0;let i=n-1;for(;i>=0&&t[i]>="0"&&t[i]<="9";)i--;return i++,i>=n?0:parseInt(t.substring(i,n),10)||0}function S(t){if(!t.startsWith("PT"))return 0;const e=T(t,"H"),n=T(t,"M"),i=T(t,"S");return e*W+n+Math.ceil(i/Z)}export{X as c,Q as i,G as u};
