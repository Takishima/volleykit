const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-OCRPanel-CTZdp3LM.js","assets/chunk-state-CZJejFfH.js","assets/index-CmWRfzXn.js","assets/chunk-router-CqUdIx6-.js","assets/chunk-validation-Cdg1t4SS.js","assets/index-KyjH_G7Q.css","assets/chunk-AssignmentsPage-zEmjATXi.js","assets/chunk-assignments-DBz14qIH.js","assets/chunk-ExchangePage-BCv06yjo.js","assets/chunk-ojp-client-BjZGMVjh.js","assets/chunk-useTravelTime-PjBEqpod.js","assets/chunk-ModalErrorBoundary-DwoMtqXl.js","assets/chunk-pdf-form-filler-CmFOyd1D.js","assets/chunk-PdfLanguageModal-CubJfemv.js","assets/chunk-SafeModeWarningModal-DSMgrkCG.js","assets/chunk-calendar-helpers-CHM4zeHQ.js","assets/chunk-LoginPage-tEQFvbH9.js","assets/chunk-useDebouncedValue-2T1rCwqN.js","assets/chunk-cropper-l1UCu5Q8.js"])))=>i.map(i=>d[i]);
import{a as m,u as Us,b as gt,j as r}from"./chunk-state-CZJejFfH.js";import{l as ar,C as Ge,d as yt,f as rr}from"./chunk-ModalErrorBoundary-DwoMtqXl.js";import{c as G,l as q,e as je,p as bt,q as we,A as Nt,u as D,a3 as He,an as wt,o as nr,a_ as ir,a$ as or,ad as ue,L as Me,b0 as vt,b1 as Ws,b2 as Vs,b3 as kt,_ as lr,b4 as cr,b5 as dr,b6 as $t,b7 as zt,B as Z,M as Ct,a as At,b as Gs}from"./index-CmWRfzXn.js";import{R as Ks,U as ur}from"./chunk-ExchangePage-BCv06yjo.js";import{u as St,I as mr}from"./chunk-useDebouncedValue-2T1rCwqN.js";import{B as Ht}from"./chunk-useTravelTime-PjBEqpod.js";import{C as Te}from"./chunk-AssignmentsPage-zEmjATXi.js";import{R as Xs}from"./chunk-LoginPage-tEQFvbH9.js";import"./chunk-router-CqUdIx6-.js";import{F as Je}from"./chunk-PdfLanguageModal-CubJfemv.js";import{C as hr}from"./chunk-cropper-l1UCu5Q8.js";const fr=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ke=G("camera",fr);const pr=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],qs=G("chevron-right",pr);const xr=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Et=G("chevron-up",xr);const gr=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],et=G("circle-check-big",gr);const yr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],br=G("circle-x",yr);const Nr=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ys=G("image",Nr);const wr=[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]],vr=G("party-popper",wr);const kr=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Cr=G("pen-tool",kr);const Ar=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Sr=G("plus",Ar);const Er=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],jr=G("rotate-ccw",Er);const Rr=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],_r=G("rotate-cw",Rr);const Ir=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],Mr=G("skip-forward",Ir);const Tr=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],Or=G("stethoscope",Tr);const Pr=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Lr=G("trash-2",Pr);const Br=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Dr=G("undo-2",Br);const Fr=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ut=G("upload",Fr);const $r=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Zs=G("user-plus",$r);function Wt(){return{homeRoster:{reviewed:!1,playerModifications:{added:[],removed:[]},coachModifications:{added:new Map,removed:new Set}},awayRoster:{reviewed:!1,playerModifications:{added:[],removed:[]},coachModifications:{added:new Map,removed:new Set}},scorer:{selected:null},scoresheet:{file:null,uploaded:!1}}}function tt(t){return t.added.length>0||t.removed.length>0}function Qs(t,e){const s=t.indoorPlayerNominations?.map(o=>o.__identity).filter(o=>!!o)??[],a=new Set(e.removed),n=s.filter(o=>!a.has(o)),i=e.added.map(o=>o.id);return[...n,...i]}function Js(t){return t.added.size>0||t.removed.size>0}function ea(t,e){if(!Js(e))return;const s={},a={head:"coachPerson",firstAssistant:"firstAssistantCoachPerson",secondAssistant:"secondAssistantCoachPerson"};for(const n of["head","firstAssistant","secondAssistant"]){const i=e.added.get(n);if(i){s[n]=i.id;continue}if(e.removed.has(n)){s[n]="";continue}const o=t[a[n]]?.__identity;o&&(s[n]=o)}return s}async function Vt(t,e,s,a,n){const i=tt(a),o=n?Js(n):!1;if(!i&&!o){q.debug("[VS] skip roster save: no modifications");return}if(!s?.__identity||!s.team?.__identity){q.debug("[VS] skip roster save: missing nomination list or team ID");return}const c=Qs(s,a),u=n?ea(s,n):void 0;await t.updateNominationList(s.__identity,e,s.team.__identity,c,u)}async function zr(t,e,s,a,n){if(!a||!s?.__identity){q.debug("[VS] skip scorer save: no scorer or scoresheet ID");return}await t.updateScoresheet(s.__identity,e,a,s.isSimpleScoresheet??!1,n)}async function Gt(t,e,s,a,n){if(!s?.__identity||!s.team?.__identity){q.debug("[VS] skip roster finalize: missing nomination list or team ID");return}const i=Qs(s,a),o=n?ea(s,n):void 0;await t.finalizeNominationList(s.__identity,e,s.team.__identity,i,s.nominationListValidation?.__identity,o)}async function Hr(t,e,s,a,n){if(!a||!s?.__identity){q.debug("[VS] skip scoresheet finalize: no scorer or scoresheet ID");return}await t.finalizeScoresheet(s.__identity,e,a,n,s.scoresheetValidation?.__identity,s.isSimpleScoresheet??!1)}function Ur(t){const[e,s]=m.useState(Wt),[a,n]=m.useState(!1),[i,o]=m.useState(!1),c=m.useRef(!1),u=m.useRef(!1),d=m.useRef(void 0),l=je(A=>A.dataSource),h=bt(l),f=Us(),x=gt({queryKey:we.validation.gameDetail(t??""),queryFn:async()=>t?h.getGameWithScoresheet(t):null,enabled:!!t,staleTime:Nt}),g=m.useMemo(()=>({homeRoster:e.homeRoster.reviewed,awayRoster:e.awayRoster.reviewed,scorer:e.scorer.selected!==null,scoresheet:!0}),[e.homeRoster.reviewed,e.awayRoster.reviewed,e.scorer.selected]),p=m.useMemo(()=>g.homeRoster&&g.awayRoster&&g.scorer,[g]),y=m.useMemo(()=>!!x.data?.scoresheet?.closedAt,[x.data]),R=m.useMemo(()=>{const A=x.data?.scoresheet;if(!A?.closedAt)return null;const P=A.writerPerson;return{validatedAt:A.closedAt,scorerName:P?.displayName??"Unknown",scorerBirthday:P?.birthday,hasScoresheet:!!A.hasFile}},[x.data]),S=m.useMemo(()=>{if(y)return null;const A=x.data?.scoresheet?.writerPerson;return A?.__identity?{__identity:A.__identity,displayName:A.displayName??"Unknown",birthday:A.birthday}:null},[x.data,y]),j=m.useMemo(()=>x.data?.group?.hasNoScoresheet??!1,[x.data]),C=m.useMemo(()=>x.data?.nominationListOfTeamHome??null,[x.data?.nominationListOfTeamHome]),w=m.useMemo(()=>x.data?.nominationListOfTeamAway??null,[x.data?.nominationListOfTeamAway]),b=m.useMemo(()=>tt(e.homeRoster.playerModifications)||tt(e.awayRoster.playerModifications)||e.homeRoster.coachModifications.added.size>0||e.homeRoster.coachModifications.removed.size>0||e.awayRoster.coachModifications.added.size>0||e.awayRoster.coachModifications.removed.size>0||e.scorer.selected!==null||e.scoresheet.file!==null,[e]),N=m.useCallback(A=>{s(P=>({...P,homeRoster:{...P.homeRoster,playerModifications:A.players,coachModifications:A.coaches,reviewed:!0}}))},[]),v=m.useCallback(A=>{s(P=>({...P,awayRoster:{...P.awayRoster,playerModifications:A.players,coachModifications:A.coaches,reviewed:!0}}))},[]),k=m.useCallback(A=>{s(P=>({...P,scorer:{selected:A}}))},[]),$=m.useCallback((A,P)=>{s(Y=>({...Y,scoresheet:{file:A,uploaded:P}}))},[]),_=m.useCallback(()=>{s(Wt())},[]),I=m.useCallback(async()=>{if(c.current){q.debug("[VS] save skip: in progress");return}c.current=!0,n(!0);try{const A=x.data;if(!t||!A){q.warn("[VS] no game data for save");return}let P=d.current;!P&&e.scoresheet.file&&(P=(await h.uploadResource(e.scoresheet.file))[0]?.__identity,d.current=P,q.debug("[VS] PDF uploaded:",P)),await Vt(h,t,A.nominationListOfTeamHome,e.homeRoster.playerModifications,e.homeRoster.coachModifications),await Vt(h,t,A.nominationListOfTeamAway,e.awayRoster.playerModifications,e.awayRoster.coachModifications),await zr(h,t,A.scoresheet,e.scorer.selected?.__identity,P),await f.invalidateQueries({queryKey:we.validation.gameDetail(t)}),q.debug("[VS] save done")}catch(A){throw q.error("[VS] save failed:",A),A}finally{c.current=!1,n(!1)}},[t,x.data,e,h,f]),H=m.useCallback(async()=>{if(u.current){q.debug("[VS] finalize skip: in progress");return}u.current=!0,o(!0);try{const A=x.data;if(!t||!A){q.warn("[VS] no game data for finalize");return}let P=d.current;!P&&e.scoresheet.file&&(P=(await h.uploadResource(e.scoresheet.file))[0]?.__identity,d.current=P,q.debug("[VS] PDF uploaded:",P)),await Gt(h,t,A.nominationListOfTeamHome,e.homeRoster.playerModifications,e.homeRoster.coachModifications),await Gt(h,t,A.nominationListOfTeamAway,e.awayRoster.playerModifications,e.awayRoster.coachModifications),await Hr(h,t,A.scoresheet,e.scorer.selected?.__identity,P),await f.invalidateQueries({queryKey:we.validation.gameDetail(t)}),q.debug("[VS] finalize done")}catch(A){throw q.error("[VS] finalize failed:",A),A}finally{u.current=!1,o(!1)}},[t,x.data,e,h,f]);return{state:e,isDirty:b,completionStatus:g,isAllRequiredComplete:p,isValidated:y,validatedInfo:R,pendingScorer:S,scoresheetNotRequired:j,setHomeRosterModifications:N,setAwayRosterModifications:v,setScorer:k,setScoresheet:$,reset:_,saveProgress:I,finalizeValidation:H,isSaving:a,isFinalizing:i,isLoadingGameDetails:x.isLoading,gameDetailsError:x.error,homeNominationList:C,awayNominationList:w}}const st=6;function Kt(t,e,s){if(!t)return{isValid:!0,playerCount:0,hasHeadCoach:!0,hasMinPlayers:!0};const a=t.indoorPlayerNominations?.length??0,n=e.added.length,i=e.removed.length,o=a+n-i,c=!!t.coachPerson,u=s.removed.has("head"),l=s.added.has("head")||c&&!u,h=o>=st;return{isValid:l&&h,playerCount:o,hasHeadCoach:l,hasMinPlayers:h}}function Wr(t,e,s,a,n,i){const o=Kt(t,e,s),c=Kt(a,n,i);return{home:o,away:c,allValid:o.isValid&&c.isValid}}function Vr({steps:t,initialStepIndex:e=0,onStepChange:s}){if(t.length===0)throw new Error("useWizardNavigation: steps array cannot be empty");const a=Math.max(0,Math.min(e,t.length-1)),[n,i]=m.useState(a),[o,c]=m.useState(()=>new Set),u=t.length,d=n===0,l=n===u-1,h=!l,f=!d,x=m.useMemo(()=>{const C=t[n];if(!C)throw new Error(`useWizardNavigation: step at index ${n} not found`);return C},[t,n]),g=m.useCallback(C=>{const w=Math.max(0,Math.min(C,t.length-1));w!==n&&(s?.(n,w),i(w))},[n,t.length,s]),p=m.useCallback((C,w)=>{c(b=>{if(w&&b.has(C)||!w&&!b.has(C))return b;const N=new Set(b);return w?N.add(C):N.delete(C),N})},[]),y=m.useCallback(()=>{h&&g(n+1)},[h,n,g]),R=m.useCallback(()=>{f&&g(n-1)},[f,n,g]),S=m.useCallback(()=>{i(0),c(new Set)},[]),j=m.useMemo(()=>{for(let C=0;C<t.length;C++)if(!t[C]?.isOptional&&!o.has(C))return!1;return!0},[t,o]);return{currentStepIndex:n,currentStep:x,totalSteps:u,isFirstStep:d,isLastStep:l,goNext:y,goBack:R,goToStep:g,resetToStart:S,canGoNext:h,canGoBack:f,stepsMarkedDone:o,setStepDone:p,allRequiredStepsDone:j}}const Gr=3e3;function Kr({assignment:t,isOpen:e,onClose:s}){const{t:a}=D(),[n,i]=m.useState(!1),[o,c]=m.useState(!1),[u,d]=m.useState(!1),[l,h]=m.useState(null),[f,x]=m.useState(null),[g,p]=m.useState(!1),y=je(U=>U.dataSource),R=He(U=>U.isSafeModeEnabled),S=He(U=>U.isSafeValidationEnabled),j=y!=="demo"&&R,C=y!=="demo"&&S,w=Us(),b=t.refereeGame?.game?.__identity,{state:N,isDirty:v,completionStatus:k,isValidated:$,validatedInfo:_,pendingScorer:I,scoresheetNotRequired:H,setHomeRosterModifications:A,setAwayRosterModifications:P,setScorer:Y,setScoresheet:K,reset:te,saveProgress:J,finalizeValidation:he,isSaving:fe,isFinalizing:pe,isLoadingGameDetails:ye,gameDetailsError:be,homeNominationList:oe,awayNominationList:se}=Ur(b),W=t.refereeGame?.game?.scoresheet?.closedAt,ae=$||!!W,B=_??(W?{validatedAt:W,scorerName:"â€”",scorerBirthday:void 0,hasScoresheet:!1}:null),z=m.useMemo(()=>Wr(oe,N.homeRoster.playerModifications,N.homeRoster.coachModifications,se,N.awayRoster.playerModifications,N.awayRoster.coachModifications),[oe,se,N.homeRoster.playerModifications,N.homeRoster.coachModifications,N.awayRoster.playerModifications,N.awayRoster.coachModifications]),L=m.useMemo(()=>[{id:"home-roster",label:a("validation.homeRoster"),isInvalid:!z.home.isValid},{id:"away-roster",label:a("validation.awayRoster"),isInvalid:!z.away.isValid},{id:"scorer",label:a("validation.scorer")},{id:"scoresheet",label:a("validation.scoresheet"),isOptional:!0}],[a,z.home.isValid,z.away.isValid]),{currentStepIndex:F,currentStep:X,totalSteps:le,isFirstStep:ce,isLastStep:E,goNext:O,goBack:T,goToStep:V,resetToStart:ee,stepsMarkedDone:Re,setStepDone:Ne}=Vr({steps:L}),Dt=m.useRef(v),Xe=m.useRef(!1),Pe=m.useRef(null);m.useEffect(()=>{Dt.current=v},[v]),m.useEffect(()=>()=>{Pe.current&&(clearTimeout(Pe.current),Pe.current=null)},[]),m.useEffect(()=>{e&&(b&&w.invalidateQueries({queryKey:we.validation.gameDetail(b)}),h(null),x(null),c(!1),d(!1),te(),ee())},[e,te,ee,b,w]);const _e=m.useMemo(()=>L[F]?.id==="scorer"?k.scorer:!0,[F,L,k.scorer]),qe=m.useMemo(()=>{for(let U=0;U<F;U++)if(!L[U]?.isOptional&&!Re.has(U))return!1;return!0},[L,F,Re]),Ga=!pe&&!ye&&!g,Ka=m.useCallback(()=>{ae?s():Dt.current?i(!0):s()},[s,ae]),Le=m.useCallback(async()=>{Xe.current=!0,h(null);try{C?(await J(),d(!0)):(await he(),x(a("validation.state.saveSuccess")),Pe.current=setTimeout(()=>{x(null)},Gr),s())}catch(U){const Ft=U instanceof Error?U.message:a("validation.state.saveError");h(Ft)}finally{Xe.current=!1}},[C,J,he,a,s]),Xa=m.useCallback(async()=>{if(Xe.current)return;const U=L[L.length-1];if(!(!U?.isOptional&&!_e)&&qe){if(!z.allValid){c(!0);return}U?.isOptional||Ne(F,!0),await Le()}},[L,_e,qe,z.allValid,F,Ne,Le]),qa=m.useCallback(async()=>{try{await J(),i(!1),s()}catch(U){q.error("[ValidateGameModal] Save failed during close:",U),h(a("validation.state.saveError")),i(!1)}},[J,s,a]),Ya=m.useCallback(()=>{i(!1),te(),s()},[te,s]),Za=m.useCallback(()=>{i(!1)},[]),Qa=m.useCallback(()=>{_e&&(Ne(F,!0),O())},[_e,Ne,F,O]),Ja=m.useCallback(U=>{p(U)},[]),er=m.useCallback(()=>{c(!1),z.home.isValid?z.away.isValid||V(1):V(0)},[z.home.isValid,z.away.isValid,V]),tr=m.useCallback(async()=>{c(!1),L[L.length-1]?.isOptional||Ne(F,!0),await Le()},[L,F,Ne,Le]),sr=m.useCallback(()=>{d(!1),s()},[s]);return{currentStepIndex:F,currentStepId:X.id,currentStep:X,totalSteps:le,isFirstStep:ce,isLastStep:E,stepsMarkedDone:Re,goToStep:V,wizardSteps:L,isInSafeMode:j,validationState:N,isDirty:v,completionStatus:k,isValidated:ae,validatedInfo:B,pendingScorer:I,scoresheetNotRequired:H,setHomeRosterModifications:A,setAwayRosterModifications:P,setScorer:Y,setScoresheet:K,isSaving:fe,isFinalizing:pe,isLoadingGameDetails:ye,gameDetailsError:be,homeNominationList:oe,awayNominationList:se,showUnsavedDialog:n,showRosterWarningDialog:o,showSafeValidationComplete:u,saveError:l,successToast:f,isAddPlayerSheetOpen:g,rosterValidation:z,canMarkCurrentStepDone:_e,allPreviousRequiredStepsDone:qe,isSwipeEnabled:Ga,attemptClose:Ka,handleFinish:Xa,handleSaveAndClose:qa,handleDiscardAndClose:Ya,handleCancelClose:Za,goNext:O,handleValidateAndNext:Qa,goBack:T,handleAddPlayerSheetOpenChange:Ja,handleRosterWarningGoBack:er,handleRosterWarningProceed:tr,handleSafeValidationCompleteClose:sr}}const Xr=.3,Be=300;function qr({currentStep:t,totalSteps:e,onSwipeNext:s,onSwipePrevious:a,swipeEnabled:n=!0,children:i}){const[o,c]=m.useState("idle"),[u,d]=m.useState(!1),l=m.useRef(t),h=m.useRef(null),f=t<e-1,x=t>0,g=m.useCallback((b,N,v)=>{d(!0),v(b?N:-N),requestAnimationFrame(()=>{requestAnimationFrame(()=>{d(!1),c("entering"),v(0)})}),h.current=setTimeout(()=>{c("idle"),h.current=null},Be)},[]),{containerRef:p,translateX:y,isDragging:R,containerWidth:S,setTranslateX:j,handlers:C}=ar({enabled:n,maxSwipeMultiplier:1.5,canSwipe:(b,N)=>!(N==="left"&&!f||N==="right"&&!x),onDragEnd:(b,N)=>{const v=Math.abs(b),k=b<0,$=k&&f||!k&&x,_=N*Xr;return v>_&&$?(c("exiting"),j(k?-N:N),h.current=setTimeout(()=>{p.current&&(l.current+=k?1:-1,k?s?.():a?.(),g(k,N,j))},Be),!0):!1}});m.useEffect(()=>()=>{h.current&&(clearTimeout(h.current),h.current=null)},[]),m.useLayoutEffect(()=>{if(t!==l.current&&S){const b=t>l.current;if(l.current=t,o==="idle"){j(b?S:-S),c("entering"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{j(0)})});const N=setTimeout(()=>{c("idle"),h.current=null},Be);return h.current=N,()=>{clearTimeout(N)}}}},[t,S,o,j]);const w=!R&&!u;return r.jsx("div",{ref:p,className:"relative overflow-hidden",...C,children:r.jsx("div",{style:{transform:`translateX(${y}px)`,transition:w?`transform ${Be}ms cubic-bezier(0.25, 0.1, 0.25, 1)`:"none",cursor:n?R?"grabbing":"grab":"default"},children:i})})}function Yr(t,e,s){return t?s?"bg-warning-500 text-warning-950 ring-2 ring-warning-500 ring-offset-2 dark:ring-offset-surface-card-dark":"bg-primary-500 text-primary-950 ring-2 ring-primary-500 ring-offset-2 dark:ring-offset-surface-card-dark":s?"bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-400 ring-2 ring-warning-400 dark:ring-warning-600":e?"bg-success-500 text-white":"bg-surface-muted dark:bg-surface-subtle-dark text-text-muted dark:text-text-muted-dark"}function Zr({steps:t,currentStepIndex:e,stepsMarkedDone:s,onStepClick:a,clickable:n=!1}){const{t:i}=D();return r.jsx("div",{className:"flex items-center justify-center gap-2",role:"navigation","aria-label":i("common.wizardProgress"),children:t.map((o,c)=>{const u=c===e,d=s.has(c),l=o.isInvalid??!1,h=!o.isOptional&&d&&!l,f=!n,x=()=>{!f&&a&&a(c)},g=y=>{!f&&a&&(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),a(c))},p=[o.label];return u&&p.push(i("common.stepIndicatorCurrent")),h&&p.push(i("common.stepIndicatorDone")),l&&p.push(i("common.stepIndicatorInvalid")),r.jsxs("div",{className:"flex items-center",children:[c>0&&r.jsx("div",{className:`w-8 h-0.5 mx-1 transition-colors ${c<=e?"bg-primary-500":"bg-border-strong dark:bg-border-strong-dark"}`}),r.jsx("button",{type:"button",onClick:x,onKeyDown:g,"aria-disabled":f,"aria-current":u?"step":void 0,"aria-label":p.join(" "),className:`
                relative flex items-center justify-center w-8 h-8 rounded-full
                transition-all duration-200
                ${n?"cursor-pointer hover:scale-110":"cursor-default"}
                ${Yr(u,h,l)}
                focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-surface-card-dark
                aria-disabled:cursor-default aria-disabled:opacity-100
              `,children:l&&!u?r.jsx(wt,{className:"w-4 h-4",strokeWidth:2.5,"aria-hidden":"true"}):h&&!u?r.jsx(Ge,{className:"w-4 h-4",strokeWidth:3,"aria-hidden":"true"}):r.jsx("span",{className:"text-xs font-semibold",children:c+1})})]},o.id)})})}function Qr(t){const e=t.indoorPlayer?.person;if(e?.displayName)return e.displayName;const s=e?.firstName?.trim()??"",a=e?.lastName?.trim()??"";return[s,a].filter(Boolean).join(" ")}function Jr(t){const e=t.__identity,s=Qr(t),a=t.indoorPlayer?.person;return!e||!s?null:{id:e,displayName:s,firstName:a?.firstName,lastName:a?.lastName,birthday:a?.birthday,licenseCategory:t.indoorPlayerLicenseCategory?.shortName,isNewlyAdded:!1}}function Xt(t){return t?t.map(Jr).filter(e=>e!==null).sort((e,s)=>e.displayName.localeCompare(s.displayName)):[]}function en({gameId:t,team:e,prefetchedData:s}){const n=je(l=>l.dataSource)==="demo",i=nr(l=>l.nominationLists),o=s!=null,c=m.useMemo(()=>o?Xt(s?.indoorPlayerNominations):[],[o,s]),u=m.useMemo(()=>{if(o||!n||!t)return null;const l=i[t];return l?l[e]??null:null},[o,n,t,e,i]),d=m.useMemo(()=>u?Xt(u.indoorPlayerNominations):[],[u]);return o?{nominationList:s,players:c,isLoading:!1,isError:!1,error:null,refetch:()=>{}}:n?{nominationList:u,players:d,isLoading:!1,isError:!1,error:null,refetch:()=>{}}:{nominationList:null,players:[],isLoading:!1,isError:!0,error:new Error("Nomination list data not available. Ensure prefetchedData is provided from getGameWithScoresheet()."),refetch:()=>{}}}function ta(t){const e=t.trim();if(!e)return{};const s=e.split(/\s+/),a={},n=s[s.length-1];return n&&/^\d{4}$/.test(n)&&(a.yearOfBirth=n,s.pop()),s.length===1?a.lastName=s[0]:s.length>=2&&(a.firstName=s[0],a.lastName=s.slice(1).join(" ")),a}function sa(t,e={}){const s=je(o=>o.dataSource),a=bt(s),n=!!(t.firstName||t.lastName||t.yearOfBirth),i=gt({queryKey:we.scorerSearch.search(t),queryFn:async()=>{const o=await a.searchPersons(t);return ir(o,or,"scorerSearch").items??[]},enabled:e.enabled!==!1&&n,staleTime:Nt});return{data:i.data,isLoading:i.isLoading,isError:i.isError,error:i.error}}const tn=100,sn=300,qt="coach-search-listbox";function an(t,e){switch(t){case"head":return e("validation.roster.headCoach");case"firstAssistant":return e("validation.roster.firstAssistant");case"secondAssistant":return e("validation.roster.secondAssistant")}}function rn({isOpen:t,onClose:e,role:s,onSelectCoach:a}){const{t:n}=D(),[i,o]=m.useState(""),[c,u]=m.useState(-1),d=St(i,sn),l=m.useRef(null),h=ta(d),{data:f,isLoading:x,isError:g}=sa(h,{enabled:t&&d.trim().length>0}),p=m.useCallback(()=>{o(""),u(-1),e()},[e]),y=m.useCallback(w=>{a(w,s),p()},[a,s,p]),R=m.useCallback(w=>{if(!(!f||f.length===0))switch(w.key){case"ArrowDown":w.preventDefault(),u(b=>b<f.length-1?b+1:b);break;case"ArrowUp":w.preventDefault(),u(b=>b>0?b-1:b);break;case"Enter":{const b=f[c];c>=0&&b&&(w.preventDefault(),y(b));break}case"Escape":u(-1);break}},[f,c,y]);m.useEffect(()=>{if(t&&l.current){const w=setTimeout(()=>{l.current?.focus()},tn);return()=>clearTimeout(w)}},[t]),m.useEffect(()=>{if(c>=0&&f?.[c]){const w=`coach-option-${f[c].__identity}`,b=document.getElementById(w);b?.scrollIntoView&&b.scrollIntoView({block:"nearest",behavior:"smooth"})}},[c,f]);const S=f&&f.length>0,j=d.trim().length>0,C=an(s,n);return r.jsxs(Ks,{isOpen:t,onClose:p,titleId:"add-coach-title",children:[r.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[r.jsxs("div",{children:[r.jsx("h2",{id:"add-coach-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:n("validation.roster.addCoach")}),r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:C})]}),r.jsx("button",{onClick:p,"aria-label":n("common.close"),className:`
            p-2 -mr-2 rounded-lg
            text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
            hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
            transition-colors
          `,children:r.jsx(ue,{className:"w-5 h-5","aria-hidden":"true"})})]}),r.jsx("div",{className:"flex-shrink-0 p-4 border-b border-border-default dark:border-border-default-dark",children:r.jsx("input",{ref:l,type:"text",value:i,onChange:w=>{o(w.target.value),u(-1)},onKeyDown:R,placeholder:n("validation.roster.searchCoaches"),"aria-label":n("validation.roster.searchCoaches"),role:"combobox","aria-expanded":S&&j?"true":"false","aria-controls":qt,"aria-activedescendant":c>=0&&f?.[c]?`coach-option-${f[c].__identity}`:void 0,"aria-autocomplete":"list",className:`
            w-full px-4 py-2 rounded-lg
            bg-surface-subtle dark:bg-surface-subtle-dark
            text-text-primary dark:text-text-primary-dark
            placeholder-text-muted dark:placeholder-text-muted-dark
            border border-transparent
            focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
            outline-none transition-colors
          `})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 py-2",children:j?x?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(Me,{size:"md"})}):g?r.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:n("validation.roster.loadCoachesError")}):S?r.jsx("ul",{id:qt,role:"listbox","aria-label":n("validation.roster.coaches"),className:"space-y-1",children:f.map((w,b)=>{const N=b===c;return r.jsx("li",{id:`coach-option-${w.__identity}`,role:"option","aria-selected":N,children:r.jsxs("button",{type:"button",onClick:()=>y(w),onMouseEnter:()=>u(b),className:`
                      w-full flex items-center justify-between p-3 rounded-lg
                      text-left
                      transition-colors
                      ${N?"bg-primary-50 dark:bg-primary-900/30":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
                    `,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate",children:w.displayName}),r.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[w.associationId&&r.jsxs("span",{children:["ID: ",w.associationId]}),w.birthday&&r.jsxs("span",{children:[n("common.dob"),": ",vt(w.birthday)]})]})]}),r.jsx(qs,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},w.__identity)})}):r.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:n("validation.roster.noCoachesFound")}):r.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:n("validation.scorerSearch.searchHint")})}),r.jsx("div",{className:"flex-shrink-0 p-4 border-t border-border-default dark:border-border-default-dark",children:r.jsx("button",{type:"button",onClick:p,className:`
            w-full py-3 px-4 rounded-lg
            text-sm font-medium
            text-text-secondary dark:text-text-secondary-dark
            bg-surface-subtle dark:bg-surface-subtle-dark
            hover:bg-gray-200 dark:hover:bg-gray-700
            transition-colors
            focus:outline-none focus:ring-2 focus:ring-primary-500/50
          `,children:n("common.cancel")})})]})}function nn({nominationListId:t,enabled:e=!0}){const s=je(n=>n.dataSource),a=bt(s);return gt({queryKey:we.nominations.possible(t),queryFn:async()=>(await a.getPossiblePlayerNominations(t)).items??[],enabled:e&&!!t,staleTime:Nt})}const on=100,ln=200;function cn({isOpen:t,onClose:e,nominationListId:s,excludePlayerIds:a,onAddPlayer:n,onRemovePlayer:i}){const{t:o}=D(),[c,u]=m.useState(""),d=St(c,ln),l=m.useRef(null),[h,f]=m.useState(new Set),{data:x,isLoading:g,isError:p}=nn({nominationListId:s,enabled:t&&!!s}),y=m.useMemo(()=>{if(!x)return[];const w=d.toLowerCase();return x.filter(b=>{const N=b.indoorPlayer?.__identity??"";if(a.includes(N)&&!h.has(N)||b.isAlreadyNominated)return!1;const v=b.indoorPlayer?.person?.lastName?.toLowerCase()??"",k=b.indoorPlayer?.person?.firstName?.toLowerCase()??"";return`${v} ${k}`.includes(w)||k.includes(w)||v.includes(w)})},[x,d,a,h]),R=m.useMemo(()=>{const w=y.map(b=>({id:b.indoorPlayer?.__identity??"",firstName:b.indoorPlayer?.person?.firstName,lastName:b.indoorPlayer?.person?.lastName,birthday:b.indoorPlayer?.person?.birthday}));return Ws(w)},[y]),S=m.useMemo(()=>Vs(R),[R]),j=m.useCallback(()=>{u(""),f(new Set),e()},[e]),C=m.useCallback(w=>{const b=w.indoorPlayer?.__identity??"";h.has(b)?(f(N=>{const v=new Set(N);return v.delete(b),v}),i(b)):(f(N=>{const v=new Set(N);return v.add(b),v}),n(w))},[h,n,i]);return m.useEffect(()=>{if(t&&l.current){const w=setTimeout(()=>{l.current?.focus()},on);return()=>clearTimeout(w)}},[t]),r.jsxs(Ks,{isOpen:t,onClose:j,titleId:"add-player-title",children:[r.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-border-default dark:border-border-default-dark",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h2",{id:"add-player-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:o("validation.addPlayer")}),h.size>0&&r.jsxs("span",{className:"px-2 py-0.5 text-sm font-medium text-success-700 dark:text-success-400 bg-success-100 dark:bg-success-900/30 rounded-full",children:[h.size," ",o("validation.roster.added")]})]}),r.jsx("button",{onClick:j,"aria-label":o("common.close"),className:`
              p-2 -mr-2 rounded-lg
              text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
              hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
              transition-colors
            `,children:r.jsx(ue,{className:"w-5 h-5","aria-hidden":"true"})})]}),r.jsx("div",{className:"flex-shrink-0 p-4 border-b border-border-default dark:border-border-default-dark",children:r.jsx("input",{ref:l,type:"text",value:c,onChange:w=>u(w.target.value),placeholder:o("validation.searchPlayers"),"aria-label":o("validation.searchPlayers"),className:`
              w-full px-4 py-2 rounded-lg
              bg-surface-subtle dark:bg-surface-subtle-dark
              text-text-primary dark:text-text-primary-dark
              placeholder-text-muted dark:placeholder-text-muted-dark
              border border-transparent
              focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
              outline-none transition-colors
            `})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain px-2 py-2",children:g?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(Me,{size:"md"})}):p?r.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:o("validation.loadPlayersError")}):y.length===0?r.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:o("validation.noPlayersFound")}):r.jsx("ul",{children:y.map(w=>{const b=w.indoorPlayer?.__identity??"",N=h.has(b),v=R.get(b),k=v?.lastName||w.indoorPlayer?.person?.lastName||"",$=v?.firstInitial||"",_=v?.dob||"",I=N?"text-success-700 dark:text-success-400":"text-text-primary dark:text-text-primary-dark";return r.jsx("li",{children:r.jsxs("button",{onClick:()=>C(w),"aria-pressed":N,className:`
                        group w-full flex items-center justify-between py-2 px-3 rounded-lg
                        text-left transition-colors
                        ${N?"bg-success-50 dark:bg-success-900/20 hover:bg-danger-50 dark:hover:bg-danger-900/20":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
                      `,children:[r.jsx("div",{className:"flex-1 min-w-0",children:r.jsxs("div",{className:"flex items-baseline text-sm font-mono",children:[r.jsx("span",{className:`font-medium ${I}`,style:{minWidth:`${S}ch`},children:k}),r.jsx("span",{className:`ml-2 w-[3ch] ${I}`,children:$}),r.jsx("span",{className:"ml-2 text-text-muted dark:text-text-muted-dark tabular-nums",children:_})]})}),N?r.jsxs("span",{className:"relative flex-shrink-0 ml-2 w-5 h-5",children:[r.jsx(Ge,{className:"w-5 h-5 text-success-600 dark:text-success-400 absolute inset-0 group-hover:opacity-0 transition-opacity","aria-hidden":"true"}),r.jsx(ue,{className:"w-5 h-5 text-danger-500 dark:text-danger-400 absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity","aria-hidden":"true"}),r.jsx("span",{className:"sr-only",children:o("validation.roster.added")})]}):r.jsx(Sr,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},w.__identity)})})}),r.jsx("div",{className:"flex-shrink-0 p-4 border-t border-border-default dark:border-border-default-dark",children:r.jsx("button",{type:"button",onClick:j,className:`
              w-full py-3 px-4 rounded-lg
              text-sm font-medium
              text-white bg-primary-500 hover:bg-primary-600
              dark:bg-primary-600 dark:hover:bg-primary-700
              transition-colors
              focus:outline-none focus:ring-2 focus:ring-primary-500/50
            `,children:o("common.done")})})]})}function Ye({label:t,person:e,coachRole:s,readOnly:a,isPendingAddition:n,isPendingRemoval:i,onAdd:o,onRemove:c}){const{t:u}=D(),d=e!=null,l=e?.displayName??u("validation.roster.notAssigned"),h=i&&d,f=n;return r.jsxs("div",{className:`
        flex items-center justify-between py-2 px-3
        ${h?"bg-danger-50 dark:bg-danger-900/20":""}
        ${f?"bg-success-50 dark:bg-success-900/20":""}
      `,"data-testid":`coach-row-${s}`,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("span",{className:"text-xs text-text-muted dark:text-text-muted-dark uppercase tracking-wide",children:t}),r.jsx("p",{className:`
            text-sm truncate
            ${h?"line-through text-danger-600 dark:text-danger-400":""}
            ${f?"text-success-700 dark:text-success-400 font-medium":""}
            ${!d&&!f?"text-text-muted dark:text-text-muted-dark italic":"text-text-primary dark:text-text-primary-dark"}
          `,children:l})]}),!a&&r.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[d&&!h&&r.jsx("button",{type:"button",onClick:c,"aria-label":u("validation.roster.removeCoach"),className:"p-1.5 rounded-md text-text-muted hover:text-danger-600 hover:bg-danger-50 dark:hover:text-danger-400 dark:hover:bg-danger-900/30 transition-colors",children:r.jsx(ue,{className:"w-4 h-4","aria-hidden":"true"})}),h&&r.jsx("button",{type:"button",onClick:c,"aria-label":u("validation.roster.undoRemoval"),className:"text-xs px-2 py-1 rounded-md text-danger-600 hover:bg-danger-100 dark:text-danger-400 dark:hover:bg-danger-900/40 transition-colors",children:u("validation.roster.undoRemoval")}),!d&&!f&&r.jsx("button",{type:"button",onClick:o,"aria-label":u("validation.roster.addCoach"),className:"p-1.5 rounded-md text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/30 transition-colors",children:r.jsx(Zs,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}function dn({headCoach:t,firstAssistant:e,secondAssistant:s,readOnly:a=!1,onAddCoach:n,onRemoveCoach:i,pendingAdditions:o,pendingRemovals:c}){const{t:u}=D(),d=o?.get("head")??t,l=o?.get("firstAssistant")??e,h=o?.get("secondAssistant")??s;return r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 divide-y divide-gray-200 dark:divide-gray-700",role:"list","aria-label":u("validation.roster.coaches"),children:[r.jsx(Ye,{label:u("validation.roster.headCoach"),person:d,coachRole:"head",readOnly:a,isPendingAddition:o?.has("head"),isPendingRemoval:c?.has("head"),onAdd:()=>n?.("head"),onRemove:()=>i?.("head")}),r.jsx(Ye,{label:u("validation.roster.firstAssistant"),person:l,coachRole:"firstAssistant",readOnly:a,isPendingAddition:o?.has("firstAssistant"),isPendingRemoval:c?.has("firstAssistant"),onAdd:()=>n?.("firstAssistant"),onRemove:()=>i?.("firstAssistant")}),r.jsx(Ye,{label:u("validation.roster.secondAssistant"),person:h,coachRole:"secondAssistant",readOnly:a,isPendingAddition:o?.has("secondAssistant"),isPendingRemoval:c?.has("secondAssistant"),onAdd:()=>n?.("secondAssistant"),onRemove:()=>i?.("secondAssistant")})]})}function un({player:t,displayData:e,maxLastNameWidth:s,isMarkedForRemoval:a,onRemove:n,onUndoRemoval:i,readOnly:o=!1}){const{t:c}=D(),u=a?"line-through text-text-subtle dark:text-text-subtle-dark":"text-text-primary dark:text-text-primary-dark";return r.jsxs("div",{className:`flex items-center justify-between py-3 px-2 border-b border-border-subtle dark:border-border-subtle-dark last:border-b-0 ${a?"opacity-50":""}`,children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[r.jsxs("div",{className:"flex items-baseline text-sm font-mono",children:[r.jsx("span",{className:u,style:{minWidth:`${s}ch`},children:e.lastName}),r.jsx("span",{className:`ml-2 w-[3ch] ${u}`,children:e.firstInitial}),r.jsx("span",{className:`ml-2 text-text-muted dark:text-text-muted-dark tabular-nums ${a?"line-through":""}`,children:e.dob})]}),r.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[t.licenseCategory&&!a&&r.jsx(Ht,{variant:"neutral",children:t.licenseCategory}),t.isNewlyAdded&&!a&&r.jsx(Ht,{variant:"success",children:c("validation.roster.newlyAdded")})]})]}),!o&&r.jsx("div",{className:"flex-shrink-0 ml-2",children:a?r.jsx("button",{type:"button",onClick:i,className:"p-1.5 rounded-full text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/50 transition-colors","aria-label":c("validation.roster.undoRemoval"),title:c("validation.roster.undoRemoval"),children:r.jsx(Dr,{className:"w-4 h-4","aria-hidden":"true"})}):r.jsx("button",{type:"button",onClick:n,className:"p-1.5 rounded-full text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/50 transition-colors","aria-label":c("validation.roster.removePlayer"),title:c("validation.roster.removePlayer"),children:r.jsx(Lr,{className:"w-4 h-4","aria-hidden":"true"})})})]})}const mn=m.lazy(()=>lr(()=>import("./chunk-OCRPanel-CTZdp3LM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])).then(t=>({default:t.OCRPanel})));function Yt({title:t,count:e,countLabel:s,expanded:a,onToggle:n,sectionId:i}){const o=a?Et:kt;return r.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-3 px-1 text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 rounded-lg","aria-expanded":a,"aria-controls":i,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(o,{className:"w-5 h-5 text-text-muted dark:text-text-muted-dark","aria-hidden":"true"}),r.jsx("span",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:t})]}),r.jsx("span",{className:"text-xs text-text-muted dark:text-text-muted-dark",children:s.replace("{count}",String(e))})]})}function aa({team:t,teamName:e,gameId:s,onModificationsChange:a,onAddPlayerSheetOpenChange:n,readOnly:i=!1,initialModifications:o,initialCoachModifications:c,prefetchedNominationList:u}){const{t:d}=D(),{nominationList:l,players:h,isLoading:f,isError:x,refetch:g}=en({gameId:s,team:t,prefetchedData:u}),{isOCREnabled:p}=He(),[y,R]=m.useState("players"),[S,j]=m.useState(()=>o?.added??[]),[C,w]=m.useState(()=>new Set(o?.removed??[])),[b,N]=m.useState(()=>c?.added??new Map),[v,k]=m.useState(()=>c?.removed??new Set),[$,_]=m.useState(!1),[I,H]=m.useState(!1),[A,P]=m.useState("head"),[Y,K]=m.useState(!1),te=m.useRef(a);m.useEffect(()=>{te.current=a},[a]),m.useEffect(()=>{te.current?.({players:{added:S,removed:[...C]},coaches:{added:b,removed:v}})},[S,C,b,v]),m.useEffect(()=>{n?.($)},[$,n]);const J=m.useCallback(E=>{w(O=>{const T=new Set(O);return T.add(E),T})},[]),he=m.useCallback(E=>{w(O=>{const T=new Set(O);return T.delete(E),T})},[]),fe=m.useCallback(E=>{const O=E.indoorPlayer?.__identity;if(!O)return;const T=E.indoorPlayer?.person,V={id:O,displayName:T?.displayName??`${T?.firstName??""} ${T?.lastName??""}`.trim(),firstName:T?.firstName,lastName:T?.lastName,birthday:T?.birthday,licenseCategory:E.licenseCategory,isNewlyAdded:!0};j(ee=>[...ee,V])},[]),pe=m.useCallback(E=>{j(O=>O.filter(T=>T.id!==E))},[]),ye=m.useCallback(E=>{P(E),H(!0)},[]),be=m.useCallback(E=>{if(b.has(E)){N(O=>{const T=new Map(O);return T.delete(E),T});return}k(O=>{const T=new Set(O);return T.has(E)?T.delete(E):T.add(E),T})},[b]),oe=m.useCallback((E,O)=>{const T={id:E.__identity,displayName:E.displayName??"",firstName:E.firstName,lastName:E.lastName,birthday:E.birthday};N(V=>{const ee=new Map(V);return ee.set(O,T),ee}),k(V=>{const ee=new Set(V);return ee.delete(O),ee})},[]),se=m.useCallback(E=>{if(i){K(!1);return}w(O=>{const T=new Set(O);return E.forEach(V=>T.delete(V)),T}),K(!1)},[i]),W=[...h,...S].sort((E,O)=>{if(E.isNewlyAdded&&!O.isNewlyAdded)return 1;if(!E.isNewlyAdded&&O.isNewlyAdded)return-1;const T=E.lastName??E.displayName,V=O.lastName??O.displayName;return T.localeCompare(V)}),ae=m.useMemo(()=>Ws(W),[W]),B=m.useMemo(()=>Vs(ae),[ae]),z=W.filter(E=>!C.has(E.id)).length,L=l?.coachPerson,F=l?.firstAssistantCoachPerson,X=l?.secondAssistantCoachPerson,le=m.useMemo(()=>{const E=new Map;return b.forEach((O,T)=>{E.set(T,{__identity:O.id,displayName:O.displayName,firstName:O.firstName,lastName:O.lastName,birthday:O.birthday})}),E},[b]),ce=m.useMemo(()=>{let E=0;const O=["head","firstAssistant","secondAssistant"],T={head:L,firstAssistant:F,secondAssistant:X};for(const V of O){const ee=b.has(V),Re=T[V]&&!v.has(V);(ee||Re)&&E++}return E},[L,F,X,b,v]);return f?r.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"status","aria-live":"polite",children:[r.jsx(Me,{size:"md",className:"mb-3"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d("validation.roster.loadingRoster")})]}):x?r.jsxs("div",{className:"py-8 flex flex-col items-center justify-center",role:"alert",children:[r.jsx(Te,{className:"w-10 h-10 text-danger-500 mb-3","aria-hidden":"true"}),r.jsx("p",{className:"text-sm text-danger-600 dark:text-danger-400 mb-4",children:d("validation.roster.errorLoading")}),r.jsxs("button",{type:"button",onClick:()=>g(),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[r.jsx(Xs,{className:"w-4 h-4","aria-hidden":"true"}),d("common.retry")]})]}):r.jsxs("div",{className:"py-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:e}),r.jsxs("div",{className:"mb-2",children:[r.jsx(Yt,{title:d("validation.roster.coaches"),count:ce,countLabel:d("validation.roster.coachCount"),expanded:y==="coaches",onToggle:()=>R("coaches"),sectionId:`coaches-section-${t}`}),y==="coaches"&&r.jsx("div",{id:`coaches-section-${t}`,className:"mt-2",children:r.jsx(dn,{headCoach:L,firstAssistant:F,secondAssistant:X,readOnly:i,onAddCoach:ye,onRemoveCoach:be,pendingAdditions:le,pendingRemovals:v})})]}),r.jsxs("div",{children:[r.jsx(Yt,{title:d("validation.roster.players"),count:z,countLabel:d("validation.roster.playerCount"),expanded:y==="players",onToggle:()=>R("players"),sectionId:`players-section-${t}`}),y==="players"&&r.jsxs("div",{id:`players-section-${t}`,className:"mt-2",children:[W.length===0?r.jsx("div",{className:"py-8 text-center",children:r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d("validation.roster.emptyRoster")})}):r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:W.map(E=>{const O=ae.get(E.id);return r.jsx(un,{player:E,displayData:{lastName:O?.lastName||E.lastName||E.displayName,firstInitial:O?.firstInitial||"",dob:O?.dob||""},maxLastNameWidth:B,isMarkedForRemoval:C.has(E.id),onRemove:i?void 0:()=>J(E.id),onUndoRemoval:i?void 0:()=>he(E.id),readOnly:i},E.id)})}),(!i||p)&&r.jsxs("div",{className:"mt-4 flex gap-2",children:[!i&&r.jsxs("button",{type:"button",onClick:()=>_(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 hover:bg-primary-100 dark:hover:bg-primary-900/50 rounded-lg border border-primary-200 dark:border-primary-800 transition-colors",children:[r.jsx(Zs,{className:"w-4 h-4","aria-hidden":"true"}),d("validation.roster.addPlayer")]}),p&&r.jsxs("button",{type:"button",onClick:()=>K(!0),className:`flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600 transition-colors ${i?"flex-1":""}`,title:d("validation.ocr.scanScoresheet"),children:[r.jsx(Ke,{className:"w-4 h-4","aria-hidden":"true"}),r.jsx("span",{className:"sr-only",children:d("validation.ocr.scanScoresheet")})]})]})]})]}),!i&&r.jsx(cn,{isOpen:$,onClose:()=>_(!1),nominationListId:l?.__identity??"",excludePlayerIds:h.map(E=>E.id),onAddPlayer:fe,onRemovePlayer:pe}),!i&&r.jsx(rn,{isOpen:I,onClose:()=>H(!1),role:A,onSelectCoach:oe}),p&&r.jsx(m.Suspense,{fallback:null,children:r.jsx(mn,{isOpen:Y,onClose:()=>K(!1),team:t,teamName:e,rosterPlayers:W,onApplyResults:se})})]})}function hn({assignment:t,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:a=!1,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o}){const{homeTeam:c}=yt(t),u=t.refereeGame?.game?.__identity??"";return r.jsx(aa,{team:"home",teamName:c,gameId:u,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:a,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o})}function fn({assignment:t,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:a=!1,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o}){const{awayTeam:c}=yt(t),u=t.refereeGame?.game?.__identity??"";return r.jsx(aa,{team:"away",teamName:c,gameId:u,onModificationsChange:e,onAddPlayerSheetOpenChange:s,readOnly:a,initialModifications:n,initialCoachModifications:i,prefetchedNominationList:o})}function pn(t){return`scorer-option-${t}`}function xn({results:t,isLoading:e,isError:s,onSelect:a,highlightedIndex:n=-1,onHighlight:i,listboxId:o}){const{t:c}=D(),u=t&&t.length>0;return e?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(Me,{size:"md"})}):s?r.jsx("div",{role:"alert",className:"text-center py-8 text-danger-500 dark:text-danger-400",children:c("validation.scorerSearch.searchError")}):u?r.jsx("ul",{id:o,role:"listbox","aria-label":c("validation.scorerSearch.searchResults"),className:"space-y-1",children:t.map((d,l)=>{const h=l===n;return r.jsx("li",{id:pn(d.__identity),role:"option","aria-selected":h,children:r.jsxs("button",{onClick:()=>a(d),onMouseEnter:()=>i?.(l),className:`
                w-full flex items-center justify-between p-3 rounded-lg
                text-left
                transition-colors
                ${h?"bg-primary-50 dark:bg-primary-900/30":"hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark"}
              `,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark truncate",children:d.displayName}),r.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[d.associationId&&r.jsxs("span",{children:["ID: ",d.associationId]}),d.birthday&&r.jsxs("span",{children:[c("common.dob"),": ",vt(d.birthday)]})]})]}),r.jsx(qs,{className:"w-5 h-5 text-text-subtle flex-shrink-0 ml-2","aria-hidden":"true"})]})},d.__identity)})}):r.jsx("div",{className:"text-center py-8 text-text-muted dark:text-text-muted-dark",children:c("validation.scorerSearch.noScorersFound")})}function Zt({scorer:t,displayName:e,displayBirthday:s,onClear:a,readOnly:n=!1}){const{t:i}=D(),o=t?.displayName??e??"",c=t?.birthday??s;return r.jsx("div",{className:"mb-4 p-4 bg-primary-50 dark:bg-primary-900/20 rounded-lg border border-primary-200 dark:border-primary-800",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-text-primary dark:text-text-primary-dark",children:o}),(t?.associationId||c)&&r.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted dark:text-text-muted-dark",children:[t?.associationId&&r.jsxs("span",{children:["ID: ",t.associationId]}),c&&r.jsxs("span",{children:[i("common.dob"),": ",vt(c)]})]})]}),!n&&a&&r.jsx("button",{onClick:a,"aria-label":i("common.close"),className:`
              p-2 rounded-lg
              text-text-muted hover:text-text-secondary dark:text-text-muted-dark dark:hover:text-text-secondary-dark
              hover:bg-surface-subtle dark:hover:bg-surface-subtle-dark
              transition-colors
            `,children:r.jsx(ue,{className:"w-5 h-5","aria-hidden":"true"})})]})})}const gn=300,yn=100,Qt="scorer-search-listbox",Jt="scorer-search-hint";function bn({selectedScorer:t,onScorerSelect:e,readOnly:s=!1,readOnlyScorerName:a,readOnlyScorerBirthday:n}){const{t:i,tInterpolate:o}=D(),[c,u]=m.useState(""),[d,l]=m.useState(-1),h=St(c,gn),f=m.useRef(null),x=ta(h),{data:g,isLoading:p,isError:y}=sa(x);m.useEffect(()=>{if(t)return;const b=setTimeout(()=>{f.current?.focus()},yn);return()=>clearTimeout(b)},[t]),m.useEffect(()=>{if(d>=0&&g?.[d]){const b=`scorer-option-${g[d].__identity}`,N=document.getElementById(b);N?.scrollIntoView&&N.scrollIntoView({block:"nearest",behavior:"smooth"})}},[d,g]);const R=m.useCallback(b=>{e(b),u(""),l(-1)},[e]),S=m.useCallback(b=>{if(!(!g||g.length===0))switch(b.key){case"ArrowDown":b.preventDefault(),l(N=>N<g.length-1?N+1:N);break;case"ArrowUp":b.preventDefault(),l(N=>N>0?N-1:N);break;case"Enter":{const N=g[d];d>=0&&N&&(b.preventDefault(),R(N));break}case"Escape":l(-1);break;case"Home":b.preventDefault(),l(0);break;case"End":b.preventDefault(),l(g.length-1);break}},[g,d,R]),j=m.useCallback(()=>{e(null),u(""),l(-1),f.current?.focus()},[e]),C=g&&g.length>0,w=h.trim()&&!t;return s?r.jsx("div",{className:"py-4",children:t||a?r.jsx(Zt,{scorer:t,displayName:a,displayBirthday:n,readOnly:!0}):r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.noScorerSelected")})}):r.jsxs("div",{className:"py-4",children:[t&&r.jsx(Zt,{scorer:t,onClear:j}),!t&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("input",{ref:f,type:"text",value:c,onChange:b=>{u(b.target.value),l(-1)},onKeyDown:S,placeholder:i("validation.scorerSearch.searchPlaceholder"),"aria-label":i("validation.scorerSearch.searchPlaceholder"),role:"combobox","aria-expanded":C&&w?"true":"false","aria-controls":Qt,"aria-activedescendant":d>=0&&g?.[d]?`scorer-option-${g[d].__identity}`:void 0,"aria-autocomplete":"list","aria-describedby":Jt,className:`
                w-full px-4 py-2 rounded-lg
                bg-surface-subtle dark:bg-surface-subtle-dark
                text-text-primary dark:text-text-primary-dark
                placeholder-text-muted dark:placeholder-text-muted-dark
                border border-transparent
                focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20
                outline-none transition-colors
              `}),r.jsx("p",{id:Jt,className:"mt-2 text-xs text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.searchHint")})]}),w&&r.jsx("div",{className:"mt-4",children:r.jsx(xn,{results:g,isLoading:p,isError:y,onSelect:R,highlightedIndex:d,onHighlight:l,listboxId:Qt})}),r.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:w&&!p&&!y&&g&&r.jsx("span",{children:g.length===1?i("validation.scorerSearch.resultsCountOne"):o("validation.scorerSearch.resultsCount",{count:g.length})})})]}),!t&&!w&&r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("validation.scorerSearch.noScorerSelected")})]})}function Nn({onScorerChange:t,initialScorer:e=null,readOnly:s=!1,readOnlyScorerName:a,readOnlyScorerBirthday:n}){const[i,o]=m.useState(e);m.useEffect(()=>{e&&t?.(e)},[e,t]);const c=u=>{o(u),t?.(u)};return r.jsx(bn,{selectedScorer:i,onScorerSelect:c,readOnly:s,readOnlyScorerName:a,readOnlyScorerBirthday:n})}const wn=".jpg,.jpeg,.png,.pdf",es=1500,vn=10,kn=90,Cn=100,An=10;function Sn(t){return t<$t?`${t} B`:t<zt?`${(t/$t).toFixed(1)} KB`:`${(t/zt).toFixed(1)} MB`}function En({onScoresheetChange:t,readOnly:e=!1,hasScoresheet:s=!1,scoresheetNotRequired:a=!1}){const{t:n}=D(),o=je(I=>I.dataSource)==="demo",c=m.useRef(t);m.useEffect(()=>{c.current=t},[t]);const[u,d]=m.useState(null),[l,h]=m.useState("idle"),[f,x]=m.useState(null),[g,p]=m.useState(0),y=m.useRef(null),R=m.useRef(null),S=m.useRef({}),j=m.useRef(null),C=m.useRef(!1);m.useEffect(()=>{const I=S.current;return()=>{j.current&&URL.revokeObjectURL(j.current),I.interval&&clearInterval(I.interval),I.timeout&&clearTimeout(I.timeout)}},[]);const w=m.useCallback(I=>cr.includes(I.type)?I.size>dr?n("validation.scoresheetUpload.fileTooLarge"):null:n("validation.scoresheetUpload.invalidFileType"),[n]),b=m.useCallback(I=>{S.current.interval&&clearInterval(S.current.interval),S.current.timeout&&clearTimeout(S.current.timeout),C.current=!0,h("uploading"),p(0),c.current?.(I,!1),S.current.interval=setInterval(()=>{p(H=>H>=kn?(S.current.interval&&clearInterval(S.current.interval),H):H+vn)},es/An),S.current.timeout=setTimeout(()=>{S.current.interval&&clearInterval(S.current.interval),p(Cn),h("complete"),C.current=!1,c.current?.(I,!0)},es)},[]),N=m.useCallback(I=>{if(C.current)return;const H=w(I);if(H){x(H);return}j.current&&URL.revokeObjectURL(j.current),x(null);const A=I.type.startsWith("image/")?URL.createObjectURL(I):null;j.current=A,d({file:I,previewUrl:A}),b(I)},[w,b]),v=m.useCallback(I=>{const H=I.target.files?.[0];H&&N(H),I.target.value=""},[N]),k=m.useCallback(()=>{j.current&&(URL.revokeObjectURL(j.current),j.current=null),S.current.interval&&clearInterval(S.current.interval),S.current.timeout&&clearTimeout(S.current.timeout),C.current=!1,d(null),h("idle"),p(0),x(null),c.current?.(null,!1)},[]),$=m.useCallback(()=>{k(),y.current?.click()},[k]),_=I=>n(`validation.scoresheetUpload.${I}`);return a?r.jsx("div",{className:"py-4",children:r.jsxs("div",{className:"border border-info-200 dark:border-info-800 bg-info-50 dark:bg-info-900/20 rounded-lg p-4 text-center",children:[r.jsx(mr,{className:"w-12 h-12 mx-auto text-info-500 mb-3","aria-hidden":"true"}),r.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1",children:n("validation.scoresheetUpload.notRequired")}),r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:n("validation.scoresheetUpload.notRequiredDescription")})]})}):e?r.jsx("div",{className:"py-4",children:r.jsx("div",{className:"border border-border-default dark:border-border-default-dark rounded-lg p-4 text-center",children:s?r.jsxs(r.Fragment,{children:[r.jsx(et,{className:"w-12 h-12 mx-auto text-green-500 mb-3","aria-hidden":"true"}),r.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:n("validation.scoresheetUpload.scoresheetUploaded")})]}):r.jsxs(r.Fragment,{children:[r.jsx(Je,{className:"w-12 h-12 mx-auto text-text-subtle dark:text-text-subtle-dark mb-3","aria-hidden":"true"}),r.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark",children:n("validation.scoresheetUpload.noScoresheet")})]})})}):r.jsxs("div",{className:"py-4",children:[r.jsx("input",{ref:y,type:"file",accept:wn,onChange:v,className:"hidden","aria-label":_("selectFile")}),r.jsx("input",{ref:R,type:"file",accept:"image/jpeg,image/png",capture:"environment",onChange:v,className:"hidden","aria-label":_("takePhoto")}),u?r.jsxs("div",{className:"border border-border-default dark:border-border-default-dark rounded-lg overflow-hidden",children:[u.previewUrl?r.jsx("div",{className:"relative bg-surface-subtle dark:bg-surface-card-dark",children:r.jsx("img",{src:u.previewUrl,alt:_("previewAlt"),className:"w-full max-h-64 object-contain"})}):r.jsxs("div",{className:"bg-surface-subtle dark:bg-surface-card-dark p-8 flex flex-col items-center justify-center",children:[r.jsx(Je,{className:"w-16 h-16 text-text-subtle dark:text-text-subtle-dark mb-2","aria-hidden":"true"}),r.jsx("span",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:"PDF"})]}),r.jsxs("div",{className:"p-4 bg-surface-card dark:bg-surface-card-dark",children:[l==="uploading"&&r.jsxs("div",{className:"mb-3",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted dark:text-text-muted-dark mb-1",children:[r.jsx("span",{children:_("uploading")}),r.jsxs("span",{children:[g,"%"]})]}),r.jsx("div",{className:"h-2 bg-surface-muted dark:bg-surface-subtle-dark rounded-full overflow-hidden",role:"progressbar","aria-valuenow":g,"aria-valuemin":0,"aria-valuemax":100,"aria-label":_("uploading"),children:r.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-200",style:{width:`${g}%`}})})]}),l==="complete"&&r.jsxs("div",{className:"mb-3 flex items-center gap-2 text-green-600 dark:text-green-400",role:"status","aria-live":"polite",children:[r.jsx(et,{className:"w-5 h-5","aria-hidden":"true"}),r.jsx("span",{className:"text-sm font-medium",children:_("uploadComplete")})]}),r.jsx("p",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark truncate",children:u.file.name}),r.jsx("p",{className:"text-xs text-text-muted dark:text-text-muted-dark",children:Sn(u.file.size)}),r.jsxs("div",{className:"mt-4 flex gap-3",children:[r.jsx("button",{type:"button",onClick:$,disabled:l==="uploading",className:"flex-1 px-4 py-2 text-sm font-medium text-text-secondary dark:text-text-secondary-dark bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_("replace")}),r.jsx("button",{type:"button",onClick:k,disabled:l==="uploading",className:"flex-1 px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_("remove")})]})]})]}):r.jsxs("div",{className:"border-2 border-dashed border-border-strong dark:border-border-strong-dark rounded-lg p-6 text-center",children:[r.jsx(Ut,{className:"w-12 h-12 mx-auto text-text-subtle dark:text-text-subtle-dark mb-4","aria-hidden":"true"}),r.jsx("h3",{className:"text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1",children:_("title")}),r.jsx("p",{className:"text-sm text-text-muted dark:text-text-muted-dark mb-4",children:_("description")}),r.jsxs("p",{className:"text-xs text-text-subtle dark:text-text-subtle-dark mb-4",children:[_("acceptedFormats")," â€¢ ",_("maxFileSize")]}),f&&r.jsxs("div",{role:"alert",className:"mb-4 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg flex items-center gap-2",children:[r.jsx(Te,{className:"w-5 h-5 text-danger-500 flex-shrink-0","aria-hidden":"true"}),r.jsx("span",{className:"text-sm text-danger-700 dark:text-danger-400",children:f})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[r.jsxs("button",{type:"button",onClick:()=>y.current?.click(),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:[r.jsx(Ut,{className:"w-4 h-4","aria-hidden":"true"}),_("selectFile")]}),r.jsxs("button",{type:"button",onClick:()=>R.current?.click(),className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-text-secondary dark:text-text-secondary-dark bg-surface-subtle dark:bg-surface-subtle-dark hover:bg-surface-muted dark:hover:bg-surface-muted-dark rounded-lg transition-colors",children:[r.jsx(Ke,{className:"w-4 h-4","aria-hidden":"true"}),_("takePhoto")]})]})]}),o&&r.jsx("p",{className:"mt-3 text-xs text-center text-text-subtle dark:text-text-subtle-dark",children:_("demoModeNote")})]})}const jn=60;function Rn({isOpen:t,onSaveAndClose:e,onDiscard:s,onCancel:a,isSaving:n}){const{t:i}=D(),o=m.useRef(null);return m.useEffect(()=>{t&&o.current&&o.current.querySelector("button")?.focus()},[t]),t?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:jn},"aria-hidden":"true",children:r.jsxs("div",{ref:o,className:"bg-surface-card dark:bg-surface-card-dark rounded-lg shadow-xl max-w-sm w-full p-6",role:"alertdialog","aria-modal":"true","aria-labelledby":"unsaved-changes-title","aria-describedby":"unsaved-changes-description",children:[r.jsx("h3",{id:"unsaved-changes-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark mb-2",children:i("validation.state.unsavedChangesTitle")}),r.jsx("p",{id:"unsaved-changes-description",className:"text-sm text-text-muted dark:text-text-muted-dark mb-4",children:i("validation.state.unsavedChangesMessage")}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(Z,{variant:"secondary",onClick:a,disabled:n,children:i("validation.state.continueEditing")}),r.jsx(Z,{variant:"danger",onClick:s,disabled:n,children:i("validation.state.discardChanges")}),r.jsx(Z,{variant:"primary",onClick:e,disabled:n,children:i(n?"common.loading":"validation.state.saveAndClose")})]})]})}):null}const _n=60;function In({isOpen:t,rosterValidation:e,homeTeamName:s,awayTeamName:a,onGoBack:n,onProceedAnyway:i,isProceedingAnyway:o}){const{t:c,tInterpolate:u}=D(),d=m.useRef(null);if(m.useEffect(()=>{t&&d.current&&d.current.querySelector("button")?.focus()},[t]),m.useEffect(()=>{if(!t)return;const p=y=>{y.key==="Escape"&&!o&&n()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[t,o,n]),!t)return null;const{home:l,away:h}=e,f=[],x=[];l.hasHeadCoach||f.push({key:"home-coach",message:c("validation.rosterWarning.missingHeadCoach")}),l.hasMinPlayers||f.push({key:"home-players",message:u("validation.rosterWarning.insufficientPlayers",{count:l.playerCount,required:st})}),h.hasHeadCoach||x.push({key:"away-coach",message:c("validation.rosterWarning.missingHeadCoach")}),h.hasMinPlayers||x.push({key:"away-players",message:u("validation.rosterWarning.insufficientPlayers",{count:h.playerCount,required:st})});const g=p=>{p.target===p.currentTarget&&!o&&n()};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:_n},onClick:g,"aria-hidden":"true",children:r.jsxs("div",{ref:d,className:"bg-surface-card dark:bg-surface-card-dark rounded-lg shadow-xl max-w-md w-full p-6",role:"alertdialog","aria-modal":"true","aria-labelledby":"roster-warning-title","aria-describedby":"roster-warning-description",children:[r.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[r.jsx("div",{className:"flex-shrink-0 p-2 bg-warning-100 dark:bg-warning-900/30 rounded-full",children:r.jsx(wt,{className:"w-6 h-6 text-warning-600 dark:text-warning-400","aria-hidden":"true"})}),r.jsxs("div",{children:[r.jsx("h3",{id:"roster-warning-title",className:"text-lg font-semibold text-text-primary dark:text-text-primary-dark",children:c("validation.rosterWarning.title")}),r.jsx("p",{id:"roster-warning-description",className:"text-sm text-text-muted dark:text-text-muted-dark mt-1",children:c("validation.rosterWarning.description")})]})]}),r.jsxs("div",{className:"space-y-3 mb-6",children:[f.length>0&&r.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-3",children:[r.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-300 mb-1",children:s}),r.jsx("ul",{className:"list-disc list-inside text-sm text-warning-700 dark:text-warning-400 space-y-0.5",children:f.map(p=>r.jsx("li",{children:p.message},p.key))})]}),x.length>0&&r.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-3",children:[r.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-300 mb-1",children:a}),r.jsx("ul",{className:"list-disc list-inside text-sm text-warning-700 dark:text-warning-400 space-y-0.5",children:x.map(p=>r.jsx("li",{children:p.message},p.key))})]})]}),r.jsx("p",{className:"text-xs text-text-muted dark:text-text-muted-dark mb-4",children:c("validation.rosterWarning.forfeitNote")}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(Z,{variant:"secondary",onClick:n,disabled:o,children:c("validation.rosterWarning.goBack")}),r.jsx(Z,{variant:"danger",onClick:i,disabled:o,children:c(o?"common.loading":"validation.rosterWarning.proceedAnyway")})]})]})})}const ts="safe-validation-complete-title",Mn="https://volleymanager.volleyball.ch";function Tn({isOpen:t,onClose:e}){const{t:s}=D(),a=m.useRef(!1),n=m.useCallback(()=>{if(!a.current){a.current=!0;try{window.open(Mn,"_blank","noopener,noreferrer"),e()}finally{a.current=!1}}},[e]),i=r.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-success-100 dark:bg-success-900 flex items-center justify-center",children:r.jsx("svg",{className:"w-6 h-6 text-success-600 dark:text-success-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});return r.jsxs(Ct,{isOpen:t,onClose:e,titleId:ts,size:"md",children:[r.jsx(At,{title:s("settings.safeValidationCompleteTitle"),titleId:ts,icon:i}),r.jsx("div",{className:"mb-6",children:r.jsx("p",{className:"text-sm text-text-secondary dark:text-text-secondary-dark",children:s("settings.safeValidationCompleteMessage")})}),r.jsxs(Gs,{divider:!0,children:[r.jsx(Z,{variant:"secondary",className:"flex-1 rounded-md",onClick:e,children:s("common.close")}),r.jsx(Z,{variant:"primary",className:"flex-1 rounded-md",onClick:n,children:s("settings.safeValidationCompleteButton")})]})]})}const On=70;function Pn({message:t}){return r.jsxs("div",{role:"status","aria-live":"polite",className:"fixed top-4 right-4 bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",style:{zIndex:On},children:[r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5","aria-hidden":"true",children:[r.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),r.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]}),r.jsx("span",{className:"text-sm font-medium",children:t})]})}function Ln({currentStepId:t,assignment:e,loading:s,validation:a,handlers:n}){const{t:i}=D();return s.isLoading?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"text-sm text-text-muted dark:text-text-muted-dark",children:i("common.loading")})}):s.error?r.jsx("div",{role:"alert",className:"p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",children:r.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:s.error.message})}):r.jsxs(rr,{modalName:"ValidateGameModal",onClose:n.onClose,children:[t==="home-roster"&&r.jsx(hn,{assignment:e,onModificationsChange:n.setHomeRosterModifications,onAddPlayerSheetOpenChange:n.onAddPlayerSheetOpenChange,readOnly:a.isValidated||a.isInSafeMode,initialModifications:a.state.homeRoster.playerModifications,initialCoachModifications:a.state.homeRoster.coachModifications,prefetchedNominationList:a.homeNominationList}),t==="away-roster"&&r.jsx(fn,{assignment:e,onModificationsChange:n.setAwayRosterModifications,onAddPlayerSheetOpenChange:n.onAddPlayerSheetOpenChange,readOnly:a.isValidated||a.isInSafeMode,initialModifications:a.state.awayRoster.playerModifications,initialCoachModifications:a.state.awayRoster.coachModifications,prefetchedNominationList:a.awayNominationList}),t==="scorer"&&r.jsx(Nn,{onScorerChange:n.setScorer,readOnly:a.isValidated||a.isInSafeMode,readOnlyScorerName:a.validatedInfo?.scorerName,readOnlyScorerBirthday:a.validatedInfo?.scorerBirthday,initialScorer:a.pendingScorer?{__identity:a.pendingScorer.__identity,displayName:a.pendingScorer.displayName,birthday:a.pendingScorer.birthday??""}:null},a.pendingScorer?.__identity??"no-pending-scorer"),t==="scoresheet"&&r.jsx(En,{onScoresheetChange:n.setScoresheet,readOnly:a.isValidated||a.isInSafeMode,hasScoresheet:a.validatedInfo?.hasScoresheet,scoresheetNotRequired:a.scoresheetNotRequired})]})}function ra({navigation:t,onBack:e,onNext:s,onClose:a,closeLabel:n}){const{t:i}=D();return r.jsxs(r.Fragment,{children:[r.jsx("div",{children:!t.isFirstStep&&r.jsx(Z,{variant:"secondary",onClick:e,children:i("validation.wizard.previous")})}),r.jsx("div",{children:t.isLastStep?r.jsx(Z,{variant:"primary",onClick:a,children:n}):r.jsx(Z,{variant:"primary",onClick:s,children:i("validation.wizard.next")})})]})}function Bn(t){const{t:e}=D();return r.jsx(ra,{...t,closeLabel:e("common.close")})}function Dn(t){const{t:e}=D();return r.jsx(ra,{...t,closeLabel:e("validation.wizard.dismiss")})}function Fn({navigation:t,state:e,onAttemptClose:s,onBack:a,onValidateAndNext:n,onFinish:i}){const{t:o}=D(),c=e.isFinalizing||e.isLoadingGameDetails||e.hasGameDetailsError,u=c||!e.allPreviousRequiredStepsDone||!e.currentStepIsOptional&&!e.canMarkCurrentStepDone;return r.jsxs(r.Fragment,{children:[r.jsx("div",{children:t.isFirstStep?r.jsx(Z,{variant:"secondary",onClick:s,disabled:e.isFinalizing,children:o("common.cancel")}):r.jsx(Z,{variant:"secondary",onClick:a,disabled:e.isFinalizing,children:o("validation.wizard.previous")})}),r.jsx("div",{children:t.isLastStep?r.jsx(Z,{variant:"success",onClick:()=>i(),disabled:u,title:e.allPreviousRequiredStepsDone?void 0:o("validation.state.markAllStepsTooltip"),children:e.isFinalizing?o("common.loading"):o("validation.wizard.finish")}):r.jsx(Z,{variant:"success",onClick:n,disabled:c||!e.canMarkCurrentStepDone,children:o("validation.wizard.validate")})})]})}const na=.7,ia=.9,$n=4,zn=5,at=$n/zn,Hn=180,Un={electronic:{widthPercent:na,aspectRatio:at},manuscript:{widthPercent:ia,aspectRatio:at}},oa=.92;function Wn(t,e,s,a,n){const i=Un[n],o=t/e,c=s/a;let u,d,l,h;o>c?(d=e,u=e*c,l=(t-u)/2,h=0):(u=t,d=t/c,l=0,h=(e-d)/2);const f=u*i.widthPercent,x=f/i.aspectRatio,g=(u-f)/2,p=(d-x)/2;return{x:Math.round(l+g),y:Math.round(h+p),width:Math.round(f),height:Math.round(x)}}function Vn(t,e,s=oa){const a=document.createElement("canvas");a.width=e.width,a.height=e.height;const n=a.getContext("2d");return n?(n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),new Promise((i,o)=>{a.toBlob(c=>{c?i(c):o(new Error("Failed to create blob from canvas"))},"image/jpeg",s)})):Promise.reject(new Error("Could not get canvas context"))}function la(t){return t*Math.PI/Hn}function Gn(t,e,s){const a=la(s),n=Math.abs(Math.sin(a)),i=Math.abs(Math.cos(a));return{width:t*i+e*n,height:t*n+e*i}}function Kn(t){return new Promise((e,s)=>{const a=new Image;a.addEventListener("load",()=>e(a)),a.addEventListener("error",n=>s(n)),a.src=t})}async function Xn(t,e,s,a=oa){const n=await Kn(t),i=document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new Error("Could not get canvas context");const c=la(s),{width:u,height:d}=Gn(n.width,n.height,s);i.width=u,i.height=d,o.translate(u/2,d/2),o.rotate(c),o.translate(-n.width/2,-n.height/2),o.drawImage(n,0,0);const l=document.createElement("canvas"),h=l.getContext("2d");if(!h)throw new Error("Could not get cropped canvas context");return l.width=e.width,l.height=e.height,h.drawImage(i,e.x,e.y,e.width,e.height,0,0,e.width,e.height),new Promise((f,x)=>{l.toBlob(g=>{g?f(g):x(new Error("Failed to create blob from canvas"))},"image/jpeg",a)})}const qn=17,Yn=20,Zn=qn/Yn,Qn=4,Jn=5,ei=Qn/Jn,ti=.5,si=3,ss=90;function ai({imageBlob:t,scoresheetType:e,onConfirm:s,onCancel:a}){const{t:n}=D(),i=m.useMemo(()=>URL.createObjectURL(t),[t]);m.useEffect(()=>()=>URL.revokeObjectURL(i),[i]);const[o,c]=m.useState({x:0,y:0}),[u,d]=m.useState(1),[l,h]=m.useState(0),[f,x]=m.useState(null),[g,p]=m.useState(!1),[y,R]=m.useState(null),S=e==="electronic"?Zn:ei,j=m.useCallback((N,v)=>{x(v)},[]),C=m.useCallback(()=>{h(N=>N-ss)},[]),w=m.useCallback(()=>{h(N=>N+ss)},[]),b=m.useCallback(async()=>{if(f){p(!0),R(null);try{const N=await Xn(i,f,l);s(N)}catch(N){console.error("Failed to crop image:",N),R(n("validation.ocr.errors.processingFailed")),p(!1)}}},[f,i,l,s,n]);return r.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-gray-900",children:[r.jsx("div",{className:"relative flex-1",children:r.jsx(hr,{image:i,crop:o,zoom:u,rotation:l,aspect:S,minZoom:ti,maxZoom:si,onCropChange:c,onZoomChange:d,onRotationChange:h,onCropComplete:j,showGrid:!0,classes:{containerClassName:"!absolute !inset-0",cropAreaClassName:"!border-2 !border-white/90"}})}),r.jsxs("div",{className:"flex-shrink-0 py-2 px-4",children:[y&&r.jsxs("div",{className:"flex items-center gap-2 mb-2 px-3 py-2 text-sm text-red-200 bg-red-900/50 rounded",role:"alert",children:[r.jsx(Te,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),y]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("button",{type:"button",onClick:C,className:"p-2 text-gray-300 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors","aria-label":n("validation.ocr.rotateLeft"),children:r.jsx(jr,{className:"w-6 h-6","aria-hidden":"true"})}),r.jsx("span",{className:"px-3 py-1 text-sm text-gray-300 bg-white/10 rounded",children:n("validation.ocr.photoGuide.alignScoresheet")}),r.jsx("button",{type:"button",onClick:w,className:"p-2 text-gray-300 hover:text-white bg-white/10 hover:bg-white/20 rounded-full transition-colors","aria-label":n("validation.ocr.rotateRight"),children:r.jsx(_r,{className:"w-6 h-6","aria-hidden":"true"})})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex gap-4 p-4 bg-white dark:bg-gray-800",children:[r.jsxs("button",{type:"button",onClick:a,disabled:g,className:"flex-1 flex items-center justify-center gap-2 min-h-12 px-4 py-3 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-medium transition-colors disabled:opacity-50",children:[r.jsx(ue,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.cancel")]}),r.jsxs("button",{type:"button",onClick:b,disabled:g||!f,className:"flex-1 flex items-center justify-center gap-2 min-h-12 px-4 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg font-medium transition-colors disabled:opacity-50",children:[r.jsx(Ge,{className:"w-5 h-5","aria-hidden":"true"}),n(g?"validation.ocr.processing":"common.confirm")]})]})]})}const ri=100;function ni({scoresheetType:t}){const{t:e}=D(),s=t==="electronic",n={width:`${(s?na:ia)*ri}%`,aspectRatio:`${at}`},i=e(s?"validation.ocr.photoGuide.electronicHint":"validation.ocr.photoGuide.manuscriptHint");return r.jsxs("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/40"}),r.jsxs("div",{className:"relative border-2 border-white/80 rounded-lg bg-transparent z-10",style:n,children:[r.jsx("div",{className:"absolute -top-0.5 -left-0.5 w-6 h-6 border-t-4 border-l-4 border-white rounded-tl-lg"}),r.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-6 h-6 border-t-4 border-r-4 border-white rounded-tr-lg"}),r.jsx("div",{className:"absolute -bottom-0.5 -left-0.5 w-6 h-6 border-b-4 border-l-4 border-white rounded-bl-lg"}),r.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-6 h-6 border-b-4 border-r-4 border-white rounded-br-lg"}),r.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[r.jsx("div",{className:"w-8 h-0.5 bg-white/50"}),r.jsx("div",{className:"absolute w-0.5 h-8 bg-white/50"})]}),r.jsx("div",{className:"absolute -bottom-10 left-0 right-0 text-center",children:r.jsx("span",{className:"text-sm text-white/90 bg-black/50 px-3 py-1 rounded-full",children:i})})]}),r.jsx("div",{className:"absolute top-4 left-0 right-0 text-center z-10",children:r.jsx("span",{className:"text-sm font-medium text-white/90 bg-black/50 px-4 py-2 rounded-lg",children:e("validation.ocr.photoGuide.alignScoresheet")})})]})}const ii=10,as=1024,oi=ii*as*as,li=["image/jpeg","image/png","image/webp"],ci=".jpg,.jpeg,.png,.webp",di={facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},rs=.92;function ui({isOpen:t,scoresheetType:e,onClose:s,onImageSelected:a}){const{t:n}=D(),i=m.useRef(null),o=m.useRef(null),c=m.useRef(null),[u,d]=m.useState("select"),[l,h]=m.useState(null),[f,x]=m.useState(null),[g,p]=m.useState(!1),y=m.useCallback(()=>{c.current&&(c.current.getTracks().forEach(v=>v.stop()),c.current=null),o.current&&(o.current.srcObject=null)},[]);m.useEffect(()=>()=>{y()},[y]),m.useEffect(()=>{u==="camera"&&c.current&&o.current&&(o.current.srcObject=c.current,o.current.play().catch(console.error))},[u]),m.useEffect(()=>{if(!t)return;const v=k=>{k.key==="Escape"&&(u==="camera"?(y(),d("select")):u==="crop"?(x(null),d("select")):s())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[t,u,s,y]);const R=m.useCallback(async()=>{h(null),p(!1);try{const v=await navigator.mediaDevices.getUserMedia({video:di,audio:!1});c.current=v,d("camera")}catch(v){console.error("Camera access error:",v),p(!0),h(n("validation.ocr.errors.cameraNotAvailable"))}},[n]),S=m.useCallback(async()=>{const v=o.current;if(!v)return;const k=document.createElement("canvas");k.width=v.videoWidth,k.height=v.videoHeight;const $=k.getContext("2d");if(!$)return;$.drawImage(v,0,0,k.width,k.height);const _=Wn(v.videoWidth,v.videoHeight,v.clientWidth,v.clientHeight,e);try{const I=await Vn(k,_,rs);y(),x(I),d("crop")}catch(I){console.error("Failed to crop captured image:",I),k.toBlob(H=>{H&&(y(),x(H),d("crop"))},"image/jpeg",rs)}},[y,e]),j=m.useCallback(v=>{const k=v.target.files?.[0];if(k){if(v.target.value="",h(null),!li.includes(k.type)){h(n("validation.scoresheetUpload.invalidFileType"));return}if(k.size>oi){h(n("validation.ocr.errors.imageTooLarge"));return}x(k),d("crop")}},[n]),C=m.useCallback(()=>{h(null),i.current?.click()},[]),w=m.useCallback(v=>{a(v)},[a]),b=m.useCallback(()=>{x(null),d("select")},[]),N=m.useCallback(()=>{y(),d("select")},[y]);return t?u==="crop"&&f?r.jsx(ai,{imageBlob:f,scoresheetType:e,onConfirm:w,onCancel:b}):u==="camera"?r.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-gray-900",children:[r.jsxs("div",{className:"relative flex-1 min-h-0 overflow-hidden",children:[r.jsx("video",{ref:o,className:"w-full h-full object-cover bg-gray-800",autoPlay:!0,playsInline:!0,muted:!0}),r.jsx(ni,{scoresheetType:e})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-6 py-4 bg-gray-900 safe-area-bottom",children:[r.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 text-white bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition-colors",children:n("validation.ocr.cancel")}),r.jsx("button",{type:"button",onClick:S,className:"w-16 h-16 rounded-full bg-white hover:bg-gray-100 flex items-center justify-center transition-colors","aria-label":n("validation.ocr.takePhoto"),children:r.jsx("div",{className:"w-12 h-12 rounded-full bg-danger-500"})}),r.jsx("div",{className:"w-20"})]})]}):r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-capture-title",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-sm w-full mx-4 overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{id:"ocr-capture-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("validation.ocr.scanScoresheet")}),r.jsx("button",{type:"button",onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":n("common.close"),children:r.jsx(ue,{className:"w-5 h-5","aria-hidden":"true"})})]}),r.jsxs("div",{className:"p-4 space-y-4",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n("validation.ocr.scanScoresheetDescription")}),l&&r.jsxs("div",{className:"flex items-center gap-2 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",role:"alert",children:[r.jsx(Te,{className:"w-5 h-5 text-danger-500 flex-shrink-0","aria-hidden":"true"}),r.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:l})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("button",{type:"button",onClick:g?C:R,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors font-medium",children:[r.jsx(Ke,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.takePhoto")]}),r.jsxs("button",{type:"button",onClick:C,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/30 hover:bg-primary-100 dark:hover:bg-primary-900/50 border border-primary-200 dark:border-primary-800 rounded-lg transition-colors font-medium",children:[r.jsx(Ys,{className:"w-5 h-5","aria-hidden":"true"}),n("validation.ocr.selectImage")]}),r.jsx("button",{type:"button",onClick:s,className:"w-full px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors font-medium",children:n("validation.ocr.cancel")})]}),r.jsx("input",{ref:i,type:"file",accept:ci,onChange:j,className:"hidden","aria-hidden":"true"})]})]})}):null}const mi="https://volleykit-proxy.takishima.workers.dev/ocr",ns=95,is=50,hi=8,os=20,ls=10,fi=20,pi=40,xi=80,gi=100;class cs{#r;#e=!1;#s;#t=null;constructor(e,s){this.#r=e,this.#s=s??mi}#a(e,s){this.#r?.({status:e,progress:s})}async initialize(){if(!this.#e){this.#a("Initializing Mistral OCR...",0);try{const e=this.#s.replace("/ocr","/health");this.#t=new AbortController;const s=await fetch(e,{method:"GET",signal:this.#t.signal});if(this.#t=null,!s.ok)throw new Error("OCR service health check failed");this.#a("Mistral OCR ready",ls),this.#e=!0}catch(e){if(this.#t=null,e instanceof Error&&e.name==="AbortError")throw new Error("OCR cancelled");console.warn("OCR service health check failed, will attempt OCR anyway:",e),this.#a("Mistral OCR ready (health check skipped)",ls),this.#e=!0}}}#n(e){const n=new DOMParser().parseFromString(e,"text/html").querySelector("table");if(!n)return[e];const i=[],o=n.querySelectorAll("tr");for(const c of o){const u=c.querySelectorAll("th, td"),d=Array.from(u).map(l=>l.textContent?.trim()??"").filter(l=>l.length>0);d.length>0&&i.push(d.join("	"))}return i}#i(e){return typeof e=="string"?e:typeof e=="object"&&e!==null&&typeof e.content=="string"?e.content:(console.warn("Unexpected table format:",e),"")}#o(e,s){if(!s||s.length===0)return e;let a=e;for(let n=0;n<s.length;n++){const i=s[n];if(!i)continue;const o=`[tbl-${n}.html](tbl-${n}.html)`,c=this.#i(i),d=this.#n(c).join(`
`);a=a.replace(o,d)}return a}#l(e){const s=e.pages.map(o=>this.#o(o.markdown,o.tables??[])).join(`

--- Page Break ---

`).trim(),n=s.split(`
`).map((o,c)=>{const d=o.split(/\s+/).filter(l=>l.length>0).map((l,h)=>({text:l,confidence:ns,bbox:{x0:h*is,y0:c*os,x1:h*is+l.length*hi,y1:(c+1)*os}}));return{text:o,confidence:ns,words:d}}),i=n.flatMap(o=>o.words);return{fullText:s,lines:n,words:i,hasPreciseBoundingBoxes:!1}}async recognize(e){if(!this.#e)throw new Error("MistralOCR not initialized. Call initialize() first.");this.#a("Uploading image...",fi),this.#t=new AbortController;try{const s=new FormData;s.append("image",e,"scoresheet.jpg"),this.#a("Processing with Mistral OCR...",pi);const a=await fetch(this.#s,{method:"POST",body:s,signal:this.#t.signal});if(this.#a("Receiving results...",xi),!a.ok){const i=await a.json().catch(()=>({}));throw new Error(i.error??`OCR request failed: ${a.status}`)}const n=await a.json();return this.#a("Processing complete",gi),this.#l(n)}catch(s){throw s instanceof Error&&s.name==="AbortError"?new Error("OCR cancelled"):s}finally{this.#t=null}}async terminate(){this.#t&&(this.#t.abort(),this.#t=null),this.#e=!1}}const yi=1500,bi=200,Ni=300,ds=95,us=50,wi=8,ms=20,vi=50,ki=60,Ci=90,Ai=100,Si=`VBC Heimteam	VBC Gastteam
N.	Name of the player	License	N.	Name of the player	License
1	MÃœLLER ANNA	OK	3	SCHMIDT LISA	OK
4	WEBER MARIE	OK	7	FISCHER JULIA	OK
6	SCHNEIDER LAURA	OK	9	MEYER SARAH	OK
8	ZIMMERMANN NINA	OK	11	WAGNER EMMA	OK
10	HUBER LENA	OK	13	BECKER MILA	OK
12	KELLER SOPHIE	OK	15	HOFFMANN PAULA	OK
LIBERO
L1	2 BRUNNER LEA	OK	L1	5 KOCH CLARA	OK
OFFICIAL MEMBERS ADMITTED ON THE BENCH
C	Hans Trainer	C	Peter Coach
AC	Maria Assistentin	AC	Sandra Helper`;function Ei(t){const s=t.split(`
`).map((a,n)=>{const i=a.split(/\s+/).filter(o=>o.length>0);return{text:a,confidence:ds,words:i.map((o,c)=>({text:o,confidence:ds,bbox:{x0:c*us,y0:n*ms,x1:c*us+o.length*wi,y1:(n+1)*ms}}))}});return{fullText:t,lines:s,words:s.flatMap(a=>a.words),hasPreciseBoundingBoxes:!1}}const ji=Ei(Si);class hs{#r;#e=!1;constructor(e){this.#r=e}#s(e,s){this.#r?.({status:e,progress:s})}async initialize(){this.#e||(this.#s("Initializing stub OCR...",0),await new Promise(e=>setTimeout(e,bi)),this.#s("Stub OCR ready",vi),this.#e=!0)}async recognize(e){if(!this.#e)throw new Error("StubOCR not initialized. Call initialize() first.");return this.#s("Processing image...",ki),await new Promise(s=>setTimeout(s,yi)),this.#s("Extracting text...",Ci),await new Promise(s=>setTimeout(s,Ni)),this.#s("Complete",Ai),ji}async terminate(){this.#e=!1}}const Ri=3e3,rt="https://volleykit-proxy.ngn-damien.workers.dev/ocr";async function _i(){try{const t=rt.replace("/ocr","/health");return(await fetch(t,{method:"GET",signal:AbortSignal.timeout(Ri)})).ok}catch{return!1}}const Ii={create(t){return new cs(t,rt)},async createWithFallback(t){return await _i()?new cs(t,rt):(console.warn("OCR proxy not available, falling back to stub implementation"),new hs(t))},createStub(t){return new hs(t)}},ca=99,da=2,fs=3,Mi=.6,nt=new Set(["C","AC","AC2","AC3","AC4","M"]),Ti={O:"0",o:"0",Q:"0",D:"0",I:"1",l:"1",i:"1","|":"1",Z:"2",z:"2",E:"3",A:"4",S:"5",s:"5",G:"6",b:"6",T:"7",B:"8",g:"9",q:"9"},Oi={0:"O",1:"I","|":"I",5:"S",8:"B","@":"A","&":"A","â‚¬":"E","Â£":"L","Â¢":"C"};function Pi(t){return t.split("").map(e=>Ti[e]??e).join("")}function Li(t){return t.split("").map(e=>Oi[e]??e).join("")}function Bi(t){if(!t)return null;const e=t.trim(),s=Pi(e),a=/^(\d{1,2})$/.exec(s);if(a){const n=parseInt(a[1],10);if(n>=1&&n<=ca)return n}return null}function ve(t){return t?Li(t).toLowerCase().split(/[\s-]+/).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}function jt(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=ve(s[0]);return{lastName:o,firstName:"",displayName:o}}const a=ve(s[0]),n=s.slice(1).map(ve).join(" "),i=`${n} ${a}`;return{lastName:a,firstName:n,displayName:i}}function it(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=ve(s[0]);return{lastName:o,firstName:"",displayName:o}}const a=ve(s[s.length-1]),n=s.slice(0,-1).map(ve).join(" "),i=`${n} ${a}`;return{lastName:a,firstName:n,displayName:i}}const Di=3,Rt=[/punkte.*points.*punti/i,/lizenz.*licence.*licenza/i,/spieler.*joueur.*giocatore/i,/name.*nom.*nome/i,/mannschaft.*equipe.*squadra/i,/offizielle.*officiels.*ufficiali/i,/kapitÃ¤n.*capitaine.*capitano/i,/trainer.*entraÃ®neur.*allenatore/i,/aader\/ou\/o/i],Fi=10,$i=[/^[\d\s.]+$/,/^["T:\s]+$/i,/^\d+$/];function zi(t){const e=t.trim();return e.length<2||e.length>=Fi&&/^[\d\s]+$/.test(e)?!0:$i.some(s=>s.test(e))}function Hi(t){const e=t.split(`
`),s=e.some(o=>Rt.some(c=>c.test(o))),n=e.filter(o=>o.includes("	")).length>=Di,i=/[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+/.test(t);return s&&(n||i)}function Ui(t){if(!t||t.trim().length===0)return[];const e=[],s=/([a-zÃ -Ã¿])([A-Z]\.)/g,i=t.replace(s,"$1|||$2").replace(/([a-zÃ -Ã¿])([A-Z][a-zÃ -Ã¿])/g,"$1|||$2").split("|||").filter(o=>o.trim().length>0);for(const o of i){const c=o.trim();c.length>=2&&e.push(c)}return e}function Wi(t){if(!t||t.trim().length===0)return[];const e=[];let s=t;for(;s.length>0;){const a=s.match(/^(\d{1,2})\.(\d{1,2})\.((?:19|20)\d{2})/);if(a){e.push(a[0]),s=s.substring(a[0].length);continue}const n=s.match(/^(\d{1,2})\.(\d{1,2})\.(\d{2})/);if(n){e.push(n[0]),s=s.substring(n[0].length);continue}s=s.substring(1)}return e}const ua=["VTV","TV","VBC","BC","VC","SC","FC","STV","TSV","USC","US"],Vi=3;function Gi(t){return t.replace(/aader\/ou\/o\s*B?\s*/gi," ").replace(/punkte[\s\S]*?punti\s*/i," ").replace(/\s+/g," ").trim()}function Ki(t){const s=t.trim().split(/\s+/);for(;s.length>1&&/^\d+$/.test(s[s.length-1]);)s.pop();return s.join(" ")}function Xi(t,e,s){const a=t.substring(e+s.length).trim();let n=a.length;for(const o of ua){const c=a.toUpperCase().indexOf(` ${o} `);c>=0&&c<n&&(n=c)}const i=a.substring(0,n).trim();return Ki(`${s} ${i}`)}function qi(t,e,s){const a=e===0||/\s/.test(t[e-1]),n=e+s,i=n>=t.length||/\s/.test(t[n]);return a&&i}function Yi(t){const e=Gi(t),s=e.toUpperCase();for(const a of ua){const n=s.indexOf(a);if(n<0||!qi(e,n,a.length))continue;const i=Xi(e,n,a);if(i.length>Vi)return i}return null}function Zi(t){return t.every(e=>Rt.some(s=>s.test(e)))}function Qi(t){const e=t.split(`
`);for(const s of e){if(!s.includes("	"))continue;const a=s.split("	").map(i=>i.trim());if(Zi(a))continue;const n=[];for(const i of a){const o=Yi(i);o&&!n.includes(o)&&n.push(o)}if(n.length>=2)return{teamA:n[0],teamB:n[1]};if(n.length===1)return{teamA:n[0],teamB:""}}return{teamA:"",teamB:""}}const Ji=14,eo=14,to=3,so=/^\d{1,2}\.\d{1,2}\.\d{2,4}$/,ao=/^[A-Za-zÃ€-Ã¿]/,ma=/^\d{1,2}$/;function ps(t,e){let s=e,a="",n=null,i="";if(s<t.length&&so.test(t[s])&&(a=t[s],s++),s<t.length&&ma.test(t[s])&&(n=parseInt(t[s],10),n>ca&&(n=null),s++),s<t.length&&ao.test(t[s])&&(i=t[s],s++),!i)return{player:null,nextIndex:s};const o=jt(i);return{player:{shirtNumber:n,lastName:o.lastName,firstName:o.firstName,displayName:o.displayName,rawName:i,licenseStatus:"",birthDate:a||void 0},nextIndex:s}}function ro(t){const e=t.split("	").map(i=>i.trim()).filter(i=>i.length>0);if(e.length<to)return{teamA:null,teamB:null};let s=0;ma.test(e[0])&&parseInt(e[0],10)<=eo&&(s=1);const a=ps(e,s);s=a.nextIndex;const n=ps(e,s);return{teamA:a.player,teamB:n.player}}function no(t){const e=t.split("	").map(i=>i.trim()).filter(i=>i.length>0);let s=null,a=null,n=0;if(n<e.length){const i=e[n].toUpperCase();if(nt.has(i)&&(n++,n<e.length&&/^[A-Za-zÃ€-Ã¿]/.test(e[n]))){const o=e[n],c=it(o);s={role:i,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:o},n++}}if(n<e.length){const i=e[n].toUpperCase();if(nt.has(i)&&(n++,n<e.length&&/^[A-Za-zÃ€-Ã¿]/.test(e[n]))){const o=e[n],c=it(o);a={role:i,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:o},n++}}return{teamA:s,teamB:a}}const io=/[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+[A-Z]\.\s*[A-Za-zÃ€-Ã¿]+/,oo=/\d{1,2}\.\d{1,2}\.\d{2,4}.*\d{1,2}\.\d{1,2}\.\d{2,4}/,lo=/^[CA]C?\d?\t/i;function co(t,e){const s=jt(t);return{shirtNumber:null,lastName:s.lastName,firstName:s.firstName,displayName:s.displayName,rawName:t,licenseStatus:"",birthDate:e}}function uo(t){const e=[],s=[],a=[],n=[],i=Math.ceil(t.length/2);for(let o=0;o<t.length;o++){const c=t[o],u=o<i;if(io.test(c)){const d=Ui(c);u?e.push(...d):s.push(...d)}if(oo.test(c)){const d=Wi(c);u?a.push(...d):n.push(...d)}}return{firstHalfNames:e,secondHalfNames:s,firstHalfDates:a,secondHalfDates:n}}function xs(t,e,s){for(let a=0;a<e.length&&!(t.players.length>=Ji);a++){const n=co(e[a],s[a]);t.players.push(n)}}function mo(t,e,s,a,n){if(e||lo.test(t)){const i=no(t);return i.teamA&&a.officials.push(i.teamA),i.teamB&&n.officials.push(i.teamB),!0}if(s){const i=ro(t);return i.teamA&&a.players.push(i.teamA),i.teamB&&n.players.push(i.teamB),!0}return!1}function ho(t){return!!(zi(t)||Rt.some(e=>e.test(t))&&!t.includes("	"))}function fo(t){return _t(t)?"libero":It(t)?"officials":Mt(t)?"end":null}function po(t,e){const s=[];return t.players.length===0&&s.push("No players found for Team A"),e.players.length===0&&s.push("No players found for Team B"),t.officials.length===0&&e.officials.length===0&&s.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),s}function xo(t){const e=t.split(`
`).map(u=>u.trim()),s=Qi(t),a={name:s.teamA,players:[],officials:[]},n={name:s.teamB,players:[],officials:[]};let i=!1,o=!1;for(const u of e){if(ho(u))continue;const d=fo(u);if(d==="end")break;if(d==="libero"){i=!0,o=!1;continue}if(d==="officials"){o=!0,i=!1;continue}if(!u.includes("	")||mo(u,o,i,a,n))continue;const l=u.split("	"),h=uo(l);xs(a,h.firstHalfNames,h.firstHalfDates),xs(n,h.secondHalfNames,h.secondHalfDates)}const c=po(a,n);return{teamA:a,teamB:n,warnings:c}}const ha=/^(\d{1,2})[\s.:_-]+([A-Za-zÃ€-Ã¿][A-Za-zÃ€-Ã¿\s]*)/,fa=/^([0-9OoIlZzSsGgBb]{1,2})[\s.:_-]+([A-Za-zÃ€-Ã¿][A-Za-zÃ€-Ã¿\s]*)/,go=/^(C|AC\d?)[\s.:_-]+([a-zÃ -Ã¿][a-zÃ -Ã¿\s]*)/i;function yo(t){const e=t.toUpperCase();return e.includes("TEAM A")||e.includes("TEAM B")||e.includes("Ã‰QUIPE A")||e.includes("Ã‰QUIPE B")||e.includes("MANNSCHAFT A")||e.includes("MANNSCHAFT B")||e.includes("HOME")||e.includes("AWAY")||e.includes("HEIM")||e.includes("GAST")}function _t(t){return t.toUpperCase().includes("LIBERO")}function It(t){const e=t.toUpperCase();return e.includes("OFFICIAL")||e.startsWith("COACH")||/^TRAINER\b/.test(e)}function Mt(t){const e=t.toUpperCase();return e.includes("SIGNATURE")||e.includes("CAPTAIN")||e.includes("REFEREE")||e.includes("ARBITRE")}function bo(t){let e=ha.exec(t);if(e||(e=fa.exec(t)),!e)return null;const s=e[1],a=e[2].trim(),n=Bi(s);if(a.length<da)return null;const i=jt(a);return{shirtNumber:n,lastName:i.lastName,firstName:i.firstName,displayName:i.displayName,rawName:a,licenseStatus:""}}function gs(t){const e=go.exec(t);if(!e)return null;const s=e[1].toUpperCase(),a=e[2].trim();if(!nt.has(s)||a.length<da)return null;const n=it(a);return{role:s,lastName:n.lastName,firstName:n.firstName,displayName:n.displayName,rawName:a}}function pa(t){const e=t.trim();if(e.length<fs||ha.test(e)||fa.test(e)||_t(e)||It(e)||Mt(e))return null;const s=(e.match(/[A-Za-zÃ€-Ã¿]/g)??[]).length;return s>=fs&&s/e.length>Mi?e:null}const No=["TEAM A","Ã‰QUIPE A","MANNSCHAFT A","HOME","HEIM"],wo=["TEAM B","Ã‰QUIPE B","MANNSCHAFT B","AWAY","GAST"],vo=/TEAM\s*A|Ã‰QUIPE\s*A|MANNSCHAFT\s*A|HOME|HEIM/i,ko=/TEAM\s*B|Ã‰QUIPE\s*B|MANNSCHAFT\s*B|AWAY|GAST/i;function Co(t){return No.some(e=>t.includes(e))}function Ao(t){return wo.some(e=>t.includes(e))}function ys(t,e){const s=t.replace(e,"").trim();return pa(s)??""}function So(t,e){const s=t.toUpperCase();if(Co(s)){const a=ys(t,vo);return a&&(e.teamAName=a),{team:"A",isTeamA:!0}}if(Ao(s)){const a=ys(t,ko);return a&&(e.teamBName=a),{team:"B",isTeamA:!1}}return null}function Eo(t){const e={teamALines:[],teamBLines:[],teamAName:"",teamBName:""};let s=null,a=!1;for(const n of t){const i=n.trim();if(i){if(yo(i)){const o=So(i,e);if(o){s=o.team,o.isTeamA&&(a=!0);continue}}if(!a&&!e.teamAName){const o=pa(i);if(o){e.teamAName=o,s="A";continue}}s===null&&(s="A"),s==="A"?e.teamALines.push(i):e.teamBLines.push(i)}}return e}function bs(t,e){const s={name:e,players:[],officials:[]},a=[];let n=!1;for(const i of t){if(It(i)){n=!0;continue}if(Mt(i))break;if(!_t(i))if(n){const o=gs(i);o&&s.officials.push(o)}else{const o=bo(i);if(o){s.players.push(o);continue}const c=gs(i);c&&s.officials.push(c)}}return{team:s,warnings:a}}function jo(t){const e=[],s={name:"",players:[],officials:[]};if(!t||typeof t!="string")return e.push("No OCR text provided"),{teamA:{...s},teamB:{...s},warnings:e};const a=t.split(`
`).map(c=>c.trim()).filter(c=>c.length>0);if(a.length===0)return e.push("OCR text contains no lines"),{teamA:{...s},teamB:{...s},warnings:e};if(Hi(t))return xo(t);const n=Eo(a),i=bs(n.teamALines,n.teamAName),o=bs(n.teamBLines,n.teamBName);return e.push(...i.warnings),e.push(...o.warnings),i.team.players.length===0&&e.push("No players found for Team A"),o.team.players.length===0&&n.teamBLines.length>0&&e.push("No players found for Team B"),{teamA:i.team,teamB:o.team,warnings:e}}const ge=3,Oe=6,xa=2,ga=4,ya=0,ba=1,Na=2,wa=3,va=4,ka=5,Ca=2,Aa=3,Ro=3,_o=3,ot=3,lt=99,Io=4,Mo=50,Ns=new Set(["NOT","LFP","OK","NE","PEN"]),To=5;function Oo(t){if(!t||t.includes("	"))return null;const s=t.trim().split(/\s+/);if(s.length<To)return null;const a=s[0];if(!/^\d{1,2}$/.test(a))return null;const n=parseInt(a,10);if(n<1||n>lt)return null;let i=-1;for(let g=2;g<s.length-2;g++)if(Ns.has(s[g].toUpperCase())){i=g;break}if(i===-1)return null;const o=s[i],c=s.slice(1,i);if(c.length===0)return null;const u=s[i+1];if(!u||!/^\d{1,2}$/.test(u))return null;const d=parseInt(u,10);if(d<1||d>lt)return null;const l=s.slice(i+2);if(l.length===0)return null;const h=l[l.length-1];let f="",x=l;return Ns.has(h.toUpperCase())&&(f=h,x=l.slice(0,-1)),x.length===0?null:{teamAParts:[a,c.join(" "),o],teamBParts:[u,x.join(" "),f]}}function Tt(t){if(!t||t.includes("	"))return null;const e=t.trim(),s=e.search(/\s{3,}/);if(s===-1)return null;const a=e.slice(s).search(/\S/);if(a===-1)return null;const n=e.slice(0,s),i=e.slice(s+a),o=n.replace(/^[AB]\s+/,"").trim(),c=i.replace(/^[AB]\s+/,"").trim();return o.length>=ot&&c.length>=ot?[o,c]:null}function ke(t){return t?t.toLowerCase().split(/[\s-]+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}function ct(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=ke(s[0]);return{lastName:o,firstName:"",displayName:o}}const a=ke(s[0]),n=s.slice(1).map(ke).join(" "),i=`${n} ${a}`;return{lastName:a,firstName:n,displayName:i}}function Po(t){if(!t||typeof t!="string")return{lastName:"",firstName:"",displayName:""};const s=t.trim().split(/\s+/).filter(o=>o.length>0);if(s.length===0)return{lastName:"",firstName:"",displayName:""};if(s.length===1){const o=ke(s[0]);return{lastName:o,firstName:"",displayName:o}}const a=ke(s[s.length-1]),n=s.slice(0,-1).map(ke).join(" "),i=`${n} ${a}`;return{lastName:a,firstName:n,displayName:i}}function Lo(t){if(!t||typeof t!="string")return null;const e=t.trim(),s=/^L\d?\s+(\d{1,2})$/.exec(e);return s?parseInt(s[1],10):null}function Bo(t){if(!t||typeof t!="string")return{number:null,name:""};const e=t.trim(),s=/^(\d{1,2})\s+(\S[\s\S]*?)$/.exec(e);return s?{number:parseInt(s[1],10),name:s[2].trim()}:{number:null,name:e}}function Sa(t){const e=t.toUpperCase();return e.includes("OFFICIAL MEMBERS")||e.includes("ADMITTED ON THE BENCH")}function Ea(t){const e=t.toUpperCase();return e.includes("SIGNATURES")||e.includes("TEAM CAPTAIN")}function ja(t,e){return t.toUpperCase().includes("LIBERO")&&e.length<=2}const Do=new Set(["C","AC","AC2","AC3","AC4","M"]);function Fo(t){return Do.has(t.toUpperCase().trim())}function ws(t){const e=t.toUpperCase();return e.includes("LIBERO")||e.includes("N.")||e.includes("NAME OF THE PLAYER")}function $o(t){const e=/[a-zA-Z]{3,}/;return t.some(s=>e.test(s))}function zo(t,e){const s=Math.max(0,e-_o);for(let a=e-1;a>=s;a--){const n=t[a];if(!n)continue;const i=n.split("	").filter(c=>c.trim().length>0);if(i.length>=2&&$o(i)||Tt(n))return a}return-1}function Ho(t){const e=t.split("	");if(e.length<ge)return!1;const s=e[0].trim();if(!/^\d{1,2}$/.test(s))return!1;const a=parseInt(s,10);if(a<1||a>lt)return!1;const n=e[1].trim();return/^[A-Z\s]+$/.test(n)&&n.length>ot}function Ra(t){for(let e=0;e<t.length;e++){const s=t[e];if(!s)continue;const a=s.toUpperCase();if(a.includes("NAME OF THE PLAYER")||a.includes("N.")&&a.includes("NAME"))return{startIndex:e+1,teamNamesIndex:zo(t,e)}}for(let e=0;e<t.length;e++){const s=t[e];if(s&&Ho(s))return{startIndex:e,teamNamesIndex:e-1}}return{startIndex:0,teamNamesIndex:-1}}function Ce(t){return t.replace(/^[AB]\s+/,"").trim()}function _a(t,e){if(e<0||e>=t.length)return{teamAName:"",teamBName:""};const s=t[e];if(!s)return{teamAName:"",teamBName:""};const a=s.split("	").map(i=>i.trim()).filter(i=>i.length>0);if(a.length>=2)return{teamAName:Ce(a[0]),teamBName:Ce(a[1])};const n=Tt(s);return n?{teamAName:n[0],teamBName:n[1]}:a.length===1?{teamAName:Ce(a[0]),teamBName:""}:{teamAName:"",teamBName:""}}function de(t,e){const s=t[e],a=t[e+1],n=t[e+2];if(!s||!a)return null;const i=parseInt(s,10);if(isNaN(i))return null;const o=ct(a);return{shirtNumber:i,lastName:o.lastName,firstName:o.firstName,displayName:o.displayName,rawName:a,licenseStatus:n||""}}function Ae(t,e,s,a){const n=t[e],i=t[s];if(!n||!i)return null;const o=Lo(n);if(o===null){const u=Bo(i);if(u.name){const d=ct(u.name);return{shirtNumber:u.number,lastName:d.lastName,firstName:d.firstName,displayName:d.displayName,rawName:u.name,licenseStatus:t[a]||""}}return null}const c=ct(i);return{shirtNumber:o,lastName:c.lastName,firstName:c.firstName,displayName:c.displayName,rawName:i,licenseStatus:t[a]||""}}function Se(t,e,s){const a=t[e],n=t[s];if(!a||!Fo(a)||!n)return null;const i=Po(n);return{role:a.toUpperCase(),lastName:i.lastName,firstName:i.firstName,displayName:i.displayName,rawName:n}}function Ot(t){return t.teamAColumnEnded||t.seenTwoColumnPlayers}function Ia(t,e,s){if(s.headerRowsParsed===0&&!ws(e)){if(t.length>=2)s.teamA.name=Ce(t[0]),s.teamB.name=Ce(t[1]);else if(t.length===1){const a=Tt(e);a?(s.teamA.name=a[0],s.teamB.name=a[1]):s.teamA.name=Ce(t[0])}return s.headerRowsParsed++,"header"}return ws(e)?"players":(s.headerRowsParsed++,s.headerRowsParsed>Ro?"players":"header")}function Uo(t,e,s){if(t.length<ge){const n=Oo(e);if(n){s.seenTwoColumnPlayers=!0;const i=de(n.teamAParts,0);i&&s.teamA.players.push(i);const o=de(n.teamBParts,0);o&&s.teamB.players.push(o)}return}if(t.length>=Oe){s.seenTwoColumnPlayers=!0;const n=de(t,0);n&&s.teamA.players.push(n);const i=de(t,ge);i&&s.teamB.players.push(i)}else{const n=de(t,0);n&&(Ot(s)?(s.teamAColumnEnded=!0,s.teamB.players.push(n)):s.teamA.players.push(n))}}function Wo(t,e){if(t.length<ge)return;if(t.length>=Oe){const a=Ae(t,ya,ba,Na);a&&e.teamA.players.push(a);const n=Ae(t,wa,va,ka);n&&e.teamB.players.push(n)}else{const a=Ae(t,0,1,2);a&&(Ot(e)?e.teamB.players.push(a):e.teamA.players.push(a))}}function Vo(t,e){if(t.length<xa)return;if(t.length>=ga){const a=Se(t,0,1);a&&e.teamA.officials.push(a);const n=Se(t,Ca,Aa);n&&e.teamB.officials.push(n)}else{const a=Se(t,0,1);a&&(Ot(e)?e.teamB.officials.push(a):e.teamA.officials.push(a))}}function Go(t,e){if(Ea(t)){e.section="done";return}if(e.section==="done")return;if(Sa(t)){e.section="officials";return}const s=t.split("	").map(a=>a.trim());if(ja(t,s)){e.section="libero";return}switch(e.section){case"header":e.section=Ia(s,t,e);break;case"players":Uo(s,t,e);break;case"libero":Wo(s,e);break;case"officials":Vo(s,e);break}}function Ko(t){const e=[],s={section:"header",headerRowsParsed:0,teamA:{name:"",players:[],officials:[]},teamB:{name:"",players:[],officials:[]},seenTwoColumnPlayers:!1,teamAColumnEnded:!1};if(!t||typeof t!="string")return e.push("No OCR text provided"),{teamA:s.teamA,teamB:s.teamB,warnings:e};const a=t.split(`
`).map(l=>l.trim()).filter(l=>l.length>0),{startIndex:n,teamNamesIndex:i}=Ra(a);n>0&&e.push(`Skipped ${n} lines of non-player data (score/set information)`);const{teamAName:o,teamBName:c}=_a(a,i);s.teamA.name=o,s.teamB.name=c;const u=o.length>0||c.length>0;s.section=u?"players":"header";const d=a.slice(n);if(d.length===0)return e.push("OCR text contains no lines"),{teamA:s.teamA,teamB:s.teamB,warnings:e};for(const l of d)Go(l,s);return s.teamA.players.length===0&&e.push("No players found for Team A"),s.teamB.players.length===0&&e.push("No players found for Team B"),s.teamA.officials.length===0&&s.teamB.officials.length===0&&e.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),{teamA:s.teamA,teamB:s.teamB,warnings:e}}function Xo(t,e){if(t.text.includes("	")||!e.isValid||!t.words||t.words.length===0)return t.text;const s=[...t.words].sort((i,o)=>i.bbox.x0-o.bbox.x0),a=[],n=[];for(const i of s)(i.bbox.x0+i.bbox.x1)/2<e.midpoint?a.push(i.text):n.push(i.text);return a.length===0||n.length===0?t.text:`${a.join(" ")}	${n.join(" ")}`}function qo(t){const e=[],s=[];for(const o of t){if(!o.words||o.words.length<Io||o.text.split("	").filter(f=>f.trim().length>0).length<Oe)continue;const d=[...o.words].sort((f,x)=>f.bbox.x0-x.bbox.x0);let l=0,h=-1;for(let f=0;f<d.length-1;f++){const x=d[f+1].bbox.x0-d[f].bbox.x1;x>l&&(l=x,h=f)}if(h>=0&&l>Mo){const f=d[h].bbox.x1,x=d[h+1].bbox.x0;e.push(f),s.push(x)}}if(e.length<2||s.length<2)return{midpoint:0,isValid:!1};const a=e.reduce((o,c)=>o+c,0)/e.length,n=s.reduce((o,c)=>o+c,0)/s.length;return{midpoint:(a+n)/2,isValid:!0}}function Pt(t,e){return!e.isValid||!t.words||t.words.length===0?"B":t.words.reduce((a,n)=>a+n.bbox.x0,0)/t.words.length<e.midpoint?"A":"B"}function Yo(t,e){if(t.length<ge)return;if(t.length>=Oe){e.seenTwoColumnPlayers=!0;const a=de(t,0);a&&e.teamA.players.push(a);const n=de(t,ge);n&&e.teamB.players.push(n)}else{const a=de(t,0);a&&e.currentLine?Pt(e.currentLine,e.columnBoundary)==="A"?e.teamA.players.push(a):(e.teamAColumnEnded=!0,e.teamB.players.push(a)):a&&(e.seenTwoColumnPlayers?(e.teamAColumnEnded=!0,e.teamB.players.push(a)):e.teamA.players.push(a))}}function Zo(t,e){if(t.length<ge)return;if(t.length>=Oe){const a=Ae(t,ya,ba,Na);a&&e.teamA.players.push(a);const n=Ae(t,wa,va,ka);n&&e.teamB.players.push(n)}else{const a=Ae(t,0,1,2);a&&e.currentLine?Pt(e.currentLine,e.columnBoundary)==="A"?e.teamA.players.push(a):e.teamB.players.push(a):a&&(e.teamAColumnEnded||e.seenTwoColumnPlayers?e.teamB.players.push(a):e.teamA.players.push(a))}}function Qo(t,e){if(t.length<xa)return;if(t.length>=ga){const a=Se(t,0,1);a&&e.teamA.officials.push(a);const n=Se(t,Ca,Aa);n&&e.teamB.officials.push(n)}else{const a=Se(t,0,1);a&&e.currentLine?Pt(e.currentLine,e.columnBoundary)==="A"?e.teamA.officials.push(a):e.teamB.officials.push(a):a&&(e.teamAColumnEnded||e.seenTwoColumnPlayers?e.teamB.officials.push(a):e.teamA.officials.push(a))}}function Jo(t,e,s){if(e.currentLine=s,Ea(t)){e.section="done";return}if(e.section==="done")return;if(Sa(t)){e.section="officials";return}const a=t.split("	").map(n=>n.trim());if(ja(t,a)){e.section="libero";return}switch(e.section){case"header":e.section=Ia(a,t,e);break;case"players":Yo(a,e);break;case"libero":Zo(a,e);break;case"officials":Qo(a,e);break}}function el(t,e){if((e?.type??"electronic")==="manuscript")return jo(t.fullText);const a=[];if(!t.lines||t.lines.length===0){const p=Ko(t.fullText);return{...p,warnings:["No OCR line data available, using text-only parsing",...p.warnings]}}const n=qo(t.lines);n.isValid||a.push("Could not determine column boundaries from bounding boxes, using heuristic fallback");const i={section:"header",headerRowsParsed:0,teamA:{name:"",players:[],officials:[]},teamB:{name:"",players:[],officials:[]},seenTwoColumnPlayers:!1,teamAColumnEnded:!1,columnBoundary:n},o=[],c=new Map;for(const p of t.lines){const y=p.text.trim();if(!y)continue;const R=Xo(p,n);o.push(R),c.set(y,p),R!==y&&c.set(R,p)}const u=o.length>0?o:t.fullText.split(`
`).map(p=>p.trim()).filter(p=>p.length>0),{startIndex:d,teamNamesIndex:l}=Ra(u);d>0&&a.push(`Skipped ${d} lines of non-player data (score/set information)`);const{teamAName:h,teamBName:f}=_a(u,l);i.teamA.name=h,i.teamB.name=f;const x=h.length>0||f.length>0;i.section=x?"players":"header";const g=u.slice(d);if(g.length===0)return a.push("OCR text contains no lines"),{teamA:i.teamA,teamB:i.teamB,warnings:a};for(const p of g){const y=c.get(p);Jo(p,i,y)}return i.teamA.players.length===0&&a.push("No players found for Team A"),i.teamB.players.length===0&&a.push("No players found for Team B"),i.teamA.officials.length===0&&i.teamB.officials.length===0&&a.push("No officials (coaches) found - the OFFICIAL MEMBERS section may not have been recognized"),{teamA:i.teamA,teamB:i.teamB,warnings:a}}function tl(){const[t,e]=m.useState(!1),[s,a]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(null),[u,d]=m.useState(null),l=m.useRef(null),h=m.useCallback(async(g,p="electronic")=>{e(!0),a(null),i(null),c(null),d(null);try{const y=Ii.create(j=>{a(j)});l.current=y,await y.initialize();const R=await y.recognize(g),S=el(R,{type:p});return await y.terminate(),l.current=null,i(S),c(R),e(!1),S}catch(y){const R=y instanceof Error?y:new Error(String(y));return R.message!=="OCR cancelled"&&d(R),e(!1),l.current=null,null}},[]),f=m.useCallback(async()=>{if(l.current){try{await l.current.terminate()}catch{}l.current=null}e(!1),a(null)},[]),x=m.useCallback(()=>{e(!1),a(null),i(null),c(null),d(null)},[]);return{isProcessing:t,progress:s,result:n,ocrResult:o,error:u,processImage:h,cancel:f,reset:x}}function sl(t,e){return t.officials.filter(s=>s.role===e).length}function vs(t){return t.officials.some(e=>e.role==="AC3")}function ks(t){return sl(t,"M")>=2}function al(){const[t,e]=m.useState({isOpen:!1,type:null}),s=m.useCallback(n=>{vs(n.teamA)||vs(n.teamB)?e({isOpen:!0,type:"ac3"}):(ks(n.teamA)||ks(n.teamB))&&e({isOpen:!0,type:"multipleDoctors"})},[]),a=m.useCallback(()=>{e({isOpen:!1,type:null})},[]);return{easterEgg:t,checkForEasterEggs:s,dismissEasterEgg:a}}const Cs=["#f94144","#f3722c","#f8961e","#f9c74f","#90be6d","#43aa8b","#4d908e","#577590","#277da1","#9b5de5"],rl=100,nl=.3,As=.99,il=.015,ol=8,ll=8,cl=200,dl=.3,ul=10,ml=8,hl=8,Ss=.5,fl=.2,pl=.6,Es=2,xl=4;function gl(t=3e3){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const e=document.createElement("canvas");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e);const s=()=>{e.width=window.innerWidth,e.height=window.innerHeight};s(),window.addEventListener("resize",s);const a=e.getContext("2d");if(!a){e.parentNode&&e.parentNode.removeChild(e);return}const n=[],i=e.width/2;for(let d=0;d<rl;d++){const l=Math.random()*Math.PI*2,h=ol+Math.random()*ll;n.push({x:i+(Math.random()-Ss)*cl,y:e.height*dl,vx:Math.cos(l)*h,vy:Math.sin(l)*h-ul,color:Cs[Math.floor(Math.random()*Cs.length)],size:ml+Math.random()*hl,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-Ss)*fl,opacity:1})}let o;const c=Date.now(),u=()=>{const d=Date.now()-c;if(d>t||n.every(l=>l.opacity<=0)){cancelAnimationFrame(o),window.removeEventListener("resize",s),e.parentNode&&e.parentNode.removeChild(e);return}a.clearRect(0,0,e.width,e.height);for(const l of n)l.vy+=nl,l.vx*=As,l.vy*=As,l.x+=l.vx,l.y+=l.vy,l.rotation+=l.rotationSpeed,d>t*pl&&(l.opacity-=il),l.opacity>0&&(a.save(),a.translate(l.x,l.y),a.rotate(l.rotation),a.globalAlpha=Math.max(0,l.opacity),a.fillStyle=l.color,a.fillRect(-l.size/Es,-l.size/xl,l.size,l.size/Es),a.restore());o=requestAnimationFrame(u)};u()}const yl=3e3;function bl({isOpen:t,type:e,onClose:s}){const{t:a}=D();m.useEffect(()=>{t&&gl(yl)},[t]);const n=`easter-egg-${e}-title`,i=()=>{switch(e){case"ac3":return r.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center",children:r.jsx(vr,{className:"w-6 h-6 text-amber-600 dark:text-amber-400","aria-hidden":"true"})});case"multipleDoctors":return r.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:r.jsx(Or,{className:"w-6 h-6 text-red-600 dark:text-red-400","aria-hidden":"true"})})}};return r.jsxs(Ct,{isOpen:t,onClose:s,titleId:n,size:"sm",zIndex:70,children:[r.jsx(At,{title:a(`easterEggs.${e}.title`),titleId:n,icon:i()}),r.jsx("p",{className:"text-text-secondary dark:text-text-secondary-dark mb-6",children:a(`easterEggs.${e}.message`)}),r.jsx(Gs,{children:r.jsx("button",{type:"button",onClick:s,className:"w-full px-4 py-2.5 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:a("easterEggs.dismiss")})})]})}function ie(t){return Array.isArray?Array.isArray(t):Oa(t)==="[object Array]"}function Nl(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function wl(t){return t==null?"":Nl(t)}function re(t){return typeof t=="string"}function Ma(t){return typeof t=="number"}function vl(t){return t===!0||t===!1||kl(t)&&Oa(t)=="[object Boolean]"}function Ta(t){return typeof t=="object"}function kl(t){return Ta(t)&&t!==null}function Q(t){return t!=null}function Ze(t){return!t.trim().length}function Oa(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Cl="Incorrect 'index' type",Al=t=>`Invalid value for key ${t}`,Sl=t=>`Pattern length exceeds max of ${t}.`,El=t=>`Missing ${t} property in key`,jl=t=>`Property 'weight' in key '${t}' must be a positive integer`,js=Object.prototype.hasOwnProperty;class Rl{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(a=>{let n=Pa(a);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(a=>{a.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Pa(t){let e=null,s=null,a=null,n=1,i=null;if(re(t)||ie(t))a=t,e=Rs(t),s=dt(t);else{if(!js.call(t,"name"))throw new Error(El("name"));const o=t.name;if(a=o,js.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(jl(o));e=Rs(o),s=dt(o),i=t.getFn}return{path:e,id:s,weight:n,src:a,getFn:i}}function Rs(t){return ie(t)?t:t.split(".")}function dt(t){return ie(t)?t.join("."):t}function _l(t,e){let s=[],a=!1;const n=(i,o,c)=>{if(Q(i))if(!o[c])s.push(i);else{let u=o[c];const d=i[u];if(!Q(d))return;if(c===o.length-1&&(re(d)||Ma(d)||vl(d)))s.push(wl(d));else if(ie(d)){a=!0;for(let l=0,h=d.length;l<h;l+=1)n(d[l],o,c+1)}else o.length&&n(d,o,c+1)}};return n(t,re(e)?e.split("."):e,0),a?s:s[0]}const Il={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Ml={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},Tl={location:0,threshold:.6,distance:100},Ol={useExtendedSearch:!1,getFn:_l,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var M={...Ml,...Il,...Tl,...Ol};const Pl=/[^ ]+/g;function Ll(t=1,e=3){const s=new Map,a=Math.pow(10,e);return{get(n){const i=n.match(Pl).length;if(s.has(i))return s.get(i);const o=1/Math.pow(i,.5*t),c=parseFloat(Math.round(o*a)/a);return s.set(i,c),c},clear(){s.clear()}}}class Lt{constructor({getFn:e=M.getFn,fieldNormWeight:s=M.fieldNormWeight}={}){this.norm=Ll(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,a)=>{this._keysMap[s.id]=a})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,re(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();re(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,a=this.size();s<a;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!Q(e)||Ze(e))return;let a={v:e,i:s,n:this.norm.get(e)};this.records.push(a)}_addObject(e,s){let a={i:s,$:{}};this.keys.forEach((n,i)=>{let o=n.getFn?n.getFn(e):this.getFn(e,n.path);if(Q(o)){if(ie(o)){let c=[];const u=[{nestedArrIndex:-1,value:o}];for(;u.length;){const{nestedArrIndex:d,value:l}=u.pop();if(Q(l))if(re(l)&&!Ze(l)){let h={v:l,i:d,n:this.norm.get(l)};c.push(h)}else ie(l)&&l.forEach((h,f)=>{u.push({nestedArrIndex:f,value:h})})}a.$[i]=c}else if(re(o)&&!Ze(o)){let c={v:o,n:this.norm.get(o)};a.$[i]=c}}}),this.records.push(a)}toJSON(){return{keys:this.keys,records:this.records}}}function La(t,e,{getFn:s=M.getFn,fieldNormWeight:a=M.fieldNormWeight}={}){const n=new Lt({getFn:s,fieldNormWeight:a});return n.setKeys(t.map(Pa)),n.setSources(e),n.create(),n}function Bl(t,{getFn:e=M.getFn,fieldNormWeight:s=M.fieldNormWeight}={}){const{keys:a,records:n}=t,i=new Lt({getFn:e,fieldNormWeight:s});return i.setKeys(a),i.setIndexRecords(n),i}function De(t,{errors:e=0,currentLocation:s=0,expectedLocation:a=0,distance:n=M.distance,ignoreLocation:i=M.ignoreLocation}={}){const o=e/t.length;if(i)return o;const c=Math.abs(a-s);return n?o+c/n:c?1:o}function Dl(t=[],e=M.minMatchCharLength){let s=[],a=-1,n=-1,i=0;for(let o=t.length;i<o;i+=1){let c=t[i];c&&a===-1?a=i:!c&&a!==-1&&(n=i-1,n-a+1>=e&&s.push([a,n]),a=-1)}return t[i-1]&&i-a>=e&&s.push([a,i-1]),s}const xe=32;function Fl(t,e,s,{location:a=M.location,distance:n=M.distance,threshold:i=M.threshold,findAllMatches:o=M.findAllMatches,minMatchCharLength:c=M.minMatchCharLength,includeMatches:u=M.includeMatches,ignoreLocation:d=M.ignoreLocation}={}){if(e.length>xe)throw new Error(Sl(xe));const l=e.length,h=t.length,f=Math.max(0,Math.min(a,h));let x=i,g=f;const p=c>1||u,y=p?Array(h):[];let R;for(;(R=t.indexOf(e,g))>-1;){let N=De(e,{currentLocation:R,expectedLocation:f,distance:n,ignoreLocation:d});if(x=Math.min(N,x),g=R+l,p){let v=0;for(;v<l;)y[R+v]=1,v+=1}}g=-1;let S=[],j=1,C=l+h;const w=1<<l-1;for(let N=0;N<l;N+=1){let v=0,k=C;for(;v<k;)De(e,{errors:N,currentLocation:f+k,expectedLocation:f,distance:n,ignoreLocation:d})<=x?v=k:C=k,k=Math.floor((C-v)/2+v);C=k;let $=Math.max(1,f-k+1),_=o?h:Math.min(f+k,h)+l,I=Array(_+2);I[_+1]=(1<<N)-1;for(let A=_;A>=$;A-=1){let P=A-1,Y=s[t.charAt(P)];if(p&&(y[P]=+!!Y),I[A]=(I[A+1]<<1|1)&Y,N&&(I[A]|=(S[A+1]|S[A])<<1|1|S[A+1]),I[A]&w&&(j=De(e,{errors:N,currentLocation:P,expectedLocation:f,distance:n,ignoreLocation:d}),j<=x)){if(x=j,g=P,g<=f)break;$=Math.max(1,2*f-g)}}if(De(e,{errors:N+1,currentLocation:f,expectedLocation:f,distance:n,ignoreLocation:d})>x)break;S=I}const b={isMatch:g>=0,score:Math.max(.001,j)};if(p){const N=Dl(y,c);N.length?u&&(b.indices=N):b.isMatch=!1}return b}function $l(t){let e={};for(let s=0,a=t.length;s<a;s+=1){const n=t.charAt(s);e[n]=(e[n]||0)|1<<a-s-1}return e}const Ue=String.prototype.normalize?(t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(t=>t);class Ba{constructor(e,{location:s=M.location,threshold:a=M.threshold,distance:n=M.distance,includeMatches:i=M.includeMatches,findAllMatches:o=M.findAllMatches,minMatchCharLength:c=M.minMatchCharLength,isCaseSensitive:u=M.isCaseSensitive,ignoreDiacritics:d=M.ignoreDiacritics,ignoreLocation:l=M.ignoreLocation}={}){if(this.options={location:s,threshold:a,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:u,ignoreDiacritics:d,ignoreLocation:l},e=u?e:e.toLowerCase(),e=d?Ue(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(x,g)=>{this.chunks.push({pattern:x,alphabet:$l(x),startIndex:g})},f=this.pattern.length;if(f>xe){let x=0;const g=f%xe,p=f-g;for(;x<p;)h(this.pattern.substr(x,xe),x),x+=xe;if(g){const y=f-xe;h(this.pattern.substr(y),y)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:a,includeMatches:n}=this.options;if(e=s?e:e.toLowerCase(),e=a?Ue(e):e,this.pattern===e){let p={isMatch:!0,score:0};return n&&(p.indices=[[0,e.length-1]]),p}const{location:i,distance:o,threshold:c,findAllMatches:u,minMatchCharLength:d,ignoreLocation:l}=this.options;let h=[],f=0,x=!1;this.chunks.forEach(({pattern:p,alphabet:y,startIndex:R})=>{const{isMatch:S,score:j,indices:C}=Fl(e,p,y,{location:i+R,distance:o,threshold:c,findAllMatches:u,minMatchCharLength:d,includeMatches:n,ignoreLocation:l});S&&(x=!0),f+=j,S&&C&&(h=[...h,...C])});let g={isMatch:x,score:x?f/this.chunks.length:1};return x&&n&&(g.indices=h),g}}class me{constructor(e){this.pattern=e}static isMultiMatch(e){return _s(e,this.multiRegex)}static isSingleMatch(e){return _s(e,this.singleRegex)}search(){}}function _s(t,e){const s=t.match(e);return s?s[1]:null}class zl extends me{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Hl extends me{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const a=e.indexOf(this.pattern)===-1;return{isMatch:a,score:a?0:1,indices:[0,e.length-1]}}}class Ul extends me{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Wl extends me{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Vl extends me{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Gl extends me{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Da extends me{constructor(e,{location:s=M.location,threshold:a=M.threshold,distance:n=M.distance,includeMatches:i=M.includeMatches,findAllMatches:o=M.findAllMatches,minMatchCharLength:c=M.minMatchCharLength,isCaseSensitive:u=M.isCaseSensitive,ignoreDiacritics:d=M.ignoreDiacritics,ignoreLocation:l=M.ignoreLocation}={}){super(e),this._bitapSearch=new Ba(e,{location:s,threshold:a,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:u,ignoreDiacritics:d,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Fa extends me{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,a;const n=[],i=this.pattern.length;for(;(a=e.indexOf(this.pattern,s))>-1;)s=a+i,n.push([a,s-1]);const o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}const ut=[zl,Fa,Ul,Wl,Gl,Vl,Hl,Da],Is=ut.length,Kl=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Xl="|";function ql(t,e={}){return t.split(Xl).map(s=>{let a=s.trim().split(Kl).filter(i=>i&&!!i.trim()),n=[];for(let i=0,o=a.length;i<o;i+=1){const c=a[i];let u=!1,d=-1;for(;!u&&++d<Is;){const l=ut[d];let h=l.isMultiMatch(c);h&&(n.push(new l(h,e)),u=!0)}if(!u)for(d=-1;++d<Is;){const l=ut[d];let h=l.isSingleMatch(c);if(h){n.push(new l(h,e));break}}}return n})}const Yl=new Set([Da.type,Fa.type]);class Zl{constructor(e,{isCaseSensitive:s=M.isCaseSensitive,ignoreDiacritics:a=M.ignoreDiacritics,includeMatches:n=M.includeMatches,minMatchCharLength:i=M.minMatchCharLength,ignoreLocation:o=M.ignoreLocation,findAllMatches:c=M.findAllMatches,location:u=M.location,threshold:d=M.threshold,distance:l=M.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:a,includeMatches:n,minMatchCharLength:i,findAllMatches:c,ignoreLocation:o,location:u,threshold:d,distance:l},e=s?e:e.toLowerCase(),e=a?Ue(e):e,this.pattern=e,this.query=ql(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:a,isCaseSensitive:n,ignoreDiacritics:i}=this.options;e=n?e:e.toLowerCase(),e=i?Ue(e):e;let o=0,c=[],u=0;for(let d=0,l=s.length;d<l;d+=1){const h=s[d];c.length=0,o=0;for(let f=0,x=h.length;f<x;f+=1){const g=h[f],{isMatch:p,indices:y,score:R}=g.search(e);if(p){if(o+=1,u+=R,a){const S=g.constructor.type;Yl.has(S)?c=[...c,...y]:c.push(y)}}else{u=0,o=0,c.length=0;break}}if(o){let f={isMatch:!0,score:u/o};return a&&(f.indices=c),f}}return{isMatch:!1,score:1}}}const mt=[];function Ql(...t){mt.push(...t)}function ht(t,e){for(let s=0,a=mt.length;s<a;s+=1){let n=mt[s];if(n.condition(t,e))return new n(t,e)}return new Ba(t,e)}const We={AND:"$and",OR:"$or"},ft={PATH:"$path",PATTERN:"$val"},pt=t=>!!(t[We.AND]||t[We.OR]),Jl=t=>!!t[ft.PATH],ec=t=>!ie(t)&&Ta(t)&&!pt(t),Ms=t=>({[We.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function $a(t,e,{auto:s=!0}={}){const a=n=>{let i=Object.keys(n);const o=Jl(n);if(!o&&i.length>1&&!pt(n))return a(Ms(n));if(ec(n)){const u=o?n[ft.PATH]:i[0],d=o?n[ft.PATTERN]:n[u];if(!re(d))throw new Error(Al(u));const l={keyId:dt(u),pattern:d};return s&&(l.searcher=ht(d,e)),l}let c={children:[],operator:i[0]};return i.forEach(u=>{const d=n[u];ie(d)&&d.forEach(l=>{c.children.push(a(l))})}),c};return pt(t)||(t=Ms(t)),a(t)}function tc(t,{ignoreFieldNorm:e=M.ignoreFieldNorm}){t.forEach(s=>{let a=1;s.matches.forEach(({key:n,norm:i,score:o})=>{const c=n?n.weight:null;a*=Math.pow(o===0&&c?Number.EPSILON:o,(c||1)*(e?1:i))}),s.score=a})}function sc(t,e){const s=t.matches;e.matches=[],Q(s)&&s.forEach(a=>{if(!Q(a.indices)||!a.indices.length)return;const{indices:n,value:i}=a;let o={indices:n,value:i};a.key&&(o.key=a.key.src),a.idx>-1&&(o.refIndex=a.idx),e.matches.push(o)})}function ac(t,e){e.score=t.score}function rc(t,e,{includeMatches:s=M.includeMatches,includeScore:a=M.includeScore}={}){const n=[];return s&&n.push(sc),a&&n.push(ac),t.map(i=>{const{idx:o}=i,c={item:e[o],refIndex:o};return n.length&&n.forEach(u=>{u(i,c)}),c})}class ne{constructor(e,s={},a){this.options={...M,...s},this.options.useExtendedSearch,this._keyStore=new Rl(this.options.keys),this.setCollection(e,a)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof Lt))throw new Error(Cl);this._myIndex=s||La(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Q(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let a=0,n=this._docs.length;a<n;a+=1){const i=this._docs[a];e(i,a)&&(this.removeAt(a),a-=1,n-=1,s.push(i))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:a,includeScore:n,shouldSort:i,sortFn:o,ignoreFieldNorm:c}=this.options;let u=re(e)?re(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return tc(u,{ignoreFieldNorm:c}),i&&u.sort(o),Ma(s)&&s>-1&&(u=u.slice(0,s)),rc(u,this._docs,{includeMatches:a,includeScore:n})}_searchStringList(e){const s=ht(e,this.options),{records:a}=this._myIndex,n=[];return a.forEach(({v:i,i:o,n:c})=>{if(!Q(i))return;const{isMatch:u,score:d,indices:l}=s.searchIn(i);u&&n.push({item:i,idx:o,matches:[{score:d,value:i,norm:c,indices:l}]})}),n}_searchLogical(e){const s=$a(e,this.options),a=(c,u,d)=>{if(!c.children){const{keyId:h,searcher:f}=c,x=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(u,h),searcher:f});return x&&x.length?[{idx:d,item:u,matches:x}]:[]}const l=[];for(let h=0,f=c.children.length;h<f;h+=1){const x=c.children[h],g=a(x,u,d);if(g.length)l.push(...g);else if(c.operator===We.AND)return[]}return l},n=this._myIndex.records,i={},o=[];return n.forEach(({$:c,i:u})=>{if(Q(c)){let d=a(s,c,u);d.length&&(i[u]||(i[u]={idx:u,item:c,matches:[]},o.push(i[u])),d.forEach(({matches:l})=>{i[u].matches.push(...l)}))}}),o}_searchObjectList(e){const s=ht(e,this.options),{keys:a,records:n}=this._myIndex,i=[];return n.forEach(({$:o,i:c})=>{if(!Q(o))return;let u=[];a.forEach((d,l)=>{u.push(...this._findMatches({key:d,value:o[l],searcher:s}))}),u.length&&i.push({idx:c,item:o,matches:u})}),i}_findMatches({key:e,value:s,searcher:a}){if(!Q(s))return[];let n=[];if(ie(s))s.forEach(({v:i,i:o,n:c})=>{if(!Q(i))return;const{isMatch:u,score:d,indices:l}=a.searchIn(i);u&&n.push({score:d,key:e,value:i,idx:o,norm:c,indices:l})});else{const{v:i,n:o}=s,{isMatch:c,score:u,indices:d}=a.searchIn(i);c&&n.push({score:u,key:e,value:i,norm:o,indices:d})}return n}}ne.version="7.1.0";ne.createIndex=La;ne.parseIndex=Bl;ne.config=M;ne.parseQuery=$a;Ql(Zl);const nc=50,Ts=.6,Os=.4,za=90,Ha=85,Ua=95,ic=.4,Wa=.6,Ie={threshold:ic,ignoreLocation:!0,includeScore:!0},Bt=100,Va=new Set(["de","del","della","di","du","von","van","den","der","la","le","las","los","dos","da","das"]);function oc(t){const e=new Map;for(const s of t){const a=[s.firstName??"",s.lastName??""].filter(x=>x&&x.trim()).join(" "),n=Ee(a),i=n?n.split(" ").filter(x=>x.length>=2||Va.has(x)):[],o=i.length>0?new ne(i,Ie):null,c=Ee(s.lastName??""),u=c?c.split(" ").filter(x=>x.length>1):[],d=u.length>0?new ne(u,Ie):null,l=Ee(s.firstName??""),h=l?l.split(" ").filter(x=>x.length>1):[],f=h.length>0?new ne(h,Ie):null;e.set(s.id,{fullNameWords:i,fullNameFuse:o,lastNameWords:u,lastNameFuse:d,firstNameWords:h,firstNameFuse:f})}return e}function Ee(t){return t?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim():""}function Ve(t){return Ee(t)}function xt(t){const e=Ve(t);return e?e.split(" ").filter(s=>s.length>=2||Va.has(s)):[]}function lc(t,e){const s=xt(t),a=xt(e);if(s.length===0||a.length===0)return 0;const n=new ne(a,Ie);let i=0;const o=new Set;for(const u of s){const d=n.search(u);for(const l of d){const h=l.refIndex;if(o.has(h))continue;const f=1-(l.score??1);if(f>0){i+=f,o.add(h);break}}}const c=Math.max(s.length,a.length);return Math.round(i/c*Ua)}function Ps(t,e){const s=Ve(t),a=Ve(e);if(!s||!a)return 0;if(s===a)return Bt;if(s.includes(a)||a.includes(s)){const l=s.length<a.length?s:a,h=s.length>=a.length?s:a;return Math.round(l.length/h.length*za)}const n=s.split(" ").filter(l=>l.length>1),i=a.split(" ").filter(l=>l.length>1);if(i.length===0)return 0;const o=new ne(i,Ie);let c=0;const u=new Set;for(const l of n){const h=o.search(l);for(const f of h){const x=f.refIndex;if(u.has(x))continue;const g=1-(f.score??1);if(g>Wa){c+=g,u.add(x);break}}}const d=Math.max(n.length,i.length);return d===0?0:Math.round(c/d*Ha)}function cc(t,e,s){const a=xt(t);if(a.length===0||e.length===0||!s)return 0;let n=0;const i=new Set;for(const c of a){const u=s.search(c);for(const d of u){const l=d.refIndex;if(i.has(l))continue;const h=1-(d.score??1);if(h>0){n+=h,i.add(l);break}}}const o=Math.max(a.length,e.length);return Math.round(n/o*Ua)}function Ls(t,e,s,a){const n=Ve(t);if(!n||!e)return 0;if(n===e)return Bt;if(n.includes(e)||e.includes(n)){const d=n.length<e.length?n:e,l=n.length>=e.length?n:e;return Math.round(d.length/l.length*za)}const i=n.split(" ").filter(d=>d.length>1);if(s.length===0||!a)return 0;let o=0;const c=new Set;for(const d of i){const l=a.search(d);for(const h of l){const f=h.refIndex;if(c.has(f))continue;const x=1-(h.score??1);if(x>Wa){o+=x,c.add(f);break}}}const u=Math.max(i.length,s.length);return u===0?0:Math.round(o/u*Ha)}function Bs(t,e){return[t,e].filter(s=>s&&s.trim()).join(" ")}function dc(t,e,s,a){let n=null,i=0;const o=Bs(t.firstName,t.lastName);for(const c of e){if(s.has(c.id))continue;let u,d;const l=a?.get(c.id);if(l){const f=Ee(c.lastName??""),x=Ee(c.firstName??""),g=Ls(t.lastName,f,l.lastNameWords,l.lastNameFuse),p=Ls(t.firstName,x,l.firstNameWords,l.firstNameFuse);u=g*Ts+p*Os,d=cc(o,l.fullNameWords,l.fullNameFuse)}else{const f=Ps(t.lastName,c.lastName??""),x=Ps(t.firstName,c.firstName??"");u=f*Ts+x*Os;const g=Bs(c.firstName??"",c.lastName??"");d=lc(o,g)}const h=Math.max(u,d);h>i&&(i=h,n=c)}return i<nc?{player:null,confidence:0}:{player:n,confidence:Math.min(Bt,Math.round(i))}}function Fe(t,e){const s=[],a=new Set,n=oc(e);for(const o of t){const{player:c,confidence:u}=dc(o,e,a,n);c?(a.add(c.id),s.push({status:"match",ocrPlayer:o,rosterPlayerId:c.id,rosterPlayerName:c.displayName,confidence:u})):s.push({status:"ocr-only",ocrPlayer:o,rosterPlayerId:null,rosterPlayerName:null,confidence:0})}for(const o of e)a.has(o.id)||s.push({status:"roster-only",ocrPlayer:null,rosterPlayerId:o.id,rosterPlayerName:o.displayName,confidence:0});const i={match:0,"ocr-only":1,"roster-only":2};return s.sort((o,c)=>i[o.status]-i[c.status]),s}function uc(t,e){switch(t){case"match":return{icon:Ge,iconColor:"text-success-500",bgColor:"bg-success-50 dark:bg-success-900/20",borderColor:"border-success-200 dark:border-success-800",label:e("validation.ocr.comparison.matched")};case"ocr-only":return{icon:wt,iconColor:"text-warning-500",bgColor:"bg-warning-50 dark:bg-warning-900/20",borderColor:"border-warning-200 dark:border-warning-800",label:e("validation.ocr.comparison.ocrOnly")};case"roster-only":return{icon:br,iconColor:"text-danger-500",bgColor:"bg-danger-50 dark:bg-danger-900/20",borderColor:"border-danger-200 dark:border-danger-800",label:e("validation.ocr.comparison.rosterOnly")}}}function Qe({result:t,isSelected:e,onToggle:s,isSelectable:a}){const{t:n,tInterpolate:i}=D(),o=uc(t.status,n),c=o.icon,u=t.status==="roster-only"?t.rosterPlayerName:t.ocrPlayer?.displayName,d=t.status==="match"?t.rosterPlayerName:null;return r.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${o.bgColor} ${o.borderColor}`,children:[a&&r.jsx("input",{type:"checkbox",checked:e,onChange:s,className:"w-4 h-4 text-primary-500 border-gray-300 rounded focus:ring-primary-500 focus:ring-2","aria-label":`Select ${u}`}),r.jsx("div",{className:`flex-shrink-0 ${o.iconColor}`,children:r.jsx(c,{className:"w-5 h-5","aria-hidden":"true"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ur,{className:"w-4 h-4 text-gray-400 flex-shrink-0","aria-hidden":"true"}),r.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:u})]}),d&&r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate",children:d})]}),r.jsxs("div",{className:"flex flex-col items-end gap-1",children:[r.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${o.bgColor} ${o.iconColor}`,children:o.label}),t.confidence>0&&r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("validation.ocr.comparison.confidence",{score:String(t.confidence)})})]})]})}function $e({results:t,selectedPlayerIds:e,onTogglePlayer:s,onSelectAll:a,onDeselectAll:n,readOnly:i=!1}){const{t:o,tInterpolate:c}=D(),{matched:u,ocrOnly:d,rosterOnly:l}=m.useMemo(()=>({matched:t.filter(p=>p.status==="match"),ocrOnly:t.filter(p=>p.status==="ocr-only"),rosterOnly:t.filter(p=>p.status==="roster-only")}),[t]),h=u.length,f=e.size,x=h>0&&f===h,g=!i&&h>0&&a&&n;return t.length===0?r.jsx("div",{className:"py-8 text-center",children:r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o("validation.ocr.comparison.noMatches")})}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[u.length>0&&r.jsx("span",{className:"px-2 py-1 bg-success-50 dark:bg-success-900/20 text-success-700 dark:text-success-400 rounded-full",children:c("validation.ocr.comparison.matchedCount",{count:String(u.length)})}),d.length>0&&r.jsx("span",{className:"px-2 py-1 bg-warning-50 dark:bg-warning-900/20 text-warning-700 dark:text-warning-400 rounded-full",children:c("validation.ocr.comparison.ocrOnlyCount",{count:String(d.length)})}),l.length>0&&r.jsx("span",{className:"px-2 py-1 bg-danger-50 dark:bg-danger-900/20 text-danger-700 dark:text-danger-400 rounded-full",children:c("validation.ocr.comparison.rosterOnlyCount",{count:String(l.length)})})]}),g&&r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{type:"button",onClick:x?n:a,className:"text-xs text-primary-600 dark:text-primary-400 hover:underline",children:o(x?"validation.ocr.comparison.deselectAll":"validation.ocr.comparison.selectAll")}),r.jsxs("span",{className:"text-xs text-gray-400",children:["(",f,"/",h,")"]})]}),u.length>0&&r.jsx("div",{className:"space-y-2",children:u.map(p=>r.jsx(Qe,{result:p,isSelected:p.rosterPlayerId?e.has(p.rosterPlayerId):!1,onToggle:()=>p.rosterPlayerId&&s(p.rosterPlayerId),isSelectable:!i&&!!p.rosterPlayerId},p.rosterPlayerId??p.ocrPlayer?.rawName))}),d.length>0&&r.jsx("div",{className:"space-y-2",children:d.map(p=>r.jsx(Qe,{result:p,isSelected:!1,onToggle:()=>{},isSelectable:!1},`ocr-only-${p.ocrPlayer?.rawName??p.ocrPlayer?.displayName}`))}),l.length>0&&r.jsx("div",{className:"space-y-2",children:l.map(p=>r.jsx(Qe,{result:p,isSelected:!1,onToggle:()=>{},isSelectable:!1},p.rosterPlayerId))})]})}function Ds(t){return t.map(e=>({shirtNumber:null,lastName:e.lastName,firstName:e.firstName,displayName:e.displayName,rawName:e.rawName,licenseStatus:""}))}function Fs(t){return t.map(e=>({id:e.id,displayName:e.displayName,firstName:e.firstName,lastName:e.lastName}))}function mc({isOpen:t,homeTeamName:e,awayTeamName:s,homeRosterPlayers:a,awayRosterPlayers:n,homeRosterCoaches:i,awayRosterCoaches:o,onSkip:c,onComplete:u,onClose:d}){const{t:l}=D(),{processImage:h,progress:f,error:x,reset:g,ocrResult:p}=tl(),{easterEgg:y,checkForEasterEggs:R,dismissEasterEgg:S}=al(),[j,C]=m.useState("intro"),[w,b]=m.useState(!1),[N,v]=m.useState("electronic"),[k,$]=m.useState(null),[_,I]=m.useState(null),[H,A]=m.useState(null),[P,Y]=m.useState(null),[K,te]=m.useState(null),[J,he]=m.useState(new Set(["home-players","away-players"])),fe=m.useRef(!1);m.useEffect(()=>{if(!t||w)return;const B=z=>{z.key==="Escape"&&d()};return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[t,w,d]),m.useEffect(()=>{t&&(C("intro"),v("electronic"),$(null),I(null),A(null),Y(null),K&&URL.revokeObjectURL(K),te(null),he(new Set(["home-players","away-players"])),g())},[t,g]),m.useEffect(()=>()=>{K&&URL.revokeObjectURL(K)},[K]),m.useEffect(()=>{p&&Y(p)},[p]);const pe=m.useCallback(B=>{const z=B.teamA.name.toLowerCase(),L=B.teamB.name.toLowerCase(),F=e.toLowerCase(),X=s.toLowerCase(),le=z.includes(F)||F.includes(z),ce=z.includes(X)||X.includes(z),E=L.includes(F)||F.includes(L),O=L.includes(X)||X.includes(L);return le&&!ce?{homeOCR:B.teamA,awayOCR:B.teamB}:ce&&!le?{homeOCR:B.teamB,awayOCR:B.teamA}:E&&!O?{homeOCR:B.teamB,awayOCR:B.teamA}:O&&!E?{homeOCR:B.teamA,awayOCR:B.teamB}:{homeOCR:B.teamA,awayOCR:B.teamB}},[e,s]),ye=m.useCallback(async B=>{if(fe.current)return;fe.current=!0,b(!1),C("processing");const z=URL.createObjectURL(B);te(z);try{const L=await h(B,N);if(L){A(L);const{homeOCR:F,awayOCR:X}=pe(L);if(F.players.length===0&&X.players.length===0){C("error");return}const le=Fe(F.players,a.map(T=>({id:T.id,displayName:T.displayName,firstName:T.firstName,lastName:T.lastName}))),ce=Fe(Ds(F.officials),Fs(i)),E=Fe(X.players,n.map(T=>({id:T.id,displayName:T.displayName,firstName:T.firstName,lastName:T.lastName}))),O=Fe(Ds(X.officials),Fs(o));$({teamName:e,ocrTeamName:F.name,playerResults:le,coachResults:ce}),I({teamName:s,ocrTeamName:X.name,playerResults:E,coachResults:O}),R(L),C("results")}else C("error")}catch{C("error")}finally{fe.current=!1}},[h,N,pe,e,s,a,n,i,o,R]),be=m.useCallback(()=>{g(),$(null),I(null),A(null),Y(null),K&&URL.revokeObjectURL(K),te(null),C("capture"),b(!0)},[g,K]),oe=m.useCallback(B=>{v(B),C("capture"),b(!0)},[]),se=m.useCallback(B=>{he(z=>{const L=new Set(z);return L.has(B)?L.delete(B):L.add(B),L})},[]);if(!t)return null;const W=B=>{const z=B.filter(F=>F.status==="ocr-only").length,L=B.filter(F=>F.status==="roster-only").length;return z+L},ae=(k?W(k.playerResults)+W(k.coachResults):0)+(_?W(_.playerResults)+W(_.coachResults):0);return r.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col bg-white dark:bg-gray-900",role:"dialog","aria-modal":"true","aria-labelledby":"ocr-entry-title",children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("div",{children:r.jsx("h1",{id:"ocr-entry-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scanScoresheet")})}),r.jsx("button",{type:"button",onClick:d,className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":l("common.close"),children:r.jsx(ue,{className:"w-5 h-5","aria-hidden":"true"})})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[j==="intro"&&r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",children:[r.jsx(Ke,{className:"w-16 h-16 text-primary-400 dark:text-primary-500 mb-4","aria-hidden":"true"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:l("validation.ocr.scanScoresheet")}),r.jsx("p",{className:"text-center text-gray-600 dark:text-gray-300 max-w-md mb-6",children:l("validation.ocr.scoresheetType.title")}),r.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-sm mb-6",children:[r.jsxs("button",{type:"button",onClick:()=>oe("electronic"),className:"w-full flex items-start gap-4 p-4 bg-white dark:bg-gray-800 border-2 border-primary-500 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors text-left",children:[r.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-primary-100 dark:bg-primary-900/30",children:r.jsx(Je,{className:"w-6 h-6 text-primary-600 dark:text-primary-400","aria-hidden":"true"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("span",{className:"block text-base font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scoresheetType.electronic")}),r.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:l("validation.ocr.scoresheetType.electronicDescription")})]})]}),r.jsxs("button",{type:"button",onClick:()=>oe("manuscript"),className:"w-full flex items-start gap-4 p-4 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary-300 dark:hover:border-primary-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[r.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-700",children:r.jsx(Cr,{className:"w-6 h-6 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("span",{className:"block text-base font-semibold text-gray-900 dark:text-white",children:l("validation.ocr.scoresheetType.manuscript")}),r.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:l("validation.ocr.scoresheetType.manuscriptDescription")})]})]})]}),r.jsxs("button",{type:"button",onClick:c,className:"flex items-center justify-center gap-2 px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[r.jsx(Mr,{className:"w-4 h-4","aria-hidden":"true"}),l("tour.actions.skip")]})]}),j==="processing"&&r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",role:"status","aria-live":"polite",children:[r.jsx(Me,{size:"lg",className:"mb-6"}),r.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:l("validation.ocr.processing")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:f?.status??l("validation.ocr.processingDescription")}),f&&f.progress>0&&r.jsx("div",{className:"w-64 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mt-6 overflow-hidden",children:r.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all duration-300",style:{width:`${f.progress}%`}})})]}),j==="results"&&r.jsxs("div",{className:"max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center gap-2 text-success-600 dark:text-success-400 mb-4",children:[r.jsx(et,{className:"w-6 h-6","aria-hidden":"true"}),r.jsx("span",{className:"text-lg font-medium",children:l("validation.ocr.scanComplete")})]}),ae>0&&r.jsx("div",{className:"mb-4 p-3 bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg",children:r.jsxs("p",{className:"text-sm text-warning-700 dark:text-warning-400",children:[ae," discrepancies found"]})}),k&&r.jsxs("div",{className:"mb-6",children:[r.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:[k.teamName,k.ocrTeamName&&k.ocrTeamName!==k.teamName&&r.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(OCR: ",k.ocrTeamName,")"]})]}),r.jsx(ze,{title:l("validation.ocr.players"),count:k.playerResults.length,discrepancies:W(k.playerResults),expanded:J.has("home-players"),onToggle:()=>se("home-players"),sectionId:"home-players",children:r.jsx($e,{results:k.playerResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})}),k.coachResults.length>0&&r.jsx(ze,{title:l("validation.ocr.coaches"),count:k.coachResults.length,discrepancies:W(k.coachResults),expanded:J.has("home-coaches"),onToggle:()=>se("home-coaches"),sectionId:"home-coaches",children:r.jsx($e,{results:k.coachResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})})]}),_&&r.jsxs("div",{className:"mb-6",children:[r.jsxs("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:[_.teamName,_.ocrTeamName&&_.ocrTeamName!==_.teamName&&r.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(OCR: ",_.ocrTeamName,")"]})]}),r.jsx(ze,{title:l("validation.ocr.players"),count:_.playerResults.length,discrepancies:W(_.playerResults),expanded:J.has("away-players"),onToggle:()=>se("away-players"),sectionId:"away-players",children:r.jsx($e,{results:_.playerResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})}),_.coachResults.length>0&&r.jsx(ze,{title:l("validation.ocr.coaches"),count:_.coachResults.length,discrepancies:W(_.coachResults),expanded:J.has("away-coaches"),onToggle:()=>se("away-coaches"),sectionId:"away-coaches",children:r.jsx($e,{results:_.coachResults,selectedPlayerIds:new Set,onTogglePlayer:()=>{},readOnly:!0})})]}),H&&r.jsx(hc,{data:H,ocrResult:P,imageUrl:K,expanded:J.has("raw-ocr-data"),onToggle:()=>se("raw-ocr-data")})]}),j==="error"&&r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",role:"alert",children:[r.jsx(Te,{className:"w-16 h-16 text-danger-500 mb-6","aria-hidden":"true"}),r.jsx("p",{className:"text-lg font-medium text-danger-700 dark:text-danger-400 mb-2",children:l("validation.ocr.scanFailed")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center max-w-md mb-6",children:x?.message??l("validation.ocr.errors.processingFailed")}),r.jsxs("button",{type:"button",onClick:be,className:"flex items-center gap-2 px-6 py-3 text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors font-medium",children:[r.jsx(Xs,{className:"w-5 h-5","aria-hidden":"true"}),l("validation.ocr.retryCapture")]})]})]}),j==="results"&&r.jsxs("div",{className:"flex gap-3 px-4 py-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{type:"button",onClick:be,className:"flex-1 px-4 py-3 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:l("validation.ocr.retryCapture")}),r.jsx("button",{type:"button",onClick:u,className:"flex-1 px-4 py-3 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors",children:l("validation.ocr.continueToValidation")})]}),r.jsx(ui,{isOpen:w,scoresheetType:N,onClose:()=>{b(!1),j==="capture"&&C("intro")},onImageSelected:ye}),y.type&&r.jsx(bl,{isOpen:y.isOpen,type:y.type,onClose:S})]})}function ze({title:t,count:e,discrepancies:s,expanded:a,onToggle:n,sectionId:i,children:o}){const c=a?Et:kt;return r.jsxs("div",{className:"mb-3",children:[r.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-expanded":a,"aria-controls":i,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(c,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),r.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",e,")"]})]}),s>0&&r.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-400",children:[s," discrepancies"]})]}),a&&r.jsx("div",{id:i,className:"mt-2 pl-6",children:o})]})}function hc({data:t,ocrResult:e,imageUrl:s,expanded:a,onToggle:n}){const{t:i}=D(),o=a?Et:kt;return r.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between py-2 px-3 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-expanded":a,"aria-controls":"raw-ocr-data",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(o,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("validation.ocr.rawData.title")})]})}),a&&r.jsxs("div",{id:"raw-ocr-data",className:"mt-3 space-y-4",children:[s&&e&&r.jsx(fc,{imageUrl:s,ocrResult:e,parsedData:t}),r.jsx($s,{team:t.teamA,label:i("validation.ocr.rawData.teamA")}),r.jsx($s,{team:t.teamB,label:i("validation.ocr.rawData.teamB")})]})]})}function $s({team:t,label:e}){const{t:s}=D();return r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[r.jsxs("div",{className:"mb-2",children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:e}),r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"-"})]}),t.players.length>0&&r.jsxs("div",{className:"mb-3",children:[r.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[s("validation.ocr.rawData.players")," (",t.players.length,")"]}),r.jsx("div",{className:"mt-1 overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[r.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.shirtNumber")}),r.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.name")}),r.jsx("th",{scope:"col",className:"text-left font-medium",children:s("validation.ocr.rawData.licenseStatus")})]})}),r.jsx("tbody",{children:t.players.map(a=>r.jsxs("tr",{className:"text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("td",{className:"pr-2 py-0.5",children:a.shirtNumber??"-"}),r.jsx("td",{className:"pr-2 py-0.5 font-mono",children:a.rawName||a.displayName}),r.jsx("td",{className:"py-0.5",children:a.licenseStatus||"-"})]},`${a.shirtNumber}-${a.rawName||a.displayName}`))})]})})]}),t.officials.length>0&&r.jsxs("div",{children:[r.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[s("validation.ocr.rawData.officials")," (",t.officials.length,")"]}),r.jsx("div",{className:"mt-1 overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[r.jsx("th",{scope:"col",className:"text-left pr-2 font-medium",children:s("validation.ocr.rawData.role")}),r.jsx("th",{scope:"col",className:"text-left font-medium",children:s("validation.ocr.rawData.name")})]})}),r.jsx("tbody",{children:t.officials.map(a=>r.jsxs("tr",{className:"text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("td",{className:"pr-2 py-0.5",children:a.role}),r.jsx("td",{className:"py-0.5 font-mono",children:a.rawName||a.displayName})]},`${a.role}-${a.rawName||a.displayName}`))})]})})]})]})}function fc({imageUrl:t,ocrResult:e,parsedData:s}){const{t:a}=D(),n=m.useRef(null),[i,o]=m.useState(null),[c,u]=m.useState(0),[d,l]=m.useState(!0),h=m.useMemo(()=>{const p=new Set;return[...s.teamA.players,...s.teamB.players].forEach(y=>{y.rawName&&p.add(y.rawName.toLowerCase()),y.displayName&&p.add(y.displayName.toLowerCase()),y.lastName&&p.add(y.lastName.toLowerCase())}),[...s.teamA.officials,...s.teamB.officials].forEach(y=>{y.rawName&&p.add(y.rawName.toLowerCase()),y.displayName&&p.add(y.displayName.toLowerCase()),y.lastName&&p.add(y.lastName.toLowerCase())}),p},[s]),f=m.useCallback(p=>{const y=p.toLowerCase();return h.has(y)},[h]),x=m.useCallback(p=>{const y=p.currentTarget;o({width:y.naturalWidth,height:y.naturalHeight}),n.current&&u(n.current.offsetWidth)},[]),g=m.useMemo(()=>!i||c===0?1:c/i.width,[i,c]);return r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ys,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"}),r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:a("validation.ocr.rawData.imageOverlay")})]}),e.hasPreciseBoundingBoxes&&r.jsx("button",{type:"button",onClick:()=>l(!d),className:"text-xs px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:a(d?"validation.ocr.rawData.hideOverlay":"validation.ocr.rawData.showOverlay")})]}),e.hasPreciseBoundingBoxes&&r.jsxs("div",{className:"flex items-center gap-4 mb-2 text-xs",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-3 h-3 rounded border-2 border-success-500 bg-success-500/20"}),r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a("validation.ocr.rawData.matchedWords")})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-3 h-3 rounded border-2 border-gray-400 bg-gray-400/20"}),r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a("validation.ocr.rawData.otherWords")})]})]}),r.jsxs("div",{ref:n,className:"relative overflow-auto max-h-96 rounded border border-gray-200 dark:border-gray-700",children:[r.jsx("img",{src:t,alt:a("validation.ocr.rawData.capturedImage"),onLoad:x,className:"w-full h-auto"}),e.hasPreciseBoundingBoxes&&d&&i&&r.jsx("svg",{className:"absolute top-0 left-0 pointer-events-none",style:{width:i.width*g,height:i.height*g},viewBox:`0 0 ${i.width} ${i.height}`,preserveAspectRatio:"none",children:e.words.map(p=>{const y=f(p.text);return r.jsx("g",{children:r.jsx("rect",{x:p.bbox.x0,y:p.bbox.y0,width:p.bbox.x1-p.bbox.x0,height:p.bbox.y1-p.bbox.y0,fill:y?"rgba(34, 197, 94, 0.2)":"rgba(156, 163, 175, 0.15)",stroke:y?"#22c55e":"#9ca3af",strokeWidth:y?2:1,rx:2})},`${p.bbox.x0}-${p.bbox.y0}-${p.bbox.x1}-${p.bbox.y1}`)})})]}),r.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.words.length," ",a("validation.ocr.rawData.wordsDetected")," â€¢ ",e.words.filter(p=>f(p.text)).length," ",a("validation.ocr.rawData.wordsMatched")]}),!e.hasPreciseBoundingBoxes&&e.fullText&&r.jsxs("div",{className:"mt-3",children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:a("validation.ocr.rawData.rawText")})}),r.jsx("pre",{className:"text-xs text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-900 p-3 rounded border border-gray-200 dark:border-gray-700 overflow-auto max-h-64 whitespace-pre-wrap break-words",children:e.fullText})]})]})}function zs(t){if(!t)return[];const e=[];for(const s of t){const a=s.__identity,n=s.indoorPlayer?.person,i=n?.displayName??[n?.firstName,n?.lastName].filter(Boolean).join(" ");!a||!i||e.push({id:a,displayName:i,firstName:n?.firstName,lastName:n?.lastName})}return e.sort((s,a)=>s.displayName.localeCompare(a.displayName))}function Hs(t){if(!t)return[];const e=[],s=t.coachPerson;s?.__identity&&s.displayName&&e.push({id:s.__identity,displayName:s.displayName,firstName:s.firstName,lastName:s.lastName,role:"head"});const a=t.firstAssistantCoachPerson;a?.__identity&&a.displayName&&e.push({id:a.__identity,displayName:a.displayName,firstName:a.firstName,lastName:a.lastName,role:"firstAssistant"});const n=t.secondAssistantCoachPerson;return n?.__identity&&n.displayName&&e.push({id:n.__identity,displayName:n.displayName,firstName:n.firstName,lastName:n.lastName,role:"secondAssistant"}),e}function pc({assignment:t,isOpen:e,onClose:s}){const{t:a,tInterpolate:n}=D(),i=He(I=>I.isOCREnabled),[o,c]=m.useState(null),u=t.__identity,d=o===u,l=Kr({assignment:t,isOpen:e,onClose:s}),{homeTeam:h,awayTeam:f}=yt(t),x="validate-game-title",g=`${h} ${a("common.vs")} ${f}`,p=m.useMemo(()=>zs(l.homeNominationList?.indoorPlayerNominations),[l.homeNominationList]),y=m.useMemo(()=>zs(l.awayNominationList?.indoorPlayerNominations),[l.awayNominationList]),R=m.useMemo(()=>Hs(l.homeNominationList),[l.homeNominationList]),S=m.useMemo(()=>Hs(l.awayNominationList),[l.awayNominationList]),j=m.useCallback(()=>{c(u)},[u]),C=m.useCallback(()=>{c(u)},[u]),w=m.useCallback(()=>{c(u)},[u]),b=e&&i&&!d&&!l.isLoadingGameDetails,N={isFirstStep:l.isFirstStep,isLastStep:l.isLastStep},v={isFinalizing:l.isFinalizing,isLoadingGameDetails:l.isLoadingGameDetails,hasGameDetailsError:!!l.gameDetailsError,canMarkCurrentStepDone:l.canMarkCurrentStepDone,allPreviousRequiredStepsDone:l.allPreviousRequiredStepsDone,currentStepIsOptional:l.currentStep.isOptional??!1},k={isLoading:l.isLoadingGameDetails,error:l.gameDetailsError},$={isValidated:l.isValidated,isInSafeMode:l.isInSafeMode,validatedInfo:l.validatedInfo,pendingScorer:l.pendingScorer,scoresheetNotRequired:l.scoresheetNotRequired,state:l.validationState,homeNominationList:l.homeNominationList,awayNominationList:l.awayNominationList},_={setHomeRosterModifications:l.setHomeRosterModifications,setAwayRosterModifications:l.setAwayRosterModifications,setScorer:l.setScorer,setScoresheet:l.setScoresheet,onAddPlayerSheetOpenChange:l.handleAddPlayerSheetOpenChange,onClose:s};return r.jsxs(r.Fragment,{children:[l.successToast&&r.jsx(Pn,{message:l.successToast}),r.jsxs(Ct,{isOpen:e,onClose:l.attemptClose,titleId:x,size:"lg",isLoading:l.showUnsavedDialog||l.showRosterWarningDialog,children:[r.jsx(At,{title:a("assignments.validateGame"),titleId:x,subtitle:g,onClose:l.attemptClose}),l.isValidated&&l.validatedInfo&&r.jsxs("div",{role:"status",className:"mb-4 p-3 bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 rounded-lg",children:[r.jsx("p",{className:"text-sm font-medium text-success-700 dark:text-success-400",children:a("validation.wizard.alreadyValidated")}),r.jsx("p",{className:"text-xs text-success-600 dark:text-success-500 mt-1",children:n("validation.wizard.validatedBy",{scorer:l.validatedInfo.scorerName})})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx(Zr,{steps:l.wizardSteps,currentStepIndex:l.currentStepIndex,stepsMarkedDone:l.stepsMarkedDone,clickable:!l.isFinalizing,onStepClick:l.goToStep}),r.jsx("p",{className:"text-center text-xs text-text-muted dark:text-text-muted-dark mt-2",children:n("validation.wizard.stepOf",{current:l.currentStepIndex+1,total:l.totalSteps})})]}),r.jsx(qr,{currentStep:l.currentStepIndex,totalSteps:l.totalSteps,onSwipeNext:l.goNext,onSwipePrevious:l.goBack,swipeEnabled:l.isSwipeEnabled,children:r.jsx("div",{className:"max-h-80 overflow-y-auto",children:r.jsx(Ln,{currentStepId:l.currentStepId,assignment:t,loading:k,validation:$,handlers:_})})}),l.saveError&&r.jsxs("div",{role:"alert",className:"mt-4 p-3 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg",children:[r.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-400",children:l.saveError}),r.jsxs("div",{className:"mt-2 flex gap-3",children:[r.jsx("button",{type:"button",onClick:()=>l.handleFinish(),className:"text-sm font-medium text-danger-600 dark:text-danger-400 hover:text-danger-700 dark:hover:text-danger-300",children:a("common.retry")}),r.jsx("button",{type:"button",onClick:l.handleDiscardAndClose,className:"text-sm font-medium text-text-muted dark:text-text-muted-dark hover:text-text-secondary dark:hover:text-text-secondary-dark",children:a("validation.state.discardAndClose")})]})]}),l.isSaving&&r.jsx("div",{className:"mt-4 text-center text-sm text-text-muted dark:text-text-muted-dark",children:a("validation.wizard.saving")}),r.jsx("div",{className:"flex justify-between gap-3 pt-4 border-t border-border-default dark:border-border-default-dark mt-4",children:l.isValidated?r.jsx(Bn,{navigation:N,onBack:l.goBack,onNext:l.goNext,onClose:s}):l.isInSafeMode?r.jsx(Dn,{navigation:N,onBack:l.goBack,onNext:l.goNext,onClose:s}):r.jsx(Fn,{navigation:N,state:v,onAttemptClose:l.attemptClose,onBack:l.goBack,onValidateAndNext:l.handleValidateAndNext,onFinish:l.handleFinish})})]}),r.jsx(Rn,{isOpen:l.showUnsavedDialog,onSaveAndClose:l.handleSaveAndClose,onDiscard:l.handleDiscardAndClose,onCancel:l.handleCancelClose,isSaving:l.isSaving}),r.jsx(In,{isOpen:l.showRosterWarningDialog,rosterValidation:l.rosterValidation,homeTeamName:h,awayTeamName:f,onGoBack:l.handleRosterWarningGoBack,onProceedAnyway:l.handleRosterWarningProceed,isProceedingAnyway:l.isFinalizing}),r.jsx(Tn,{isOpen:l.showSafeValidationComplete,onClose:l.handleSafeValidationCompleteClose}),r.jsx(mc,{isOpen:b,homeTeamName:h,awayTeamName:f,homeRosterPlayers:p,awayRosterPlayers:y,homeRosterCoaches:R,awayRosterCoaches:S,onSkip:j,onComplete:C,onClose:w})]})}const xc=m.memo(pc),jc=Object.freeze(Object.defineProperty({__proto__:null,ValidateGameModal:xc},Symbol.toStringTag,{value:"Module"}));export{Ke as C,ui as O,$e as P,jc as V,et as a,Fe as c,tl as u};
